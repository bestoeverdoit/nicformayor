YUI.add("mail-ui-onboarding",function(e){var t=e.common.Utils,n={},r,i=NeoConfig.browser,s,o,u,a,f,l;e.namespace("mail.ui.Onboarding"),r=function(){function r(){var t=[],n=[],r=[],i=[];e.on("onboard:tip",function(s){var o=s.node;if(!o)return;var u=s.template,a=s.fn,f=s.dir||"left",l=s.offset,c=o.getXY(),h=[0,0],p={},d,v,m=s.parent||e.one("body"),g=s.parent?m.getXY():[0,0],y,b,w,E=s.classNames,S=s.type,x=s.id;d=e.Node.create("<div class='onboardtip'></div>"),m.appendChild(d),l||(l=[0,0]),NeoConfig.isRTL&&(f=f==="left"?"right":"left"),f==="right"?m===e.one("body")?c[0]=g[0]+e.one("html").get("offsetWidth")-(c[0]+o.get("offsetWidth")):c[0]=g[0]+m.get("offsetWidth")-(c[0]+o.get("offsetWidth")):c[0]=c[0]-g[0],c[1]=c[1]-g[1],h[0]=c[0]+l[0],h[1]=c[1]+l[1],d.hide(),d.set("innerHTML",u),S!=="takeover"&&(p[f]=h[0],p.top=h[1]),d.setStyles(p),x&&d.set("id",x);if(E){w=E.length;for(b=0;b<w;b++)d.addClass(E[b])}s.evt&&(v=s.evt,i.push(e.one(v.parent).delegate(v.actionType,v.handler,v.target))),d.show(),y=d.on("click",a),s.isPersistentTooltip===!0?(r.push(d),i.push(y)):(n.push(y),t.push(d))}),e.on("onboard:tipclose",function(){e.Array.each(t,function(e){e.remove()}),t=[],e.Array.each(n,function(e){e&&e.detach()})}),e.on("onboard:tipclosePersistent",function(t){var n=t&&t.fade||!1;e.Array.each(r,function(e){e.getDOMNode()&&e.hide(n,null,function(){this.remove()})}),r=[],e.Array.each(i,function(e){e&&e.detach()})})}function c(){var t=e.one(".onboardtip"),n;return s=window.innerWidth,o=window.innerHeight,t?(n=t.getDOMNode().getBoundingClientRect(),u=n.left,a=n.top,l=n.width,f=n.height,n.right<=s&&u>=0&&n.bottom<=o&&a>=0):!1}function h(){var t=e.one(".onboardtip"),n,r=12,i=u+l,c="left",h,p,d;NeoConfig.isRTL&&(c="right",u<0&&(i=Math.abs(u-s))),a+f>o&&(p=a+f-o,n=parseInt(t.getDOMNode().style.top,10),d=n-p-r+"px",t.setStyle("top",d)),i>s&&(p=i-s,h=parseInt(t.getDOMNode().style[c],10),d=h-p+"px",t.setStyle(c,d))}function p(t,n,r){e.fire("onboard:tipclosePersistent",{name:t}),e.fire("callout:action",{name:t,action:"close"}),n&&n(r)}function d(n){var r=n.name,s=n.offset,o=n.classNames||[],u=n.type,a=["scout_css"],f=["bdText","btnPrimaryText","btnCancelText","linkText","imgSrc","showArrows"],l,d,v,m,g,y;o.push("scout-"+r);if(n.beforeShow&&!n.beforeShow())return;t.features.enabled("scoutStyleVariation")&&(t.settings.value("scoutStyleCallouts").indexOf(n.name)>-1&&o.push("scout-style-var"),t.features.enabled("scoutStyleVariationT01")?a.push("scout-var-1_css"):t.features.enabled("scoutStyleVariationT02")?a.push("scout-var-2_css"):a.push("scout-var-3_css")),l=f.reduce(function(e,t){return e||t in n},!1),l||o.push("no-body"),e.use(a.concat(n.template?[]:["minty_module_offscreen_bin_callout_default"]),function(e){var a={hdText:n.hdText,showHeader:!!n.hdText,bdText:n.bdText,showBody:!!n.bdText,btnPrimaryText:n.btnPrimaryText,showPrimary:!!n.btnPrimaryText,btnCancelText:n.btnCancelText,showCancel:!!n.btnCancelText,showActions:!!n.btnPrimaryText||!!n.btnCancelText,pointer:n.pointer,showPointer:!!n.pointer,linkText:n.linkText||n.inlineLinkText,showLink:!!n.linkText,showInlineLink:!!n.inlineLinkText,inlineLinkHref:n.inlineLinkText&&typeof n.onLinkClick=="string",linkHref:typeof n.onLinkClick=="string",onLinkClick:n.onLinkClick,showArrows:n.showArrows,arrowLeftText:n.arrowLeftText||strings.str_back,arrowRightText:n.arrowRightText||strings.str_next,showLinkFooter:n.showArrows||!!n.linkText,imgSrc:n.imgSrc,showImg:!!n.imgSrc,imgClass:"callout-img-"+(n.imgPlace||"default")};n.templateParams&&(a=e.mix(a,n.templateParams)),e.fire("onboard:tipclosePersistent"),v=n.template||e.ui.Templates.minty_module_offscreen_bin_callout_default,m=t.ezSub(v.base,a,v),g=function(t){var s=t.target,o=s.get("parentNode"),u=function(t){var s=Math.floor(new Date/1e3),o={agent:i,segment:NeoConfig.webEngScore},u={action:"scout_cue_"+r+"_"+t};r==="iris"&&(u.append={eventTs:s},o.ymreqid=s.toString()),(!n.dontCloseOnActions||t==="close")&&p(r,n.onUnmount,t),e.fire("util:ymstats",{name:"scout_cue_"+r+"_"+t,tags:o,include:{bucket:!0}}),e.use("scout-ult",function(e){e.fire("mt:click",u)})};s.hasClass("close")?(u("close"),n.onClose&&n.onClose(t)):s.hasClass("callout-btn-primary")?(u("success"),n.onSuccess&&n.onSuccess(t)):s.hasClass("callout-btn-cancel")?(u("cancel"),n.onCancel&&n.onCancel(t)):o&&o.hasClass("callout-arrow-left")?(u("back"),n.onBack&&n.onBack(t)):o&&o.hasClass("callout-arrow-right")?(u("next"),n.onNext&&n.onNext(t)):s.hasClass("callout-link")&&(u("link"),typeof n.onLinkClick=="function"&&n.onLinkClick(t))},n.pointer&&(o.push("callout-pointer"),o.push("arrow-"+n.pointer)),d=typeof n.node=="string"?e.one(n.node):n.node;if(!d||!d._node||d.getAttribute("hidden")==="true"||d.getStyle("visibility")==="hidden"||d.getStyle("display")==="none")return;e.fire("onboard:tip",{node:d,parent:n.parent,template:m,isPersistentTooltip:!0,offset:s,fn:g,classNames:o,type:u});if(n.checkInView&&!c()){e.fire("onboard:tipclosePersistent");return}e.fire("callout:action",{name:r,action:"shown",keyValue:n.keyVal!==undefined?n.keyVal:Date.now()}),n.onShow&&n.onShow(),c()||h(),y=e.one(".callout-default"),y&&y.focus(),e.fire("util:ymstats",{name:"scout_cue_"+r+"_invoke",tags:{agent:i,segment:NeoConfig.webEngScore},include:{bucket:!0}})})}function v(t,r){var s=t.name;if(!s)return;n[s]&&n[s].detach(),t.forceRender&&e.fire("callout:action",{action:"closeAllCallouts"}),n[s]=e.on("initCallout:"+s,function(){d(t),e.once("closeCallout:"+s,function(){p(s,t.onUnmount),t.onTimeout&&t.onTimeout(),e.fire("util:ymstats",{name:"scout_cue_"+s+"_timeout",tags:{agent:i,segment:NeoConfig.webEngScore},include:{bucket:!0}})},this)}),(r||t.forceRender||t.fireInit)&&e.fire("callout:action",{name:s,action:"init"})}e.mix(this,{showDefaultOnboarding:d,registerDefaultOnboarding:v,closeDefaultOnboarding:p,setupOnBoardToolTip:r})},e.mail.ui.Onboarding=new r,e.mail.ui.Onboarding.setupOnBoardToolTip()},"1.0.0",{requires:["common-utils","json-parse","node-event-simulate","onboarding_css"]});
YUI.add("mail-ui-onboarding-configmap",function(e){var t=e.common.Utils,n=172800;e.namespace("mail.ui.onboarding").configMap={adFreeMailCallout:{module:"mail-ui-adfree-pricing",beforeDelay:0,afterDelay:0,closeTimeout:30},winAppOnboarding:{module:"mail-ui-windows-helper",beforeDelay:30,afterDelay:n,closeTimeout:120},winAppContactSync:{module:"mail-ui-windows-helper",beforeDelay:120,afterDelay:3600,closeTimeout:120},imapInMohawkOb:{beforeDelay:30,afterDelay:900,closeTimeout:-1},enhancrCallout1:{module:"mail-ui-onboarding-enhancr",beforeDelay:0,closeTimeout:60},enhancrCallout2:{module:"mail-ui-onboarding-enhancr",beforeDelay:0,closeTimeout:60},enhancrSettings:{module:"mail-ui-onboarding-enhancr",beforeDelay:10,afterDelay:0},enhancrSettingsDeclined:{module:"mail-ui-onboarding-enhancr",beforeDelay:0,afterDelay:0},mobileUpsellOnSignout:{beforeDelay:0,afterDelay:n,closeTimeout:120},mobileUpsellMohawkOb:{beforeDelay:0,afterDelay:3600,closeTimeout:-1},mothersDayMohawk:{module:"mail-ui-onboarding-mday-mohawk",beforeDelay:0,afterDelay:3600,closeTimeout:-1},mDayAutocompose:{module:"mail-ui-onboarding-mday-autocompose",beforeDelay:0},mdayReminder:{module:"mail-ui-onboarding-mday-final",beforeDelay:0,afterDelay:1800,closeTimeout:120},mdayFinal:{module:"mail-ui-onboarding-mday-final",beforeDelay:0,afterDelay:1800,closeTimeout:120},imapInPreV2:{module:"mail-ui-onboarding-imap-in",beforeDelay:0,closeTimeout:120,afterDelay:n},verifyEmailCallout:{module:"mail-ui-onboarding-security-upsell",beforeDelay:0,afterDelay:30},updateEmailCallout:{module:"mail-ui-onboarding-security-upsell",beforeDelay:0,afterDelay:30},winAppStoreOnboarding:{module:"mail-ui-onboarding-winapp-store",beforeDelay:120,closeTimeout:-1},imapInPost:{predicate:function(){var e,t,n;if(NeoConfig.accounts&&NeoConfig.accounts.imapInAccounts){e=NeoConfig.accounts.imapInAccounts,t=e.length;for(n=0;n<t;n++)if(e[n].status==="ENABLED")return!0}return!1},module:"mail-ui-onboarding-imap-in",closeTimeout:60,beforeDelay:0},imapInUpsellSendOnlyNav:{module:"mail-ui-onboarding-imap-in-upsell",closeTimeout:-1,beforeDelay:0},imapInUpsellAltNav:{module:"mail-ui-onboarding-imap-in-upsell",closeTimeout:-1,beforeDelay:0,afterDelay:10},imapInUpsellXobniNav:{module:"mail-ui-onboarding-imap-in-upsell",closeTimeout:-1,beforeDelay:0,afterDelay:10},imapInUpsellSendOnlySetting:{beforeDelay:0,afterDelay:0,closeTimeout:0},imapInUpsellAltSetting:{beforeDelay:0,afterDelay:300,closeTimeout:300},imapInUpsellXobniSetting:{beforeDelay:0,afterDelay:300,closeTimeout:300},archiveOnboarding:{beforeDelay:0},restoreInboxOnboarding:{beforeDelay:0},contactImportReonboarding:{closeTimeout:120,beforeDelay:0,afterDelay:n},compromisedAccountOnboarding:{module:"mail-ui-onboarding-compromised-account",beforeDelay:0,closeTimeout:1800},valentinesMenu:{beforeDelay:10,afterDelay:3},valentinesStationery:{beforeDelay:0,afterDelay:3},valentinesComposeAssist:{beforeDelay:0,afterDelay:3},mailWebsearchOnboarding:{module:"mail-ui-onboarding-web-search",closeTimeout:t.features.enabled("webSearchPersistentOnboarding",!1)?-1:30,beforeDelay:10},folderSearchOnboarding:{beforeDelay:0},smartviewsOnboarding:{beforeDelay:0},desktopNotificationsOnboarding:{module:"mail-ui-onboarding-desktop-notification",beforeDelay:0},notificationsOnSent:{beforeDelay:0,closeTimeout:60},notificationsOnSentWithImage:{beforeDelay:0,closeTimeout:60},composeAssistOnboarding:{module:"mail-ui-richcompose-view",beforeDelay:0,closeTimeout:60},composeAssistSpotlight:{module:"mail-ui-onboarding-compose-assist-spotlight",beforeDelay:0,closeTimeout:60},widerMailExtOnboarding:{beforeDelay:5,afterDelay:900},newTabExtOnboarding:{beforeDelay:5},restart:{module:"mail-ui-onboarding-restart",beforeDelay:0,closeTimeout:60},restartError:{beforeDelay:0,afterDelay:0,closeTimeout:120},restartOutro:{beforeDelay:0,afterDelay:30},restartFlipped:{module:"mail-ui-onboarding-restart",beforeDelay:0,afterDelay:0,closeTimeout:120},tripodInTray:{beforeDelay:0,afterDelay:0,closeTimeout:300},pensiveCalloutOnLaunch:{beforeDelay:0,afterDelay:0,closeTimeout:300},pensiveCalloutOnComposeAssist:{beforeDelay:0,afterDelay:0,closeTimeout:300},mobileUpsell:{module:"mail-ui-onboarding-mobile-upsell",beforeDelay:0,closeTimeout:60},qrCode:{module:"mail-ui-onboarding-mobile-qrcode",closeTimeout:120},convTutorial:{beforeDelay:2},mobileUpsellOnSent:{module:"mail-ui-onboarding-mobile-upsell-on-sent",beforeDelay:0,closeTimeout:60},mobileUpsellWithPhone:{module:"mail-ui-onboarding-mobile-upsell-with-phone",predicate:function(){var e=/^(1-)?\d{10}$/,t=NeoConfig.recoveryPhone?NeoConfig.recoveryPhone.match(e):!1;return t&&NeoConfig.isRecentMobileUser!==1},beforeDelay:0,closeTimeout:60}}},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-onboarding-calloutlist-model",function(e){function i(e){return r[e]?r[e].state==="skipped":!0}function s(e){return r[e]?r[e].state==="shown":!0}function o(){return t.isLaunchOnboardingShown()}function u(e){return r[e]&&r[e].pages.indexOf("launch")>=0}function a(e){return r[e]?r[e].state==="ready":!1}function f(e){return r[e]?!!r[e].force:!1}function l(e){r[e]&&!s(e)&&(r[e].state="skipped")}function c(e){r[e]&&!s(e)&&(r[e].force=!0)}function h(e){r[e]&&(r[e].state="shown",r[e].pages.indexOf("launch")>=0&&t.setLaunchOnboardingShown(1))}function p(e){r[e]&&!s(e)&&(r[e].state="ready")}function d(t){return e.Lang.isObject(r[t])?r[t]:null}function v(e){var t,r,u;if(e==="launch"&&o())return null;if(!e||!n[e])return null;u=n[e];if(u){for(r=0;r<u.length;r++){t=u[r];if(t&&!s(t)&&!i(t)&&(a(t)||f(t)))return t}for(r=0;r<u.length;r++){t=u[r];if(t&&!s(t)&&!i(t))return t}}return e!=="default"?v("default"):null}function m(e){r[e]&&(r[e].state="")}function g(e){var t,r,s;if(!e||!n[e])return;s=n[e];for(t=0;t<s.length;t++)r=s[t],r&&i(r)&&m(r)}function y(){var i=e.Lang.isObject(NeoConfig.onboardingList)?t.wcopy(NeoConfig.onboardingList):{},s,o;for(s in i)if(i.hasOwnProperty(s)){n[s]=[];for(o in i[s])i[s].hasOwnProperty(o)&&(n[s][i[s][o].order]=o,r[o]?r[o].pages.push(s):(r[o]=i[s][o],r[o].pages=[s],r[o].state=""))}}var t=e.common.Utils,n={},r={};e.namespace("mail.ui.onboarding").calloutListModel={isSkipped:i,isForced:f,isShown:s,isReady:a,isLaunchCallout:u,isLaunchCalloutShown:o,markAsReady:p,markAsShown:h,markAsSkipped:l,markAsForced:c,getCalloutObj:d,resetCallout:m,resetAllSkippedCallouts:g,nextEligibleCallout:v},y()},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-onboarding-dispatcher",function(e){var t,n=e.common.Utils,r=e.mail.persist.MetaData,i=1e3,s=n.settings.value("beforeCalloutDelay",43200),o=n.settings.value("afterCalloutDelay",43200),u=n.settings.value("closeCalloutDelay",30),a=n.settings.value("skipCalloutDelay",30),f={module:"mail-common-utils-features",beforeDelay:s,afterDelay:o,closeTimeout:u,predicate:function(){return!0}},l=e.mail.ui.onboarding.calloutListModel,c="",h="",p="",d=n.features.enabled("logScout"),v=!1,m="neo.pref.onboard.lastCalloutTs",g=e.Lang.isNumber(parseInt(r.get(m),10))?parseInt(r.get(m),10):0,y="neo.pref.onboard.nextCalloutTs",b=e.Lang.isNumber(parseInt(r.get(y),10))?parseInt(r.get(y),10):Date.now(),w=Date.now(),E=null,S=null,x=null;t=function(){function t(){var t={messagepane:"read",convpane:"read",messagelist:"list",convlist:"list",author:"compose",search:"search"},n=e.mail.Tabs.getActiveTab(),r=n&&n.widget,i=r&&r.type;return t[i]?t[i]:"default"}function s(){return NeoConfig.bandwidthMode==="broadband"?5*i:NeoConfig.bandwidthMode==="cable"?6*i:7*i}function o(t,n){var r=e.mail.ui.onboarding.configMap[t];return r&&r[n]!==undefined?r[n]:f[n]?f[n]:null}function u(t,n){return e.Lang.isNumber(t)||(t=0),e.Lang.isNumber(n)||(n=0),Math.round(Math.max(t,n))}function T(t,n,r){r=r?1:0,e.fire("util:ymstats",{name:"scout_dispatcher",tags:{callout:t,action:n,isSystem:r,segment:NeoConfig.webEngScore},include:{bucket:!0}})}function N(e){return e&&e.cancel&&e.cancel(),null}function C(t){x=N(x);if(l.isShown(t)){D();return}if(NeoConfig.isRegOnboardingEnabled)return;p=t;if(v){e.once("net:resumed",function(){v=!1,C(t)});return}if(!NeoGV.isWindowFocused){e.one("window").once("focus",function(){C(t)});return}l.isForced(t)||o(t,"predicate")()?e.use(o(t,"module"),function(e){A(t),e.fire("initCallout:"+t,{calloutName:t,isForced:l.isForced(t)})}):(k(t),e.log("Predicate is false"+o(t,"predicate"),"info","mail-ui-onboarding-dispatcher"))}function k(e){x=N(x),S=N(S),l.markAsSkipped(e),D()}function L(t){var n=o(c,"afterDelay");h=c,x=N(x),S=N(S),E=N(E),M(h)&&!t&&(g=Date.now(),b=g+n*i,O()),t&&(c="",e.fire("closeCallout:"+h)),T(h,"close",t),D()}function A(t){S=N(S),S=e.later(a*i,null,function(){!l.isSkipped(t)&&!l.isShown(t)&&(d&&T(t,"skip",1),k(t))})}function O(){r.set(m,g,!0),r.set(y,b,!0)}function M(e){return o(e,"closeTimeout")===-1}function _(t){var n=o(t,"closeTimeout"),r=o(t,"afterDelay"),s=M(t);E=N(E),s||(E=e.later(n*i,null,function(){c===t&&L(!0)})),g=Date.now()+(s?1800:n)*i,b=g+r*i,O()}function D(n){var r,i;if(NeoConfig.isRegOnboardingEnabled||x)return;n||(n=t()),r=l.nextEligibleCallout(n),p="";if(!r){x=null,n==="launch"&&D();return}i=P(r,n);if(n==="launch"&&i>0){D();return}x=e.later(i,null,function(){d&&T(r,"init",1),C(r)})}function P(e,t){var r,a,f,c=s(),p;return r=o(e,"beforeDelay"),a=g+r*i,f=u(b,a),p=f-Date.now(),n.features.enabled("forceCalloutDelay")?p=n.settings.value("fixCalloutDelay",3)*i:l.isForced(e)?p=0:t==="launch"?p=p<=60*i?0:p:h===""&&(!g||p<=c)&&(Date.now()-w>=c?p=0:p=c-(Date.now()-w)),p}function H(t,n,i){var s={};d&&T(t,"setKey",1),n.keygroup==="udb"?(s[t]=i,s.type="onboarding",e.fire("setUdbKey",s)):n.keygroup==="msdb"&&r.set(n.key,i)}function B(t){var n=t.name,r=l.getCalloutObj(n),i=M(n);if(t.action&&(t.action==="closeAllCallouts"||r))switch(t.action){case"init":if(!l.isShown(n)&&(!l.isLaunchCalloutShown()||!l.isLaunchCallout(n))||t.force){l.markAsReady(n);if(!p||p===n)d&&T(n,"init",0),C(n)}break;case"shown":l.isSkipped(n)||(i?l.markAsForced(n):l.markAsShown(n),c=n,S=N(S),T(n,"shown",0),_(n),t.keyValue&&H(n,r,t.keyValue));break;case"skip":l.isShown(n)||(k(n),d&&T(n,"skip",0));break;case"close":c===n&&(i&&l.markAsShown(n),L(!1),t.keyValue&&H(n,r,t.keyValue));break;case"closeAllCallouts":c&&L(!0);break;case"saveKeyValue":t.keyValue&&H(n,r,t.keyValue);break;default:}else e.log("Missing action property or callout "+n+" not found in NeoConfig.onboardingList object","warn","mail-ui-onboarding-dispatcher")}function j(){x=N(x),l.resetAllSkippedCallouts(t());if(c){L(!0);return}D()}NeoGV.isWindowFocused=!0,e.mail.FoldersView.before("fidChange",function(t){var n=t.prevVal.fid||e.mail.ui.FolderUtils.getInboxFid();n!==t.newVal.fid&&j()},this),e.before("tabChange",j),e.on("callout:action",B),e.on("net:suspended",function(){v=!0}),e.mix(this,{getActivePage:t,getCalloutConfig:o,setNextCalloutTimer:D,setCalloutKey:H})},e.namespace("mail.ui.onboarding").dispatcher=new t},"1.0.0",{requires:["common-ui-tabs-base","mail-common-utils-features","mail-ui-onboarding","mail-ui-onboarding-configmap","mail-ui-onboarding-calloutlist-model","mail-persist-meta-data","mail-ui-foldersview-base","mail-ui-folder-utils"]});
