YUI.add("mail-ui-signature-tweet-view",function(e){"use strict";function f(r){var i=this;r&&n.get("enableTweet")==="on"&&e.mail.common.ConnectedAccounts.getAllSPIDStatus(function(e){var n=e&&e.results,s=t.settings.value("twitter_credstore_spid");n&&n[s]&&!n[s].is_expired&&i._addTweet(r,n[s].external_id)})}var t=e.common.Utils,n=e.mail.persist.MetaData,r=12e4,i="/neo/lastTweet",s=".signature-tweet",o=5e3,u=null,a=0;e.mix(f.prototype,{removeTweet:function(e){if(!e)return;var t=e.one(s);t&&t.remove(!0)},_getHTML:function(n){return t.ezSub(e.ui.Templates._shared_module_compose_signature_tweet.base,{accountHandle:n.handle,profileImgUrl:n.img_url,tweetText:n.text,tweetId:n.id,tweetDate:t.dateFormatter(new Date(n.creation_time),strings.str_tog_dateformat_messagelist_yesyear_l10n),userName:n.name})},_addTweet:function(t,f){var l=this,c;Date.now()-a>=r||!u?e.io(i+"?wssid="+NeoConfig.wssid+"&user_id="+f,{timeout:o,on:{success:function(e,r){var i;c=t.one(s);if(!r||r.status!==200||!r.responseText||!c||n.get("enableTweet")!=="on")return;try{i=JSON.parse(r.responseText)}catch(o){return}if(!i.success){i.hasOwnProperty("newWssid")&&(NeoConfig.wssid=i.newWssid);return}u=l._getHTML(i.tweet),a=Date.now(),c.set("innerHTML",u)},timeout:function(){e.fire("util:ymstats",{name:"compose_lastTweet_client_timeout"})}}}):(c=t.one(s),c&&c.set("innerHTML",u))}}),e.namespace("mail.Views").SignatureTweetView=f},"1.0.0",{requires:["io-base","common-utils","_shared_module_compose_signature_tweet","mail-persist-meta-data","mail-common-connected-accounts"]});
YUI.add("mail-ui-fullcompose-v3",function(e){function k(t){var n=this,r,i;n.composeViewRendered&&(n.isDraft?r="draft":(i=n.draft&&n.draft.get&&n.draft.origin,r=i?i.action:null),r=r||"new",e.Lang.later(90,null,function(){n.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+r})})),t.cbk&&t.cbk()}function L(e){var t=this;t.get("isQuickReply")||t.header.hideACWidget(),t.dirty&&t.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose&&(t.isAutoSave=!0,t.save()),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),e.cbk&&e.cbk()}function A(){var e=this,n=e.baseNode,r=n.one(".cm-subject-field"),i=n.one("input.cm-subject-field");return i.ancestor("div").removeClass(g),{subjectVal:t(r.get("value")),subjectDir:NeoConfig.bidi?r.getStyle("direction"):null}}function O(){var t=this,n=t.draft,r=t.closeSrc,i,s=n.origin;s&&s.action!==null?s=s.action:s="new",i={action:"cmps_tab_cls",append:{t1:"cmpsTb",ltxt:s,cmpsType:t.get("isQuickReply")?"QR":"fullCmps"}};switch(r){case"closeBtn":break;case"escKey":i.append.actn="keybrd";break;case"cancelBtn":i.action="tlbr_cancelcompose"}t.editor&&t.editor.detachEvents(),t.set("close",1),e.fire("mt:click",i)}function M(){var t=this,n=t.attComposer,r;t.blockSave=!0,t.saveTimer&&t.saveTimer.cancel(),t.adRotationTimer&&t._cancelAdRotationTimer(),t.resizeRTEDelayTimer&&t.resizeRTEDelayTimer.cancel(),t._clearOriginTimers(),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),!e.Lang.isNull(t.spellCheckView)&&!e.Lang.isUndefined(t.spellCheckView)&&t.spellCheckView.destroy(),t.spellCheckView=null,n&&(n.cleanup(),t.attComposer=null),t.tray&&t.tray.destroy(),r=t.rteFormatter,r&&(r.fontFamilyOptions&&r.fontFamilyOptions.remove().destroy(!0),r.fontSizeMenu&&r.fontSizeMenu.remove().destroy(!0),r.fontNameMenu&&r.fontNameMenu.remove().destroy(!0),r.formatButtons&&r.formatButtons.remove().destroy(!0),r.fontColorMenu&&r.fontColorMenu.remove().destroy(!0),r.textIndentation&&r.textIndentation.remove().destroy(!0),r.textAlignment&&r.textAlignment.remove().destroy(!0),r.textLists&&r.textLists.remove().destroy(!0),r.emotionMenu&&r.emotionMenu.remove().destroy(!0)),t.rtSwitch=null,t.baseNode&&(e.each(t.handles,function(e){e.detach()}),t.handles=null,t.baseNode.remove().destroy(!0)),t.composeTictacApi.destroy(),t.rteFormatter&&(t.rteFormatter.destroy(),t.rteFormatter=null),t.header=null,t.formatters=null,t.container=null,t.editor=null,e.fire("compose:rte:blur"),C.superclass.ondestroy.call(this,arguments)}function _(){var e=this,t,n=e.baseNode.one(".ac-input.focus .recipient-input input");n&&e.header._lozengeIt(n),t=e.baseNode.all(".compose-header .field .hLozenge");if(t.size()>100){this._warnTooManyRecipients();return}e._invokeSend(!0)}function D(){var e=this;e._cancelSaveTimer(),e.controller.send()}function P(){e.use("common-ui-dialog-helper",function(){a.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_send_toomanyrecipients,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})})}function H(t){if(!this.dropzone){var n=h(p._shared_module_compose_dropzone.base,{},0,0,strings);this.dropzone=e.Node.create(n),t?(this.baseNode.one(".footer-separator").appendChild(this.dropzone),this.baseNode.one(".footer-separator").setStyles({position:"relative",maxHeight:"200px"}),this.baseNode.one(".bottomToolbar").removeClass("smartFixed")):this.baseNode.appendChild(this.dropzone)}}function B(){this.dropzone&&(this.dropzone.remove(),this.dropzone=null,o.inlineImageEnabled()&&(this.baseNode.one(".footer-separator").setStyles({position:null,maxHeight:null}),this.doResizeRTE(),e.fire("recalculateScrollToRepositionSend")))}function j(e){var t=e.cloneNode(!0),n=e.parentNode;return t.value=null,n.replaceChild(t,e)}function F(){function a(e){return"quoted-text"===e.getAttribute("data-action")}function c(n){var r=n.keyCode;if(r&&r!==13){(r===8||r===46)&&n.stopImmediatePropagation();return}a(n.target)&&(t._expandQuotedReply(),e.fire("mt:click",{action:"cmps_qtd_txt"}))}var t=this,n=t.draft,s=t.handles,u;t.attachIcon=t.baseNode.one(".attachment-button-attach"),NeoConfig.backButtonFull||e.fire("initPage"),t.setDraftDirtyDebounced=f.debounce(function(){t._setDirty()},S),s.push(t.editor.on({keyDown:function(n){var r=!1;e.fire("HoverCard:hideHoverCard");if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.keyCode===27||n.keyCode===40)r=t.get("keydownHandler")?t.get("keydownHandler")(n):t.onKeyDown(n);r?n.halt():(t._lastActivityTime=(new Date).getTime(),t.setDraftDirtyDebounced(),t.uploadFormDirty&&q(t),setTimeout(function(){t.get("isQuickReply")&&t.resizeRTE()},0))},focus:function(e){t._registerFocus(e.editor),t.header._removeLozengeHighlights(),t.neoFire("composeEvent",{action:"setActiveCompose",cv:t,editor:e.editor})},blur:function(n){e.fire("compose:rte:blur",{editor:n.editor,cv:t})},nodeChange:function(e){e&&(e.type==="paste"||e.type==="drop"||e.type==="undoLoadState")&&t.setDraftDirtyDebounced()},ready:function(){t.postRender(),t.focusNode&&t.setFocus(t.focusNode)}})),s.push(n.on("compose:restoreFocus",function(){t.focusNode instanceof e.Node?t._restoreFocus():t.setFocus("body",0,1)},t)),s.push(t.baseNode.delegate("click",function(n){var r=n.currentTarget,i=r.get("parentNode"),s=i.hasClass("cc-btn")?"cc":"bcc",o=i.get("id");n.halt(!1);var u=o==="btn-show-"+s+"-in-to"||o==="btn-show-"+s+"-in-cc",a="cmps_"+(u?"shw"+s:"hd"+s);t.header._cmdBccSwitch(u,"bcc"),t.header._cmdBccSwitch(u,"cc"),e.fire("mt:click",{action:a,append:{t1:"cmpsTb"}}),t._restoreFocus()},"span.cc-btn a, span.bcc-btn a")),s.push(t.compArea.on("click",c)),s.push(t.compArea.on("keydown",c)),s.push(t.compArea.on("key",function(e){var n,r;e.keyCode===38?a(e.target)?t.editor.setFocus():e.target.ancestor(".attachments-well",!0,"#rtetext")&&(r=t.baseNode.one(".compose-quoted-text:not(.hidden) .qtd-expansion-text"),r?r.focus():t.editor.setFocus()):e.keyCode===40&&a(e.target)&&(n=t.baseNode.one(".attachments-well:not(.hidden)"),n&&n.focus()),e.stopPropagation()},"down:38,40")),s.push(t.baseNode.delegate
("click",function(){t._clearOriginTimers(),t._displayLoading(),i.fetchOrigin(n,t.isDraft,t._getTextMode())},"a.retryOrigin")),t.on("renderComplete",function(){var n;l.enabled("lastTweetSignature")&&!t.signatureTweetView&&(t.signatureTweetView=new r.Views.SignatureTweetView(t.compArea)),t.contentLoaded=!0,e.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(){})}),t._addFocusListenersFresh(),s.push(t.baseNode.on("keydown",function(e){var n,r=e.target;e.keyCode===13&&r.ancestor("div.rte-well-container")&&(e.halt(),t.focusNode=r,n=r.one("b"),n&&n.simulate("click"))})),s.push(t.baseNode.delegate("click",function(e){var n=f.getDataAction(e).action;t.handleComposeAction(n,e)},".bottomToolbar > span")),s.push(t.baseNode.delegate({click:function(){q(t),e.fire("mt:click",{action:"cmps_attfl"})},focus:function(){var e=t.baseNode.one("#attachment-button-input");e.ancestor("span").addClass("focused")},blur:function(){var e=t.baseNode.one("#attachment-button-input");e.ancestor("span").removeClass("focused")},change:function(){var e=this.getDOMNode();window.FormData&&window.FileReader?t.fire("attachmentUpload",{files:[].slice.call(e.files)}):e.value!==""&&(this.uploadFormDirty=!0,t.fire("attachmentUploadForm",{inputEl:e})),t.openComposeAssistOnFirstAttach(),t.hasUserAttachedFile=!0}},"#attachment-button-input")),t.baseNode.one(".attachments-pane").removeClass("hidden"),s.push(t.baseNode.on("drop",function(e){var n=e._event.dataTransfer.files;n&&n.length&&t.fire("attachmentUpload",{files:[].slice.call(n)}),t.openComposeAssistOnFirstAttach(),t.hasUserAttachedFile=!0})),u={dragover:function(e){var n=o.inlineImageEnabled(),r=function(e){return e.isinlineattachonly?!1:!0};o.dragShouldShowDropzone(e._event,r,["isinlineattachonly"])&&(clearTimeout(t._dragTimer),t._showDropzone(n)),e.preventDefault()},dragleave:function(e){var n=window.innerWidth,r=window.innerHeight,i=e.clientX,s=e.clientY;i<=0||i>=n||s<=0||s>=r?t._hideDropzone():(clearTimeout(t._dragTimer),t._dragTimer=setTimeout(function(){t._hideDropzone()},300))},drop:function(n){t._hideDropzone(),e.fire("dropHandled"),n.preventDefault()}},window.FileReader&&s.push(e.one("body").on(u)),s.push(e.on("dropHandled",function(){t._hideDropzone()})),s.push(e.on("windowresize",function(){t.resizeRTE()})),t._showSendBtn(!1),t.composeTictacApi.bindUI()}function I(){var t=this.baseNode.one(".attachment-button-form"),n=t.one("#jsonString"),r=2,i=this.draft.attachments.filter(function(e){return e.state()==="pending"}),s=JSON.parse(this.draft.jsonify({iframeUpload:{multipartName:"uploadfile"}}));s.actions.responseContentType="text/plain",i.forEach(function(e){e.setPartId(r),r++,e.setProgress(.5)}),n||(n=e.Node.create('<input type="hidden" name="jsonString" id="jsonString">'),t.insertBefore(n,t.get("firstChild"))),n.set("value",JSON.stringify(s)),this.draft.formId=t.get("id")}function q(e){var t=e.baseNode.one(".attachment-button-form");t&&t._node.reset(),e.uploadFormDirty=!1}function R(e){e?this.neoFire("composeEvent",{action:"showSendBtn"}):this.neoFire("composeEvent",{action:"hideSendBtn"})}function U(){var e=this,t=e.rteFormatter,n=e.handles;t.bindUI(),n.push(t.on("formatter:action",function(t){e._setDirty(),l.enabled("saveFontSelection")&&e._setComposePreference(t.act,t.val)})),n.push(e.after("isRichTextChanged",function(){e.editor.set("isRich",!NeoConfig.low_bandwidth&&e.isRichText),e.rteFormatter&&e.rteFormatter._switchEditMode(e.isRichText)})),e._intlBindUIRTE()}function z(){var t=this,n=l.enabled("spellCheck"),r,i,s,o;r=t.rteFormatter=new e.mail.ui.RTEFormatter({isBidi:NeoConfig.bidi,isSpellCheckEnabled:n,editor:t.editor,globalPathImage:t.formatters.global_path_img()}),r.renderUI(t.baseNode.one(".rte-well-container")),r._switchEditMode(t._isRTEActive()),t._bindWellUIFresh(),i=t.richFontInfo.fontFamily,s=t.richFontInfo.fontSize,s&&(o=parseInt(s.replace("pt",""),10),o=e.Array.indexOf(b,o),o>=0&&(r.selectedFSIndex=o+1)),r.selectedFNIndex=i,n&&t._initializeSpellCheck(),t._bindTextSwitchFresh()}function W(){var t=this,n,r,i=t.getRTEDocNode(),s=t.compArea.one(".compose-quoted-text"),o=i.one(".yahoo_quoted"),u=t.quotedTextBody,a;i.append(t.quotedTextBody),t.quotedTextBody="",d._insertEmptyLineBeforeQuotedText(i),o&&o.setStyle("display","block"),n=f.getVal(t.draft.origin,"yqtdPrefix");if(n)for(r=0;r<n.length;r++)a=t.getRTEDocNode().one("."+n[r]+"yahoo_quoted"),a&&a.setStyle("display","block");s&&s.remove(),e.fire("processedEditorHtml",{processHtml:function(t){var r=e.Node.create("<div>"+t+u+"</div>"),i=d._expandQuotedText(r,n);return i&&i.getHTML()},rteNode:i}),e.fire("recalculateScrollToRepositionSend"),t.resizeRTE()}function X(){var e=this;e.hasRTEFormatter&&e.initializeRTEFormatter(),e.baseNode.one(".attachments-pane").addClass(m)}function V(t){var n=this,r,s;if(t){n.parent=t,r=h(p._shared_module_compose_fresh_conv.base,n.draft,n.formatters,null,strings,p),t.append(r),n.baseNode=t.one(".compose"),n.get("isQuickReply")||(n.baseNode.addClass("full-compose"),n.baseNode.addClass("content")),n.compArea=n.baseNode.one("div.compose-message").one("div.inner"),n.loadingArea=n.compArea.one("div.msg-loadingpane"),n.footer=n.baseNode.one(".footer-separator");var o=i.getDefaultFontInfo(!n._isRTEActive());n.richFontInfo.fontFamily=o.fontFamily,n.richFontInfo.fontSize=o.fontSize,s=n.baseNode.one("div.cm-plaintext"),s&&s.get("parentNode").removeChild(s),e.UA.gecko&&n.compArea.ancestor("td").setStyle("height","0"),n.header.enableHeader(!1),n._renderWellsFresh(),n.bindUI(),n.header.render(),n.header.bind(),n.composeViewRendered=!0,n.editor.render(n.baseNode);var u=n.baseNode.one(".attachments-well");$(this,u)}}function $(t,n){t.tray=new e.Tray({model:t.draft,view:t,container:n,filesView:n.one(".file-attach"),thumbnailsView:n.one(".thumbnails-attach")}),t.tray.on("attachmentRemoved",function(){t._setDirty(),t.save()}),t.tray.render()}function J(){var e=this,t=e.footer.getY();e.footer.setStyles({position:"fixed",top:t+"px"})}function K(){var t=this,n=e.mail.
Tabs,r=function(e){return e.type==="author"&&e.view&&e.view.draft&&e.view.draft.csid&&t.draft.csid&&e.view.draft.csid===t.draft.csid},i;t.isDraft&&NeoConfig.tabs&&NeoConfig.previewPanePref>0&&(i=n.getTab(r),i&&i.isRemovable&&i!==n.getActiveTab()&&i.set("close",1))}function Q(){NeoConfig.tabs&&!NeoConfig.hasConvView?(this.resizeRTEDelayTimer&&this.resizeRTEDelayTimer.cancel(),this.resizeRTEDelayTimer=e.later(300,this,this.doResizeRTE)):this.doResizeRTE()}function G(){var t=this,n,r,i=7,s=0,o,u=0,a,f,h=l.enabled("fullheightcomposeOnThreshold"),p=h?500:300,d=c.value("fullheightcomposeThreshold",953),v=t.baseNode.one("div.attachments-well");u=v?v.getStyle("height"):0,u=u==="auto"?0:parseInt(u,10),o=e.one("body").get("offsetHeight");if(t.get("close"))return;if(!t.get("isQuickReply")){n=parseInt(t.compArea.getY(),10),r=parseInt(t.compArea.getComputedStyle("paddingBottom"),10),o=e.one("body").get("offsetHeight"),a=o-n-x-r;var m=a-.2*o;m>p&&(m=p);if(l.enabled("fullheightcompose")||h&&o<=d)m=a-i,NeoConfig.isWinApp&&(m-=30),s=20,t.baseNode.one("#to").addClass("fullheight-input"),t.baseNode.one("#cc").addClass("fullheight-input"),t.baseNode.one("#bcc").addClass("fullheight-input");t.compArea.setStyles({maxHeight:a+"px",minHeight:m+"px"}),f=m-u-s>0?m-u-s:0,t.editor.rteArea.setStyles({minHeight:f+"px"})}else if(!NeoConfig.smartscroll){parseInt(t.baseNode.getStyle("height"),10)>t.maxHeight&&(t.maxHeightFn&&(t.maxHeight=t.maxHeightFn()),t.compArea.setStyles({maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-x+"px"}));var g=t.baseNode.get("parentNode").get("offsetTop")-t.containerNode.get("scrollTop")+parseInt(t.baseNode.getStyle("height"),10)+6-t.containerNode.get("offsetHeight");g>0&&t.containerNode.set("scrollTop",t.containerNode.get("scrollTop")+g)}}function Y(){function i(i){var s=i.params,o,u,a,f,l={format:1};if(!l.hasOwnProperty(s.tab))return;if(!t.baseNode)return;s.tooltip=s.tooltip||"";if(s.tab!=="format")return;u=s.name||"Stationery",a='<span class="btn menu" data-app="'+i.appInstance+'">'+'<a class="icon '+u+'" href="#" title="'+s.tooltip+'">'+'<i role="presentation" class="plaintext">'+s.label+"</i></a></span>",f=n(a);try{t.baseNode.one("."+s.tab+"-pane").one(".om-buttons").append(f)}catch(c){}o=e.stamp(f),r.push(f.on("click",function(e){e.preventDefault(),i.handler(o,t)})),r.push(e.on("om:click_btn",function(e){if(!e.app||!e.app.instance||!e.tab)return;i.appInstance===e.app.instance&&i.handler(o,t)}))}var t=this,r=t.handles;e.each(u,i),r.push(e.on("om:compose_add_btn",function(){i(u[u.length-1])}))}function Z(){return l.enabled("autocomposeValentines")&&NeoConfig.mrd&&NeoConfig.mrd.param&&NeoConfig.mrd.param.autocompose}function et(){this.editor.set("isRich",!0),this.rteFormatter._switchEditMode(!0),this.isRichText=!0}function tt(){var t=this,n,r,s,o,u,a,c,h=t.draft;t._bindDraft(),t._isOrigin()?(f.perf.startMeasurement("draft_loading"),t.slowOriginReqTimer=setTimeout(function(){t._handleSlowOriginRequest()},E),t.loadingTimer=setTimeout(function(){t._displayLoading()},w),t.editor.hideArea(),i.fetchOrigin(h,t.isDraft,t._getTextMode(),t.stopwatch,function(){var n;Mt(t.quotedTextBody)&&t._expandQuotedReply(),t.set("draftLoaded",!0),t.fire("draftLoaded"),n=f.perf.endMeasurement("draft_loading"),n&&e.fire("stat:feature_latency",{feature_group:"DRAFT_LOADING",value:n})}),t.isDraft?t.hasHardDraft=!0:(o=h.origin,e.Lang.later(90,null,function(){t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+o.action})})),n=h.origin.oMsg,n&&n.header?(r=n.header.to,s=n.header.cc,c=n.header.xapparentlyto,u=n.header.from):(r=[],s=[],c=null,u=n&&n.from),t.header.setReplyFrom(r,s,c),u&&t.isDraft&&e.later(10,t,function(){t.header._setFromMenu(u)})):(t.header.setHeader(h),a=h.cc&&h.cc.length>0||h.bcc&&h.bcc.length>0,t._allowEditing(h.body.html,a),t.dirty=t.controller.isPopulated()?!0:!1,e.later(0,t,At,[h.to&&h.to.length>0?"body":"to"]),t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_new"})),t._initOpenMailButtons(),e.fire("load:autosuggest",{rte:t.editor,rteActive:t._isRTEActive(),context:t}),e.fire("FullCompose:fullComposeReady",{rte:t.editor,rteActive:t._isRTEActive(),context:t}),e.fire("compose-stat:fullComposeReady"),e.fire("read-stat:draftRendered"),!NeoConfig.smartscroll&&t.get("isQuickReply")&&t.compArea.setStyles({minHeight:"150px",maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-x-6+"px"}),l.enabled("autoCloseDraftTab")&&t._handleDraftTabAutoClose(),Z()&&(t.temporarySwitchToRichTextMode(),t.rteFormatter.disableEditModeSwitching()),t.resizeRTE()}function nt(){function i(){var t;if(r[e.rteTabIndex]==="#switchtext-plain"||r[e.rteTabIndex]==="#switchtext-rich")return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]===".attach-btn-menu a")return e.rteTabIndex=r.length-1,n.one(r[e.rteTabIndex]);do t=n.one(r[++e.rteTabIndex]);while(!t||t.ancestor().hasClass(m)||t.ancestor().getStyle("display")==="none");return t}function s(){var t;if(e.rteTabIndex===0)return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]==="#switchtext-plain")return e.rteTabIndex=1,n.one(r[e.rteTabIndex]);do t=n.one(r[--e.rteTabIndex]);while(!t||t.ancestor().hasClass(m)||t.ancestor().getStyle("display")==="none");return t}function o(t){var n,r,o=e.baseNode.one(".attachments-pane");switch(t.keyCode){case 9:t.shiftKey||(n=e.baseNode.one(".attachments-well"),n&&!n.hasClass(m)?(r=n.one('li.attachmentVisible span.left a[tabIndex="0"]'),r||(r=n.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(t.target.blur(),e.setFocus("body"),t.halt()));break;case 13:case 32:t.target!==o?t.target._node.click():t.target.one("input")&&t.target.one("input")._node.click();break;case 37:t.target&&t.target.set("tabIndex",-1),r=s(),r&&r.set("tabIndex",0),r.focus();break;case 39:t.target&&t.target.set("tabIndex",-1),r=i(),r&&r.set("tabIndex",0),r.focus();break;default:}}var e=this,t=e.handles,n=e.baseNode.one("div.rte-well-container"),r=[".attachments-pane","#btn-fontname","#btn-fontsize"
,"span.bold","span.italic","span.underline","#btn-forecolor","#btn-backcolor","#btn-insertunordered","#btn-insertnumbered","#btn-outdent","#btn-indent","span.align-l","span.align-c","span.align-r","#links","#emoticon","span.Stationery","#spellCheck","#btn-spell-langs","#switchtext-plain","#switchtext-rich"];t.push(n.delegate("keydown",o,'div.attachments-pane, span[role="button"]'))}function rt(){var e=window.getSelection().getRangeAt(0),t=e.cloneRange(),n=this.getRTEDocNode().getDOMNode(),r=document.createRange();return r.selectNodeContents(n),t.selectNodeContents(n),t.setEnd(e.endContainer,e.endOffset),t.toString&&r.toString&&t.toString().trim()===r.toString().trim()}function it(t){var n=this,r=t.keyCode,i=(t.ctrlKey||t.metaKey)&&!t.altKey&&!t.shiftKey,s=e.UA.os,o=t.ctrlKey&&(s==="linux"||s==="windows"||s==="win")||t.metaKey&&(s==="macintosh"||s==="mac"),u,a;switch(r){case 27:a=e&&e.one(".btn-close-msg"),a&&a._node.click();break;case 40:if(n._isAtEndOfRTE()){var f=n.baseNode.one(".compose-quoted-text:not(.hidden) .qtd-expansion-text"),l=n.baseNode.one(".attachments-well:not(.hidden)");f?f.focus():l&&l.focus()}break;case 85:o&&t.shiftKey&&!e.UA.ie&&(!e.UA.gecko||e.UA.gecko>1.92)&&(u=n.baseNode.one(".attachments-pane input"),u._node.click(),t.halt());break;case 13:if(o&&!t.altKey){var c={spid:"sent",append:{t1:"cmpsTb",actn:"keybrd",cmpsType:n.get("isQuickReply")?"QR":"fullCmps"},action:"tlbr_send"};return n.lastSendState&&(c.append.ltxt=n.lastSendState),e.fire("mt:click",c),n.send(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0}if(t.target.get("nodeName")==="A")return t.target.simulate("click"),!0;break;case 65:i&&n._expandQuotedReply();break;case 83:if(i)return n.isAutoSave=!1,n.save(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0;break;case 88:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.frameEvent.halt(),NeoConfig.bidi&&(n.editor.invokeCommand("swapdir",null),n.fire("formatter:action",{act:"swapdir",val:null})),!0;break;case 89:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.halt(),n.allowEdit&&n._cmdTextSwitch(),!0;break;case 219:case 221:e.fire("tabview:handleKeyDown",t);break;default:}return t.frameEvent&&(t.frameEvent.stopPropagation(),t.shiftKey&&r===9),i||a?!0:!1}function st(e){var t=this,n=t.baseNode.one("div.rte-well-container"),r,i=n.one(".attachments-well");t.rteTabIndex=0,i&&!i.hasClass(m)?(i.all("li.attachmentVisible span.left a").each(function(e){!r&&e.get("tabIndex")===0&&(r=e)}),r||(r=i.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(r=n.one(".attachments-pane"),r&&r.set("tabIndex",0)),r&&t.setFocus(r),e.frameEvent.halt()}function ot(t){var n=e.Node.getDOMNode(t);return n!==null?n.tagName.toUpperCase()==="DIV":!1}function ut(){var t=this,n=this.draft.getAccountId(),r=v.getSentFid(n),i={msg:{mid:t.draft.mid},fid:r},s,o,u,a;s=function(t,n){n==="view"?e.fire("openMessage",i):n==="send-another"&&(e.fire("newMessage",{flavor:"autocompose",cbfn:function(){e.fire("util:ymstats",{name:"compose_valentine_autocompose",tags:{source:"sendMore"}})}}),e.fire("mt:click",{action:"autocompose_sendmore"}))},e.use("common-ui-notification-v2",function(e){o=e.common.ui.NotificationV2,u=t.lastNotification,a={type:"info",cbk:s,duration:4e3,speed:"fast"},f.features.enabled("autocomposeValentines")&&t.isValentineAutocompose?(e.use("_shared_module_compose_autocompose_notification",function(e){var t=e.ui.Templates._shared_module_compose_autocompose_notification;o.notify(f.substitute(t.base,0,0,0,strings),{type:"error",cbk:s,duration:1e4,speed:"fast",close:!0})}),e.fire("util:ymstats",{name:"autocompose_sent"}),e.fire("mt:click",{action:"autocompose_send"}),N&&u&&(t.lastNotification=undefined)):(e.mail.persist.MetaData.get("neo.pref.desktopNotification")!=="granted"&&(l.enabled("notificationsOnSentWithImage")||l.enabled("notificationsOnSentOnboarding"))&&(!f.isCalloutShown("notificationsOnSentWithImage")||!f.isCalloutShown("notificationsOnSent"))?e.use("mail-ui-onboarding-notifications-on-sent",function(e){e.mail.ui.onboarding.notificationsOnSent.init(s),o.clearAll(),t.lastNotification=undefined,u=undefined}):N&&u?(o.update(strings.str_comp_msg_sent,a),t.lastNotification=undefined):l.enabled("mobileUpsellSentMail")&&!f.isCalloutShown("mobileUpsellOnSent")?e.use("mail-ui-onboarding-mobile-upsell-on-sent",function(e){e.mail.ui.onboarding.mobileUpsellOnSent.init(s)}):o.notify(strings.str_comp_msg_sent,a),t.isMDayAutocompose&&e.fire("util:ymstats",{name:"autocompose_mday_sent",tags:{theme:t.mDayStationery}}),e.common.Utils.retentionStat("mbUpsellSent"))})}function at(){var e=this,t;e.lastSaveType=e.isAutoSave?1:0,e.resetSaveTimer(),e.isAutoSave||(e.hasHardDraft=!0),e.isAutoSave=!1,e.dirty=!1,t=f.dateFormatter(new Date,strings.str_tog_dateformat_rsstime_l10n),t=h(strings.str_comp_saved,0,0,0,{saved_time:t}),e.updateSaveStatusText(t),e.fire("compose:saveSuccess")}function ft(t){var n=this,r,i;n.lastSaveType=-1,n.neoFire("composeEvent",{action:"saveComplete",saveSuccess:!1}),!n.isAutoSave&&!t.notificationDisplayed&&(i=strings.str_error_MessageSaveFailed,e.common.ui.NotificationV2.notify(i,{type:"error",close:!0,speed:"show-medium"})),n.isAutoSave=!1,n._setDirty(),r=strings.str_comp_saveasdraftfail,n.updateSaveStatusText(r),n.fire("compose:saveFail")}function lt(e){var t=this;t.baseNode.one(".save-draft-msg")&&t.baseNode.one(".save-draft-msg").removeClass("hidden").set("innerHTML",e)}function ct(t){var n=this,r=strings.str_tae_unabletosendmsg,i=e.common.ui.NotificationV2;n.showComposeShim(!1),t.notificationDisplayed||(t.code==="EP-4010"?(i.clearAll(),n.notifySendAbuse()):i.notify(r,{type:"error",close:!0,speed:"show-medium"}))}function ht(){var e=this;e.sendValidationHandlers.handleSpame()}function pt(){var t=this.baseNode.one("#bcc_add_contacts"),n=15e3;e.mail.ui.Onboarding.registerDefaultOnboarding({name:"onboard_bcc_tooltip",node:t,hdText:strings.str_comp_bcc_recipients_added_title,bdText:strings.str_comp_bcc_recipients_added_body,pointer:"bottom-left",offset:[-15
,-105]}),e.fire("initCallout:onboard_bcc_tooltip"),setTimeout(function(){e.fire("closeCallout:onboard_bcc_tooltip")},n),e.one("document").once("click",function(){e.mail.ui.Onboarding.closeDefaultOnboarding("onboard_bcc_tooltip")})}function dt(e){var t=this;t.baseNode.one(".composeshim")[e?"removeClass":"addClass"]("hidden"),e?t.baseNode.addClass("sending"):t.baseNode.removeClass("sending"),t.neoFire("composeEvent",{action:"updateTitle",sending:e})}function vt(){var e=this,t=e.draft.attachments,n=e.handles;n.push(t.on("added",function(){e._setDirty(),e.resizeRTE()})),n.push(t.on("deleted",function(){e._setDirty(),setTimeout(function(){e.resizeRTE()},50)})),n.push(t.on("updated",function(t){e.resizeRTE();if(!t.isUploadDone())return;e._setDirty()}))}function mt(e){var t=this;e.reply?t.replyContentChangeAfter(e):e.uiUpdate||(t.draft.body.html?t.editor.setContent(t.draft.body.html,!e.textConvert):t.editor.setContent(t.draft.body.html))}function gt(e){var t=this,n=t.draft,r;if(!e.reply)return;t.header.setHeader(n),r=n.subject,t.neoFire("composeEvent",{action:"replyheaderLoad",subject:r})}function yt(e){var t=this,n,r=t.draft;t._setTextMode(e.isRichText),t._setClean(),n=r.cc&&r.cc.length>0||r.bcc&&r.bcc.length>0,t._allowEditing(t.draft.body.html,n),t.header.enableSwitchReplyButton(),t.get("noFocus")||t.setFocus(r.to&&r.to.length>0?"body":"to")}function bt(){var t=this;t.rtSwitch||(t.rtSwitch=t.baseNode.all("span.switchtext")),t.rtSwitch.each(function(n){t.handles.push(n.on("click",function(n){e.fire("mt:click",{action:"cmps_stchpt",append:{t1:"cmpsTb",ltxt:t._isRTEActive()?"plaintext":"richtext"}}),n.halt(!1),t.allowEdit&&t._cmdTextSwitch()}))})}function wt(){function n(){e.editor.fire("beforeModeSwitch"),e.draft.setBody(null,e.getContent()),e._setDirty()}function r(t,n){e._setTextMode(!1),e.draft.setBody(null,n),e.draft.notifyBodyChanged({textConvert:!0})}function i(){e._setTextMode(!0)}function s(){n(),e._expandQuotedReply(),e._removeSignatureTweet(),r(e.draft,e.editor.getContentAsPlainText()),e.resizeRTE(),e.setFocus("body"),e.editor.fire("afterModeSwitch")}var e=this,t;e._isRTEActive()?e.editor.hasContent()?(t=!0,e.confirm(strings.str_rte_plaintext,strings.str_comp_conf_plainText,s)):s():(n(),i(e.draft),e.editor.fire("afterModeSwitch")),!t&&e.setFocus("body")}function Et(){var e=this,t=e.signatureTweetView;t&&t.removeTweet(e.compArea)}function St(){return!NeoConfig.low_bandwidth&&this._getTextMode()}function xt(){return this.spellCheckView&&this._isRTEActive()}function Tt(e){return this.baseNode.one(".cm-"+e+" ul li")}function Nt(){return this.editor.getContent()+this.quotedTextBody}function Ct(){var e=this.editor.getContentNodeClone();return e.append(this.quotedTextBody),e}function kt(){return this.editor.richFontInfo}function Lt(){return this.editor.getRTE()}function At(t,n,r){var i=this,s=!0,o,u=i.editor.getRTE();if(typeof t=="string"){o=i.baseNode.one(".compose-header");if(o)switch(t){case"to":case"cc":case"bcc":case"subject":o=i.baseNode.one(".compose-header"),t=o.one(".cm-"+t+"-field");break;case"body":t=u,s=r&&e.UA.os==="macintosh"&&e.UA.chrome>=11?0:i.editor.get("ready")}}s&&(t===u?i.editor.setFocus(n):t&&t.focus()),t&&i._registerFocus(t)}function Ot(e,t){return'<div class="'+t+'">'+e+"</div>"}function Mt(t){return!e.Lang.isString(t)||t.length===0||NeoConfig.hasConvView?!1:t.length<T}function _t(e,t){var n=this;n.header.allowEditing(e,t),n.composeTictacApi.render(n.baseNode.one(".attachments-pane")),n.allowEdit=!0,n.fire("renderComplete")}function Dt(e,t){var n=this,r,i,s,o,u=[],a,l,c="yahoo_quoted";n._clearOriginTimers(),n.header.enableHeader(!0),n.editor.showArea(),n.loadingArea.addClass(m);if(!e){n._setFlagsforAllowEditing(e,t);return}if(!n._isOrigin()){n.editor.setContent(e,!n.isDraft),n._setFlagsforAllowEditing(e,t);return}n.editor.setContent(e,!n.isDraft);if(n.draft.origin.action!=="forward"){if(n.isDraft){r=f.getVal(n.draft.origin,"yqtdPrefix");for(i=0;i<r.length;i++)a="."+r[i]+c,s=n.getRTEDocNode().one(a),s&&(l=Ot(s.getContent(),a),u.push(l),s.remove());n.quotedTextBody=u.join("")}else s=n.getRTEDocNode().one("."+c);s&&n.baseNode.one(".compose-quoted-text")&&n.baseNode.one(".compose-quoted-text").removeClass("hidden"),o=n.getRTEDocNode().one("."+c),o&&(n.quotedTextBody=Ot(o.getContent(),c),o.remove())}n._setFlagsforAllowEditing(e,t)}function Pt(e,t){var n=null;switch(e){case"fontname":n="userUIPref.composeFontFamily",t+="|1";break;case"fontsize":n="userUIPref.composeFontSize",t=parseInt(t,10),t=b[--t];break;default:}n&&t&&sn(n,t)}function Ht(){var t=this,n;t._formatPane||(t._formatPane=t.baseNode.one(".format-pane")),t.spellCheckBtn=t._formatPane.one('[data-action="spellcheck"]'),t.spellCheckMenuBtn=t.spellCheckBtn.next(),n=e.one("#menu-spell-langs"),t.handles.push(t.spellCheckBtn.on("click",function(e){e.preventDefault(),t._isSpellCheckActive()?t.spellCheckView.destroy():t._doSpellCheck(n?n.one(".active").get("text"):null)}),t.spellCheckMenuBtn.on("click",function(e){e.preventDefault(),t._openSpellCheckMenu(e)}),t.on("SpellCheck:destroy",function(){t.spellCheckView=null,t.spellCorrections=null,t.spellCheckBtn.removeClass("active")}))}function Bt(e){var t=this;t.closeSrc="cancelBtn",e&&(t.dirty="ForceClose"),t.canClose()&&t.neoFire("composeEvent",{action:"closeAction"})}function jt(t){var n=!0,r={},i="",s=this;switch(t){case"send":r.spid="sent",s.lastSendState&&(i=s.lastSendState),s.send();break;case"savedraft":s.blockSave=!0,s._invokeSaveDraft();break;case"cancelcompose":n=!1,s.cancelCompose();break;case"delete":s.doDiscardDraft(!1),s.dirty="ForceClose",s.neoFire("composeEvent",{action:"closeAction",forceClose:!0})}n&&(r.append={t1:"cmpsTb",cmpsType:s.get("isQuickReply")?"QR":"fullCmps"},r.action="tlbr_"+t,i&&(r.append.ltxt=i),e.fire("mt:click",r))}function Ft(e){var t=this,n,r=t.baseNode.one(".attachment-button-attach");e?n=t.draft.after("stateChanged",function(e){if(e&&e.next&&e.next!=="saved")return;n.detach(),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0})
,r.fire("compose:close")}):(r.fire("compose:close"),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0}))}function It(){}function qt(){var t=this;if(t._isSpellCheckActive())return;t.spellCheckView===null&&(l.enabled("spellCheck")?(t.spellCorrections=new e.mail.Model.SpellCorrections,t.spellCheckView=new r.ui.SpellCheckView(t,t.draft,t.spellCorrections),t.spellCheckBtn.addClass("active")):t.spellCheckView=!1)}function Rt(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&(n.spellCheckView.doSpellCheck(t),n.setFocus("body"),n.neoFire("composeEvent",{action:"darlaEvent",type:"spell_chk"}))})}function Ut(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&n.spellCheckView.showLangMenu(t)})}function zt(){return this.editor.getRTE().getInstance()}function Wt(){return this.editor.getDoc()}function Xt(e){var t=this,n,i=r.model.DataStore.Messages.getPermMidPart;if(e.flavor!==t.flavor)return!1;if(e&&e.oMsg&&t.getDraftMID())return i(t.getDraftMID())===i(e.oMsg.mid);if(!t._isOrigin())if(!e||!e.oMsg)return!0;return e&&e.oMsg?(n=t.draft.get.origin,e.action===n.action&&e.fid===n.fid&&e.oMsg.mid===n.oMsg.mid&&e.forwardAsAttachment===n.forwardAsAttachment):!1}function Vt(){var e=this,t=e.draft.origin;return t.action&&t.fid&&t.oMsg}function $t(){var e=this,t;t=e.draft.origin,e._clearOriginTimers(),e._writeLoadingHtml(t.errInfo==="ok"?"pop":"slow")}function Jt(){var e=this;e._writeLoadingHtml("start")}function Kt(e,t){this.editor.setContent(e,t)}function Qt(e){var t=this;t.loadingArea.hasChildNodes()&&t.loadingArea.get("children").remove().destroy(!0),t.loadingArea.appendChild(n(h(y.base,null,t.loadFormatters,e,strings,p)))}function Gt(){var e=this;e.slowOriginReqTimer&&clearTimeout(e.slowOriginReqTimer),e.loadingTimer&&clearTimeout(e.loadingTimer)}function Yt(e){var t=this,n,r,i=t.baseNode.one(".save-draft-msg");n=function(){return e?strings.str_comp_saving_draft:t.lastSaveType===-1?h(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:t.lastSave}):t.lastSave?t.lastSaveType===1?h(strings.str_comp_autosave,0,0,0,{autosave_time:t.lastSave}):h(strings.str_comp_saved,0,0,0,{saved_time:t.lastSave}):""},r=n(),i.removeClass("hidden"),i.set("innerHTML",r)}function Zt(t){var n=this,r,i;n.allowSend?e.use("common-ui-dialog-helper",function(){n.allowSend=!1,r={hd:t?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:t?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:!0},i=function(){n.allowSend=!0,n._restoreFocus()},a.ui.DialogHelper.alert(r,{ok:{handler:i},cancel:{handler:i}})}):n._restoreFocus()}function en(e){var t=e||this.getSaveNotification(),n;if(!t)return;n=this.baseNode&&this.baseNode.one(".bottomToolbar"),n&&n.one(".save-draft-msg").setContent(t)}function tn(){var e=this;return e.lastSaveType===-1?h(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:e.lastSave}):e.lastSave&&e.lastSaveType===1?h(strings.str_comp_saved_fresh,0,0,0,{saved_time:e.lastSave}):""}function nn(){var t=this,n;return n={bidi:NeoConfig.bidi,isRTL:NeoConfig.isRTL,isRich:t._isRTEActive(),spellCheck:l.enabled("spellCheck"),getDefaultFontInfo:i.getDefaultFontInfo,convertToPlain:e.bind(e.mail.Controller.TextProcessor.convertToPlain,e.mail.Controller.TextProcessor),smartscroll:NeoConfig.smartscroll&&t.get("isQuickReply")},n}function rn(){return this.draft.to.length>0||this.draft.cc.length>0||this.draft.bcc.length>0||this.draft.subject.trim()!==""||this.draft.body.html!==""||this.draft.body.text!==""}function sn(t,n){e.common.persist.UserData.set(t,n),setTimeout(function(){e.common.persist.UserData.saveOne(t)},10)}function on(e){this.editor.getRTE().fire("cardify",e.cardInfo,e.type)}function un(e){var t=strings.str_comp_attachment_size_exceeded,n=h(t,{num:e});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:n,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}function an(t){var n=strings.str_comp_attachment_size_zero,r=t.map(function(t){return e.Escape.html(t.name)}),i="<strong>"+r.join(", ")+"</strong>",s=h(n,{filenames:i});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:s,suppressRestoreFocus:!0},{ok:{handler:function(){}}})}function fn(){a.ui.DialogHelper.alert({hd:strings.str_comp_attach_error,bd:strings.str_comp_attach_num_files_exceeded,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}function ln(){var e=this,t,n,r=e.getRichComposeView(),i=function(){e.fire("composeAssist:submitQuery",{query:"",mime:"docs"})},s=l.enabled("richcompose")&&l.enabled("openRichcomposeOnAttach")&&!e.hasUserAttachedFile&&r&&!r.isRichComposeShown;s&&(e.fire("showComposeAssist",{clickSource:"attachFromCompose"}),i(),n=e.on("composeAssist:rootMounted",function(){i(),clearTimeout(t),n.detach()}),t=setTimeout(function(){n.detach()},1e4))}function cn(e){this._richComposeView=e}function hn(){return this._richComposeView}var t=e.Lang.trim,n=e.Node.create,r=e.mail,i=r.Controller.ReplyProcessor,s=r.Views.ComposeTictacApi,o=e.mail.rte.fileUtil,u=[],a=e.common,f=a.Utils,l=e.common.Utils.features,c=e.common.Utils.settings,h=f.substitute,p=e.ui.Templates,d=e.mail.Controller.HtmlProcessor,v=r.ui.FolderUtils,m="hidden",g="focus",y=p._shared_module_compose_loading,b=[10,13,16,0,24,32,48],w=2e3,E=7e3,S=500,x=67,T=f.settings.value("rplyTxtCollapseTrigger",256e3),N=l.enabled("instantCloseOnSend"),C=function(t,n,i,o,u){var a=this,f;C.superclass.constructor.call(a,t,n,o,u),a.spellCheckView=null,a.spellCheckLang=null,a.wordsToIgnore=[],a.slowOriginReqTimer=null,a.keepHdrFocus=!1,a.formatShortcutTimer=null,a.mouseFocusEvent=!1,a.composeViewRendered=!1,a.hasUserAttachedFile=!1,a.rteTabIndex=0,a.type="fullCompose",a.handles=[],a.lastSendState=null,a.closeSrc="closeBtn",a.containerNode=u.containerNode,a.hasRTEFormatter=!0,a.flavor="compose"
,a.addAttrs({keydownHandler:{value:null},isQuickReply:{value:!1},noFocus:{value:!1}},u),u.maxHeightFn&&(a.maxHeightFn=u.maxHeightFn,a.maxHeight=a.maxHeightFn()),f=a._getEditorConfig(),f.composeView=a,a.editor=new r.RTEView(f),a.composeTictacApi=new s(a.editor),a.addChild(a.editor),a.loadFormatters={start:function(e,t){return t==="start"?h(y.start,null,null,null,strings):""},slow:function(e,t){return t==="slow"?h(y.slow,null,null,null,strings):""},error:function(e,t){return t==="err"?h(y.error,null,null,null,strings):""},populate:function(e,t){return t==="pop"?h(y.populate,null,null,null,strings):""}},NeoConfig.bidi&&e.use("comms-intl-bidihighlight"),a.neoEvent("composeEvent",{emitFacade:!0,broadcast:1}),this.neoFire("composeEvent",{action:"addChild",subview:this}),this.sendValidationHandlers=new e.mail.Views.SendValidationErrorHandlers(this),a.quotedTextBody=""};e.extend(C,e.mail.Views.MailCompose),C.prototype._bindDraft=function(){var e=this,t=e.draft,n;e.handles||(e.handles=[]),n=e.handles,n.push(t.on("stateChanged",function(t){t.prev==="savingAndSending"||t.prev==="sending"||t.prev==="sent"||t.prev==="captchaing"&&t.next==="unsaved"?t.next==="final"?e.sendSuccess():t.err&&(e.sendFailure(t.err),N&&e.controller.cancelHideCompose()):(t.next==="saved"||t.next==="saving"||t.next==="unsaved"&&t.err)&&e._updateSaveStatus(t.next,t.err),(t.next==="savingAndSending"||t.next==="sending")&&e.showComposeShim(!0),(t.next==="saved"||t.next==="unsaved")&&e.showComposeShim(!1)})),n.push(t.on("bodyChanged",function(t){e.contentChangeAfter(t)})),n.push(t.on("headerChanged",function(t){e.headerChangeAfter(t)})),n.push(t.on("originChanged",function(){var t=f.getVal(e.draft.origin,"errInfo","ok");t!=="ok"&&(e._clearOriginTimers(),t.code!==a.net.Error.abort&&e._writeLoadingHtml("err"))}))},C.prototype._updateSaveStatus=function(e,t){var n=this;e==="saving"?n.draft.isUploadingInlineImages()?n.updateSaveStatusText(strings.str_comp_inline_image_attach_progress):n.updateSaveStatusText(strings.str_comp_saving_draft):e==="saved"&&n.allowEdit?n.saveSuccess():e==="unsaved"&&t&&n.saveFailure(t)},C.prototype=e.mix(C.prototype,{NAME:"FullCompose",render:V,bindUI:F,_bindWellUIFresh:U,onKeyDown:it,onFocus:ot,closeCompose:O,hasContent:rn,getContent:Nt,getContentNodeClone:Ct,getFontInfo:kt,getRTE:Lt,getRTEInstance:zt,getRTEDocNode:Wt,getFirstNode:Tt,setFocus:At,contentChangeAfter:mt,headerChangeAfter:gt,replyContentChangeAfter:yt,updateSaveText:Yt,postRender:tt,matchOrigin:Xt,setContent:Kt,addCards:on,showAttachmentSizeDialog:un,showAttachmentEmptyDialog:an,showAttachmentCountDialog:fn,_initOpenMailButtons:Y,_handleDraftTabAutoClose:K,_addFocusListenersFresh:nt,_handleShiftTabFresh:st,_handleSendAction:_,handleComposeAction:jt,_intlBindUIRTE:It,_allowEditing:Dt,_isRTEActive:St,_isAtEndOfRTE:rt,_closeAfterWarning:Ft,_renderWellsFresh:X,_bindTextSwitchFresh:bt,_cmdTextSwitch:wt,_removeSignatureTweet:Et,_showDropzone:H,_hideDropzone:B,_moveInputFileNode:j,_alertInvalidAttachments:Zt,_initializeSpellCheck:Ht,_activateSpellCheck:qt,_isSpellCheckActive:xt,_doSpellCheck:Rt,_openSpellCheckMenu:Ut,_isOrigin:Vt,_handleSlowOriginRequest:$t,_displayLoading:Jt,_writeLoadingHtml:Qt,_clearOriginTimers:Gt,_setComposePreference:Pt,_bindAttachmentsTT:vt,_warnTooManyRecipients:P,send:D,_showSendBtn:R,_expandQuotedReply:W,temporarySwitchToRichTextMode:et,showComposeView:k,hideComposeView:L,getSubjectInfo:A,initializeRTEFormatter:z,getSaveNotification:tn,setSaveNotification:en,cancelCompose:Bt,resizeRTE:Q,doResizeRTE:G,fixBottom:J,savePref:sn,updateUploadForm:I,notifySendAbuse:ht,_getEditorConfig:nn,sendSuccess:ut,saveSuccess:at,saveFailure:ft,sendFailure:ct,updateSaveStatusText:lt,showComposeShim:dt,showGrowthTooltip:pt,setRichComposeView:cn,getRichComposeView:hn,openComposeAssistOnFirstAttach:ln,_setFlagsforAllowEditing:_t,ondestroy:M},!0),e.namespace("mail.Views").Compose=C},"1.0.0",{requires:["mail-ui-mailcompose-v3","mail-ui-messagepane-utils","attachments-fresh_css","mail-ui-tray","escape","mail-ui-composeview-attach","editor-base","mail-common-utils-features","editor-para","editor-br","node","stylesheet","mail-controller-reply-processor","mail-controller-signature-processor","mail-controller-html-processor","common-persist-user-data","mail-models-draft","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose_fresh_conv","_shared_module_toolbar_compose_fresh","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_format_pop_out","_shared_module_rte_well_content_emoticons_fresh","_shared_module_rte_well_content_fontnamesize_fresh","_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_tabs_compose_fresh","_shared_module_offscreen_bin_notification_notifications","_shared_module_compose_dropzone","common-ui-toolbar-base","common-ui-menu-helper","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align","_shared_module_offscreen_bin_compose_menu_indent","mail-views-send-validation-error-handlers","mail-ui-composetictacapi","rte-file-utils","mail-ui-signature-tweet-view","common-utils-performance","mail-ui-folder-utils"]});
YUI.add("mail-core-net-policies-compose-policy",function(B){var A=function(){this.requests={};};B.mix(A.prototype,{enforce:function(E,D,C){B.Object.each(this.requests,function(F,H,G){E.cancel(H);});},add:function(E,D,C){if(!C.upload){this.requests[E]=C;}}});B.namespace("Mail.Core.Net.Policies").ComposePolicy=A;},"1.0.0",{requires:[]});YUI.add("mail-models-serializers-draft-formdata-serializer",function(e){var t=function(e){this.draft=e};e.mix(t.prototype,{data:function(){var t=new FormData;return t.append("jsonString",this.draft.jsonify()),e.Array.each(this.draft.attachments,function(e){if(e.state()==="pending"){if(e.size()===0){e.setState("failed");return}var n=e.getMultiPartName();e.getSourceType()==="file"&&t.append(n,e.file(),e.getFilename()),e.setState("uploading")}}),t},batchData:function(t){var n=new FormData;return n.append("batchJson",this.draft.batchJsonify(t)),e.Array.each(this.draft.attachments,function(e){if(e.state()==="pending"){if(e.size()===0){e.setState("failed");return}var t=e.getMultiPartName();e.getSourceType()==="file"&&n.append(t,e.file(),e.getFilename()),e.setState("uploading")}}),n}}),e.namespace("Mail.Models.Serializers").DraftFormData=t},"1.0.0",{requires:[]});
YUI.add("mail-models-serializers-draft-payloadpart-serializer",function(B){var A=function(C){this.draft=C;};B.mix(A.prototype,{format:function(){var C={partName:"jsonString",contentType:"application/json",payload:this.draft.jsonifyObj()};return[C];}});B.namespace("Mail.Models.Serializers").DraftPayloadPartSerializer=A;},"1.0.0",{requires:["mail-models-draft"]});YUI.add("mail-core-net-helpers-cascade-request-helper",function(D){var C=D.common.Utils.verify,B="/ws/mail/v2.0/jsonrpc";var A={getV2Endpoint:function(E){C(E,"method not supplied to getV2Endpoint");return(B+"?m="+E);},getV2EndpointBatch:function(){return B;},formatV2Payload:function(F,E){C(F&&E,"method and params not supplied to formatV2Payload");return({method:F,params:E});},formatV2GdmParams:function(G,E,F){F=F||"all";C(G&&E,"fid and mid not supplied to formatV2GdmParams");return{fid:G,enableRetry:true,textToHtml:true,urlDetection:true,emailDetection:true,qtAnnotate:{enable:true},emailComposeUrl:"mailto:%e%",truncateAt:100000,charsetHint:"",annotateOption:{annotateText:"inline"},message:this.formatV2GdmMsgParams(E,F)};},formatV2GetCidsParams:function(F,E){return[{fid:F,mids:[E]}];},formatV2GdmMsgParams:function(E,F){return([{blockImages:F,restrictCSS:true,expandCIDReferences:true,enableWarnings:true,mid:E}]);}};D.namespace("Mail.Core.Net.Helpers").CascadeRequestHelper=A;},"1.0.0",{requires:["common-utils"]});YUI.add("mail-controller-conv-adapter",function(e){function p(t){var n=40,r=e.Lang.trim(t.part[0].text);return r=r.substring(0,n),r.replace(/\n/g," ")}var t=e.mail.model.ConvStore.Conversations,n=e.mail.model.DataStore.Messages,r=e.common.Utils,i=r.getVal,s=e.mail.Controller.Folders,o="Draft",u="Sent",a=e.mail.ui.FolderUtils,f=a.SentFolderType,l=r.features,c=l.enabled("instantCloseOnSend"),h={_serializeSendMessageInfo:function(e,t,n){var r=t.sourceFolderInfo&&t.sourceFolderInfo.fid||u;return{mid:t.mid,cid:e,fid:r,snippet:t?t.snippet:p(t),sourceFolderInfo:{fid:r},receivedDate:i(t,"header.sentDate")||Math.floor((new Date).getTime()/1e3),flags:i(t,"flags")||{isRead:1},from:t.from,toEmail:i(t,"header.to")||n.to,subject:i(t,"header.subject")||n.subject}},_serializeSaveMessageInfo:function(e,t){var n=t.sourceFolderInfo&&t.sourceFolderInfo.fid||o;return{mid:t.mid,header:{from:e.from,to:e.to,cc:e.cc,bcc:e.bcc,subject:e.subject,replyto:e.replyto,receivedDate:Math.floor((new Date).getTime()/1e3)},cid:i(e,"origin.oMsg.cid"),fid:n,flags:{isRead:1},snippet:t.snippet||p(t),sourceFolderInfo:{fid:n},inReplyTo:i(e.origin,"parentMsg")?i(e.origin,"parentMsg.mimeMsgId"):i(e.origin,"oMsg.mimeMsgId")}},_send:function(r){var l={draft:r.draft,draftMid:r.draftMid},h=r.draft,p=r.draftMid,d=i(h,"origin.oMsg.cid"),v=r.msgResponse,m=r.midToCidResponse&&r.midToCidResponse[0]&&r.midToCidResponse[0].cid,g=a.getFolderByIndex(h&&h.folder&&h.folder.id),y=g&&g.folderInfo&&g.folderInfo.fid||o,b,w,E,S,x;try{p&&n.remove(y,p,!0,null,{reason:"sent"}),m&&t.getPermCidPart(m)===t.getPermCidPart(d)?(x=this._serializeSendMessageInfo(m,v,h),c?n.set(x.fid,v,"add",!0,function(t){return e.mail.Controller.Messages._process(t,{fid:x.fid,key:x.mid,msg:v}),t}):e.mail.Controller.Messages._preset({fid:x.fid,msgObj:v}),t.msgAdd(d,null,x,l,!0)):v&&(v.mid=v.mid||v.id,NeoConfig.imapIn?(S=s.get(v.sourceFolderInfo.fid).acctId,b=e.mail.Controller.ImapIn.getFolderByType(f,S),w=b.folderInfo.fid,E=b.folderInfo.name):(w=u,E=u),n.set(w,v,"add",!1,function(t){return t.sourceFolderInfo&&(t.sourceFolderInfo.name=E,t.sourceFolderInfo.fid=w),e.mail.Controller.Messages._process(t,{fid:w}),t}))}catch(T){}},_save:function(e){var r={draft:e.draft,draftMid:e.draftMid},s=e.draft,u=i(s,"origin.oMsg.cid"),f=e.msgResponse,l=e.draftMid,c=a.getFolderByIndex(s&&s.folder&&s.folder.id),h=c&&c.folderInfo&&c.folderInfo.fid||o,p;NeoConfig.hasConvView&&u?(p=this._serializeSaveMessageInfo(s,f),t.msgAdd(u,null,p,r)):f&&(p={mid:f.mid||f.id,flags:{}},n.set(h,p,"add")),l&&n.remove(h,l,!0,null,{reason:"savedraft"})},store:function(e){e.method==="send"?this._send(e):e.method==="save"&&this._save(e)}};e.namespace("mail.Controller").convAdapter=h},"1.0.0",{requires:["mail-model-convstore","mail-model-datastore","mail-controller-messages","common-utils","mail-controller-folders","mail-common-utils-features","mail-ui-folder-utils"]});
YUI.add("mail-models-attachment-preprocessor",function(e){function t(e,t){var n=0;for(n=0;n<e.length;n++)if(e[n].partId===t.partId)return e[n];return undefined}function n(e,t){var n,r=t.match(/\<(.+)\>/);return r&&(n=r[1]),!e[t]&&e[n]?(e[t]=e[n],delete e[n],!0):!1}var r=function(){};e.mix(r.prototype,{preProcess:function(r){var i=r.normalizedResponse.attachments,s=r.normalizedResponse.parts,o=r.normalizedResponse.mid,u,a,f,l,c,h=[],p=r.uploads||{},d=r.draft,v=d.attachments,m=d.attachments.map(function(e){return e.contentId()}),g=e.Array.hash(m,v);for(u=0;u<i.length;u++)l=i[u],f=l.contentId,h.push(f),n(p,f),r.saveSuccess&&(n(g,f)&&g[f].setContentId(f),g[f]?g[f].partId()!==l.partId&&(g[f].setData(t(s,l)),g[f].setMid(r.normalizedResponse.mid)):(l.currentSessionAttachment=!0,c=new e.mail.Models.Attachment(o,l),c.setData(t(s,l)),c.setState("saved"),c.setSavedInfo(l),d.addAttachment(c)),d.draftToDelete&&g[f].mid()===d.draftToDelete&&g[f].setMid(r.normalizedResponse.mid));if(r.saveSuccess)for(a in g)h.indexOf(a)<0&&g[a].state()==="saved"&&d.removeAttachment(a);return i}}),e.namespace("Mail.Models.Serializers").AttachmentRespPreprocessor=r},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add("mail-models-serializers-draft-messageV3-unserializer",function(e){var t=function(){};e.mix(t.prototype,{update:function(t,n){var r,i,s;s=e.common.Utils.getVal(n,"result.message"),s&&(r=e.common.Utils.getVal(s,"spame",null),t.setSpame(r?r:"U"),i=e.common.Utils.getVal(s,"csid",null),i&&(t.csid=i))}}),e.namespace("Mail.Models.Serializers").DraftMessageV3Unserializer=t},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-controller-messages-ops",function(e){function E(t,n,r){var i=n.method,s="passive";NeoGV.isYdod&&(o.settings.value("ydodActiveAPI",[]).indexOf(i)>-1&&(s="active"),e.fire("util:ymstats",{name:"ydodBlock",tags:{api:i,mode:s},include:{farm:!0}}),s==="active"&&r("failure"))}function S(e,t,n){var r,o,u=t.parms,a=t.reason,f=t.api,l=e.error,p,d,v;if(NeoConfig.scanMoveAction&&t.method==="MoveMessages")for(o=0;o<u.mid.length;o++)p=!1,u.mid[o]&&(v=typeof u.mid[o],v==="string"?p=H(u.mid[o]):v==="object"&&u.mid[o].hashKey?p=u.mid[o].hashKey:v==="object"&&u.mid[o].mid&&(p=H(u.mid[o].mid))),p&&b[p]&&delete b[p];if(l)for(o=0;o<l.length;o++)if(l[o].code!=="WARN")return n("failure"),c._error(e,h.invalidmid);if(t&&t.origParms&&(t.origParms.sourceFid&&t.origParms.sourceFid==="%40S%40Search"||t.origParms.fromSearch)||e&&e.fromSearch)d=d||{},d.fromSearch=!0;t&&t.origParms&&t.origParms.fromConv&&(d=d||{},d.fromConv=!0),(a==="remove"||a==="move")&&u.mid&&u.mid.length>200&&s.remove(u.sourceFid||u.fid,e.mid,!u.destinationFid,u.destinationFid,d),f==="move"&&!e.fromSearch&&u.mid&&u.mid.length&&s.move(u.sourceFid,u.destinationFid,u.mid,e.mid,a,d),r=e.sourceFolder,r&&t.custom.isSparse&&i.Folders.set(r,"ds:msg:",1),r=e.destinationFolder,r&&i.Folders.set(r,"ds:msg:",1)}function x(e,t){var n=e.destinationFid&&w.isSpamFid(e.destinationFid),r=t.origParms,i=r.destinationFid,o=r.sourceFid,u=t.origParms.mid,a,f,l;if(n){a={},w.isSpamFid(i)&&(a[g.spam]=1,a[g.ham]=0),w.isSpamFid(o)&&!w.isTrashFid(i)&&(a[g.ham]=1,a[g.spam]=0),s.update(e.sourceFid||e.fid,u,{flags:a},"flag");if(y)for(f=0;f<u.length;f++)u[f].flags.isRead=1}if(t&&t.origParms&&(t.origParms.sourceFid&&t.origParms.sourceFid==="%40S%40Search"||t.origParms.fromSearch)||e&&e.fromSearch)l=l||{},l.fromSearch=!0;t&&t.origParms&&t.origParms.fromConv&&(l=l||{},l.fromConv=!0),u.length<=200&&s.remove(e.sourceFid||e.fid,u,!e.destinationFid,e.destinationFid,l)}function T(e,t,n){var r=t.origParms,i,s=e.returnCodes;if(s&&s.length){for(i=0;i<s.length;i++)if(s[i].code!=="WARN")return n("failure"),c._error(e,h.invalidmid)}else r.mid?t.custom.isSparse&&N(r.setFlags,"read")&&!t.noRefresh&&!NeoConfig.hasConvView&&a.refresh():a.refresh()}function N(e,t){return e&&t in e}function C(e,t){var n,r,i=e.setFlags;if(t.origParms.chain)return;r={};for(n in i)r[g[n]]=i[n];r[g.spam]?r[g.ham]=0:r[g.ham]&&(r[g.spam]=0),f.isUndefined(i.spam)&&t.reason!=="move"&&s.update(e.fid,t.origParms.mid||[],{flags:r},t.reason)}function k(e,t){var n,r={},i,o,u=[],a={},l=t.parms,c=t.origParms.mid||[],h=e&&e.data&&e.data.returnCodes||[],p=l.setFlags;for(n in p)n==="read"&&(a[g[n]]=p[n]?0:1);if(!f.isUndefined(p.read)){for(i=0;i<c.length;i++)r[c[i].mid]=c[i];for(i=0;i<h.length;i++)o=r[h[i].mid],o&&u.push(o);s.update(l.fid,u,{flags:a},t.reason)}}function L(e,t){var n,r=0,i=t.origParms.mid;while(i[r])n=i[r++],n.header||(t.custom.isSparse=1)}function A(e,t){return t("failure"),c._error({},h.invalidparams)}function O(e,t){var n=0,r=e.mid;if(t)return e.mid=f.isArray(r)?r[0].mid:r.mid,1;f.isArray(r)||(r=r?[r]:[]),e.mid=[];for(;n<r.length;n++)e.mid[n]=r[n].mid||r[n];return n||e.selection}function M(t,r,i){var s=f.isArray(t.mid)?t.mid:new Array(t.mid),a,l,c,h={},p,v,m,g,y,b=[],E=10,S=t.sourceFid,x=S||t.fid;if(x==="%40S%40Search"){t.enableRetry=!0;if(!s[0])return;for(l=0,a=s.length;l<a;l++){p=s[l].fid||x;if(x==="%40S%40Search"||r.api!=="move"||!w.isDraftFid(p)&&!w.isSentFid(p)||!!w.isTrashFid(t.destinationFid))h[p]||(h[p]=[]),h[p].push(s[l])}if((m=o.size(h))===1&&p==="%40S%40Search")return;if(r.api==="remove"&&x==="%40S%40Search"){t.sourceFid=t.sourceFid||t.fid,delete t.fid,t.destinationFid=d,r.newApi("move","MoveMessages",t),i("pre","move"),i(1,t);return}delete t.mids;for(l in h)y=e.clone(t),S?y.sourceFid=l:y.fid=l,y.mid=h[l],t.sourceFid==="%40S%40Search"&&(y.fromSearch=!0),b[b.length]=y;o.assert(m===b.length);if(!(m>1))return b[0];var T=i(function(){r.cbk.abort()});g=Math.ceil(m/E);for(c=0;c<g;c++){v=u.batch().Messages;for(l=c*E;l<m&&l<c*E+E;l++)l===m-1?v[r.api](b[l],{success:function(e){T(e,"success",n.usercbk)},failure:function(e){T(e,"failure",n.usercbk)}}):v[r.api](b[l]);v.execute()}}}function _(e,t){var n=e.mid,r=e.fid;r==="%40S%40Search"&&(e.enableRetry=!0,n.fid&&n.fid!==r&&(e.fid=n.fid),O(e,t.api==="fullHeader"))}function D(t,n,r){var i=t.mid,u=t.setFlags,a=0,l=t.mid=[],c=w.isSpamFid(t.fid),h,p,d,m,b,E,S,x,T,N,C,k,L,M,_;if(o.isEmpty(u))return A(n,r);f.isArray(i)||(i=i?[i]:[]);if(u.spam&&!c||u.ham&&c||u.sendercompromised&&t.fid!==v||u.phished&&t.fid!==v||u.notmymail)d=1;while(i[a]){h=i[a++];if(!o.isEmpty(h.flags)){h=s.get(t.fid,h.mid)||h;for(p in u){if(h.flags[g[p]]!==u[p]||d){l.push(h);break}if(p==="read"){C=e.all('.thread-item[data-mid="'+s.getPermMidPart(h.mid)+'"]'),k=C.size();for(L=0;L<k;L++){_=h.flags[g.read]?0:1,M=C.item(L).hasClass("unread")?1:0;if(_!==M){l.push(h),o.log({m:"DS does not reflect UI for msg",mid:h.mid},!1,"InterruptBypassed");break}}}}}else l.push(h),n.custom.isSparse=1}if(i.length&&!l.length){r("success");return}if(!O(t))return A(n,r);!t.spam&&((S=u.notmymail)||(m=u.spam)||(b=u.sendercompromised)||(E=u.phished)||u.ham)&&(x=n.getBatch(),N=m||b||E||S?v:t.destinationFid||"Inbox",t.isImapIn&&(N=t.destinationFid,delete t.isImapIn),delete t.destinationFid,T={sourceFid:t.fid,destinationFid:N,mid:i||n.origParms.mid,spam:1,enableRetry:t.enableRetry||!1},t.fromConv&&(T.fromConv=t.fromConv),n.noRefresh=1,(b||E)&&!S&&y&&(u.read=1),r(1,t),x.Messages.move(T),x.execute(n.cbk)),delete t.spam}function P(e,t,n){var r,i,s=e.destinationFid,o=e.sourceFid,u,a;e.mid=e.mid?e.mid:[],u={fid:o,mid:f.isArray(e.mid)?e.mid:[e.mid],spam:1,enableRetry:e.enableRetry||!1},a=function(){var t,r=e.mid.length;if(r>100)return;for(var i=0;i<r;i++)t=e.mid[i]&&e.mid[i].mid&&H(e.mid[i].mid),t&&b[t]?n("failure"):b[t]=!0};if(s===o){n("success");return}e.spam||(w.isSpamFid(s)&&(i=u.setFlags={spam:1},y&&(i.read=1)),w.isSpamFid(o)&&!w.isTrashFid(s)&&(i=u.setFlags={ham:1})),!i&&NeoConfig.scanMoveAction&&a(),i&&(t.newApi("flag","FlagMessages"
,u),r=t.getBatch(),t.noRefresh=1,n("pre","flag"),n(1,u),e.spam=1,e.bidiDetection=NeoConfig.bidi,r.Messages.move(e),r.execute(t.cbk)),delete e.spam;if(!O(e))return A(t,n)}function H(e){var t=e.split("_");return t[t.length-1]}function B(e,t,n){var r=e.fid;if(!w.isTrashFid(r)&&!w.isDraftFid(r)&&!w.isSpamFid(r)&&e.fid!==p&&!e.force)return e.sourceFid=e.fid,delete e.fid,e.destinationFid=d,e.isImapIn&&(e.destinationFid=e.destFid,delete e.isImapIn),t.api=t.reason="move",t.method=l.passthru.move,n("pre","move"),e;delete e.force;if(!O(e))return A(t,n)}function j(t,n){NeoConfig.scanMoveAction&&n.method==="MoveMessages"&&t.fault==="aborted"&&(b=[]);if(t&&t.reason===h.invalidparams)return;n.parms.sourceFid&&s.flush(0,1),e.later(500,a,a.refresh)}function F(e,t){if(e&&e.reason===h.invalidparams)return;var n=t.parms;"read"in n.setFlags?a.refresh():s.flush(n.fid)}var t,n,r=e.mail,i=r.model.DataStore,s=i.Messages,o=e.common.Utils,u=r.Controller,a=u.Folders,f=e.Lang,l={passthru:{move:"MoveMessages",flag:"FlagMessages",remove:"DeleteMessages",fullHeader:"GetMessageRawHeader",redirectMsg:"RedirectMessage",addFilter:"AddFilters"},isdup:{FlagMessages:function(e,t){var n=e.setFlags,r=t.setFlags;if(e.mid&&t.mid&&e.mid.length===1&&t.mid.length===1&&e.mid[0]===t.mid[0]&&n.read===r.read&&n.flagged===r.flagged)return!0}}},c,h,p="%40C%40Chats",d="Trash",v="%40B%40Bulk",m="Draft",g={replied:"isReplied",flagged:"isFlagged",read:"isRead",draft:"isDraft",forwarded:"isForwarded",ham:"isHam",spam:"isSpam",notmymail:"notmymail"},y=strings.str_cfg_tog_set_spam_read_flag,b={},w=e.mail.ui.FolderUtils;l.batchable=l.passthru,c=u.extend("Messages",l),h=c.Error,n=l.order,e.mix(c,{fixFlagHook:D}),t={success:S,failure:j},c.hook({move:t,remove:t,flag:{success:T,failure:F}}),t={pre:x},c.hook({move:t,remove:t},0,n.optimistic),c.hook({move:{pre:M},remove:{pre:M},flag:{pre:M},fullHeader:{pre:_},redirectMsg:{pre:M}},0,n.fixParms),c.hook({move:{pre:P,aborted:j},remove:{pre:B,aborted:j},flag:{pre:D,aborted:F},redirectMsg:{pre:function(e){O(e)}}},0,n.fixParms),c.hook({flag:{pre:E},move:{pre:E}},0,n.ydodCheck),c.hook({move:{pre:L},flag:{pre:C,failure:k}},0,n.optimistic),e.mix(h,{invalidmid:h._reservedIdx+1,invalidparams:h._reservedIdx+1,noitems:h._reservedIdx+2})},"3.0.0",{requires:["mail-controller-base","mail-model-datastore","json-stringify","mail-ui-folder-utils","mail-common-utils-settings"]});
YUI.add("mail-services-compose",function(e){function f(n){t(n,"no V3 mailbox id supplied to compose service"),this.transport=new e.Mail.Core.Net.Transport(new e.Mail.Core.Net.Policies.ComposePolicy),this.v3url="/ws/v3/mailboxes/@.id=="+n+"/messages",this.gdmUnserializer=new e.Mail.Models.Serializers.DraftGdmUnserializer,this.attachmentRespPreprocessor=new e.Mail.Models.Serializers.AttachmentRespPreprocessor,this.msgUnserializer=new e.Mail.Models.Serializers.DraftMessageV3Unserializer}function l(t){var n=t.attachments.filter(function(e){return e.state()==="pending"&&e.size()!==0}),r=n.map(function(e){return e.contentId()});return e.Array.hash(r,n)}function c(e){var t=e.attachments.filter(function(e){return e.state()==="pending"&&e.isToFetchFromWeb()});return t}function h(t,n){t&&e.Object.each(t,function(e){e.transactionId=n.id})}function p(t,n){var r=n.loaded;t&&e.Object.each(t,function(e){e.progress=0;if(r>0){var t=r>e.file().size?1:r/e.file().size;r-=e.file().size,e.setProgress(t)}})}function d(e,t){e&&e.attachmentInfo&&t.loaded&&(e.attachmentInfo.bytesSent=Math.min(e.attachmentInfo.size,t.loaded))}function v(e,t){var n=!1;e.attachments.forEach(function(e){e.state()==="deleted"&&(n=!0,t.cancel(e.transactionId))}),n&&e.setState("unsaved")}function m(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&(n+=e[t].size());return n}function g(e){var t=Math.max(e*s,i);return t}function y(t,n,r){var i={contentInfo:t.getLogInfo()},s=n?e.Object.size(n):0;return s>0&&(i.attachmentInfo={count:s,size:r,bytesSent:0}),i}function b(t,n,r){var i,s,o,u;if(!r||e.Lang.isArray(r)&&r.length===0)e.Object.each(n,function(e){u=!0,e.setState("failed")});else for(s=0;s<r.length;s++){i=r[s],o=n[i.contentId];if(!o)continue;i.virus==="Y"?(o.setState("infected"),u=!0):o.setState("pending")}u&&t.setState("unsaved")}function w(e,t){t.forEach(function(t){var n=e.attachments.indexOf(t);n!==-1&&(e.attachments.splice(n,1),t.deleted())})}function E(t){if(t.draftToDelete){var n=function(){},r={success:n,failure:n,suppressNotification:!0};NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.deleteMessagesWithMid({messages:t.draftToDelete,sourceFid:"Draft",showTAE:!1}):e.mail.Controller.Messages.remove({fid:"Draft",mid:t.draftToDelete,force:!0},r),t.draftToDelete=void 0}}function S(e){var t=e.SaveMessage,r=e.SendMessage,i,s;return t&&r&&t.success&&!r.success&&(i=n(t,"response.result.message.captcha"),s=n(r,"response.error"),i&&s&&(s.code="batchCaptcha")),e}function x(e,t){if(e.code)switch(e.code){case"ET-5012":T(t)&&(e.code="virusDetected");break;default:}return e}function T(e){var t,n,r;if(!e||!e.result||!e.result.simpleBody||!e.result.simpleBody.attachments)return!1;t=e.result.simpleBody.attachments;for(r=0;r<t.length;r++){n=t[r].virus;if(n&&n==="Y")return!0}return!1}var t=e.common.Utils.verify,n=e.common.Utils.getVal,r=e.mail.Controller.convAdapter,i=35e3,s=10,o="SendMessage",u="SaveMessage",a="GetDisplayMessage";e.mix(f.prototype,{save:function(t,i,s){var o=this,u,a,f=t.draftToDelete?t.draftToDelete:t.mid,p=l(t),d=c(t),m=d.length>=1,g=e.Object.size(p)>0,y=!0,S=t.attachments.filter(function(e){return e.state()==="deleted"});return v(t,this.transport),t.generateCsid(),!g&&y?u=this.jsonSave(t,s):window.FormData&&window.FileReader?m?u=this.formDataSaveWithWebAttachments(t,p,d,s):u=this.formDataSave(t,p,s):u=this.iframeSave(t,p,s),h(p,u),u.then(function(n){return o.attachmentRespPreprocessor.preProcess({uploads:p,normalizedResponse:o._normalizeResponseObject(n),draft:t,saveSuccess:!0}),E(t),o.gdmUnserializer.update(t,p,n),o.msgUnserializer.update(t,n),o._updateDraftCaptcha(t,n),w(t,S),s.suppressDS||(a={method:"save",draft:t,draftMid:f,msgResponse:n.result.messageV2},r.store(a)),n},function(r){var i=o.attachmentRespPreprocessor.preProcess({uploads:p,normalizedResponse:o._normalizeResponseObject(n(r,"res.response")),draft:t,saveSuccess:!1});return b(t,p,i),r}),u},jsonSave:function(e,t){var n=this,r=e.jsonify(),s={options:{timeout:i},upload:!1,errHandler:x,suppressNotification:t&&t.suppressNotification,suppressStat:t&&t.suppressStat,logInfo:y(e)},o;return o=n.transport.request(n.v3url,r,s),o},getRequestConfig:function(t,n,r){var i=e.Object.size(n)>0,s=m(n),o=y(t,n,s);return{options:{progress:function(e,t){p(n,t),d(o,t)},timeout:g(s)},upload:i,errHandler:x,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:o}},formDataSaveWithWebAttachments:function(t,n,r,i){var s=this,o,u,a=t.attachments.filter(function(e){return e.state()==="pending"&&e.size()!==0}),f,l,c,h="/ws/v3/batch";return c=(new e.Mail.Models.Serializers.DraftFormData(t)).batchData({saveUrl:s.v3url,v3BatchUrl:h,webAttachments:r,uploads:a}),o=this.getRequestConfig(t,n,i),u=this.transport.request(h,c,o),f=function(e){var t=e.result.responses[0];return t&&t.id!=="SaveMessage"?Promise.reject({}):t.httpCode>=200&&t.httpCode<300?t.response:Promise.reject({status:t.httpCode,res:{status:t.httpCode,response:JSON.stringify(t),responseText:JSON.stringify(t)}})},l=function(e){return Promise.reject(e)},u.then(f,l)},formDataSave:function(t,n,r){var i=this,s=e.Object.size(n)>0,o=m(n),u=new e.Mail.Models.Serializers.DraftFormData(t),a=u.data(),f=y(t,n,o),l={options:{progress:function(e,t){p(n,t),d(f,t)},timeout:g(o)},upload:s,errHandler:x,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:f},c;return c=i.transport.request(i.v3url,a,l),c},iframeSave:function(t,n,r){var i=this,s=m(n);return e.Object.each(n,function(e){e.setState("uploading")}),new Promise(function(o,u){e.use("io-upload-iframe",function(){var e=t.formId,a={},f={options:{form:{id:e,upload:!0},timeout:g(s)},errHandler:x,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:y(t,n,s)};i.transport.request(i.v3url,a,f).then(o,u)})})},sendBatch:function(e,t){var n=this,r,s,f,l={},c=e.mid;return r=this._createSendBatch(e,t),s={options:{timeout:i},errHandlerBatch:S},t&&(s.logInfo=y(e)),f=this.transport.requestBatchMultipart
([r],s).then(function(i){return l.errDetail=i.errDetail,n._wasMessageSent(i,t)&&e.setState("sent"),t&&n._processBatchAPIResponse(i,u,"save",l,function(t){n._handleSaveResponse(e,t.save)||(l.failure="save")}),n._processBatchAPIResponse(i,o,"send",l,function(){n._handleSendResponse(e)}),e.isInConv()?n._processBatchAPIResponse(i,a,"sendGDM",l,function(t){n._updateConvStore(e,t.sendGDM,c)||(l.failure="sendGDM")}):n._updateMsgStore(e,c,l.save),l.failure?Promise.reject(l):l},function(t){return l.failure="batch",l.batch=t,l.errDetail=t.errDetail,Promise.reject(l)}),f},_processBatchAPIResponse:function(e,t,n,r,i){var s=e[t],o=s&&s.response;if(r.failure)return;r[n]=o,s.success?i&&i(r):r.failure=n},_createSendBatch:function(t,n){var r=e.Mail.Core.Net.Helpers.BatchRequestHelper,i=e.Mail.Core.Net.Helpers.CascadeRequestHelper,s=new e.Mail.Models.Serializers.DraftPayloadPartSerializer(t),f={select:{mid:"$..message.immutableid"}},l={select:{mid:"$..message.id"}},c,h,p,d,v,m,g;return h=n?"$(mid)":encodeURIComponent(this._transformMidToRFC4648(t.mid)),c=this.v3url+"/@.id=="+h+"/send",t.generateCsid(),p={csid:t.csid},!n&&t.captchaAnswer&&(p.captcha=t.captchaAnswer),g=v=r.wrapCall(c,o,!0,p),n&&(g=d=r.wrapCall(this.v3url,u,!1,s.format()),r.attachChildCall(v,d,f)),t.isInConv()&&(m=r.wrapCall(i.getV2EndpointBatch(),a,!0,i.formatV2Payload(a,i.formatV2GdmParams("Sent","$(mid)","none"))),r.attachChildCall(m,v,l)),{name:"batchJson",contentType:"application/json",content:e.JSON.stringify({responseType:"json",requests:[g]})}},_handleSaveResponse:function(e,t){return E(e),this.gdmUnserializer.update(e,null,t),this.msgUnserializer.update(e,t),!this._updateDraftCaptcha(e,t)&&!e.isSpame()},_handleSendResponse:function(t){var n,r,i;try{n=t.makeInReplyTo(),n&&(n.forwarded||n.replied)&&(r=[t.origin.action==="edit"?n.messageReference.id:t.origin.oMsg],i=n.forwarded?{forwarded:1}:{replied:1},NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.flagMessagesWithMid({messages:r,sourceFid:t.origin.fid,flags:i,statTAE:!1}):e.mail.Controller.Messages.flag({fid:t.origin.fid,mid:r,setFlags:i},{suppressCodes:["*"]}))}catch(s){}},_updateConvStore:function(e,t,n){try{r.store({method:"send",draft:e,draftMid:n,msgResponse:t.result.message[0],midToCidResponse:[{cid:e.cid}]})}catch(i){return!1}return!0},_updateMsgStore:function(e,t,i){try{r.store({method:"send",draft:e,draftMid:t,msgResponse:n(i,"result.messageV2")})}catch(s){return!1}return!0},_updateDraftCaptcha:function(e,t){return e.captchaAnswer=null,t.result.message&&t.result.message.captcha?(e.captcha=t.result.message.captcha,!0):(e.captcha=null,!1)},_wasMessageSent:function(e,t){if(!e[o].success)return!1;if(t)if(!e[u].success||n(e[u],"response.result.message.captcha")||n(e[u],"response.result.message.spame","U")==="N")return!1;return!0},_transformMidToRFC4648:function(e){var t=e;return t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t},_normalizeResponseObject:function(t){var r,i,s,o;if(typeof t=="string")try{r=e.JSON.parse(t)}catch(u){r={}}else r=t;return i=n(r,"result.simpleBody.attachments")||[],s=n(r,"result.messageV2.part")||[],o=n(r,"result.messageV2.mid")||"",{response:r,parts:s,attachments:i,mid:o}}}),e.namespace("Mail.Services").Compose=f},"1.0.0",{requires:["common-utils","json","json-parse","mail-core-net-policies-compose-policy","mail-core-net-transport","mail-models-serializers-draft-formdata-serializer","mail-models-serializers-draft-payloadpart-serializer","mail-core-net-helpers-batch-request-helper","mail-core-net-helpers-cascade-request-helper","mail-controller-conv-adapter","mail-models-serializers-draft-gdm-unserializer","mail-models-attachment-preprocessor","mail-models-serializers-draft-messageV3-unserializer","mail-controller-messages-ops"]});
YUI.add("mail-compose-syncer",function(e){function i(e,t){n(e.folder.id.length>0,"Syncer requires draft.folder.id"),this.draft=e,this.service=t,this.dirty=!1,e.setState("saved")}var t=e.common.Utils,n=t.verify,r=t.getVal;i.prototype={save:function(r){var i=this,s=i.draft,o=(new Date).getTime(),u,a;if(s.state!=="unsaved")return;e.fire("stat:feature_invoke",{feature_group:"SAVE",message:"UI_SAVE_V3_START_SUCCESS"}),t.features.enabled("compose_save_adr")&&!t.features.enabled("composeActivityAdr")&&(t.features.enabled("delaySaveDraftAdRotation")?e.later(t.settings.value("saveDraftAdRotationDelay"),null,function(){e.fire("darlaEvent",{action:"compose_save"})}):e.fire("darlaEvent",{action:"compose_save"})),this.dirty=!1,s.setState("saving"),a=this.service.save(s,!1,r),a.then(function(r){n(!s.hasCsid()||s.csid===r.result.messageV2.csid,"csid invariant violated on svr response."),e.fire("stat:feature_complete",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE_SUCCESS"}),e.fire("stat:feature_latency",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE",value:(new Date).getTime()-o}),e.fire("persist:save"),u=s.state,r.result.messageV2&&(s.lastSavedRawBody=r.result.messageV2.part[0]);if(!i.dirty){s.setState("saved");return}s.setState("saved"),s.setState(u),n(s.state==="unsaved","state inconsistent w/dirty flag")},function(n){if(s.state==="sending"){e.fire("stat:feature_complete",{feature_group:"SAVE",message:"UI_SAVE_V3_CANCELED_SUCCESS"});return}e.fire("stat:feature_fail",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE_FAILURE",visible:!0,api:"messageSave"}),s.setState("unsaved",n.errDetail)})},_getErrorDetail:function(t){var n={message:"SavingAndSending: transport failed",code:"unknown"},i,s;try{i=r(t,"res.response");if(i)return n.message=e.JSON.parse(t.res.response).error.message,n.code=e.JSON.parse(t.res.response).error.code,n;i=r(t,"sendResponse.res");if(i)return s=e.JSON.parse(i.responseText),s=e.JSON.parse(s.error.message),n=s.error,n;i=r(t,"saveResponse.res");if(i)return s=e.JSON.parse(i.responseText),s=e.JSON.parse(s.error.message),n=s.error,n}catch(o){return n.message="SavingAndSending: unknown error",n}return n},send:function(n){function l(e){var n=NeoConfig.serverTime-NeoConfig.userRegTime<u,r={invoke:["ONBOARDING_SEND_INVOKED","ONBOARDING_CTRL_SEND_INVOKED","UI_SEND_V3_START_SUCCESS"],success:["ONBOARDING_SEND_SUCCESS","ONBOARDING_CTRL_SEND_SUCCESS","UI_SEND_V3_COMPLETE_SUCCESS"],failure:["ONBOARDING_SEND_FAILED","ONBOARDING_CTRL_SEND_FAILED","UI_SEND_V3_COMPLETE_FAILURE"],latency:["ONBOARDING_SEND_LATENCY","ONBOARDING_CTRL_SEND_LATENCY","UI_SEND_V3_COMPLETE"]};return n&&t.features.enabled("onboardingTest")?r[e][0]:n&&t.features.enabled("onboardingctrl")?r[e][1]:r[e][2]}function c(){i.setState("final"),e.fire("stat:feature_complete",{feature_group:"SEND",recipients:o,message:l("success")+(i.getAccountId()==="1"?"":"_EXTERNAL")}),e.fire("stat:feature_latency",{feature_group:"SEND",recipients:o,message:l("latency"),value:(new Date).getTime()-s}),e.fire("SentSuccess",null,null,a)}function h(t){var n=r._getErrorDetail(t);if(i.state==="savingAndSending"&&i.isRejectedOnCaptcha()){i.setState("captchaing");return}i.state==="sending"&&n.code==="EC-4011"&&(r.draft.captcha=null,r.draft.captchaAnswer=null),e.fire("stat:feature_fail",{feature_group:"SEND",message:l("failure")+(i.getAccountId()==="1"?"":"_EXTERNAL"),recipients:o,visible:!0,api:"messageSend"}),i.setState("unsaved",n)}function p(t){var n=t.errDetail;if(t.failure==="save"&&i.isRejectedOnCaptcha()){i.setState("captchaing");return}t.failure==="send"&&n.code==="EC-4011"&&(r.draft.captcha=null,r.draft.captchaAnswer=null);if(t.failure==="getCids"||t.failure==="sendGDM"){c(t);return}e.fire("stat:feature_fail",{feature_group:"SEND",message:"UI_SEND_V3_COMPLETE_FAILURE",recipients:o,visible:!0,api:"messageSend"}),i.setState("unsaved",n)}var r=this,i=r.draft,s=(new Date).getTime(),o=i.to.length,u=86400,a,f;o+=i.cc?i.cc.length:0,o+=i.bcc?i.bcc.length:0;if(i.state==="saving"||i.state==="sending"||i.state==="savingAndSending"||i.state==="sent"||i.state==="final")return;e.fire("stat:feature_invoke",{feature_group:"SEND",recipients:o,message:l("invoke")+(i.getAccountId()==="1"?"":"_EXTERNAL")}),e.fire("SentStart"),this.dirty=!1,!i.hasAttachmentsToReconcile()&&(i.state==="captchaing"||i.state==="saved"&&i.hasCsid())?(i.setState("sending"),a="message_send",f=n?this.service.sendBatch(i,!1):this.service.send(i)):(i.setState("savingAndSending"),a="message_sendSave",f=n?this.service.sendBatch(i,!0):this.service.saveAndSend(i)),f.then(c,n?p:h)},edited:function(){this.draft.state!=="savingAndSending"&&this.draft.state!=="sending"&&this.draft.state!=="sent"&&this.draft.state!=="final"&&(this.dirty=!0,this.draft.setState("unsaved"))},unedited:function(){this.dirty=!1,this.draft.setState("saved")},isSaving:function(){return this.draft.state==="saving"},isEdited:function(){return this.draft.state==="unsaved"}},e.namespace("mail.Compose").Syncer=i},"1.0.0",{requires:["common-utils","mail-common-utils-features"]});
YUI.add("mail-model-spellcorrections",function(B){function A(){this.corrections=null;this.correctionsHash=null;this.publish("correctionsChanged");}B.mix(A.prototype,{setCorrections:function(C){this.corrections=C;this.fire("correctionsChanged");},setCorrectionsHash:function(C){this.correctionsHash=C;}});B.augment(A,B.EventTarget,true,null,{prefix:"spell"});B.namespace("mail.Model").SpellCorrections=A;},"1.0.0",{requires:["event-custom","oop"]});YUI.add("mail-controller-spell-processor",function(F){var C=F.common.Utils;var A={PREFIX:"spell",MIDPREFIX:"misspell-",MAX_SUGG:5,ERROR_404:"<html><head><title>Yahoo! - 404 Not Found</title><style>",MARK:"mark",MISPELLREG:null,MAX_SPELL_TEXT:51200};var B={},E={"str_rte_check_spelling":"NO_OP","str_rte_spell_lang_auto_select":"asl","str_rte_spell_lang_english_us":"en_US","str_rte_spell_lang_english_uk":"en_GB","str_rte_spell_lang_english_ca":"en_CA","str_rte_spell_lang_arabic":"ar","str_rte_spell_lang_bengali":"bn","str_rte_spell_lang_bulgarian":"bg","str_rte_spell_lang_croatian":"hr","str_rte_spell_lang_czech":"cs","str_rte_spell_lang_danish":"da","str_rte_spell_lang_dutch":"nl","str_rte_spell_lang_estonian":"et","str_rte_spell_lang_filipino":"tl","str_rte_spell_lang_finnish":"fi","str_rte_spell_lang_french_canada":"fr_CA","str_rte_spell_lang_french_france":"fr_FR","str_rte_spell_lang_french_switzerland":"fr_CH","str_rte_spell_lang_german_austria":"de_AT","str_rte_spell_lang_german_switzerland":"de_CH","str_rte_spell_lang_german_germany":"de_DE","str_rte_spell_lang_greek":"el","str_rte_spell_lang_gujarati":"gu","str_rte_spell_lang_hebrew":"he","str_rte_spell_lang_hindi":"hi","str_rte_spell_lang_hungarian":"hu","str_rte_spell_lang_indonesian":"id","str_rte_spell_lang_italian":"it","str_rte_spell_lang_kannada":"kn","str_rte_spell_lang_latvian":"lv","str_rte_spell_lang_lithuanian":"lt","str_rte_spell_lang_malay":"ms","str_rte_spell_lang_malayalam":"ml","str_rte_spell_lang_marathi":"mr","str_rte_spell_lang_norwegian_bokmal":"nb","str_rte_spell_lang_norwegian_nynorsk":"nn","str_rte_spell_lang_polish":"pl","str_rte_spell_lang_portuguese_brazil":"pt_BR","str_rte_spell_lang_portuguese_portugal":"pt_PT","str_rte_spell_lang_romanian":"ro","str_rte_spell_lang_russian":"ru","str_rte_spell_lang_serbian":"sr-cyrl","str_rte_spell_lang_slovak":"sk","str_rte_spell_lang_slovenian":"sl","str_rte_spell_lang_spanish":"es","str_rte_spell_lang_swedish":"sv","str_rte_spell_lang_tamil":"ta","str_rte_spell_lang_telugu":"te","str_rte_spell_lang_turkish":"tr","str_rte_spell_lang_ukrainian":"uk","str_rte_spell_lang_vietnamese":"vi"};var D={"en-US":"en_US","en-GB":"en_GB","en-CA":"en_CA","en-JO":"en_US","en-IN":"en_GB","ko-KR":"en_GB","en-SG":"en_GB","zh-Hant-TW":"en_GB","zh-Hant-HK":"en_GB","en-AU":"en_GB","en-NZ":"en_GB","en-MY":"en_GB","en-IE":"en_GB","en-PH":"en_GB","zh-CN":"en_GB","en-XC":"en_GB","en-035":"en_GB","th-TH":"en_GB","es-CL":"en_GB","es-US":"es","es-AR":"es","es-PE":"es","es-VE":"es","es-CO":"es","es-MX":"es","ar-JO":"ar","bn-BD":"bn","bg-BG":"bg","hr-HR":"hr","cs-CZ":"cs","da-DK":"da","nl-BE":"nl","nl-NL":"nl","et-EE":"et","tl-PH":"tl","fi-FI":"fi","fil-PH":"tl","fr-BE":"fr_FR","fr-CA":"fr_CA","fr-FR":"fr_FR","fr-CH":"fr_CH","de-AT":"de_AT","de-CH":"de_CH","de-DE":"de_DE","el-GR":"el","gu-IN":"gu","he-IL":"he","hi-IN":"hi","hu-HU":"hu","id-ID":"id","it-IT":"it","kn-IN":"kn","lv-LV":"lv","lt-LT":"lt","ms-MY":"ms","ml-IN":"ml","mr-IN":"mr","nb-NO":"nb","nn-NO":"nn","pl-PL":"pl","pt-BR":"pt_BR","pt-PT":"pt_PT","ro-RO":"ro","ru-RU":"ru","sr-Cyrl-RS":"sr-cyrl","sk-SK":"sk","sl-SI":"sl","es-ES":"es","sv-SE":"sv","ta-IN":"ta","te-IN":"te","tr-TR":"tr","uk-UA":"uk","vi-VN":"vi"};function G(){this.spellHelper=A;}F.mix(G.prototype,{checkSpelling:function(N,K,M,H,I){var O=this,T=this.getLangSymbol(H);if(T==="NO_OP"){return;}if(T===""||T==="asl"){T=false;}if(T==="fr_CA"){T="fr_FR";}var L=function(W){var V=(W)?F.JSON.parse(W.responseText):null;O._saveMisspelledWords(N,V);};var S={success:function(W){var V=(W)?F.JSON.parse(W.responseText):null;O._saveMisspelledWords(N,V);},failure:function(){},responseType:"text",args:{}};S.success=(I)?I:L;var Q=K.replace(/%/g,"%25");if(Q&&Q.length>A.MAX_SPELL_TEXT){Q=Q.substring(0,A.MAX_SPELL_TEXT);}if(Q.match(/<var.*yui-ie-cursor.*var>/g)){Q=Q.replace(/<var.*yui-ie-cursor.*var>/g,"");}var J={};J.text=Q;J.iformat="html";J.oformat="js";J.intl=M;J.lang=T;var P=NeoConfig.launch_protocol+document.location.host;var R=P+"/ysp.php";var U=F.common.net.SessionMgr.request(R,F.common.net.SessionMgr.formatQueryParams(J),S,"POST");U.setHeader("Content-Type","application/x-www-form-urlencoded");U.setHeader("Connection","close");U.send();},markMisspelledWords:function(N,H,Q){var O="";if(H&&H.length){var K=H.length;var J=0;var R="";var I=null,P=null;var L=0;for(var M=0;M<K;++M){L=parseInt(H[M].offset,10);I=H[M].word;if(this._isWordIgnored(I,Q)){continue;}O+=N.substring(J,L);P=N.substring(L,L+I.length);if(I===P){O+=this._getMarkerHtml(A.MIDPREFIX+M,P);}else{O+=P;R+=I+"="+P+"|";}J=L+I.length;}if(R){}O+=N.substr(J,N.length);}return O;},_saveMisspelledWords:function(I,H){var K={};if(H&&H.length){var M=H.length;for(var J=0;J<M;++J){var L=H[J].word;K[L]=H[J];}}I.setCorrectionsHash(K);I.setCorrections(H);},removeAllMarkers:function(I,J){var H=(J&&J.toUpperCase)?J.toUpperCase():"";I.all("span[class='"+A.MARK+"']").each(function(L){if(L.get("id").indexOf(A.MIDPREFIX)!==-1){var K=L.get("text").toUpperCase();if(H!==""&&H!==K){return;}I.insert(L.get("innerHTML"),L);L.purge();L.remove();}});},removeMarker:function(I,H){var J=H.get("innerHTML");this.updateMarker(I,H,J);},updateMarker:function(K,H,J){if(J){var I=H.cloneNode(true);I.set("innerHTML",J);I.removeClass(A.MARK);H.purge();H.replace(I);}else{H.purge();H.remove();}},_getMarkerHtml:function(H,I){var J=[];J.push('<span id="');J.push(H);J.push('" class="');J.push(A.MARK);J.push('">');J.push(I);J.push("</span>");return J.join("");},getLangSymbol:function(K){var H="",J,I;if(C.isEmpty(B)){for(I in E){J=strings[I];if(J){B[J]=E[I];}}}if(K){H=B[K];}else{H=D[NeoConfig.lang];}return(H)?H:"";},_getHeaderIgnoredWord:function(K){var I="";if(K){var J=0,H=K.length,L;for(J=0;J<H;J++){L=K[J];I+=L.name+" "+L.email+" ";}}return I;},gatherIgnoreWords:function(O,N){var L="";O.all("img").each(function(P){if(P.hasAttribute("alt")){var Q=P.get("alt");L+=Q+" ";}});if(N.currentAddress){L+=N.currentAddress+" ";}L+=this._getHeaderIgnoredWord(N.from);L+=this._getHeaderIgnoredWord(N.to);
L+=this._getHeaderIgnoredWord(N.cc);L+=this._getHeaderIgnoredWord(N.bcc);var H=F.common.persist.UserData;var K=H.get("userSendPref.defaultFromAddress")||"",J=H.get("userSendPref.defaultFromName")||"",I=H.get("userSendPref.defaultID")||"",M=H.get("userSendPref.loggedInAlias")||"";L+=K+" "+J+" "+I+" "+M+" ";L=L.toUpperCase();L=L.replace(/[\x21-\x40\x5B-\x60\x7B-\x7E]/g," ");L=L.replace(/([^;])[-_\s]+/g,"$1|");return L?L.split("|"):[];},_isWordIgnored:function(J,I){if(I.length===0){return false;}J=J.toUpperCase();var H=F.Array.indexOf(I,J);return(H!==-1);}});F.namespace("mail.Controller").SpellProcessor=new G();},"1.0.0",{requires:["mail-model-spellcorrections","common-net-sessionmgr","common-persist-user-data","json-parse"]});YUI.add("mail-controller-composecontent-helper",function(e){function n(e){this.ctrl=e,this.pendingInsertedItems={},this.bindComposeEvent()}var t=3e4;e.mix(n.prototype,{buildDomId:function(e){return"contentHelper_"+e},bindComposeEvent:function(){var e=this,t=e.ctrl.view;t.once("closeChange",e.destroy,e)},resolvePendingContent:function(e){var t=this,n,r;if(Object.keys(t.pendingInsertedItems).length>0)for(r in t.pendingInsertedItems)n=t.pendingInsertedItems[r],n.processOnNodeCallBack({htmlNode:e});return e},attachFromBlob:function(t,n){var r=new e.mail.Models.Attachment(null,{file:t.blob,filename:t.name,size:n,disposition:"attachment"});this.ctrl.draft.addAttachment(r),this.ctrl.draft.setState("unsaved"),this.ctrl.save()},attachFromMessageData:function(t,n){var r=t.mid,i=t.partId*1,s=t.name,o=t.thumbnailurl||t.thumbnail,u;if(!(e.Lang.isNumber(i)&&e.Lang.isString(s)&&e.Lang.isString(r)&&e.Lang.isString(o)))return;u=new e.mail.Models.Attachment(r,{mid:r,partId:i,filename:s,size:n,thumbnailurl:o,currentSessionAttachment:!0}),u.setState("uploaded"),this.ctrl.draft.addAttachment(u),this.ctrl.draft.setState("unsaved"),this.ctrl.save()},handleAttachment:function(e){var t=this;if(t.ctrl.willAttachmentOverflow(e.length))return;switch(e.type){case"attachment":t.attachFromMessageData(e.data,e.length);break;case"blob":t.attachFromBlob(e.data,e.length)}},processUneditableInsertion:function(e){var t="<p><br></p>",n=/\bcontenteditable\s*?=\s*?["']?false["']?\b/i.test(e);return n,e.length>20&&n&&(e=t+e+t),e},getInsertCompleteFunc:function(t){var n=this;return function(r){var i=r&&r.markup||t.markup,s=t.timerId,o=!1,u,a,f,l,c;t.processOnNode?f=r.htmlNode:(a=n.ctrl.view,l=a&&a.editor&&a.getRTE().rte,f=e.one(l&&l.element)),f&&(u=f.one("#"+n.buildDomId(t.markupId))),u&&u.getDOMNode()&&(i?(u.replace(i),o=!0):u.remove()),t.processOnNode||(o?e.fire("contentHelper:"+t.markupId+":insertionSuccess"):e.fire("contentHelper:"+t.markupId+":insertionFail"),s&&clearTimeout(s),c=n.pendingInsertedItems[t.markupId],c&&(c.resolveEventHandler.detach(),c.rejectEventHandler.detach(),delete n.pendingInsertedItems[t.markupId]))}},handleInsertText:function(n){var r=this,i=this.ctrl.view,s=n.data,o=i.getRTE().rte,u=o.getPluginByName("rte-caret-plugin"),a,f,l,c,h,p,d,v,m,g,y,b;o.setCaret();switch(n.type){case"plain":o.insertText(s);break;case"html":o.isRich&&(u.restoreCaret(),s=r.processUneditableInsertion(s),o.pushButton("insertHtml",s),u.scrollCaretIntoView());break;case"promisehtml":o.isRich&&(u.restoreCaret(),f=s.markupId,c='<div id="'+r.buildDomId(f)+'">'+s.updatingMarkup+"</div>",c=r.processUneditableInsertion(c),o.pushButton("insertHtml",c),u.scrollCaretIntoView(),p={markupId:f,markup:s.resolveMarkup},h={markupId:f,markup:s.rejectMarkup},d={markupId:f,markup:s.resolveMarkup,processOnNode:!0},m=r.getInsertCompleteFunc(p),v=r.getInsertCompleteFunc(h),g=r.getInsertCompleteFunc(d),a=setTimeout(m,t),p.timerId=a,h.timerId=a,d.timerId=a,l="contentHelper:"+f,b=e.once(l+":resolve",m),y=e.once(l+":reject",v),r.pendingInsertedItems[f]={timerId:a,processOnNodeCallBack:g,resolveEventHandler:b,rejectEventHandler:y});break;default:throw"unknow dataTransfer content type "+n.type}r.ctrl.draft.setState("unsaved"),r.ctrl.save()},handleInsertCloudLink:function(e){var t=this,n=t.ctrl.view,r=e.data,i=n.getRTE(),s;i.rte.isRich&&(s=t.prepareCardData(r),i.fire("cardify",[s],r.source))},prepareCardData:function(e){return{cardInfo:{url:e.shareableLink,title:e.name,type:"article",image:{},description:e.description},urlDomain:e.urlDomain}},handleDataTransfer:function(e){var t=this,n=e.payload,r=n&&n.content;if(!(n&&n.action&&r&&r.type&&r.data&&r.length>=0))return;switch(n.action){case"attach":t.handleAttachment(n.content);break;case"insertText":t.handleInsertText(n.content);break;case"insertCloudLink":t.handleInsertCloudLink(n.content);break;default:throw"unknow dataTransfer action"+n.action}t.ctrl.attachedUsingComposeAssist=e.payload.source==="compose_assist",t.ctrl.lastCAContentProvider=e.payload.contentProvider},destroy:function(){var e=this,t,n;for(n in e.pendingInsertedItems)t=e.pendingInsertedItems[n],t.resolveEventHandler.detach(),t.rejectEventHandler.detach(),clearTimeout(t.timerId)}}),e.namespace("mail.Controller").ComposeContentHelper=n},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add("mail-controller-inlineimage-processor",function(e){function t(){}function n(e){var t;return e.attachments?(t=e.attachments.reduce(function(e,t){return e+t.size()},0),t):0}function r(e){e&&e.attachments&&e.attachments.filter(function(e){return(e.state()==="failed"||e.state()==="infected")&&e.isInline()&&e.setState("deleted"),!0})}function i(t){var n=t.inlineImageNode,r=t.ctrl,i=t.lastExitCode,s=t.imageList,o=t.attachmentList,u=n.getAttribute("data-id"),a=s.get(u),f,l="",c,h;if(0!==i)return 1;if(!a)return 1;t.rteImagePlugin.setDraftModel(r.draft),f=a.get("attachment"),f&&f.state()!=="pending"&&(f.setState("deleted"),f=null);if(!f){h=a.processedFile.size;if(r.isOverMaxFileSize(t.existingAttachmentSize+h))return r.view.showAttachmentSizeDialog("25"),r.draft.fire("attachmentSizeOverflow"),t.node.all(".rte-inline-unsaved-image").remove(),1;t.existingAttachmentSize=t.existingAttachmentSize+h,f=new e.mail.Models.Attachment(null,{file:a.processedFile,filename:a.file.name,size:h,disposition:"inline",fetchFromWeb:a.isFromSrc,webUrl:a.webUrl,currentSessionAttachment:!0}),o.push(f),r.draft.addAttachment(f),a.set("attachment",f)}return c=f.contentId().match(/\<(.+)\>/),c&&(l=c[1]),n.setAttribute("src","cid://"+l),n.addClass("rte-inline-saved-image"),n.addClass(u),0}e.mix(t.prototype,{process:function(e,t){var s=e.getRteImagePlugin(),o,u;if(!s)return t;u={ctrl:e,lastExitCode:0,existingAttachmentSize:n(e.draft),attachmentList:[],imageList:s.imageList,node:t,rteImagePlugin:s},t.all(".rte-inline-unsaved-image").each(function(e){u.inlineImageNode=e,u.lastExitCode=i(u)}),t.all(".rte-inline-unsaved-image").removeClass("rte-inline-unsaved-image");if(1===u.lastExitCode)for(o=0;o<u.attachmentList.length;o++)u.attachmentList[o].setState("deleted");return r(e.draft),t}}),e.namespace("mail.Controller").InlineImageProcessor=new t},"1.0.0",{requires:["mail-common-utils-features"]});
YUI.add("mail-controller-compose-v3",function(e){function S(){var t=p.getVal(this,"view.editor.rte.element");if(!t)return;e.one(t).all("img").each(function(t){var n=t.getAttribute("data-id");n||t.setAttribute("data-id",e.common.Utils.guid())})}function x(e){var t=this;t.injectDataIdFromImages(),t.setDraftHeader(),t.setDraftBody(),t.syncer.save({suppressNotification:!!e,suppressStat:!!e})}function T(){var e=this;this.setDraftHeader(),this.setDraftBody({isSend:!0}),e._validateSend().then(function(){e.attachOnSend&&(e.draft.setState("unsaved"),e.attachOnSend=!1),e.syncer.send(!0),N.bind(e)()})["catch"](function(){e.cancelHideCompose()})}function N(){var t=this,n,r=t._getAttachmentStatInfo();t.draft.attachments&&t.draft.attachments.length&&(n=t.view.get("isQuickReply"),d.enabled("richcompose")&&e.fire("util:ymstats",{name:"compose_assist_att_send",tags:{caUsed:t.attachedUsingComposeAssist?1:0,type:n?"QR":"fullCmps"},include:{bucket:!0}}),e.fire("mt:click",{action:"tlbr_att_send",append:{ltxt:t.attachedUsingComposeAssist?"ca":"noca",cmpsType:n?"QR":"fullCmps"}})),e.fire("util:ymstats",{name:"compose_send_info",tags:{type:t._getMessageType(),attFilesCount:r.attFilesCount,attImagesCount:r.attImagesCount,inlineImagesCount:r.inlineImagesCount,caUsed:t.lastCAContentProvider||""},include:{bucket:!0}})}function C(){var e="newCompose",t;return t=this.draft.makeInReplyTo(),t&&(t.replied?e="reply":t.forwarded&&(e="forward")),e}function k(e){if(e<3)return""+e;if(e<=10)return"3to10";if(e>10)return"gt10"}function L(){var e=this,t=e.draft.getUploadedOrSavedAtt(),n=0,r=0,i=0,s;return t&&t.length&&t.forEach(function(e){s=e.state();if(!e.isCurrentSessionAttachment())return;e.isInline()?i+=1:e.isImage()?r+=1:n+=1}),{attFilesCount:k(n),attImagesCount:k(r),inlineImagesCount:k(i)}}function A(){var t=this,n=this.view.sendValidationHandlers,r=e.mail.Models.Validators.send,i=[],s={},o,u;if(!b){u=r.validateNotUploadingAttachments(t.draft);if(!u.valid)return n.handleUploadInProgress(),Promise.reject()}u=r.validateCleanAttachments(t.draft);if(!u.valid)return n.handleBadAttachments(u.cntInfected),t.view.tray.showError(),Promise.reject();u=r.validateAddress(t.draft);if(!u.valid)return n.handleAddressInvalid(u.invalidAddress),Promise.reject();u=r.validatePresenceOfRecipients(t.draft);if(!u.valid)return n.handleNoRecipients(),Promise.reject();u=r.validateNumberOfRecipients(t.draft);if(!u.valid)return n.handleTooManyRecipients(),Promise.reject();u=r.validateSpame(t.draft);if(!u.valid)return n.handleSpame(),Promise.reject();u=r.validatePresenceOfContent(t.draft),u.valid||i.push(new Promise(function(e,t){n.handleEmptyMessage(e,t)})),u=r.validateCaptcha(t.draft),u.valid||i.push(new Promise(function(e,r){n.handleCaptcha(e,r,t.draft)})),d.enabled("attachInReply")&&t.attachInReply&&(u=r.checkForAttachment(t.draft),u.valid||i.push(new Promise(function(e,r){n.handleNewRecipients(e,r,t)})));if("saving"===t.draft.state||b&&t.draft.isUploadingAttachments())b&&("unsaved"===t.draft.state&&t.save(),t.draft.isUploadingInlineImages()===!0?(t.attachOnSend=!0,s={isInlineImage:!0}):t.draft.isUploadingAttachments()===!0&&(t.attachOnSend=!0,s={isAttachment:!0})),o=function(e,n){b?t.scheduleHideCompose(s):t.view.showComposeShim(!0),t.draft.once("stateChanged",function(r){"saving"===r.prev&&"saved"===r.next||b&&"unsaved"===r.prev&&"saved"===r.next?setTimeout(function(){t.setDraftBody({isSend:!0}),e()},1):(b?t.cancelHideCompose():t.view.showComposeShim(!1),n())})},i.push(new Promise(o));return Promise.all(i)}function O(){this.syncer.edited()}function M(){this.syncer.unedited()}function _(){return this.syncer.isSaving()}function D(){return this.syncer.isEdited()}function P(){return this.prePopulated}function H(e){var t=this.view.getFontInfo(),n=this.view.getRTEDocNode(),r,i=p.getVal(this.draft.origin,"yqtdPrefix"),s="",o="",l=!!e&&e.isSend,c=this.draft.needsOutlookSupport,d=this.composeContentHelper;this.view._isSpellCheckActive()&&h.removeAllMarkers(n,null),this.view._isRTEActive()?(r=a.processDocNode(this.view.getContentNodeClone(),i),d&&(r=d.resolvePendingContent(r)),l||(r=f.process(this,r)),s=r.getHTML(),s=a.processRawHTML(s),s=a.wrap(s,t,c)):o=u.process(n),this.view.updateUploadForm&&(window.FormData===undefined||window.FileReader===undefined)&&this.view.updateUploadForm(),this.draft.setBody(o,s),this.view.dirty&&this.draft.setSpame("U")}function B(){var t=this.view.getHeader(),n=e.mail.Controller.mailComposeFromListHelper.getReplyTo;t.replyto={email:n(t.from.email),name:t.from.name},this.draft.setHeader(t)}function j(){this.edited(),this.save()}function F(){this.view.on("FullCompose:composeEvent",this.handleEvent,this)}function I(){var e,t;this.parent&&(e=this.parent.all(".compose-loading-wrapper"),e&&e.remove(),this.view.render(this.parent),this.composeViewTainer=this.view.baseNode),this.view.on("attachmentUpload",this.handleFileUpload,this),this.view.on("dataTransfer",this.composeContentHelper.handleDataTransfer,this.composeContentHelper),this.view.on("attachmentUploadForm",this.handleFileUploadForm,this),this.draft.on("stateChanged",this.handleStateChange,this),this.view.neoFire("composeEvent",{action:"bindComplete",ccv:this}),t=this.getRteImagePlugin(),t&&(t.setDraftModel(this.draft),t.on("inline-image-updated",this.handleInlineImageAdded,this))}function q(e){var t,n,r=d.enabled("ccOnSend"),i=m.get("ccOnSend"),s;if(r){s=l.getDefaultFromAddress(e.getAccountId());if(i==="bcc"||i==="both"){e.bcc||(e.bcc=[]),n=!1;for(t=0;!n&&t<e.bcc.length;t++)e.bcc[t].email===s.email&&(n=!0);n||e.bcc.push(s)}if(i==="cc"||i==="both"){e.cc||(e.cc=[]),n=!1;for(t=0;!n&&t<e.cc.length;t++)e.cc[t].email===s.email&&(n=!0);n||e.cc.push(s)}}}function R(t,n){var r=this,i=t&&t.fid,s=new e.Mail.Models.Draft,o=t&&t.flavor==="autocompose",u;return r.setDraftOrigin(s,t),u=s.folder,u.id=w(i),u.acctId=i&&e.mail.ui.FolderUtils.getAcctIdByFid(i),NeoConfig.imapIn&&!u.acctId&&(u.acctId=e.mail.Controller.ImapIn.getCurrentAccountId()),NeoConfig.am&&!u.acctId&&(u.acctId=e.mail.ui.FolderUtils
.PrimaryAcctId),n||r.setMessageFromAddress(s),t&&t.cbfn&&(this.prePopulated=t.cbfn(s,t)),!n&&!o&&c.insertSignature(s,g.get("userUIPref.useRichText")),n||r._setAutoCC(s),s}function U(e){var t=this,n=e.action;t.eventHandlers&&t.eventHandlers[n]&&t.eventHandlers[n](e)}function z(e){var t=new FileReader;return new Promise(function(n){t.onload=function(t){e.realSize=t.total,n()},t.onerror=function(){e.realSize=0,n()},t.readAsArrayBuffer(e)})}function W(t,n,r){var i=this,s=n.reduce(function(e,t){return e+t.size()},0),o=[],u=0;e.Array.each(t,function(e){o.push(i._findRealFileSize(e))}),Promise.all(o).then(function(){u=t.reduce(function(e,t){return e+t.realSize},0),typeof r=="function"&&r(s,u)})}function X(n){var i=this,s=this.draft.attachments,u=Promise.resolve();return i._determineSize(n.files,s,function(a,f){var l=o.get("largeFileUploaders"),c=n.files.filter(function(e){return e.realSize===0});if(c.length>0){i.view.showAttachmentEmptyDialog(c);return}i.isOverMaxFileSize(a+f)?l.length>0?u=l[0].upload(n.files).then(function(e){i.view.addCards(e)}):i.view.showAttachmentSizeDialog(t):s.length+n.files.length>r?i.view.showAttachmentCountDialog(r):(e.Array.each(n.files,function(t){i.draft.addAttachment(new e.mail.Models.Attachment(null,{file:t,filename:t.name,size:t.realSize,currentSessionAttachment:!0}))}),i.edited(),i.save())}),u}function V(t){var n=this,i=t.inputEl,s=i.value||"",o=s.substr(s.lastIndexOf("\\")+1);n.draft.attachments.length+1>r?n.view.showAttachmentCountDialog(r):(n.draft.addAttachment(new e.mail.Models.Attachment(null,{inputEl:i,filename:o,size:1})),n.edited(),n.save())}function $(e){var n=this,i=n.draft.attachments,s=t+"",o=i.reduce(function(e,t){return e+t.size()},0);return n.isOverMaxFileSize(o+e)?(n.view.showAttachmentSizeDialog(s),!0):i.length+1>r?(n.view.showAttachmentCountDialog(r),!0):!1}function J(e){var t=this;e.next==="sent"?(t.view.dirty=!1,t.eventHandlers.closeAction(e)):!b||e.next!=="sending"&&e.next!=="savingAndSending"?e.next==="final"?t.autoAddContacts(t.draft):e.next==="captchaing"&&(t.captchaRetryCount>=i?(t.captchaRetryCount=0,t.draft.setState("unsaved",{code:"EP-4010"})):(t.captchaRetryCount++,t._validateSend().then(function(){t.syncer.send(!0)})["catch"](function(){t.draft.setState("saved"),t.cancelHideCompose()}))):t.scheduleHideCompose()}function K(e){var t=this,n=v&&v.value("showSendingDelay"),r=t.view.get("isQuickReply"),i;if(!t.eventHandlers.hideAction)return;if(t.view.cancelShowComposeNotification===!0){t.view.cancelShowComposeNotification=!1;return}n&&n>0?t.timers.push(setTimeout(t._showComposeNotification.bind(this,e),n)):t._showComposeNotification(e),t.view.dirty=!1,r&&(i=t.draft.from),t.eventHandlers.hideAction(i)}function Q(t){var n=this,r=n.draft.state,i=n.view,s=t&&t.isAttachment,o=t&&t.isInlineImage,u=r==="sending"||r==="savingAndSending",a={type:"info",speed:"show-medium"},f,l,c;if(n.view.cancelShowComposeNotification===!0){n.view.cancelShowComposeNotification=!1;return}o&&!u?(f=strings.str_comp_inline_image_attach_progress,c="InlineAttaching"):s&&!u?(f=strings.str_comp_attach_upload_progress,c="Attaching"):(f=strings.str_comp_sending,c="Sending"),l='<span class="s-loader"></span><span class="message">'+f+"</span>",e.fire("util:ymstats",{name:"compose_sending_notification",tags:{agent:NeoConfig.browser,isCorp:NeoConfig.isCorpmail?1:0,action:c,show:!0}});if(!u&&!s&&!o){r==="final"&&e.fire("util:ymstats",{name:"compose_sending_notification",tags:{agent:NeoConfig.browser,isCorp:NeoConfig.isCorpmail?1:0,action:"Sent",show:!1}});return}e.use("common-ui-notification-v2",function(e){var t=e.common.ui.NotificationV2;i.lastNotification?i.lastNotification=t.update(l,a):i.lastNotification=t.notify(l,a)})}function G(){var t=this;!NeoConfig.isAMT&&g.get("userSendPref.addUnknownContact")!=="prompt"&&e.use("mail-controller-contact-processor",function(e){e.mail.Controller.ContactProcessor.addContacts(t.draft)})}function Y(e){var t=e.header||{},n=e.getAccountId();t.from=l.getDefaultFromAddress(n),e.setHeader(t)}function Z(e,t){t&&t.action&&t.fid&&t.oMsg&&e.setOrigin({action:t.action,fid:t.fid,oMsg:t.oMsg,parentMsg:t.parentMsg,forwardAsAttachment:t.forwardAsAttachment,ctxReq:null})}function et(e){this.parent=e}function tt(e){var t=this;t.view.isSending=!1,t.view.resetSaveTimer(),e&&(t.view.dirty=!0,t.view.allowSend=!0),t.composeActive=!0}function nt(){var e=p.getVal(this,"view.editor.rte.plugins"),t=0;if(!e)return null;for(t=0;t<e.length;t++)if(e[t].name==="inline-image-plugin")return e[t];return null}function rt(e){return e>n}function it(){var e=this,t=e.timers,n=0,r=t&&t.length;if(!r||r<1)return;for(n=0;n<r;n++)clearTimeout(t[n]);e.timers=[]}function st(){var e=this;e._destroyTimers()}function ot(e){var t=this,n=v&&v.value("closeComposeDelay");t.view.cancelShowComposeNotification=!1,n&&n>0?(t._unsetHideComposeTimer(),t.hideComposeTimer=setTimeout(function(){t._hideComposeTab(e)},n),t.timers.push(t.hideComposeTimer)):t._hideComposeTab(e)}function ut(){var e=this;e.hideComposeTimer||(clearTimeout(e.hideComposeTimer),e.hideComposeTimer=undefined)}function at(){var e=this;e.view.cancelShowComposeNotification=!0,e._destroyTimers(),e.view.lastNotification&&e.view.lastNotification.clearAll(),e.view.set("viewable",!0),e.view.neoFire("composeEvent",{action:"showAction"})}var t=25,n=t*1024*1024,r=50,i=2,s=e.common,o=e.Mail.Services.Plugins,u=e.mail.Controller.TextProcessor,a=e.mail.Controller.HtmlProcessor,f=e.mail.Controller.InlineImageProcessor,l=e.mail.Controller.ReplyProcessor,c=e.mail.Controller.SignatureProcessor,h=e.mail.Controller.SpellProcessor,p=s.Utils,d=p.features,v=p.settings,m=e.mail.persist.MetaData,g=s.persist.UserData,y=e.mail.ui.FolderUtils,b=d.enabled("instantCloseOnSend"),w=function(t){var n,r,i,s;return NeoConfig.imapIn?(s=e.mail.ui.FolderUtils,i=e.mail.Controller.ImapIn,r=s.get(t).acctId||i.getCurrentAccountId(),n=""+i.getFolderByType(s.DraftFolderType,r).folderInfo.index):n=""+y.getFolderByName("Draft").folderInfo.index,n},E=function(t,n,r,i,s){this
.parent=t,this.draft=this.initDraftModel(r,s),this.eventHandlers=n||{},this.view=new e.mail.Views.Compose(this.draft,this,s,r,i),this.service=new e.Mail.Services.Compose(NeoConfig.V3MailboxId),this.syncer=new e.mail.Compose.Syncer(this.draft,this.service),this.composeContentHelper=new e.mail.Controller.ComposeContentHelper(this),this.captchaRetryCount=0,this.attachInReply=!0,this.timers=[],this.hideComposeTimer,n&&this.bindComposeEvent()};E.prototype={save:x,send:T,edited:O,unedited:M,isSaving:_,isEdited:D,isPopulated:P,setDraftHeader:B,setDraftBody:H,initDraftModel:R,setMessageFromAddress:Y,setDraftOrigin:Z,bindComposeView:I,bindComposeEvent:F,setParent:et,handleEvent:U,handleFileUpload:X,handleFileUploadForm:V,willAttachmentOverflow:$,handleStateChange:J,autoAddContacts:G,showCompose:tt,isOverMaxFileSize:rt,getRteImagePlugin:nt,handleInlineImageAdded:j,injectDataIdFromImages:S,_validateSend:A,_findRealFileSize:z,_determineSize:W,_setAutoCC:q,_getAttachmentStatInfo:L,_getMessageType:C,destructor:st,scheduleHideCompose:ot,cancelHideCompose:at,_hideComposeTab:K,_showComposeNotification:Q,_unsetHideComposeTimer:ut,_destroyTimers:it},e.namespace("mail.Controller").ComposeController=E},"1.0.0",{requires:["mail-ui-fullcompose-v3","mail-models-validators-send","mail-model-datastore","mail-models-draft","mail-model-attachment","mail-services-compose","mail-services-plugins","mail-compose-syncer","mail-controller-reply-processor","mail-controller-html-processor","mail-controller-text-processor","mail-controller-signature-processor","mail-controller-spell-processor","mail-ui-mailcompose-header-form-list-helper","mail-controller-composecontent-helper","mail-controller-inlineimage-processor","mail-common-utils-features","rte-file-utils","mail-ui-folder-utils"]});
YUI.add("mail-ui-authorview-v3",function(e){function f(){var t=this;t.closeChgHandler=t.on("closeChange",t.handleCloseChange,t),t.activeChangeHandler=t.on("activeChange",t.handleActiveChange),NeoConfig.hasConvView?t.msgsRemoveHandler=e.on("ds:conv:remove",t.handleConvRemove,t):t.msgsRemoveHandler=e.on("ds:msg:remove",t.handleMsgRemove,t)}function l(e){var t=this;e.newVal?(t.view.set("active",!0),t.view.showComposeView(e)):(t.view.set("active",!1),t.view.hideComposeView(e))}function c(e){var t=this;e.newVal&&t.view.closeCompose()}function h(e,t,n,r,i){var s,o=t||[],a;if(i&&i.reason==="savedraft")return;if(!u.isDraftFid(e))return;for(s=0;s<o.length;s++)a=o[s],this.view.getDraftMID()===a.mid&&this.set("close",1)}function p(e,t){var n,r=t||[],i;if(!u.isDraftFid(e))return;for(n=0;n<r.length;n++)i=r[n],i.totalMsgs===1&&this.view.getDraftMID()===i.recentmid&&this.set("close",1)}function d(e){var t="str_comp_nosubject",n=e||strings[t];this.set("title",n)}function v(e){this.set("direction",e)}function m(e){var t=this,n=t.localCharCodes.length,r;for(r=0;r<n;r++)if(e===t.localCharCodes[r])return!0;return!1}function g(){var e=this;if(e.view)return[e.view]}function y(t){var n=this,r=t.keyCode;r=n.keyCodesL10N[r]||r;switch(r){case 220:if(!t.altKey&&(t.metaKey||t.ctrlKey))return n.set("close",1),!0;break;case 27:return n.controller&&(n.controller.closeSrc="escKey"),(!e.ACWidgetInst.handleEscape||!e.ACWidgetInst.handleEscape())&&n.set("close",1),!0}return e.UA.ie&&n.view.onLocalKeyDown&&!n.view.onLocalKeyDown(t)?!1:n.view&&n.view.onKeyDown?n.view.onKeyDown(t):null}function b(e){return this.view.onFocus(e)}function w(){return this.view.isDirty()}function E(){return!this.isDirty()&&!this.view.hasContent()}function S(e){var t=this;return t.view.matchOrigin?t.view.matchOrigin(e):!1}function x(t,n){var r=this;return r.view=r.createComposeController(t,n).view,r.view.handles.push(r.view.on("renderComplete",function(){r.set("rootNode",r.get("parentNode").one("div.compose")),t&&t.postRender&&t.postRender(r,t),s.enabled("richcompose")&&(!r.view.get("isQuickReply")||s.enabled("richcomposeInQuickReply"))&&e.use("mail-ui-richcompose-view",function(e){r.richcompose||(r.richcompose=new e.mail.Views.RichCompose(r,r.view))})})),t&&t.oMsg&&t.oMsg.header&&(t.oMsg.header.subject=e.mail.Controller.ReplyProcessor.seedSubject(t)),r.view}function T(t,n){var r=this,s=null,o;return i({m:"start creating ComposeController"}),o={keydownHandler:e.bind(r.onKeyDown,r)},s=new e.mail.Controller.ComposeController(r.get("parentNode"),r.getEventBindings(),t,o,n),s.handles=[],r.controller=s,s}function N(e){e.action=e.type,this.fire("darlaEvent",e)}function C(){var e=this;e.parent=e.get("parentNode"),e.controller.setParent(e.parent),e.controller.bindComposeView()}function k(t){var n=this,r=e.one(t);n.set("parentNode",r),n.set("rootNode",r.one("div.compose"));return}function L(){return}function A(e){var t=this;t.controller.composeViewTainer&&this.controller.composeViewTainer.one(".composeshim")[e?"removeClass":"addClass"]("hidden"),e?t.tab&&t.tab.elTab.addClass("sending"):t.tab&&t.tab.elTab.removeClass("sending")}function O(){var e=this,t=e.view.getSubjectInfo();t.subjectVal?(e.updateTabTitle(n(r(t.subjectVal))),t.subjectDir&&e.updateTabDirection(t.subjectDir)):(e.updateTabTitle(e.view.title),t.subjectDir&&e.updateTabDirection(""))}function M(){var e=this;e.msgsRemoveHandler&&e.msgsRemoveHandler.detach(),e.closeChgHandler&&e.closeChgHandler.detach(),e.toolBarHandler&&e.toolBarHandler.detach(),e.activeChangeHandler&&e.activeChangeHandler.detach(),e.view&&e.view.controller&&e.view.controller.destructor(),a.superclass.ondestroy.call(e,arguments)}function _(t){var i=this;i.updateTabTitle(n(r(t.subject))),NeoConfig.bidi&&i.updateTabDirection(e.Intl.detectDirection(t.subject))}function D(e){return this.view.canClose(e)}function P(t){e.fire("compose:rte:active",{editor:t.editor,cv:t.cv})}function H(e){var t=this;this.view.fire("composeWillClose"),e.forceClose&&t.set("forceClose",1),t.set("close",1)}function B(){var e=this;e.tab.set("viewable",!1)}function j(){var e=this;e.tab.set("viewable",!0)}function F(e){this.set("focusNode",e.focusNode)}function I(){this.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(this.tab)}function q(t){var n=this;n.tab!==e.mail.Tabs.getActiveTab()?e.mail.Tabs.switchToTab(n.tab,t.sdcbk()):t.sdcbk()}function R(e){var t=this;e.sending?t.tab&&t.tab.elTab.addClass("sending"):(t.tab&&t.tab.elTab.removeClass("sending"),e.title?t.updateTabTitle(e.title):t.setSubjectAsTitle())}function U(){var t=this,n={updateSubject:e.bind(t.setSubjectAsTitle,t),closeAction:e.bind(t.closeAction,t),setActiveCompose:e.bind(t.setActiveCompose,t),qrCancel:e.bind(t.closeAction,t),replyheaderLoad:e.bind(t.replyheaderLoad,t),setFocusNode:e.bind(t.setFocusNode,t),showSaveDialog:e.bind(t.showSaveDialog,t),showCompose:e.bind(t.showCompose,t),addChild:e.bind(function(e){this.addChild(e.view)},t),removeChild:e.bind(function(e){this.removeChild(e.view)},t),updateTitle:e.bind(t.updateTitle,t),switchToTab:e.bind(t.switchToTab,t),darlaEvent:e.bind(t.fireDarlaEvent,t)};return o&&(n.hideAction=e.bind(t.hideAction,t),n.showAction=e.bind(t.showAction,t)),n}function z(){var e=this,t=e.view&&e.view.draft&&e.view.draft.folder.acctId;return t}var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=t.log,s=t.features,o=s.enabled("instantCloseOnSend"),u=e.mail.ui.FolderUtils,a=function(t){var n=this,r;n.keyCodes=[],n.keyCodesL10N={},n.parent=null,n.view=null,n.controller=null,n.localCharCodes=[8,77,78,73,84],n.composeActive=!0,n.type="author",n.widgetType="compose",n.keyCodesL10N[strings.str_cfg_sc_keycode_save_as_draft]=83,n.keyCodesL10N[strings.str_cfg_sc_keycode_close_tab]=220;for(r in n.keyCodesL10N)n.keyCodes.push(r);a.superclass.constructor.call(n,t),n.bind(),n.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+n.keyCodes.join("+ctrl,")+"+ctrl,"+n.keyCodes.join("+meta,")+"+meta"),e.UA.ie&&n.set("localCharCodes",n.localCharCodes.join()),n.updateTabTitle
(n.get("title"))};e.extend(a,e.mail.ui.BaseWidget),e.mix(a.prototype,{NAME:"AuthorView",ondestroy:M,onKeyDown:y,onFocus:b,bind:f,bindUI:L,render:k,initCompose:x,createComposeController:T,bindComposeView:C,isLocalCharCode:m,isDirty:w,isClean:E,matchOrigin:S,updateTabTitle:d,updateTabDirection:v,handleCloseChange:c,showComposeShim:A,getComposeWidgets:g,setSubjectAsTitle:O,setFocusNode:F,showSaveDialog:q,_canClose:D,closeAction:H,hideAction:B,showAction:j,setActiveCompose:P,handleActiveChange:l,replyheaderLoad:_,getEventBindings:U,updateTitle:R,switchToTab:I,handleConvRemove:p,handleMsgRemove:h,fireDarlaEvent:N,getDraftAcctId:z},!0),e.namespace("mail.ui"),e.mail.ui.AuthorViewConv=a},"1.0.0",{requires:["mail-controller-base","mail-controller-reply-processor","_shared_module_compose_title","mail-common-utils-features","mail-controller-compose-v3","mail-ui-folder-utils"]});
YUI.add("common-utils-onboarding",function(e){var t,n,r,i=e.mail.ui.FolderUtils,s;s={setRestartBuckets:function(){return(new Promise(function(t){e.contacts.utils.areContactsLoaded()?t():e.once("contacts:api:loaded",t)})).then(function(){var s=0,o=i.get(i.getInboxFid()).total||0,u=i.get(i.getInboxFid()).unread||0,a=[100,500,1e3,5e3,1e4];e.contacts.utils.areContactsLoaded()&&(s=e.contacts.utils.getTotalContacts()),t=[10,50,100,500,1e3].filter(function(e){return s<e})[0]||"gt_1000",n=a.filter(function(e){return o<e})[0]||"gt_10000",r=a.filter(function(e){return u<e})[0]||"gt_10000"})},statRestartEligibility:function(){s.getRestartBuckets().then(function(){e.fire("util:ymstats",{name:"restart_eligible",tags:{contactsBucket:t,inboxCountBucket:n,unreadInboxCountBucket:r,segment:NeoConfig.webEngScore}})})},getRestartBuckets:function(){return(new Promise(function(e){typeof t=="undefined"?e(s.setRestartBuckets()):e()})).then(function(){return{contactsBucket:t,inboxCountBucket:n,unreadInboxCountBucket:r}})}},e.namespace("common.Utils").Onboarding=s},"1.0.0",{requires:["common-utils","contacts-api","contacts-api-utils","mail-ui-folder-utils"]});
