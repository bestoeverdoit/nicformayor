"use strict";YUI.add("tictac-atm",function(a){var b,c=0,d=a.common.Utils.features,e=d.enabled("DocPreviewScroll"),f=d.enabled("docPreview"),g=d.enabled("DocPreviewPreConvert")&&e;a.namespace("Tictac.atm").loader=function(c,d,e,f){var g=a.Tictac.base.getAssetURL("js/","tictac-atm",null),h=a.Tictac.base.getTictacVersion("atm").filter||"min";f=f||{},a.Tictac.base.defineModuleGroup("tictacs",{filter:h,modules:{"tictac-atm-strings":{path:g+"strings/lang_"+(window.NeoConfig?window.NeoConfig.lang:"en-US")+"-min.js"}}},"min"===h),a.use("tictac-base-stats","tictac-base-batch-transport","tictac-att-attachments","tictac-att-downloader","tictac-att-slideshow","tictac-att-filter","tictac-base-utils","tictac-att-attachment-tray","tictac-atm-strings",function(){b=new a.Tictac.base.Stats({name:"atm",yamas:!0}),c.target!==a&&(b.stat("invoke"),a.Tictac.atm.callback(c,d,e,f))})},a.Tictac.atm.callback=function(e,h,i,j){function k(){return i.one(".icon.file")}function l(){var a=k();a&&a.addClass("hidden")}function m(a){var b=k();b&&(M.push(b.on(["click","keydown"],function(a){"keydown"===a.type&&13!==a.keyCode||(i.one(".tictac-att-tray-base").getDOMNode().scrollIntoView(),i.one(".tictac-att-header-count").focus(),a.halt())})),b.addClass("s-tp"),b.set("title",L[a>1?"str_view_attachments":"str_view_attachment"]),b.set("aria-label",L[a>1?"str_view_attachments":"str_view_attachment"]))}function n(){var a=k();a&&(a.removeClass("s-tp"),a.removeAttribute("title"))}function o(a){for(;P<a.length;){if(("ics"===a[P].type||"ics"===a[P].subtype||"ics"===a[P].filetype||"vcs"===a[P].type||"vcs"===a[P].subtype||"vcs"===a[P].filetype||"calendar"===a[P].type||"calendar"===a[P].subtype||"calendar"===a[P].filetype)&&"reply.ics"!==a[P].filename&&0!==h.header.subject.indexOf("Accepted:")&&0!==h.header.subject.indexOf("Declined:")&&0!==h.header.subject.indexOf("Tentative:")){a.splice(P,1);break}P++}}function p(c,d,e){var f,g=a.Tictac.att.downloader;f=d&&d.getObject?[d.getObject({simple:!0})]:a.Array.map(d,function(a){return a.getObject({simple:!0})}),g.setStats(b),g.download(c,f,e)}function q(b){return b&&b.getObject?[b.getObject({simple:!0})]:a.Array.map(b,function(a){return a.getObject({simple:!0})})}function r(c,d,g,j){var k,l,m,n=c&&c.currentTarget.ancestor("li",!0),o=!!g,q=n&&F.get(n.getAttribute("data-id")),r=!!(c&&c.currentTarget&&c.currentTarget.one(".disable-preview"));if(!r){if(g=n&&n.getAttribute("data-id")||g,!g){k=F.getArray();for(l in k)if("attachment"===k[l].disposition){o=!0,g=k[l].aid;break}}o=o||q.isViewable(),o&&!d?f?(m=i.ancestor(".threadpane")||i.ancestor(".messagepane"),a.use("tictac-base-assist-container",function(a){var b,c,d=i.ancestor("#inboxcontainer")?"msg-preview":i.ancestor(".tab-content").getAttribute("data-tid"),k=yui.clone(F),l=k.get(g);return R.fullView?(l&&l.data&&(l.data.active=!0),c=k.getArray().filter(function(a){return"attachment"===a.disposition}),D=a.Tictac.base.AssistContainerManager.getContainer({tabId:d,disableRightRailAd:!0,enableRTL:NeoConfig.isRTL}),D.render(m),(j||R.extras&&R.extras.previewPaneLaunch)&&(b=D.requestClose,R.extras.previewPaneLaunch=!0,D.requestClose=function(){Q.set("close",1),b.apply(D),R.extras.previewPaneLaunch=null}),e&&e.currentTarget&&N.push(e.currentTarget.on("MessagePane:unload",function(a){if(!a||!a.getDOMNode)for(f&&D&&D.getDOMNode()&&(D.notifyClose(),R.extras&&R.extras.previewPaneLaunch&&(R.extras.previewPaneLaunch=null)),D=null;N.length;)N.pop().detach()})),void a.use("tictac-previewr",function(a){a.Tictac.previewr.loadViewer(D,c,h)})):void yui.fire("openMessage",{msg:h.mid,fid:h.fid,extras:{attPid:l.data.pid}})})):(y.show(q.getId(),!0),b.stat("slideshow_thumbnail_selected"),q.isImage()?b.stat("slideshow_photo_selected"):b.stat("slideshow_file_selected")):(p(v,q),b.stat("download_thumbnail_selected")),n&&n.blur(),c&&c.halt()}}function s(){M.push(v.on("menu-item-selected",function(c){var d,e=function(){var a=c.node;a.focus()};"download"===c.action&&c.attachment?(p(v,c.attachment,e),b.stat("download_menu_selected")):"save_dropbox"===c.action&&(d=q(c.attachment),b.stat("dropbox_saveto_selected"),a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(v,d,b)})),setTimeout(function(){c.node.blur()},0)})),M.push(v.on("download_all",function(){p(v,F.getArray({},!0)),b.stat("download_all_selected")})),M.push(v.on("save_dropbox_all",function(){var c=q(F.getArray({},!0));b.stat("dropbox_saveall_selected"),a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(v,c,b)})})),f&&M.push(x.delegate("mousedown",function(a){a.halt()},".tictac-att-viewer")),M.push(x.delegate(["click","keydown"],function(a){if(!("keydown"===a.type&&13!==a.keyCode||a.target.ancestor(".tictac-att-thumb-save-options")||a.target.ancestor(".tictac-att-photo-overlay",!0))){var b=new Date,d=b-c;d>1e3&&r(a),c=b}},".tictac-att-viewer")),M.push(x.one(".tictac-att-thumb-flow").delegate("key",function(a){var b=a.target;b.hasClass("tictac-att-thumb-save-options")||b.hasClass("tictac-att-show-dd-icon")||(13===a.keyCode&&a.shiftKey?r(a,!0):13===a.keyCode&&r(a))},"down:13",".tictac-att-thumb")),M.push(y.on("download:single",function(a){var c=a.data.aid,d=F.get(c);b.stat("slideshow_download_single"),p(y,d,a.callback)})),M.push(y.on("dropbox:single",function(c){b.stat("dropbox_save_slideshow"),a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(y,[c.data.downloadInfo],b)})})),z=x.one(".tictac-att-header-view"),z&&M.push(z.on("click",function(){f?r():y.show(0),b.stat("slideshow_all_selected")}))}var t,u,v,w,x,y,z,A,B,C,D,E="."+j.headerClassName||"message-header",F=new a.Tictac.att.Collection,G=j.att?i.one(j.att.container):i.one(E),H=a.common.net.SessionMgr,I="/ws/docpreview/v1",J=a.Tictac.base.utils,K=J.getVal,L=a.Tictac.atm.strings,M=[],N=[],O=[],P=0,Q=yui.mail.Tabs.getActiveTab(),R=Q.widget.msgPane;if(h&&h.header&&h.header.from&&h.header.from.name&&(C=h.header.from.name),h&&h.header&&h.header.from&&h.header.from.email&&(B=h.header.from.email),!G||G.ancestor("div").one(".tictac-att")||!h.attachments)return l(),!1;if(u=h.attachments.slice(0),d.enabled("gCal")||o(u),u=a.Tictac.att.filter.attachments(u,{fid:h.fid,mid:h.mid}),0===u.length)return l(),!1;for(yui.fire("MessageRead:AttachmentTrayRenderStart",h),b.stat("total_attachment_emails",{count:u.length}),P=0;P<u.length;P++)F.add(new a.Tictac.att.Attachment(u[P])),A={type:u[P].type+"/"+u[P].filetype,size:Math.round(u[P].size/1024/1024*10)/10},"inline"===u[P].disposition&&(A.size=Math.round(u[P].size/1024/1024*10)/10),b.stat("total_attachments",A);if(x=a.Node.create('<div class="tictac-att-tray-base"></div>'),t=j.att?j.att.insertPos:j.insertPos||"after","prepend"===t?G.prepend(x):"append"===t?G.append(x):G.insert(x,"after"),v=new a.Tictac.att.AttachmentTray({attachments:F,isRead:!0,instanceId:"msgRead",contactName:C||B,contactAddress:B}),v.render(x),a.Tictac.atm._nortonHandler||(a.Tictac.atm._nortonHandler=a.delegate("click",function(){b.stat("norton")},x,".tictac-att-norton-logo")),y=new a.Tictac.att.Slideshow({attachments:v.get("attachments").getViewableArray(),position:0,stats:b}),window.ttTray=v,window.ttSlideshow=y,f&&R&&R.extras&&R.extras.attPid)for(P in F.data)F.data[P].data.pid===R.extras.attPid&&(r(null,null,P,!0),R.extras.attPid=null);e.currentTarget&&M.push(e.currentTarget.on("MessagePane:unload",function(b){b&&b.getDOMNode&&b.getDOMNode()!==i.getDOMNode()||(a.Array.each(M,function(a){a.detach()}),v.destroy(),y.destroy(),n())})),s(),m(u.length),yui.fire("MessageRead:AttachmentTrayRenderComplete",h),g&&!f&&(w=a.Array.filter(F.getFileArray(),function(a){return a.isDoc&&a.getAttachmentUrl}),w.length&&(w=w.slice(0,3),b.stat("docpreview_preconvert",{count:w.length}),a.each(w,function(a){var b=a.filename.split(".").pop();O.push({id:"CreatingViewSession_"+a.aid,uri:I+"/ViewingSession",method:"POST",payload:{tenantId:"YahooMail",countOfInitialPages:0,startConverting:"initialPages",serverCaching:"none",render:{flash:{optimizationLevel:1},html5:{alwaysUseRaster:!1}}},filters:{iterator:null,range:null,select:null,exportSelect:{sessionId:"$..viewingSessionId"},exportResponse:!1,importIds:null},suppressResponse:!1},{id:"GetAttachment_"+a.aid,uri:a.getAttachmentUrl+"&wssid="+H.getWssid(),method:"GET",filters:{iterator:null,range:null,select:null,exportSelect:null,exportResponse:!0,importIds:["CreatingViewSession_"+a.aid]},suppressResponse:!0,requests:[{id:"PutAttachment_"+a.aid,uri:["/ws/docpreview/v1/ViewingSession/q/SourceFile?","ViewingSessionId=u$(CreatingViewSession_"+a.aid+".sessionId)","&FileExtension="+encodeURIComponent(b)].join(""),method:"PUT",payloadFromExport:"$(GetAttachment_"+a.aid+")",filters:{iterator:null,range:null,select:null,exportSelect:null,exportResponse:!1,importIds:["CreatingViewSession_"+a.aid]},requests:[{id:"StartSession_"+a.aid,uri:["/ws/docpreview/v1/ViewingSession/q/Notification/SessionStarted?","ViewingSessionId=u$(CreatingViewSession_"+a.aid+".sessionId)"].join(""),method:"POST",payload:{viewer:"HTML5"},filters:{iterator:null,range:null,select:null,exportSelect:null,exportResponse:!1,importIds:["CreatingViewSession_"+a.aid]}}]}]})}),a.Tictac.base.BatchTransport.send({requests:O},{success:function(b,c,d){a.each(w,function(a){var b=K(d,"CreatingViewSession_"+a.aid+".body.viewingSessionId");b&&(a.sessionId=b)})}})))}},"1.0.0",{requires:["tictac-base","tictac-att","mail-common-utils-features"]});YUI.add("tictac-rsvp",function(a){"use strict";function b(b,c){return a.Tictac.base.getAssetURL(b,"tictac-rsvp",c)}function c(a,b,c,e,f){var g,h;g=new d.Tictac.rsvp.Invite({fid:a.fid,mid:a.mid,exchangeId:a.header.messageId,pid:b.pid||b.partId,url:b.downloadUrl}),h=new d.Tictac.rsvp.View(g,{hasConvView:!!window.NeoConfig.hasConvView,parent:c,insertPos:e}),h.render(),g.fetch(),f&&f.once("MessagePane:unload",function(){try{h.destroy()}catch(a){}})}var d;!function(){function c(b){return a.Tictac.base&&a.Tictac.base.isRTL?b.replace(/\.css$/,"_bidi.css"):b}var d=b("js/"),e=window.NeoConfig?window.NeoConfig.lang:"en-US",f=b("css/"),g=a.Tictac.base.getTictacVersion("rsvp").filter||"min";a.Tictac.base.defineModuleGroup("rsvp",{filter:g,modules:{"tictac-rsvp-rollups":{path:d+"tictac-rsvp-rollups_"+e+"-min.js",requires:["handlebars-base"]},"tictac-rsvp-strings":{path:d+"strings/lang_"+e+"-min.js",requires:[]},"rsvp-invite":{path:d+"invite-min.js",requires:["rsvp-api","tictac-att-downloader","event-custom","rsvp-utils"]},"rsvp-utils":{path:d+"utils-min.js",requires:["tictac-rsvp-strings","tictac-base-utils"]},"rsvp-api":{path:d+"api-min.js",requires:["io","json","mail-common-utils-features","mail-common-utils-settings","rsvp-utils"]},"rsvp-view":{path:d+"view-min.js",requires:["tictac-rsvp-rollups","tictac-rsvp-strings","rsvp-css","array-extras","tictac-base-utils","mail-common-utils-features","rsvp-utils","event-hover","escape"]}}},"min"===g),a.Tictac.base.defineModuleGroup("rsvp_css",{filter:"min",modules:{"rsvp-css":{type:"css",path:c(f+"rsvp.css")}}},"min"===g)}(),a.namespace("Tictac").rsvp={loader:function(a,b,e,f){var g,h,i,j,k="."+(f&&f.headerClassName)||"message-header",l=f.rsvp?f.rsvp.insertPos:"append",m=b.attachments;if(m&&0!==m.length){for(i=0,j=m.length;j>i;i++)if(("ics"===m[i].type||"ics"===m[i].subtype||"ics"===m[i].filetype||"vcs"===m[i].type||"vcs"===m[i].subtype||"vcs"===m[i].filetype||"calendar"===m[i].type||"calendar"===m[i].subtype||"calendar"===m[i].filetype)&&"reply.ics"!==m[i].filename&&0!==b.header.subject.indexOf("Accepted:")&&0!==b.header.subject.indexOf("Declined:")&&0!==b.header.subject.indexOf("Tentative:")){g=m[i];break}g&&(h=f.rsvp?e.one(f.rsvp.container):e.one(k),d=YUI(),d.namespace("Tictac.rsvp").Invite?c(b,g,h,l,a.currentTarget):d.use("rsvp-invite","rsvp-api","rsvp-view","node","json","tictac-base-stats",function(d){d.Tictac.rsvp.Stats=new d.Tictac.base.Stats({name:"rsvp",yamas:!0}),c(b,g,h,l,a.currentTarget)}))}}}},"1.0.0",{requires:["tictac-base","tictac-att"]});