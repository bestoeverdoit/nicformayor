YUI.add("comms-ui-nodefocus",function(F){var A="host",C="key",D="tabIndex",B="activeDescendant";function E(){E.superclass.constructor.apply(this,arguments);}E.ATTRS={keys:{value:{next:null,previous:null}},activeDescendant:{},descendants:{value:null,getter:function(){return this._descendants;}}};F.extend(E,F.Plugin.Base,{_descendants:null,_descendantsCss:"",_circular:false,_evt:[],initializer:function(H){var I=this,G=I.get(A);if(G){G.set(D,-1);I._descendantsCss=H.descendants;I._circular=H.circular;I.refresh();I.bindUI();}},destructor:function(){var G=this._evt;if(G){F.Array.each(G,function(H){H.detach();});this._evt=null;}},refresh:function(){var M=this,P=M.get(A),R,I=[],G=P.all(M._descendantsCss+":not(.hidden)"),K=P.one("#pagetoolbar"),O=K?K.all("> "+M._descendantsCss+":not(.hidden)"):null,L=K?K.all(M._descendantsCss+":not(.hidden)"):null,Q=O?O.size():0,N=L?L.size():0,H,J;G.each(function(U,S){var T=U.getStyle("display")!=="none"&&!U.hasClass("disabled");if((!R&&T&&U.get(D)===0)||(document.activeElement===F.Node.getDOMNode(U))){R=1;M.set(B,S);}else{U.set(D,-1);}if(T){I.push(U);}});for(H=0;H<Q;H++){J=O.item(H);if(J.getStyle("display")!=="none"&&!J.hasClass("disabled")){J.setAttribute("tabindex",0);break;}}for(H=0;H<N;H++){J=L.item(H);if(J.getStyle("display")!=="none"&&!J.hasClass("disabled")){J.setAttribute("tabindex",0);break;}}M._descendants=I;if(!R){M.set(B,0);M._descendants[0]&&M._descendants[0].set(D,0);}},bindUI:function(){var J=this,G=J.get(A),H=J.get("keys.previous"),I=[J.get("keys.next"),H];if(G){J._evt.push(F.on(C,J.onKeyDown,G,"down:"+I.join(","),J));J._evt.push(G.on("click",function(M){var L=M.target,O=J._descendants,N=J.get(B),K=N;if(L.test(J._descendantsCss)){F.Array.each(O,function(Q,P){if(Q===L){N=P;}});J.changeActive(K,N);}}));J._evt.push(G.on("refresh",J.refresh,J));}},onKeyDown:function(J){var I=this,M=I.get(B),O=M,G=I._circular,H=I._descendants,K=H.length-1,L=I.get("keys.next"),N=I.get("keys.previous");if(J.keyCode===L){M=(G&&O===K)?0:O+1;if(M>K){M=K;}}else{if(J.keyCode===N){M=(G&&O<=0)?K:O-1;if(M<=0){M=0;}}}if(M!==O){I.changeActive(O,M);H[M]&&H[M].focus();}J.halt();},changeActive:function(G,I){var K=this,J=K._descendants,H=J[G];H&&H.set(D,-1);H=J[I];H&&H.set(D,0);K.set(B,I);}});E.NAME="NodeFocus";E.NS="nodeFocus";F.namespace("comms.ui").NodeFocus=E;},"1.0.0",{requires:["plugin","node","event-key"]});