YUI.add("mail-ui-convpane-bind",function(D){D.namespace("mail.ui");var A=D.mail.ui._ConvPane,C=A.prototype;var B=function(F,E){var G=this;D.use("mail-ui-proxyevents",function(){D.mail.ui.MailEventsProxy.handleUI({action:E},G.getMsgFid(F),null,[F]);});};C.handleUI=B;},"1.0.0");YUI.add("mail-ui-mailpane-read",function(e){function r(e,t,n){var r=this,i,o;n=n||r.message,o={fid:r.fid,mid:n.mid,pid:e},i=n.nonImgAttachments;for(var u=0;u<i.length;u++){var a=i[u];(a.type==="message"||a.type==="text")&&a.partId===e&&(o.filename=a.filename)}typeof t!="undefined"&&t!==""&&t!=="null"&&(o.tnefid=t),s([o])}function i(e,t,n){var r=this,i,o=[],u,a;n=n||r.message,u={image:n.imgAttachments,"non-image":n.nonImgAttachments,all:n.attachments},a=u[e]||[];for(var f=0;f<a.length;f++){var l=a[f],c={fid:r.fid,mid:n.mid,pid:l.partId},h=l.tnefId;if(l.type==="message"||l.type==="text")c.filename=l.filename;typeof h!="undefined"&&(c.tnefid=h),o.push(c)}t&&t.target&&(t.target.get("nodeName")==="A"?i={restoreFocusNode:t.target}:i={restoreFocusNode:t.target.ancestor("A")}),o.length&&s(o,i)}function s(n,r){e.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){t.common.downloader.render(n,r)})}function o(){e.fire("openOptions",{view:"security"})}function u(n,r,i){var s=this,o,u;i=i||s.fid,r=r||s.message;if(r&&!s.loading_slow&&!s.loading_error&&!s.loading_moved&&!r.flags.isRead){o=e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(o!=="999")return o=o?parseInt(o,10)*1e3:750,isNaN(o)&&(o=750),u=o===0,NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded?(s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){e.mail.controller.v3.api.flagMessagesWithMid({messages:r,sourceFid:i,flags:{read:1},showTAE:!1,statTAE:!1})},o),n&&n(null)):e.use("mail-controller-messages-ops",function(){var e=function(){var e=t.Controller.batch();return e.Messages.flag({fid:i,mid:r,setFlags:{read:1},enableRetry:!0},{suppressCodes:["*"]}),e};u||(s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){var t=e&&e();t&&t.execute()},o)),n&&n(u?e:null)}),!0}return!1}function a(t,n){var r={metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey};e.UA.ie>=12?window.open("/neo/rd?url="+window.encodeURIComponent(t.get("href"))+"&ncrumb="+NeoConfig.ncrumb):t.simulate("click",r)}function f(t){var n=t.target,r=n.get("parentNode"),i=null;n.hasAttribute("ymailto")?i=n.getAttribute("ymailto"):r.hasAttribute("ymailto")&&(i=r.getAttribute("ymailto")),i&&i.length>0&&(t.preventDefault(),e.use("mail-ui-shortcuts",function(e){e.mail.ui.ShortCuts.composeMailToMessage(i)})),NeoConfig.isWinApp||(n.test("a[rel=nofollow]")?(n.setAttribute("rel","noreferrer"),t.preventDefault(),a(n,t)):r.test("a[rel=nofollow]")&&(r.setAttribute("rel","noreferrer"),t.preventDefault(),a(r,t)))}e.namespace("mail.ui");var t=e.mail,n=function(){};e.mix(n.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:r,downloadAllAttachments:i,loadOptions:o,markAsRead:u,handleBodyLinkClick:f}),e.mail.ui.MailPaneRead=n},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});
YUI.add("mail-ui-messagepane-warnings",function(e){function r(e,r){var i=window.confirm(t([n.str_warning_msg_read_form_part1,n.str_warning_msg_read_form_part2].join("  "),n));return i&&e.submit(),r&&typeof r=="function"&&r(i),!1}function i(e){return e.rel==="nofollow"?!0:strings.str_cfg_tog_exlink_alert_page?(window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(e),"new"),!1):(window.confirm(t([n.str_warning_msg_read_link_part1,n.str_warning_msg_read_link_part2,n.str_warning_msg_read_link_part3].join("  "),n))&&window.open(e.href),!1)}function s(e){e.warningShown||(window.alert(t([n.str_warning_msg_read_password_part1,n.str_warning_msg_read_password_part2].join("  "),n)),e.warningShown=1)}e.namespace("mail.ui");var t=e.common.Utils.substitute,n=strings;e.mail.ui.Warnings={showFormWarning:r,showLinkWarning:i,showPasswordWarning:s},window.theMainWindow=e.mail.ui.Warnings},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-deeplink-manager",function(e){function t(e){var t=["import_contacts","launch_compose","valentine","mothers_day"],r=t.map(function(e){return'[name="deeplink_'+e+'"]'}).join(",");return e.all(r).on("click",function(e){var t=e.currentTarget.get("name").replace("deeplink_","");e.halt(!0),n(t)})}function n(t){var n;NeoConfig.mrd=NeoConfig.mrd||{},NeoConfig.mrd.param=NeoConfig.mrd.param||{};if(t!=="valentine"||t!=="mothers_day")n=function(){e.fire("util:ymstats",{name:"deeplink",tags:{deeplinkActions:t}})};switch(t){case"launch_compose":e.fire("newMessage",{cbfn:n});break;case"import_contacts":e.fire("ws:onboarding",{type:"deeplink_import_contact",cbfn:n});break;case"valentine":n=function(){e.fire("util:ymstats",{name:"compose_valentine_autocompose",tags:{source:"deeplink"}})},e.fire("newMessage",{flavor:"autocompose",cbfn:n});break;case"mothers_day":NeoConfig.mrd.param.deeplink=!0,e.use("mail-ui-workspace-postload",function(e){e.mail.ui.Workspace.launchMothersDayAutocompose("deeplink")});break;default:}}e.namespace("mail.ui.deeplink"),e.mail.ui.deeplink.manager={attachEvents:t}},"0.1");
YUI.add("mail-ui-convpane-read",function(e){function Y(t,n){var r=[];return e.Array.each(t.slice(n,t.length),function(e){r.push(e.email)}),r.join(",")}function Z(e){var t={to:p.getName(e),rcpt_id:p.getAddress(e),rcpt_name:p.getName(e)};return t}function et(e,t,n,i){var s=e&&e.header,o=f.recipient_list,u=f.more_recipients_str,a=f.hide_recipients_str,l="",c=["to","cc","bcc"],h,d,v,m,g,y,b;i=i||[];if(s){for(d=0;d<c.length;d++)v=c[d],b=s[v]||[],h=f[v+"_group"],g=i[v]||!1,y=g?"":n+1===b.length?b.length:n,b.length&&(m={recipients_built:p.createRecipientList(b,o,t,y,Z,""),hide:U&&g&&(!y||b.length>parseInt(y,10))?r(a,{data_field:v},0,0,strings):"",more_built:!g&&b.length>parseInt(y,10)?r(u,{num_more_recipients:b.length-y,data_address:Y(b,y),data_field:v},0,0,strings):""},l+=r(h,m,null,null,strings));return l}}function tt(){e.fire("recalculateScrollToRepositionSend")}function nt(e){var t=this,n=e.srvmap,r,i,s="";if(!n){i=t.inboxservices||[],e.srvmap=n={};for(r=i.length-1;r>=0;r--)n[i[r].name]=i[r].value}return!strings.str_cfg_tog_certified_icon&&n.crt&&delete n.crt,(F||!n.crt)&&(n[j]||n.siu||t.msgicon)&&(n&&n[j]?s=I[n[j]]||"":t.msgicon&&(s=t.msgicon)),NeoConfig.isSSL&&s==="certified"&&(s="certified-ssl"),n.inboxService=s,s}function rt(t){var o=this,a=t.message,l=t.expand,c=o.message,h=a.flags.hasAttachment,d,v=o.getMsgFid(a),m=$.isDraftFid(v)?!0:!1;if(!a)return;if(!a.header)return;return d={from:function(){var e=a.header.from;if(e){var t={from_name:p.getName(e),from_id:p.getAddress(e),sender_email_address:p.displaySenderAddress(e)};return r(f.from,t,null,null,strings)}},super_collapsed:function(){return t.supercollapsed?f.super_collapsed:""},isFlagged:function(){return a.flags.isFlagged?f.isFlagged:""},isFlagged1:function(){return a.flags.isFlagged?r(f.isFlagged1,null,null,null,strings):""},isFlagged2:function(){return a.flags.isFlagged?r(f.isFlagged2,null,null,null,strings):""},isFlagged_else:function(){return a.flags.isFlagged?"":r(f.isFlagged_else,null,null,null,strings)},isFlagged_else1:function(){return a.flags.isFlagged?"":r(f.isFlagged_else1,null,null,null,strings)},isUnread:function(){return a.flags.isRead?"":f.isUnread},snippet:function(){var t;return typeof a.snippet=="string"?t=a.snippet:a.header&&typeof a.header.snippet=="string"?t=a.header.snippet:t="",s(u(e.Lang.trim(t)))},expanded:function(){return l?f.expanded:""},ariaExpanded:function(){return l?"true":"false"},expanded_else:function(){return l?"":f.expanded_else},date:function(){var e=a.header.receivedDate*1e3;return!e&&o.getMsgFid(a)==="Sent"&&(e=a.header&&a.header.sentDate*1e3),n.dateFormatter(new Date(e),Neo.getDateFormat(e,!1,!0))},received_date:function(){return a.header.receivedDate?n.dateFormatter(new Date(a.header.receivedDate*1e3),strings.str_tog_dateformat_header_long_l10n):""},hasAttachmentDownload:function(){return h?r(f.hasAttachmentDownload):""},thread_reply:function(){return r(f.thread_reply,null,d,null,strings)},mid:function(){return y(a.mid)||""},hasDraft:function(){return m?r(f.hasDraft,null,null,null,strings):""},hasDraft1:function(){return m?r(f.hasDraft1,null,null,null,strings):""},hasDraft2:function(){return m?r(f.hasDraft2,null,null,null,strings):""},hasDraft_else:function(){return m?"":r(f.hasDraft_else,null,d,null,strings)},hasAttachment:function(){return h?r(f.hasAttachment,null,null,null,strings):""},recipients:function(e,t){return a=e||a,et(a,d,z,t)},ariaStr:function(t,n){var i=[],s=[],o=strings.str_thread_to_recipients,u,f,l=0,c;return a=t||a,a.header&&(i=a.header.to||[],i=i.concat(a.header.cc||[]),i=i.concat(a.header.bcc||[]),e.Array.each(i,function(e){s.push(p.getName(e))}),u=s.length,u&&(!n&&u>3&&(s=s.slice(0,3),l=u-3),f=s.join(strings.str_thread_to_concatenate_recipients_delimiter)),o=r(o,{recipients:f}),l&&(c=r(strings.str_thread_hdr_more_recipients_btn,{number:l}),o+=", "+c)),o},thread_attachments:function(){return h?r(f.thread_attachments,null,d):""},msg_blocked:function(){if(!l)return;return p.getBlockedMsgMarkup(a,f,d)},msg_has_photo_attachment:function(){var e=a,t=e?e.imgAttachments||[]:[];return t.length?r(f.msg_has_photo_attachment,e,d,null,strings):""},attached_photos:function(){return p.getAttPhotosMarkup(a,f,d)},msg_has_attachment:function(){var e=a,t=e?e.nonImgAttachments||[]:[];return!o.isChat(e)&&t.length?r(f.msg_has_attachment,e,d,null,strings):""},hide_attachments_else:function(){return r(f.hide_attachments_else,a,d,null,strings)},attached_files:function(){return p.getAttFilesMarkup(a,f,d)},msg_loading:function(){return a.loading_slow||a.loading_error||a.loading_moved?r(f.page_loading,null,d,null,strings):""},loading_error:function(){return a.loading_error?o.getFailureMarkup(a):""},msg_truncated:function(){return a.body&&a.isTruncated&&!o.msgTrucationStatus.disabled[a.mid]?r(f.msg_truncated,null,null,null,strings):""},isInternal:function(){return NeoConfig.showFeedback?r(f.isInternal,null,null,null,strings):""},unsubscribe:function(e){return n.Features.enabled("unsubscribr")?r(e.unsubscribe,0,0,0,strings):""},flag_info:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e?"info-"+e:"";return t},flag_info_hover:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?"info-"+e:"info-unread";return t},status_title:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?r(strings.str_msg_list_info_verified_attr,strings):"";return t===""&&a&&a.flags&&(t=a.flags.isRead?strings.str_msg_list_click_mark_as_unread:strings.str_msg_list_click_mark_as_read),t},mark_unread:function(){var e="";return a&&a.flags&&(e=a.flags.isRead?strings.str_msg_list_read:strings.str_msg_list_unread),e},loadhide:function(){return t.hideCard?r(f.loadhide,null,d,null,strings):""},with_icons:function(){return NeoConfig.convBtmIcons?r(f.with_icons,null,d,null,strings):""},with_icons_else:function(){return NeoConfig.convBtmIcons?"":i(f.with_icons_else)},thread_date:function(){return r(f.thread_date,null,d,null,strings)},unread_icon:function(){return r
(f.unread_icon,null,d,null,strings)},flag_icon:function(){return r(f.flag_icon,null,d,null,strings)}},o.messageFormatter||(o.messageFormatter=d),o.getInboxService(c),t.replyOnly?r(f.thread_reply,null,d,null,strings):r(f.thread_item,null,d,null,strings)}function it(){var t=this,n=function(e){var n=e.s||"",i=e.o||0,s=e.f||t.readFormatters,o=e.a||0,u=e.strs||strings;return r(n,i,s,o,u)};t.showDetails=A.get("neo.pref.showHeaderDetails"),this.readFormatters={anyUnread:function(){var e=t.message;return e.totalUnread>0?f.anyUnread:""},anyFlagged:function(){var e=t.message;return e.totalFlagged>0?f.anyFlagged:""},anyFlagged1:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged1,null,null,null,strings):""},anyFlagged2:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged2,null,null,null,strings):""},anyFlagged_else:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else,null,null,null,strings):""},anyFlagged_else1:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else1,null,null,null,strings):""},ariaLabelStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_convUnread:strings.str_msg_list_convRead},titleStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_conv_click_mark_as_read:strings.str_msg_list_conv_click_mark_as_unread},qr_bar:function(){return r(f.qr_bar,{},t.readFormatters,null,strings,a)},popoutToolbar:function(){return X?f.popoutToolbar:""},squeezeToolbar:function(){return V?f.squeezeToolbar:""},show_formatter_well:function(){return X?"":r(f.show_formatter_well,{},t.readFormatters,null,strings,a)},show_popout_toolbar:function(){return X?r(f.show_popout_toolbar,{},t.readFormatters,null,strings,a):""},show_attachment_icon:function(){return r(f.show_attachment_icon,{},t.formatters,null,strings,a)},spellCheckEnabled:function(){return M.enabled("spellCheck")?r(f.spellCheckEnabled,{},t.readFormatters,null,strings,a):""},thread_item:function(){var r,i=t.message,s=!0,o="",u,a,l=!1,c=0,h=0,p=0,d=0,v=!1;if(t.loading_error||!i.cid)return"";u=i.msgs,a=u&&u.length;if(a!==i.totalMsgs)return"";for(r=0;r<a;r++){var m=u[r],g,b=y(m.mid);if(e.Lang.isUndefined(m.header))return;r!==0&&r!==a-1&&h++,g=m.body?!0:!1,t.midObjMap[b]=r,$.isSentFid(t.fid)?($.isSentFid(m.fid)&&r<_?(l=!1,d++):r>=_&&!l&&!$.isSentFid(m.fid)?l=!1:r>=_&&!d&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!d&&a>_&&(l=!0)):$.isDraftFid(t.fid)?($.isDraftFid(m.fid)&&r<_?(l=!1,p++):r>=_&&!l&&!$.isDraftFid(m.fid)&&u[r+1]&&!$.isDraftFid(u[r+1].fid)?l=!1:r>=_&&!p&&u[r+1]&&$.isDraftFid(u[r+1].fid)&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!p&&a>_&&(l=!0)):(!m.flags.isRead&&r<_?(l=!1,c++):r>=_&&!l&&m.flags.isRead?l=!1:r>=_&&!c&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!c&&a>_&&(l=!0)),l&&!t.submessage&&!t.midtocid&&!v&&(o+=n({s:f.super_collapsed_btn,o:{collapsed_msg_count:h}}),v=!0),o+=t.getMsgMarkUp({message:m,expand:g,supercollapsed:!1,hideCard:s})}return o},message_selection:function(){var e=t.numSelected>0&&!t.message?n({s:f.message_selection}):"";return e},message_selection_else:function(){return t.numSelected===1&&t.message?n({s:f.message_selection_else}):""},multiple_selected_msgs:function(){return t.numSelected>1?n({s:f.page_conversation_history,o:{num_selected_msgs:t.numSelected}}):""},num_selected_msgs:function(){return t.numSelected},multiple_selected_msgs_else:function(){return t.numSelected===1?n({s:f.page_conversation_history1}):""},folder_message:function(e){var r=e||t.message;if(t.loading_error||!r.cid)return;return n({s:f.folder_message,o:r})},folder_message1:function(e){var r=e||t.message,i=r&&r.header;return i&&(i.subject||i.to&&i.to[0]||i.from.name)?n({s:f.folder_message1,o:r}):""},expanded:function(){return t.showDetails?f.expanded:""},mail_search_enabled:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled})},mail_search_enabled1:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled1})},msg_subject:function(){var n=e.mail.Tabs,r=p.getMsgSub(t.message),i,s;return t.loading_error&&(i=n.getActiveTab(),i&&i.prevTabId&&(s=n.getTabById(i.prevTabId),s&&s.widgetType==="search"&&(r=r.split("^_").join("")))),r},msg_subjectDir:function(){return p.getMsgSubDir(t.message)},page_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?n({s:f.page_loading}):""},conv_loading:function(){return t.loading_error?"":n({s:f.conv_loading})},nav_arrows:function(){return n({s:f.nav_arrows})},summary:function(){var e=t.message,n=e.totalMsgs;return n>1?"("+n+")":""},showAllReplyActions:function(){return M.enabled("messageReadPaneV2")?r(f.showAllReplyActions,null,null,null,strings):""},showAllReplyActions_else:function(){return M.enabled("messageReadPaneV2")?"":r(f.showAllReplyActions_else,null,null,null,strings)},plus_icon:function(){return M.enabled("messageReadPaneV2")?"":f.plus_icon},ca_icon:function(){return M.enabled("richcompose")?r(f.ca_icon,null,null,null,strings):""}},t.setFull=1}function st(t,r,i,s){var u=this,a,l=n.Stopwatch.get("MsgInPreview")||u.stopwatch,c=t&&t.cid,h,d,v,g,w,E,S=!1,x=[];u.wasCached=r||"";try{l&&l.start(3,"OnSuccessLMTRender"),clearTimeout(u.loadingTimer);if(c&&u.message&&(u.message.cid&&b(u.message.cid)===b(c)||u.midtocid&&e.Lang.isValue(u.getMessageIdxByMidLookup(u.midtocid,t.msgs,!0)))){u.loading_moved=0,u.resetRequestLoadingState(!1),u.inboxservices=u.message.inboxservices||u.message.msgs&&u.message.msgs[0]&&u.message.msgs[0].inboxservices,u.msgicon=u.message.msgicon,u.midtocid?(u.message=t,S=!0):(u.message=t,u.allMsgsInConvInfo=t.msgs),u.message.toggleState="expanded";if(s&&t.fullmsg.mid){v=u.getMessageIdxByMidLookup(t.fullmsg.mid,u.message.msgs),t.fullmsg=e.clone(t.fullmsg),t.fullmsg.cid=t.cid,t.fullmsg.header.snippet=t.msgs[v].header.snippet,
t.fullmsg.fid=u.getMsgFid(t.msgs[v]),u.message.msgs[v]=t.fullmsg,u.primaryMid=t.fullmsg.mid,x.push(u.message.msgs[v]);for(d=0;d<x.length;d++)a=m.getQueryParams(x[d],"midRequest"),x[d].blockImages=a&&a.blockImages,E=u.midObjMap[y(x[d].mid)],p.extractQuotedText(x[d],f.quoted_text_collapse,f.quoted_text_expand,q,E)}u.setRefreshTimer(),u.fireEvent("getSuccess"),u.render(r);if(s&&v!==undefined&&v>=0){u.showMessages(v,[u.message.msgs[v]],!1,!1,l,S,!1,!1);if(!NeoConfig.hasConvV3)return}l&&l.start(1,"ThreadMsgRead"),w=u.submessage?u.submessage:u.midtocid?{mid:u.midtocid}:s&&t.fullmsg?t.fullmsg:u.message.msgs[u.message.msgs.length-1],v=u.getMessageIdxByMid(w.mid),g=u.getMsgNodeByMid(w.mid),$.isDraftFid(w.fid)?u.showMessages(v,[u.message.msgs[v]],!1,!1,l,!1,!1,!0):u.submessage?u.expandMessages(v,"adjacent","no",!0,{scroll_to_msg:!0},l,!0):u.midtocid?s||u.expandMessages(v,"one",!1,!0,{scroll_to_msg:!0},l,!0):u.fid==="Sent"?s?u.expandMessages(v,"other-send",!1,!0,null,l,!0):u.expandMessages(v,"send",!1,!0,null,l,!0):$.isDraftFid(u.fid)?u.expandMessages(v,"draft",!1,!0,null,l,!0):s?u.expandMessages(v,"other-unread",!1,!0,{no_focus:!0},l,!0):u.expandMessages(v,"unread",!1,!0,{no_focus:!0},l,!0),o.stat("convread","result=>success,env=>"+NeoConfig.mailEnv)}else t||u.loadExtra(function(){this.onFailure({msg:u.message,reason:h},i)},1)}catch(T){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1")}}function ot(){return this.activeComposeWidget.cv.view}function ut(t){var n=this,r,i,s;n.activeComposeWidget&&n.activeComposeWidget.cv.view!==t&&(n.activeComposeWidget.cv.view.set("active",!1),n.activeComposeWidget.cv.view.save()),n.activeComposeWidget=null;for(r in n.composeWidgets)s=n.composeWidgets[r].cv.view,i=n.getComposeNodeByMid(r),s===t&&(n.activeComposeWidget=n.composeWidgets[r],n.activeComposeWidget.cv.view.set("active",!0),i&&i.addClass("active"),e.fire("draftCardAdded"),tt(),!NeoConfig.smartscroll&&n.composeAction&&i&&(n.listNode.set("scrollTop",i.get("offsetTop")-10),n.composeAction=!1))}function at(e){var t=this,n,r,i,s,o,u=[],a=0;for(r in t.composeWidgets)i=t.composeWidgets[r].cv.view,i.get("dirty")&&u.push(i);if(u.length<=0)e&&e(!0);else{s=function(t,n){n.detach("compose:saveFail",o),n.dirty=!1,a--,a===0&&e&&e(!0)},o=function(t,n){n.detach("compose:saveSuccess",s),n.dirty=!0,e&&e(!1)},a=u.length;for(n=0;n<u.length;n++)i=u[n],i.once("compose:saveSuccess",s,null,i),i.once("compose:saveFail",o,null,i),i.save()}}function ft(){G.superclass.closeAllCompose.call(this,{})}function lt(t,n){var r=this,i;if(r.convUserUnread||r.msgUserUnread&&r.msgUserUnread[y(n.mid)]||!r.get("active"))return;if(n&&!r.loading_slow&&!r.loading_error&&!r.loading_moved&&!n.flags.isRead){i=parseInt(e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval"),10);if(i!==999)return i=i?i*1e3:750,isNaN(i)&&(i=750),i===0&&(i=100),r.flagMsgList.push({fid:t,msg:n}),NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded?(r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){var n=[];e.Array.forEach(r.flagMsgList,function(e){n.push(e.msg)}),e.mail.controller.v3.api.flagMessagesWithMid({messages:n,sourceFid:t,flags:{read:1},showTAE:!1,statTAE:!1,notifyStoreMsgByMsg:!0}),r.flagMsgList=[]},i)):e.use("mail-controller-messages-ops",function(){r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){e.Array.forEach(r.flagMsgList,function(e){r.markAsReadBatch(e.fid,e.msg)}),r.readBatch&&r.readBatch.execute({suppressCodes:["*"]}),r.readBatch=null,r.flagMsgList=[]},i)}),!0}return!1}function ct(e,t){var n=this;n.readBatch=n.readBatch||l.Controller.batch(),n.readBatch.Messages.flag({fid:e,mid:t,setFlags:{read:1},enableRetry:!0})}function ht(t,n,r){var i=this;try{n&&n.ancestor("body")?i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r):i.once("convAddedToDOM",function(){n.ancestor("body")||(n=i.getMsgNodeByMid(t.mid)),i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r)},n),n&&i.inspectMessageForBadContent(n,t)}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2")}M.enabled("selectToSearch")&&e.use("mail-ui-pane-utils-s2s",function(e){e.mail.ui.PaneUtils.handleS2S(i)}),M.enabled("enhancrEmbedPlay")&&M.enabled("enhancrV2")&&e.use("mail-ui-enhancr",function(e){e.mail.ui.enhancr.enhancr.prepareEnhancrCards(i,n)}),M.enabled("readLinkEnhancr")&&M.enabled("enhancrV2")&&e.use("mail-ui-pane-utils-linkEnhancr",function(e){e.mail.ui.PaneUtils.initializeReadLinkEnhancr(i)}),M.enabled("deepLinkedMail")&&i.message.srvmap.inboxService==="certified-ssl"&&i._evts.push(e.mail.ui.deeplink.manager.attachEvents(n.one(".body")))}function pt(t){var n=this,r=n.listNode,i,s,o,u=e.ACWidgetInst;if(!r)return;i=r.get("scrollTop"),s=r.get("offsetHeight"),o=r.all("."+x),!t&&u&&u.isVisible()&&u.hide(),o.size()>1&&n.checkAdsOnScroll(i,s),clearTimeout(n.markAsReadTimer),n.markAsReadTimer=setTimeout(function(){n.checkMsgCardsOnScroll(o,t)},200)}function dt(t,n){var r=this,i=window.DARLA,s,o,u=200;e.Lang.isNumber(r.prevY)||(r.prevY=t),r.scrollAdTimer&&clearTimeout(r.scrollAdTimer),i&&(i.inProgress()||(s=Math.abs(r.prevY-t),o=n*i.scrollThreshold,s>o&&(r.scrollAdTimer=setTimeout(function(){e.mail.ui.darla.fireDarlaOnScroll(),r.prevY=t},u))))}function vt(t,n){if(M.enabled("markExpandedAsRead"))return;var r=this,i,s,o,u;r.message&&(
s=r.message.msgs);if(!t||!s)return;i=t.size();for(u=0;u<i;u++)o=t.item(u),o.hasClass(T)&&o.hasClass(N)&&o.inRegion(r.listNode)&&(r.markConvMsgAsRead(r.getMsgFid(s[u]),s[u]),n&&e.fire("MailLog",{m:"Marking message as read silently",cid:s[u].cid,mid:s[u].mid}))}function mt(){var e=this,t=e.listNode,n="has-scrolled";!M.enabled("messageReadPaneV2")&&t&&(t.get("scrollTop")>B?e.hdr.addClass(n):e.hdr.removeClass(n)),e.scrollTimer&&window.clearTimeout(e.scrollTimer),e.scrollTimer=window.setTimeout(function(){e.onPaneScroll()},200)}function gt(){var e=this,t=this.getRoot();e.listNode=t.one(".thread-item-list");if(!e.listNode||!e.message)return;e.listNode.on("scroll",mt,e)}function yt(e){var t=null,n,r,i=!1;if(!e||!e.getDOMNode())return;t=e.one(".msg-truncated");if(!t)return;n=e.all(".thread-quoted-body"),r=n&&n.size()>0,r&&(i=n.item(0).hasClass("expanded")),r&&!i?t.hide():t.show()}function bt(e,t,n){var r=!1;if(!(t&&t.getDOMNode()&&e.isTruncated&&t.one(".body")))return;r=d.hasOnlyNonDisplayableContent(t.one(".body")),r&&!this.msgTrucationStatus.loading[e.mid]&&(this.msgTrucationStatus.loading[e.mid]=!0,this.viewFullMsg(e,n),t.one(".msg-truncated").hide(),t.one(".body").setContent('<div class="s-loader"></div>'))}function wt(){var t=this,r=this.getRoot();t.listNode=r.one(".thread-item-list"),t.after("activeChange",function(e){var t=this;e.newVal||t.saveDraftAction(null,!0),t.activeComposeWidget&&t.activeComposeWidget.cv.view.set("active",!!e.newVal)}),t.on("activeChange",function(e){e.newVal&&t.refreshOnActive&&t.updatePaneContent()}),t.on("closeChange",function(e){e.newVal&&t.closeAllCompose()}),t.threadHeaderHandler=r.delegate(["click","keydown"],function(r){if(r.type==="keydown"&&r.keyCode!==13)return;var i;r.stopPropagation();var s,o=n.getDataAction(r).action,u=t.message,a=r.target;i="";switch(o){case"thread-flag":s=u.totalFlagged?"unflagged":"flagged",i=u.totalFlagged?"unflag_thrd_hdr":"flag_thrd_hdr",t.handleUI(u,s);break;case"thread-unread":s=u.totalUnread?"read":"unread",i=u.totalUnread?"read_thrd_hdr":"unread_thrd_hdr",s==="unread"?(t.convUserUnread=!0,r.target.setAttribute("aria-label",strings.str_msg_list_convUnread),r.target.setAttribute("title",strings.str_msg_list_convRead_attr)):(r.target.setAttribute("aria-label",strings.str_msg_list_convRead),r.target.setAttribute("title",strings.str_msg_list_convUnread_attr)),t.handleUI(u,s);break;case"thread-toggle":s=u.toggleState==="expanded"?"collapse":"expandall",t.handleToggleAllMessageCards(a,s,u,t.getMsgFid(u));break;case"update":t.saveDraftAction(function(){t.loadPaneContent(7,null,{force:!0},null)})}i&&e.fire("mt:click",{action:i})},w),t._evts.push(r.delegate(["focus","blur"],function(e){e.type==="focus"?e&&e.currentTarget&&!e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.addClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=e.currentTarget)):e.type==="blur"&&e&&e.currentTarget&&e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.removeClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=null))},".thread-item, .add-to-conv, .supercollapsed")),t._evts.push(r.delegate("contextmenu",function(t){e.fire("HoverCard:hideHoverCard")},".lozengfy.hcard")),t._evts.push(r.delegate("click",t.logLinkClicks,".thread-body a",t)),t.threadItemHandler=r.delegate(["click","keydown"],function(r){if(!(r.type!=="keydown"||r.keyCode===13&&!r.target.hasClass("recipients")))return;r.type==="keydown"&&r.stopPropagation(),r.target.getAttribute("href")==="#"&&r.halt(),e.fire("as:close-window-click",r);var i,s,o,u,a=r.target,f=a.get("parentNode"),l=r.currentTarget,c=n.getDataAction(r).action,h=a.hasClass("thread-item")?a:a.ancestor(".thread-item",!0),p,d,v,m=t.message.msgs,g,y,b=r.type==="keydown";(f.get("nodeName")==="A"||a.get("nodeName")==="A")&&t.handleBodyLinkClick(r),h&&(v=h.getAttribute("data-mid"),v&&(p=t.getMessageIdxByMid(v),d=m[p],t.selNode=h)),c==="contact-card-menu"&&r.halt(),c==="contact-card-menu"&&!h.hasClass("expanded")&&(c="select-thread"),o="",e.fire("MailLog",{m:"Initializing Action from Conversation Pane",action:c});switch(c){case"thread-super-collapse":t.expandSuperCollapsedNodes();break;case"select-thread":window.getSelection?y=window.getSelection().toString():y=document.body.createTextRange().text;if(a.hasClass("thread-item")&&b||(a.hasClass("thread-item-header")||a.ancestor(".thread-item-header")||a.hasClass("thread-item")&&!h.hasClass("expanded"))&&!a.hasClass("more_recp")&&!a.hasClass("info-hover")&&!a.hasClass("flag")&&!e.Lang.trim(y))h.hasClass("expanded")?!h.hasClass("collapsing")&&!h.hasClass("expanding")&&(t.collapseMessage(h),o="collapse_thrd_msg_hdr",t.selNode=h,t.focusMessageCard()):(e.fire("MessagePane:expandClick",{cid:t.message.cid,mid:d.mid}),t.selNode!==h&&(t.selNode=h,t.focusMessageCard()),t.expandMessageTimers[v]=e.later(5e3,null,function(){var r={yid:NeoConfig.loginId,cid:t.message.cid,mid:d.mid};n.netError("Expand Message Failed:"+e.JSON.stringify(r))}),t.expandMessages(p,"one","yes",!1),o="expand_thrd_msg_hdr");break;case"quoted-text":var w,E=h.all(".thread-quoted-body"),S,x,T=h.one(".thread-quoted-body");E&&E.size()>0&&(w=!E.item(0).hasClass("expanded"),o=w?"expand_qtd_thrd_msg":"collapse_qtd_thrd_msg",S=h.one(".thread-quoted-text"),S&&(S.one(".icon").toggleClass("icon-chevron-down"),S.one(".icon").toggleClass("icon-chevron-right"),S.one(".qtd-expansion-text").set("text",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.one(".qtd-expansion-text").set("aria-label",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.setAttribute("title",w?strings.str_qtd_collapse:strings.str_qtd_expand)),E.each(function(t){w?(t.addClass("no-transition"),t.setStyles({display:"block",transition:""}),x=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("height",0),t.removeClass("no-transition").addClass("expanded"),e.later(0,t,t.setStyle,["height",x]),e.later(200,null,function(e){tt(),e.setStyles({transition:"none",height:"auto"})},[t])):(x=parseInt(t.getComputedStyle("height"
),10)+"px",t.setStyle("transition",""),t.setStyle("height",x),t.removeClass("expanded"),e.later(0,t,t.setStyle,["height",0]),e.later(200,null,function(e){tt(),e.setStyles({display:"none",height:"auto"})},[t]))}),yt(h),w?e.later(0,null,function(){T.setAttribute("role","gridcell"),T.setAttribute("tabindex","0"),T.focus()}):T.setAttribute("tabindex",-1));break;case"thread-item-flag":i=d.flags.isFlagged?"unflagged":"flagged",o=d.flags.isFlagged?"unflag_thrd_msg_hdr":"flag_thrd_msg_hdr",t.handleUI(d,i);break;case"thread-item-delete":i="delete",t.handleUI(d,i);break;case"thread-item-unread":i=d.flags.isRead?"unread":"read",i==="unread"&&(t.msgUserUnread||(t.msgUserUnread={}),t.msgUserUnread[v]=!0),o=d.flags.isRead?"unread_thrd_msg_hdr":"read_thrd_msg_hdr",t.handleUI(d,i);break;case"reply_all":case"reply_sender":case"forward":case"thread-item-replyall":s={},s.action=c==="thread-item-replyall"?"reply_all":c,e.fire("rc:flow",{name:c}),c==="thread-item-replyall"?o="quick_reply_all_thrd_msg":l.hasClass("add-to-conv")?o="quick_"+c+"_tlbr_thrd_msg":o=c+"_thrd_msg",d||(p=m.length-1,d=m[p]),t.composeAction=!0,t.initReplyForward(s.action,d);break;case"edit-to":t.composeWidgets[v]&&(h.one(".thread-reply-to").setStyle("display","none"),h.one(".thread-reply-to-edit").setStyle("display","block"));break;case"menu":h.hasClass("quickReply")||(t.loadMenu(r,d,h,p),o="actnMnu_thrd_msg");break;case"show-images":t.unblockImages(d,p),o="show_images_thrd_msg";break;case"mail-options":t.loadOptions(),o="options_thrd_msg";break;case"attach-download-all":case"attach-download-all-photos":var N=c==="attach-download-all-photos"?"image":"non-image";t.downloadAllAttachments(N,r,d);break;case"attach-download":var C=0,k="";l&&(C=l.get("id"),k=l.getAttribute("tnefid")),t.downloadAttachment(C,k,d);break;case"retry-msg-load":t.expandMessages(p,"one","yes",!1),o="retry_thrd_msg";break;case"retry-conv-load":t.retryLoad(),o="retry_thrd_hdr";break;case"view-full-msg":t.viewFullMsg(d,p);break;case"thread-item-edit":s={},s.action="edit",e.fire("editMessage",e.mix(s,{fid:t.getMsgFid(d),oMsg:d}));break;case"hide":g=a.getAttribute("data-field"),W[g]=!1,h.one(".recipients").set("innerHTML",t.messageFormatter.recipients(d,W)),h.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(d,!0)),h.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(d,!0));break;case"more":g=a.getAttribute("data-field"),W[g]=!0,h.one(".recipients").set("innerHTML",t.messageFormatter.recipients(d,W)),h.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(d,!0)),h.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(d,!0)),e.later(0,null,function(){h.one(".recipients").focus()}),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.installReadGlass()}e.fire("ConvPane",c),u={action:o,append:{t1:"thrdRdTb"}},o&&e.fire("mt:click",u)},".thread-item, .msg-attachments .file-attach li, .conv-loadingpane, .supercollapsed, .add-to-conv"),e.on("ds:conv:change",function(){}),e.on("ds:folder:rename",function(e,n){var r,i=0;if(t&&t.message&&t.message!==null){r=t.message.msgs;if(e.folderInfo.fid===t.message.fid){t.message.fid=n.folderInfo.fid;for(i=0;i<r.length;i++)e.folderInfo.fid===r[i].fid&&(r[i].fid=n.folderInfo.fid,r[i].folderInfo&&r[i].folderInfo.fid!==undefined&&(r[i].folderInfo.fid=n.folderInfo.fid),r[i].sourceFolderInfo&&r[i].sourceFolderInfo.fid!==undefined&&(r[i].sourceFolderInfo.fid=n.folderInfo.fid))}}}),t.refreshHandler=e.on("ds:conv:refresh",function(r,i,s){var o,u,a,f=!0,l,c;if(!t.message||!t.message.cid)return;u=b(t.message.cid),r==="lft"?o=s[u]:r==="lmt"&&s[0]&&b(s[0].cid)===u&&(o=s[0],f=!1,a=o.checksum);if(o){l=t.lftCongruencyCheck(o,t.message);if(l)if(!t.fullView&&!t.get("active"))t.saveDraftAction(function(){try{t.loadPaneContent(8,null,{force:f,checksum:a},null)}catch(i){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3",i,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3"),e.use("common-utils-error",function(){n.error.report("loadpane convpanerefresherror "+r,i,1,1,1)})}});else{if(r!=="lmt"||!t.currentLmtContext||!(t.currentLmtContext.draftMID||t.currentLmtContext.newMsg&&$.isDraftFid(t.currentLmtContext.newMsg.fid)))c=t.getRoot().one(E)||t.getRoot().one(S),c&&c.replace('<span class="badge" data-action="update">'+l+"</span>"),t.isStale=!0;t.setRefreshTimer()}}}),t.newMessageHandler=e.on("newConvMessage",function(e){t.composeAction=!0,t.get("active")&&t.initReplyForward(e.action,e.oMsg)}),t.eventsBound=!0}function Et(e,t){var n=!0;return e.totalMsgs>t.totalMsgs?(n=!1,e.totalMsgs-t.totalMsgs):0}function St(e,t,n){var r,i,s={oldIdx:-1,newIdx:-1,remainder:!0};r=i=0;while(r<e.msgs.length||i<t.msgs.length)r<e.msgs.length&&n.draftMID&&y(e.msgs[r].mid)===y(n.draftMID)?(s.oldIdx=r,r++):i<t.msgs.length&&y(t.msgs[i].mid)===y(n.newMsg.mid)?(s.newIdx=i,i++):(i<t.msgs.length&&r<e.msgs.length&&y(e.msgs[r].mid)!==y(t.msgs[i].mid)&&(s.remainder=!1),r++,i++);if(r!==e.msgs.length||i!==t.msgs.length)s.remainder=!1;return s}function xt(){var e=this,t=e.listNode;t.all(".super-hidden").removeClass("super-hidden"),t.one(".supercollapsed")&&t.one(".supercollapsed").remove()}function Tt(t){var n=this,r,i=t||n.message,s=i.totalMsgs,o,u="",a,f,l,c,h,p,d=e.one("#inboxcontainer"),v=d.hasClass("prevPaneVisible")&&!d.hasClass("offscreen"),m=[],g,y;n.destroyRichCompose(),n.composeWidgets={};for(r=0;r<s;r++)g=i.msgs[r],g&&$.isDraftFid(g.fid)&&m.push(r);for(r=0;r<m.length;r++){y=m[r],a=i.msgs[y],c=!0;if(!a.oMsgMid){var b=n.getMessageIdxByMid(a.mid);if(b>0)for(var w=b-1;w>=0;w--)if(a.inReplyTo===i.msgs[w].mimeMsgId){a.oMsgMid=i.msgs[w].mid;break}}f=a,o=n.getMsgNodeByMid(a.mid),a.oMsgMid?(l=n.message.msgs[n.getMessageIdxByMid(a.oMsgMid)],h=n.getMsgNodeByMid(a.oMsgMid)):(l=a,h=n.getMsgNodeByMid(n.message.msgs[s-1].mid)),o&&y!==s-1&&(o.remove(),o=null),y===n.message
.msgs.length-1&&n.quickReplyBox&&n.quickReplyBox.hide(),s>=_&&(u=y!==0&&y!==s-1&&h.hasClass("super-hidden")&&!$.isDraftFid(n.fid)?"super-hidden":"",y===s-1&&(h=n.listNode.one(".supercollapsed")?n.listNode.one(".supercollapsed"):h)),($.isDraftFid(n.fid)&&y===m[m.length-1]||y===s-1)&&!v&&(c=!1),a.cookedHeader&&a.cookedHeader.subject&&a.oMsgMid?p=!1:p=!0,l.fid||(l.fid=n.getMsgFid(a.fid)),n.initializeCompose({action:"edit",fid:n.getMsgFid(a),oMsg:a,parentMsg:l,showSubject:p},h,!0,c,u),o&&o.remove()}n.once("convAddedToDOM",function(){$.isDraftFid(n.fid)&&n.parentCW.msgList&&!a.oMsgMid&&s===1&&(n.subjectHandle=e.one("#subject-field").on("valueChange",n.updateSubject))})}function Nt(t,n,r,i,s){var o=this,u,a,f,l,c,h,p,d=typeof r!="undefined"?r:!1,v=t&&t.action==="forward",m=t&&t.showSubject,g,b=typeof s!="undefined"?s:"",w=typeof i!="undefined"?i:!1,E=y(t.parentMsg.mid),S="",x="quickReply";o.dirty=!0,u=o.composeWidgets[E];if(!d&&u)l=u.cv.draft.origin,f=l.action,f!==t.action?u.cv.view.header.switchReplyMode(t.action):u.cv.view.setFocus("body"),o.activeComposeWidget?o.setActiveCompose(u.cv.view):o.activeComposeWidget=u;else{d?(a=" loadhide active",S=' data-mid = "'+y(t.oMsg.mid)+'"'):(a=" active",S=""),n||(n=o.getMsgNodeByMid(o.message.msgs[o.message.msgs.length-1].mid)),n.insert('<div class = "thread-item '+x+" expanded"+a+" "+b+'" '+S+' tabIndex="-1" data-draftmid="'+E+'"> <div class="compose-loading-wrapper"><div class="cm-loadingpane"><div class="s-loader"></div></div></div></div>',"after"),g=n.next(),c={isQuickReply:!0,noFocus:w,containerNode:o.listNode,showSubject:m,maxHeightFn:function(){return o.listNode&&o.listNode.get("offsetHeight")-20||0}},h={setActiveCompose:function(t){t.cv.getDraftMID()&&(t.cv.scrollFocus=!1),e.later(0,o,o.setActiveCompose,[t.cv]),e.fire("compose:rte:active",{editor:t.editor,cv:t.cv})},closeAction:function(){var t=g&&g.one("#rtetext");e.UA.gecko>0&&t&&(t.focus(),t.blur()),p.view.closeCompose(),delete o.composeWidgets[E],o.activeComposeWidget&&o.activeComposeWidget.cv===p&&(o.activeComposeWidget=null,o.richcompose&&!o.hasDrafts()&&o.destroyRichCompose()),e.fire("draftCardRemoved"),g.remove(!0),o.message&&o.message.msgs.length>0&&!$.isDraftFid(o.message.msgs[o.message.msgs.length-1].fid)&&o.quickReplyBox&&(o.quickReplyBox.show(),o.quickReplyBox.removeClass("loadhide"),J||o.quickReplyBox.focus())},hideAction:function(e){o._transformComposeToCard(g,e)},showAction:function(){o._reverseTransformComposeToCard(g)},bindComplete:function(e){v&&o.expandReplyCard(g,e.ccv.view)},updateTitle:function(e){o.fullView&&o.parentCW&&(e.sending?o.parentCW.tab.elTab.addClass("sending"):(o.parentCW.tab.elTab.removeClass("sending"),o.setTitle()))},showDeleteDraftDialog:function(e){e&&e.sdcbk(!1)},qrCancel:function(){p.view.cancelCompose()},switchToTab:function(){o.parentCW&&o.parentCW.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(o.parentCW.tab)},darlaEvent:function(e){e.action=e.type,o.fire("darlaEvent",e)}};var T=["mail-ui-composeview-compose-loader"],N=function(){e.use(T,function(){var n={},r=new e.mail.ui.Compose.ComposeLoader(n);p=r.create_conv_compose_view(t,d,g,c,h),M.enabled("richcomposeInQuickReply")&&e.use("mail-ui-richcompose-view",function(e){o.richcompose?o.richcompose.addComposeView(p.view):o.richcompose=new e.mail.Views.RichCompose(o,p.view)}),o.composeWidgets[E]={cv:p}})};T.push("mail-controller-compose-v3"),T.push("mail-ui-rteview-v3"),T.push("mail-ui-rte-formatter-v3"),N()}}function Ct(){var e=!1,t;for(t in this.composeWidgets)e=!0;return e}function kt(t,r,i){var s=this,o,u,a,f,l,c;if(r){o=s.getMessageIdxByMid(r.mid),u=s.getMsgNodeByMid(r.mid),c=y(r.mid);if(!u)return;f=e.one('[data-draftmid="'+c+'"]');if(i&&f){l=n.getVal(s.composeWidgets[c],"cv.view.focusNode"),l?l.focus():f.focus();return}t==="forward"?a=!0:a=!1,o===s.message.msgs.length-1&&s.quickReplyBox&&s.quickReplyBox.hide(),s.initializeCompose({action:t,fid:s.getMsgFid(r),oMsg:r,parentMsg:r,showSubject:a},u),e.fire("draftCardAdded"),tt()}}function Lt(t,n,r){function l(t){var l,c=o.ancestor("div"),h=c?c.one(".card-actions-menu"):null,p=["removeAddress","spam","notspam","notmymail","sendercompromised","phished","delete"],d=t.dataAction;if(t.dataAction==="conv-help")return;t.dataAction==="bug"?(u=encodeURI(r.getAttribute("data-mid")),a=u.lastIndexOf("_")+1,f="php/qtd_r.php?cid="+i.message.cid+"&mid="+(a?u.slice(a):u)+"&fid="+s,NeoConfig.isCorpmail&&(f+="&isCorpMail=1"),window.open(f,"_bug")):e.Array.indexOf(p,d)!==-1&&h&&h.menu&&h.menu.hide();if(NeoConfig.hasConvRefactor)if(t.dataAction==="reply_sender"||t.dataAction==="forward"){i.initReplyForward(t.dataAction,n);return}var v={action:t.dataAction,context:"msg",id:r?r.get("id"):0,forwardAsAttachment:0,fid:s,item:t.item,hasMsgList:!1,tbAction:!1};e.mail.ui.MessageEvents.handleUI(v,s,null,[n?n:null]),l=t.dataAction+"_thrd_msg",l&&e.fire("mt:click",{action:l,append:{t1:"thrdRdTb"}})}var i=this,s=i.getMsgFid(n),o=t.target,u,a,f;t.preventDefault(),e.use("common-ui-menu-helper",function(e){var n=e.common.ui.MenuHelper,r=o.ancestor("div"),i=r.one(".card-actions-menu");i.addClass("pressed"),e.use("mail-ui-inboxmenu-base","mail-ui-messageevents",function(e){e.mail.ui.InboxMenu.insert("menu-bubble-actions",function(){var r=e.one("#menu-bubble-actions");n.create(i,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY],blur:!0},function(){r.on("menuSelected",l),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(i.removeClass("pressed"),i.unplug(e.Plugin.Menu),this.destroy(!0))})})},s,{fid:s})})})}function At(t,r,i,s,o,u,a){var l=this,h,d,v,g,b,w,E,S=l.message,x=null,T,N,C=o&&o.no_show_hidden_cards?!0:!1,k=o&&o.scroll_to_msg?!!o.scroll_to_msg:!1,L=o&&o.no_focus?!0:!1;l.messageFound=0,u&&u.start(2,"LoadMessageCard"),v=new n.Stopwatch("LoadMessageCard"),x=e.later(500,l,function(){l.loadExtra(function(){if(!l.messageFound)for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E&&(E.hasClass("expanded")||E.addClass("loading"))},1)}),g={success:function(n
,s){e.fire("MessagePane:loadMessageSuccessStart",n);var o=g&&g.respProps&&g.respProps.wasCached?!0:!1,d=g&&g.respProps&&g.respProps.callPerf,b,w=0,T=0,N,A=new Date;u&&(u.start(1,"GDMFetchEnd"),u.YCMSGGetEnd2=A,u.wasCached2=o,u.BECallTime2=d),v&&(v.wasCached=o,v.YCMSGGetEnd=A,v.BECallTime=d,v.stop());if(!l.isConvActive(S.cid))return;for(T=0;T<r.length;T++){N=r[T];if(l.message.msgs&&l.message.msgs[N]){if(!l.message.msgs[N].flags||!l.message.msgs[N].header)l.message.msgs[N]=c.Messages.toMessage(l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]);n[w]&&(n[w]=e.clone(n[w]),n[w].header.snippet=l.message.msgs[N].header.snippet,n[w].fid=l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]=n[w],h=m.getQueryParams(n[w],"midRequest"),n[w].blockImages=h&&h.blockImages,b=l.midObjMap[y(n[w].mid)],p.extractQuotedText(n[w],f.quoted_text_collapse,f.quoted_text_expand,q,b))}w++}l.showMessages(t,n,!1,i,u,k,C,!1,L),s&&s.length&&(a==="one"||a==="all")&&l.showNotification(t,s),l.messageFound=1;if(x){x.cancel();for(w=0;w<r.length;w++)E=l.getMsgNodeByMid(S.msgs[r[w]].mid),E.removeClass("loading")}L||(l.selNode||(l.selNode=e.all(".thread-item").item(t)),l.focusMessageCard())},failure:function(e){l.loadExtra(function(){var n=S.msgs[t],r=l.getMsgNodeByMid(n);e.data=n,n.body={},n.body.display=l.onMsgFailure.apply(l,[e,!1]),u&&u.stop(l.fullView?"MsgInTabFailure":"MsgInPreviewFailure"),l.showMessage(n,0,r,!1,i)},1),l.messageFound=1,l.primaryMid=null;if(x){x.cancel();for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E.removeClass("loading")}},errorPosition:401,suppressCodes:["*"]},b=[];for(T=0;T<r.length;T++)b.push(S.msgs[r[T]]);if(b.length===1&&l.message.msgs.length>1){w=l.getMsgNodeByMid(b[0].mid),N=function(){var e=w.one(".thread-body"),t=w.one(".thread-body .body"),n=e&&e.getAttribute("original_content"),r=!$.isDraftFid(l.getMsgFid(b[0])),i=t&&t.get("children").size()>0;return n||!o&&r&&i};if(N()){l.messageFound=1,l.showMessage(b[0],r[0],w,!1,"yes"),l.listNode.all(".loadhide").removeClass("loadhide"),l.getRoot()&&l.getRoot().one(".conv-loading").addClass("hidden");return}}e.fire("MessagePane:loadMessageCardsStart",l.message,b),d=l.requestAllMessages(b,l.message.fid,g,o,{stopwatch:u,RSstopwatch:v}),l.abortRequests(),l.outboundReq&&(l.request=d,l.requestType="loadcard")}function Ot(t){var n=this,r=n.getMessageIdxByMid(t.mid),i=n.getMsgNodeByMid(t.mid),s=n.message.msgs[r];return!e.Lang.isValue(r)||!i||!s?!1:(i.hasClass("expanded")?n.scrollToMsg(s):(n.scrollOnExpansion=!0,n.expandMessages(r,"one","yes",!1)),!0)}function Mt(t){var n=this,r=n.getMsgNodeByMid(t.mid),i=n.getMessageIdxByMid(t.mid),s,o;i===0?n.listNode.set("scrollTop",0):(o=r.get("offsetTop")-12,e.use("anim",function(){var r=new e.Anim({node:n.listNode,duration:n.fullView?.2:0,to:{scroll:[0,o]}});r.run(),r.on("end",function(){s=n.getMsgFid(t),n.markConvMsgAsRead(s,t)})})),n.scrollOnExpansion=!1}function _t(e,t,n){var r=this;r.toggleAllMessageCards(e,t,n)}function Dt(e,t,n){var r=this,i,s={};r.expandSuperCollapsedNodes(),r.lastExpandedMsgIdx=0,t==="expandall"?(n.toggleState="expanded",i=r.getMessageIdxByMid(r.message.msgs[0].mid),s.no_focus=!0,r.expandMessages(i,"all",!1,"no",s),e&&e.removeClass("thread-cards-collapsed"),e&&e.addClass("thread-cards-expanded"),e.setAttribute("title",strings.str_collapse_all_attr),e.one(".icon-text").setContent(strings.str_collapse_all)):(n.toggleState="collapsed",r.collapseAllMessageCards(),e&&e.removeClass("thread-cards-expanded"),e&&e.addClass("thread-cards-collapsed"),e.setAttribute("title",strings.str_expand_all_attr),e.one(".icon-text").setContent(strings.str_expand_all))}function Pt(e){var t=this,n=t.lastExpandedMsgIdx;if(!(t.message.msgs.length>n)){t.fetchMoreTimer=null;return}t.fetchMoreTimer=setTimeout(function(){t.expandMessages(n,"all",!1,"no",e)},100)}function Ht(t,n,r,i,s,o,u){var a=this,f=a.message,l,c,h=null,p=[],d,v=0,m,g,y;switch(n){case"all":a.lastExpandedMsgIdx=a.lastExpandedMsgIdx?a.lastExpandedMsgIdx:0,u=!1,t=0,v=0;for(a.lastExpandedMsgIdx;a.lastExpandedMsgIdx<f.msgs.length;a.lastExpandedMsgIdx++){if(!(v<L)){a.fetchMoreMsgs(s);break}if($.isDraftFid(a.getMsgFid(f.msgs[a.lastExpandedMsgIdx])))continue;p.push(a.lastExpandedMsgIdx),v++}a.scrollLoad=!0,a.expandAllMode=!0;break;case"one":p.push(t);break;case"unread":case"other-unread":m=n==="other-unread"?t:0,u=u&&n==="unread",y=function(e){a.expandMessages(e+1,"other-unread",!1,!1,{scroll_to_msg:!1,no_show_hidden_cards:!0,no_focus:!0})};for(d=m;d<f.msgs.length;d++){if($.isDraftFid(a.getMsgFid(f.msgs[d]))||n==="other-unread"&&d===0)continue;if(!f.msgs[d].flags.isRead){if(!(v<k))break;if(h===null&&n==="unread"){h=d,t=h,p.push(d),g=d,a.fetchOther=e.Lang.later(P,a,y,g);break}n==="other-unread"&&p.push(d),v++}}!p.length&&n!=="other-unread"&&(t=f.msgs.length-1,p.push(t));break;case"adjacent":l=t,t+C+1>f.msgs.length?c=f.msgs.length:c=t+C+1;for(l;l<c;l++)p.push(l);break;case"send":case"other-send":t=null;for(d=0;d<f.msgs.length;d++)a.getMsgFid(f.msgs[d])==="Sent"&&(p.push(d),t=d);n==="other-send"&&p.length&&p.pop();break;case"draft":t=null,u=!1,a.listNode.all(".loadhide").removeClass("loadhide"),a.getRoot()&&a.getRoot().one(".conv-loading").addClass("hidden")}a.selMsgIdx=t,u&&e.Lang.isNumber(t)&&(a.primaryMid=a.message.msgs[t].mid),a.loadMessageCards(t,p,r,i,s,o,n)}function Bt(e){var t=this,n=parseInt(e.getComputedStyle("height"),10);e.setStyles({height:n+"px",overflow:"hidden"}),setTimeout(function(){e.setStyle("transition",""),e.setStyle("height",D+"px"),M.enabled("messageReadPaneV2")&&e.removeClass("expanded")},0),setTimeout(function(){e.removeClass("expanded"),e.setAttribute("aria-expanded","false"),e.one(".thread-body").setContent(""),t.fire("darlaEvent",{action:t.fullView?"message_tabpane":"msgread_reading_pane"}),t.fire("MessagePane:unload",e),tt()},200)}function jt(t,n,r,i,s,o,u){function E(e,t){h=a.getMsgFid(e),t.inRegion(a.listNode)&&t.hasClass("expanded")&&t.hasClass("unread")&&a.markConvMsgAsRead(h,e)}var a=this,f,l=t.mid,c=this.getMsgMarkUp({message:t
,expand:!0,replyMode:i}),h,p=s!==!1,v,m,g,b,w;try{if(r.hasClass("collapsing")||r.hasClass("expanding"))return;return r.hasClass("thread-focus")&&(w=!0),r.replace(c),r=a.getMsgNodeByMid(l),w&&(a.selNode=r,a.focusMessageCard()),r.removeClass("loadhide"),t.body&&(r.one(".body").setContent(d.processBodyMarkup(t.body.display||"")),yt(r),a.autoLoadNonDisplaybleTruncMsg(t,r,n),p&&a.initialRender?(f=parseInt(r.getComputedStyle("height"),10),r.setStyles({transition:"none",height:D+"px"}),u&&a.scrollOnExpansion&&a.scrollToMsg(t),M.enabled("markExpandedAsRead")||E(t,r),a.fire("darlaEvent",{action:a.fullView?"message_tabpane":"msgread_reading_pane"}),setTimeout(function(){r.setStyle("transition",""),r.setStyle("height",f+"px")},0),e.later(200,r,r.setStyles,{height:"auto",overflow:"visible",transition:"none"})):r.setStyles({height:"auto",overflow:"visible",transition:"none"}),d.plainTextMessage(t.part)?(v=r.one(".thread-body .body"))!==null&&(b="addClass"):b="removeClass",b&&v&&v.parentNode&&(v[b]("plaintextMsg"),v.parentNode[b]("compose"),b=undefined),r.removeClass("loading"),a.scrollTop&&(g=a.get("rootNode").one(R),setTimeout(function(){g.set("scrollTop",a.scrollTop)},200))),t.loading_error||a.convMsgRenderComplete(t,r,o),m=a.expandMessageTimers[y(t.mid)],m&&m.cancel(),e.fire("MessagePane:messageExpandDone",{mid:t.mid,cid:a.message.cid}),tt(),r}catch(S){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4")}}function Ft(e,t){var n,r,i=t||[],s,o=this;for(n=0;n<i.length;n++)r=i[n],s=o.getMsgNodeByMid(r.mid),s&&(s.addClass("load-error"),s.one(".load-error-msg").setContent(r.msgPermDeleted?strings.str_msg_deleted_error:strings.str_msg_load_error_generic))}function It(t,r,i,s,o,u,a,f,l){function b(){var n,r,i;r=e.Lang.isArray(t)?t[0]:t,n=c.getMsgNodeByMid(c.message.msgs[r].mid);if(!c.expandAllMode){l||(c.selNode=n);if(!a||y&&r>0)i=n,setTimeout(function(){a||(c.listNode&&c.listNode.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading")&&g.one(".conv-loading").addClass("hidden")),y&&r>0&&c.listNode&&c.listNode.set("scrollTop",i.get("offsetTop")-12)},0)}else c.selNode=null}var c=this,h=0,p,d,v,m,g=this.getRoot(),y=u===!0;o&&o.start(1,"MessageInDOM");for(h=0;h<r.length;h++)p=r[h],d=c.getMessageIdxByMid(p.mid),v=c.getMsgNodeByMid(p.mid),f?(v.hasClass("expanded")||v.addClass("expanded"),c.convMsgRenderComplete(p,v,o)):$.isDraftFid(p.fid)||c.showMessage(p,d,v,i,s,o,y),M.enabled("markExpandedAsRead")&&c.markConvMsgAsRead(c.getMsgFid(p),p);f&&(g.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading").addClass("hidden")),c.initialRender=!0,o&&(c.fire("renderConvComplete"),c.fullView&&c.fire("read-stat:renderCompleteOnUpdate"),NeoConfig.hasConvView&&setTimeout(function(){e.fire("tutorConvMsgPaneRendered")},200)),h=c.primaryMid?1:0,m=function(){var e=new n.Stopwatch(c.fullView?"MsgInTab":"MsgInPreview");e.wasCached=!0,e.stop()};for(;h<r.length;h++)setTimeout(m,(h+1)*250);c.primaryMid=null,c.parentNode&&c.parentNode.ancestor("body")?(b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)):c.once("activeChange",function(){b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)})}function qt(){var e=[];this.message&&(e=this.message.msgs),e.forEach(function(e){!e.flags.isRead&&e.body&&this.markConvMsgAsRead(this.getMsgFid(e),e)},this)}function Rt(){var e=this;return e.listNode?e.listNode.all("."+x):null}function Ut(e,t){t.scrollFocus&&this.listNode.set("scrollTop",e.get("offsetTop")-5)}function zt(e,t){var n=this,r={truncateAt:null},i=n.get("rootNode").one(R);n.scrollTop=i.get("scrollTop"),n.msgTrucationStatus.disabled[e.mid]=!0,n.expandMessages(t,"one","yes",!1,r)}function Wt(e,t){var n=this,r={midRequest:{blockImages:"none"}};n.expandMessages(t,"one","yes",!1,r)}function Xt(e,t,n){var r=this,i=r.message;t||(i.body=i.attachments=i.imgAttachments=i.nonImgAttachments=0),r.loadMessage(1,e,n)}function Vt(){var e=this,t=e.loading_slow?2:1;e.loading_slow=e.loading_error=e.loading_moved=0,t>0&&t<=6&&(e.numRetries=e.numRetries?e.numRetries+1:1,e.numRetries>=e.maxRetries),e.loading_slow=e.loading_error=e.loading_moved=0,e.fireEvent("retry"),e.loadPaneContent(6,t),e.set("transferFocus",1)}function $t(t,n){var r=this,i=t||[],s,o,u=i.length;if(NeoConfig.enableMessagePrefetch){e.fire("prefetchConversations",{fid:r.fid,cids:i});return}for(o=0;o<u;o++)s||(s=v.batch()),s.setAsReadOp(!0),g.batchAddConvPrefetch(s,o,r.fid,i[o],n);s&&s.execute({suppressCodes:["*"],backgroundLogs:["*"]})}function Jt(){var t=this,n;!NeoConfig.backButtonFull&&t.fullView===!0&&e.fire("initPage"),t.quickReplyBox&&(t.quickReplyBox.one("#switchtext-plain").addClass("hidden"),t.quickReplyBox.one("#switchtext-rich").removeClass("hidden")),NeoConfig.hasConvPerf&&t.fid!=="%40B%40Bulk"&&t.fid!=="Trash"&&!t.midtocid&&setTimeout(function(){t.prefetch(t.neighbors,"Neighbors")},Math.min(P+50,H)),t.fullView?n="thread_tabpane":n="msgread_reading_pane",e.fire("mt:view",{action:n})}function Kt(){}function Qt(e){var t=this,n=e.insertObj,r,i,s,o,u,a,f,l,p;r=n.msg,s=n.replace||0;if(t.message){i=n.pos!==undefined?n.pos:t.message.msgs.length,a=r.fid,r.header||(r=c.Messages.toMessage(a,r)),t.message.msgs.splice(i,s,r),t.message.midMap.splice(i,s,{fid:r.fid,mid:r.mid}),t.message=h.Conversations.calcConvSummary(t.message),p=t.message.msgs,u=p.length;for(o=0;o<u;o++)l=y(p[o].mid),t.midObjMap[l]=o;e.render&&(f=t.getMsgMarkUp({message:r,expand:e.expand||!1}),t.quickReplyBox?t.listNode.insertBefore(f,t.quickReplyBox):t.listNode.append(f),J?t.expandMessages(t.message.msgs.length-1,"one",e.anim,undefined,e.ovparams):t.expandMessages(t.message.msgs.length-1,"one",!0)),t.updateCount()}}function Gt(){var e=this,t,n=e.message.totalMsgs,r=e.getRoot
().one(E);r&&(n>1?t="("+n+")":t="",r.set("innerHTML",t))}function Yt(){var t=e.one("#subject-field"),n=e.one(w+" .thread-subject");t.get("value")!==""?(n.set("innerHTML",t.get("value")),n.set("title",t.get("value"))):(n.set("innerHTML",strings["str_msg-view_no_subject"]),n.set("title",strings["str_msg-view_no_subject"]))}function Zt(e,t){var n=this,r;e&&!e.hasClass("instant-quick-reply-card")&&(r=e.one(K),r&&(r.blur(),r.removeAttribute("contenteditable")),e.addClass("instant-quick-reply-card"),n._transformHeader(e,t),n._transformBody(e),n._transformFooter(e))}function en(e){var t,n,r,i,s,o;e&&(t=e.one(K),n=e.one(".custom-sender-info"),i=e.one(".custom-footer-info"),r=e.one(".custom-quoted-text"),s=e.one(Q),o=e.one(".cm-cc-group.hidden"),n&&n.remove(),r&&r.remove(),i&&i.remove(),s&&(s.setStyle("min-height","180px"),o||s.setStyle("margin-top","0")),e.removeClass("instant-quick-reply-card"),t.focus(),t.setAttribute("contenteditable",!0))}function tn(e,t){var n,r,i;e&&(n=e.one(K),r=e.one(".compose-header.fresh"),i=this._getHeaderTmpl(t),n&&r&&i&&r.prepend(i))}function nn(e){var t,n,r,i,s;e&&(t=e.one(K),r=e.one(".yahoo_quoted"),n=e.one(Q),i=this._getCollapsedQuotedTmpl(),s=e.one(".cm-cc-group.hidden"),t&&(r&&i&&r.insert(i,"before"),n&&(n.setStyle("min-height","0"),s||n.setStyle("margin-top","-10px"))))}function rn(e){var t,n,r;e&&(t=e.one(K),n=e.one(".footer-separator"),r=this._getDisabledFooterTmpl(),t&&n&&r&&n.insert(r,"before"))}function sn(t){var i,o,u,a,l;return t&&(u="&lt;"+(s(t.email)||"")+"&gt;",i={from_name:s(t.name)||"",from_id:u,sender_email_address:u},o={received_date:new Date,date:strings.str_mail_today+n.substitute(strings.str_smw_date_time,{date:"",time:""})+n.dateFormatter(new Date,strings.str_smw_today_date)},l=e.Node.create('<div class="custom-sender-info">'+r(f.unread_icon,{flag_info_hover:"info-unread"})+r(f.from,i)+r(f.thread_date,o)+r(f.flag_icon)+"</div>"),l.all("*[data-action]").removeAttribute("data-action")),l}function on(){var t={str_reply:strings.str_reply,str_reply_all:strings.str_reply_all,str_forward:strings.str_forward,str_more:strings.str_more},n=e.Node.create(r(f.with_icons,t));return n&&(n.all("*[data-action]").removeAttribute("data-action"),n.addClass("custom-footer-info")),n}function un(){var t=e.Node.create(r(f.quoted_text_collapse,{str_qtd_expand:strings.str_qtd_expand}));return t&&(t.all("*[data-action]").removeAttribute("data-action"),t.addClass("custom-quoted-text")),t}e.namespace("mail.ui");var t=e.mail.ui._ConvPane,n=e.common.Utils,r=n.substitute,i=n.ezSub,s=n.escapeHtml,o=n.ymmastats,u=n.unescapeHtml,a=e.ui.Templates,f=a._shared_module_thread_thread_display_rollup,l=e.mail,c=l.model.DataStore,h=l.model.ConvStore,p=l.ui.PaneUtils,d=l.ui.MessagePaneUtils,v=l.Controller,m=l&&l.Controller?l.Controller.Messages:{},g=l&&l.Controller?l.Controller.Conversations:{},y=c.Messages.getPermMidPart,b=h.Conversations.getPermCidPart,w=".message-header",E=w+" .summary",S=w+" .badge",x="thread-item",T="expanded",N="unread",C=2,k=NeoConfig.convMsgsToOpenCount||5,L=NeoConfig.convMsgsToOpenCount||5,A=e.mail.persist.MetaData,O=n.settings,M=n.features,_=O.value("SUPER_COLLAPSE_THRESHOLD")||6,D=M.enabled("messageReadPaneV2")?24:21,P=10,H=175,B=5,j=strings.str_cfg_tog_hkr_siu===!0?"hkr_siu":"cg_siu",F=strings.str_cfg_tog_hkr_siu===!0,I={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},q=[],R=".thread-item-list",U=M.enabled("hideRecipients"),z=O.value("recipientThresholdVal")||5,W={to:!1,cc:!1,bcc:!1},X=M.enabled("rtePopoutToolbar"),V=M.enabled("squeezeToolbar"),$=e.mail.ui.FolderUtils,J=M.enabled("instantCloseOnSend"),K=".cm-rtetext",Q=".inner",G=function(e){var t=this;e=e||{},G.superclass.constructor.call(t,e)};e.extend(G,l.ui.MailPaneRead,{setFullFormatters:it,onSuccess:st,bindPaneContent:wt,retryLoad:Vt,unblockImages:Wt,viewFullMsg:zt,autoLoadNonDisplaybleTruncMsg:bt,changeRequest:Xt,searchRecipients:Kt,postRender:Jt,prefetch:$t,getMsgMarkUp:rt,selectMessage:Ot,scrollToMsg:Mt,expandMessages:Ht,collapseMessage:Bt,loadMessageCards:At,showMessage:jt,showMessages:It,showNotification:Ft,setActiveCompose:ut,getActiveCompose:ot,hasDrafts:Ct,saveDrafts:at,insertMsgAtPos:Qt,loadMenu:Lt,expandReplyCard:Ut,toggleAllMessageCards:Dt,handleToggleAllMessageCards:_t,lftCongruencyCheck:Et,lftSendSaveCongruencyCheck:St,expandSuperCollapsedNodes:xt,initializeCompose:Nt,initializeAllDrafts:Tt,initReplyForward:kt,updateCount:Gt,updateSubject:Yt,closeAllCompose:ft,markConvMsgAsRead:lt,convMsgRenderComplete:ht,bindContentUI:gt,fetchMoreMsgs:Pt,checkMsgCardsOnScroll:vt,checkAdsOnScroll:dt,scheduleScrollHandler:mt,onPaneScroll:pt,getAllCards:Rt,markAsReadBatch:ct,getInboxService:nt,markExpandedMsgsAsRead:qt,_getHeaderTmpl:sn,_getDisabledFooterTmpl:on,_getCollapsedQuotedTmpl:un,_transformComposeToCard:Zt,_reverseTransformComposeToCard:en,_transformHeader:tn,_transformBody:nn,_transformFooter:rn}),e.mix(t.prototype,G.prototype),e.mix(t.prototype,l.ui.MailPaneRead.prototype)},"1.0.0",{requires:["_shared_module_thread_thread_display_rollup","common-persist-user-data","common-ui-tabs-base","common-utils-stats","contacts-api","contacts-api-utils","mail-persist-meta-data","mail-platform","mail-ui-common-fonts","mail-ui-convpane-base","mail-ui-convpane-bind","mail-ui-mailpane-read","mail-ui-messagepane-utils","mail-ui-messagepane-warnings","mod-conversation-history_css","mail-common-utils-features","mail-common-utils-settings","mail-ui-pane-utils","common-utils","mail-ui-folder-utils","mail-ui-deeplink-manager"]});
YUI.add("mail-common-cachewarmer",function(e){e.namespace("mail.common.cachewarmer");var t=5e3,n=3e3,r=10,i=NeoConfig.pfm,s=50,o=e.Env._loader,u={isIdle:function(){return!0}},a=e.common.net.Session||u,f={},l=e.on("ds:msg:remove",function(e,t){if(e==="Inbox")for(var n in t)f[t[n].mid]=!0}),c={},h=e.on("ds:conv:remove",function(e,t){if(e==="Inbox")for(var n in t)c[t[n].cid]=!0}),p=function(e){try{return function(){this.queue[e].apply(this.queue,arguments)}}catch(t){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-common-cachewarmer:1",t,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-common-cachewarmer:1")}return!1};e.mail.common.cachewarmer={queue:function(){var t=new e.AsyncQueue;return t.defaults.timeout=s,t}(),add:function(){return this.queue.add.apply(this.queue,arguments),this},run:function(){return this.queue.add(this.queue.stop),this.queue.run(),this},clear:function(){this.queue.stop(),e.detach("cachewarmer:stopMessagePrefetch")},warmUp:function(t,n,r,i){return r&&this.addDelay(r),!i&&this.addIdleCheck(),e.Lang.isArray(n)&&n.length?(this.queue.add({fn:function(){e.use.apply(e,n)},timeout:10,id:t}),this):!1},addDelay:function(e){return e?(this.queue.add({fn:function(){},timeout:e}),!0):!1},addIdleCheck:function(e){var t=0,n=this.queue;return e=e||r,n.add({fn:function(){t++},timeout:400,until:function(){return a.isIdle()&&(!o||!o._loading)||t===e&&n.stop()}}),!0},setupLaunch:function(e){return this.addDelay(e?n:t),this.addIdleCheck(),!0},preFetchMessages:function(e,t,n,r){if(NeoConfig.hasConv)return;return this.clear(),n&&this.addDelay(n),e==="Inbox"&&!t?this.addInboxPreFetching():this._preFetchMessages(e,t,r),this.run()},addInboxPreFetching:function(){var t=this;NeoConfig.hasConv&&NeoConfig.hasConvPerf?t._preFetchConvs("Inbox",e.mail.ui.ConvList.getConvHdrList(),null,!0):NeoConfig.hasConv||t._preFetchMessages("Inbox",e.mail.ui.MessageList.getMsgHdrList(),null,!0)},_preFetchConvs:function(t,n,r,s){function b(n,r,i){var s=function(){var s=[],o;for(o in n)c[n[o].cid]||s.push(n[o]);if(s.length>0){f=e.mail.Controller.batch(),f.setAsReadOp(!0);for(o=0;o<s.length;o++)e.mail.model.ConvStore.Conversations.isCached(t,s[o].cid)||e.mail.Controller.Conversations.batchAddConvPrefetch(f,o,t,s[o],"CacheWarmer");f.execute({suppressCodes:["*"],backgroundLogs:["*"]})}r&&e.detach(i)};this.timeout=100,this.id="convsPrefetch",this.fn=s}var o,u,a=[],f,l,p,d,v=i.batch.split(","),m=i.count,g=i.maxSize,y=e.mail.ui.ConvList;r&&r[0]?a=r:y&&n&&y.getNeighbors(n,-1,a,t,m,g);while((d=v.shift()||10)&&(p=a.splice(0,d))&&(u=p.length)){l=[];for(o=0;o<u;o++)l.push(p[o]);this.addIdleCheck(),this.queue.add(new b(l,s,h))}return e.once("cachewarmer:stopMessagePrefetch",function(t){var n=["convsPrefetch"];this.queue.remove("convsPrefetch"),this.clear(),!e.Lang.isUndefined(t)&&e.Lang.isFunction(t.done)&&(e.Lang.isUndefined(t.data)||n.push(t.data),t.done.apply(this,n))},this),this.queue.on("complete",function(){e.detach("cachewarmer:stopMessagePrefetch")}),!0},_preFetchMessages:function(t,n,r,s){function o(n,r,i){var s=function(){var s=[];for(var o in n)f[n[o].mid]||s.push(n[o]);s.length>0&&(NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:s,sourceFid:t,statTAE:!1,showTAE:!1}):e.mail.Controller.Messages.get({fid:t,prefetch:s,cachekey:"CacheWarmer"},{suppressCodes:["*"],backgroundLogs:["*"]})),r&&e.detach(i)};this.timeout=10,this.id="messagePrefetch",this.fn=s}if(!i||NeoConfig.hasConv)return!1;NeoConfig.grid&&(i.batch="6,6",i.count=12);var u,a,c=[],h,p,d,v=i.batch.split(","),m=i.count,g=i.maxSize,y=e.mail.ui.MessageList;r&&r[0]?c=r:y&&n&&y.getNeighbors(n,-1,c,t,m,g);while((d=v.shift()||10)&&(p=c.splice(0,d))&&(a=p.length)){h=[];for(u=0;u<a;u++)h.push(p[u]);this.addIdleCheck(),this.queue.add(new o(h,s,l))}return e.once("cachewarmer:stopMessagePrefetch",function(t){var n=["messagePrefetch"];this.queue.remove("messagePrefetch"),this.clear(),!e.Lang.isUndefined(t)&&e.Lang.isFunction(t.done)&&(e.Lang.isUndefined(t.data)||n.push(t.data),t.done.apply(this,n))},this),this.queue.on("complete",function(){e.detach("cachewarmer:stopMessagePrefetch")}),!0},addCompose:function(e,t,n){this.warmUp("compose",n,e,t)},before:p("before"),on:p("on"),after:p("after"),fire:p("fire")}},"1.0.0",{requires:["async-queue","loader","common-net-session","mail-controller-messages"]});
