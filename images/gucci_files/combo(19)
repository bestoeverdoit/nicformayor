YUI.add("mail-models-draft",function(e){function o(e){return!!r[e]}function u(e){var t={};return e.name&&(t.name="Doe"),e.email&&(t.email="doe@x.com"),t}function a(t,n){switch(t){case"simpleBody":n.html&&(n.html="<html-filtered>"),n.text&&(n.text="<text-filtered>");break;case"to":case"cc":case"bcc":case"from":case"replyTo":e.Lang.isArray(n)&&e.Array.each(n,function(e){n=u(e)})}return n}function f(){this.csid=null,this.mid=null,this.cid=null,this.state="uninitialized",this.captcha=null,this.to=[],this.cc=[],this.bcc=[],this.replyto={name:"",email:""},this.from={name:"",email:""},this.subject="",this.body={html:"",text:""},this.origin={action:null,fid:null,oMsg:null,yqtdPrefix:"",ctxReq:null,forwardAsAttachment:!1,errInfo:null},this.folder={id:""},this.attachments=[],this.inreplyto="",this.references=[],this.spame="U",this.draftModelId=i++,this.publish("stateChanged"),this.isRead=!0}var t=e.common.Utils.verify,n=e.common.Utils.guid,r=e.Array.hash(["uninitialized","saved","unsaved","saving","savingAndSending","sending","captchaing","sent","final"]),i=1,s=e.Array.hash(["Y","N","C","U"]);e.mix(f.prototype,{fireEvent:function(t){try{this.fire.apply(this,arguments)}catch(n){e.fire("MailLog",{m:"ComposeV3: Draft: Exception occured while firing event : "+t,exp:n})}},addAttachment:function(e){this.attachments.push(e);if(!e.contentId()){var t="<"+n()+"@yahoo.com"+">";e.setContentId(t)}this.fireEvent("attachmentAdded",e)},removeAttachment:function(e){var t=0,n=this.attachments;for(t=0;t<n.length;t++)if(n[t].contentId()===e){n[t].setState("deleted");break}},isFresh:function(){var t=this.origin.oMsg&&this.origin.oMsg.sourceFolderInfo&&this.origin.oMsg.sourceFolderInfo.fid,n=e.mail.ui.FolderUtils;return!this.origin.oMsg||!n.isDraftFid(t)},generateCsid:function(){var e;this.hasCsid()||(e="000000000"+(Math.floor(Math.random()*1e9)+(new Date).getTime()%1e9).toString(),this.csid=e.substr(e.length-10))},hasCsid:function(){return!!this.csid},hasMid:function(){return!!this.mid},isInConv:function(){return e.common.Utils.getVal(this,"origin.oMsg.cid",null)!==null},isRejectedOnCaptcha:function(){return!!e.common.Utils.getVal(this,"captcha.captchaPayload")},isUploadingAttachments:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return e.state()==="uploading"||e.state()==="pending"}).length>0},isUploadingInlineImages:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return(e.state()==="uploading"||e.state()==="pending")&&e.isInline()&&e.isImage()}).length>0},getUploadedOrSavedAtt:function(){return this.attachments.filter(function(e){return e.state()==="uploaded"||e.state()==="saved"})},hasAttachmentsToReconcile:function(){return this.attachments.filter(function(e){return e.state()==="saved"||e.state()==="uploaded"||e.state()==="pending"&&e.size()!==0}).length>0},_createAttachJson:function(t,n,r){var i=[],s=2,o;return t=t||{},e.Array.each(n,function(e){var n=e.state(),u=e.size(),a={disposition:e.disposition()},f=n==="saved"||n==="uploaded",l=n==="pending"&&u!==0||r&&n==="uploading";if(f||l)f?(a.messageReference={id:e.mid(),pid:e.partId()},a.contentId=e.contentId()):l&&(o=e.getSourceType()+s,e.setPartId("multipart://"+o),t.iframeUpload&&e.setPartId("multipart://"+t.iframeUpload.multipartName),e.setMultiPartName(o),a.multipartName=e.partId(),a.contentId=e.contentId(),s++),i.push(a)}),i},jsonifyObj:function(t,n){var r=this,i,s=["subject","to","cc","bcc"],o=["folder"],u={actions:{responseMessage:!0,responseMessageV2:!0},message:{csid:r.csid,captcha:r.captchaAnswer,flags:{spam:!1,read:this.isRead},headers:{}},simpleBody:{}};return t=t||{},r.body.html!==""?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,this.attachments.length>0&&(u.simpleBody.attachments=this._createAttachJson(t,this.attachments,n)),r.body.html?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,e.Array.each(o,function(e){u.message[e]=r[e]}),e.Array.each(s,function(e){u.message.headers[e]=r[e]}),i=r.makeInReplyTo(),i?(u.message.inReplyTo=i,u.message.newMessage=!1):u.message.newMessage=!0,r.replyto.email&&(u.message.headers.replyTo=[r.replyto]),u.message.headers.from=[r.from],u},batchSaveJsonifyInfo:function(t,n){var r=this.jsonifyObj(t,n),i,s=[],o="",u,a=[],f=[];f=t.webAttachments;for(i=0;i<f.length;i++)u=f[i].getMultiPartName(),o=u,s.push({id:"id_"+u,uri:f[i].getWebUrl(),method:"GET",filters:{exportResponse:!0},suppressResponse:!0});return a.push({partName:"jsonString",contentType:"application/json",payload:r}),e.Array.each(t.uploads,function(e){if(e.size()===0)return;a.push(e.getPayLoadPartDefinitionForJediBatch())}),{payloadParts:a,webAttRequests:s}},batchJsonifyObject:function(e){var t=e&&e.saveUrl,n={responseType:"json",requests:[]},r=n,i,s=this.batchSaveJsonifyInfo(e);for(i=0;i<s.webAttRequests.length;i++)s.webAttRequests[i].requests=[],n.requests.push(s.webAttRequests[i]),n=s.webAttRequests[i];return n.requests=[{id:"SaveMessage",uri:t,method:"POST",payloadType:"multipart",payloadParts:s.payloadParts}],r},batchJsonify:function(t){return e.JSON.stringify(this.batchJsonifyObject(t),null,4)},setRead:function(e){this.isRead=e},jsonify:function(t){return e.JSON.stringify(this.jsonifyObj(t),null,4)},getLogInfo:function(t){var n=this.jsonifyObj(t,!0);return n.draftModelId=this.draftModelId,e.JSON.stringify(n,a)},setState:function(n,r){var i={prev:this.state,next:n};t(o(n),"Draft: Illegal model state: "+n);if(i.prev==="final"||i.prev==="sent"&&i.next!=="final")return;i.next!==i.prev&&e.fire("MailLog",{m:"v3 draft state change",info:"modelID: "+this.draftModelId+", next: "+i.next+", prev: "+i.prev}),this.state=n,r&&(i.err=r),this.fireEvent("stateChanged",i)},setSpame:function(e){t(!!s[e],"Draft: Illegal spame code: "+e),this.spame=e},setHeader:function(e){this.to=e.to||[],this.cc=e.cc||[],this.bcc=e.bcc||[],this.from=e.from||{},this.replyto=e.replyto||{},this.subject=e
.subject||""},setOrigin:function(e){this.origin=e;var t=this.origin.oMsg,n,r;t&&(n=this.origin.action==="edit",r={from:t.from,subject:t.subject,cc:n?t.cc:this.cc,bcc:n?t.bcc:this.bcc},this.setHeader(r)),this.fireEvent("originChanged")},setBody:function(e,t){var n=this.body.text!==e||this.body.html!==t;n&&this.state==="saved"&&this.setState("unsaved"),this.body.text=e||"",this.body.html=t||""},notifyBodyChanged:function(e){this.fireEvent("bodyChanged",e)},notifyHeaderChanged:function(e){this.fireEvent("headerChanged",e)},isSaved:function(){return this.state==="saved"},isSpame:function(){return this.spame==="N"},getAccountId:function(){return this.folder&&this.folder.acctId},makeInReplyTo:function(){var t,n,r=!1;return t=e.common.Utils.getVal(this,"origin.oMsg",null),t&&(this.origin.action==="edit"?(n=e.common.Utils.getVal(t,"inReplyToV3MsgRef",null),n&&n.messageReference&&(r={replied:n.replied?!0:!1,forwarded:n.forwarded?!0:!1,messageReference:{id:n.messageReference.id}})):r={replied:this.origin.action==="reply_sender"||this.origin.action==="reply_all",forwarded:this.origin.action==="forward",messageReference:{id:this.origin.oMsg.mid}}),r&&r.messageReference&&r.replied^r.forwarded?r:undefined}}),e.augment(f,e.EventTarget,!0,null,{prefix:"draft"}),e.namespace("Mail.Models").Draft=f},"1.0.0",{requires:["common-utils","event-custom","json","oop","mail-common-utils-features","mail-ui-folder-utils"]});
YUI.add('contacts_strings', function(Y) {
Y.namespace("mail");
Y.mix(strings,{"str_form_placeholder_first":"First","str_form_placeholder_middle":"Middle","str_form_placeholder_last":"Last","str_cont_edit_cont":"","str_cont_add_to_cont":"Add to Contacts","str_help":"Help","str_cont_lbl_add_xtra_email":"Add another email address","str_cont_lbl_remove_xtra_email":"Remove email address","str_form_lbl_email":"Email:","str_form_lbl_email_email":"Email","str_form_lbl_email_work":"Work Email","str_form_lbl_email_home":"Home Email","str_form_lbl_im_dont_add":"Don't add to {{str_branding_messenger}}","str_cont_lbl_add_xtra_im":"Add another instant messenger ID","str_cont_lbl_remove_xtra_im":"Remove instant messenger ID","str_form_lbl_im":"Instant Message:","str_form_lbl_im_ymsgr":"{{str_branding_messenger}}","str_form_lbl_im_msn":"Windows Live (MSN)","str_form_lbl_im_aol":"AOL\/AIM","str_form_lbl_im_gtalk":"GTalk","str_form_lbl_im_icq":"ICQ","str_form_lbl_im_irc":"IRC","str_form_lbl_im_qq":"QQ","str_form_lbl_im_skype":"Skype","str_form_lbl_im_ali":"Ali Wangwang","str_form_lbl_im_yjapan":"{{str_branding}} Japan","str_form_lbl_im_jabber":"Jabber","str_form_lbl_im_mslcs":"Microsoft LCS","str_form_lbl_im_lotus":"Lotus Sametime","str_cont_lbl_add_xtra_phone":"Add another phone number","str_cont_lbl_remove_xtra_phone":"Remove phone number","str_form_lbl_phone":"Phone:","str_form_lbl_phone_phone":"Phone","str_form_lbl_phone_mobile":"Mobile","str_form_lbl_phone_home":"Home Phone","str_form_lbl_phone_work":"Work Phone","str_form_lbl_phone_pager":"Pager","str_form_lbl_phone_fax":"Fax","str_cont_add_contact_confirm_short":"Contact has been added.","str_cont_add_contact_confirm_update":"Contact has been updated.","str_cont_add_contact_confirm_long":"will receive an email from you asking permission to share contact info.","str_cont_add_to_cont_confirm":"Contact Added","str_hovercard_phone_src":"Sent in an email","str_reauthorize":"Reauthorize","str_hovercard_get_photos":"Get photos","str_hovercard_facebook_profile":"Facebook profile","str_hovercard_linkedin_profile":"Linkedin profile","str_hovercard_twitter_profile":"Twitter profile","str_hovercard_backyard_profile":"Backyard profile","str_hovercard_flickr_profile":"Flickr profile","str_people_card_search_msgs":"Search emails","str_people_card_msgs":"Search Emails","str_hovercard_copy_email":"Copy email address","str_hovercard_copy_all":"Copy all details","str_hovercard_fb_dismiss":"Dismiss","str_people_card_new_compose":"Compose new email","str_people_card_add_contacts":"Add to contacts","str_hovercard_edit_card":"Edit card details","str_hovercard_home_email":"Home Email","str_hovercard_work_email":"Work Email","str_hovercard_mobile":"Mobile","str_hovercard_home_phone":"Home Phone","str_hovercard_work_phone":"Work Phone","str_hovercard_pager":"Pager","str_hovercard_fax":"Fax","str_hovercard_email":"Email","str_hovercard_phone":"Phone","str_hovercard_add_successful":"New contact added successfully.","str_hovercard_edit_successful":"Card details are successfully updated.","str_hovercard_edit_details":"Edit Details","str_hovercard_for_email":"for {{email}}","str_hovercard_edit_error":"Unable to edit contact details. Please try again later.","str_hovercard_remove_image":"Remove image from this contact","str_hovercard_lbl_name":"Name","str_hovercard_lbl_company":"Company","str_hovercard_lbl_position":"Position","str_hovercard_lbl_location":"Location","str_hovercard_show_more":"Show more","str_hovercard_edit_learn_how":"This is a new contact. If you save any changes, we will automatically add it to your address book. <a href=\"{{str_cfg_url_hovercard_help}}\" target=\"_blank\">What's this?<\/a>","str_hovercard_add_email":"Add Email","str_hovercard_remove":"Remove","str_hovercard_add_phone":"Add Phone","str_hovercard_yahoo_messenger":"Yahoo Messenger","str_hovercard_add_contact":"Add Contact","str_hovercard_add_error":"Unable to add contact. Please try again later.","str_hovercard_lbl_firstname":"First Name","str_hovercard_lbl_lastname":"Last Name"});
}, '1.0.0');YUI.add("comms-utils",function(e){e.namespace("comms");var t={},n=e.Lang,r=n.trim,i=/{{([^{}]*)}}/g;e.mix(t,{substitute:function(e,n,r,s,o,u,a){if(typeof e!="string")return;return a&&(e=a.str||e,n=a.obj||n,r=a.formatters||r,s=a.args||s,o=a.strings||o,u=a.templates||u),e.replace(i,function(e,f){var l,c,h=t.substitute;return r&&(l=a&&a.formatters?a.formatters[f]:r[f])?l(n,s,a)||"":n&&f in n?(c=n[f],typeof c=="string"&&c.match(i)?h(c,n,r,s,o,u,a):c):o&&f in o?(c=o[f],c.match(i)?h(c,n,r,s,o,u,a):c):u&&f in u?h(u[f].base||u[f],n,r,s,o,u,a):""})},escapeHtml:function(e){return e===null?null:(e=""+e,e=e.replace(/&(?!(amp|lt|gt|quot|#39|#92);)/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\'/g,"&#39;"),e=e.replace(/\\/g,"&#92;"),e)},unescapeHtml:function(e){return e===null?null:(e=""+e,e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&#39;/g,"'"),e=e.replace(/&#92;/g,"\\"),e)},createAddress:function(e){var n=!1,i=null,s=null,o=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a=e.replace(/\".*\"/g,"");return!r(a)||a.indexOf("@")<0?{fail:!0,email:e,name:t.escapeHtml(e)}:(o.test(e)?(u=e.match(o),s=u[0],i=r(e.replace(s,"")),s=s.substring(1,s.length-1)):s=i=r(e),t.isValidEmail(s)||(n=!0),{fail:n,email:s,name:t.escapeHtml(i)})},isValidEmail:function(e){if(!e)return!1;var t=0,n=e,r=e.lastIndexOf("@"),i=e.substr(0,r),s=i.replace(/\\\\/g,""),o=e.substr(r+1),u=o.length,a=/^(\\.|[A-Za-z0-9!#%&`_=\/$'*+?^{}|~.-])+$/,f=/^"(\\"|[^"])+"$/,l=/^[A-Za-z0-9\-]+$/;!a.test(s)&&!f.test(s)&&(n=!1),o=o.split("."),u=o.length,u<2&&(n=!1);while(t<u)l.test(o[t++])||(n=!1);return n},splitName:function(e){var t={},n,i,s=r(e),o,u,a=[],f=strings.str_name_format.replace(/\{|\}/g,"").split(" "),l=!1,c=!0;f[0]==="family_name"&&(l=!0),f.length<3&&(c=!1);while(s){o=s.match(/([^\u3000\s]*)[\u3000\s]+/);if(!o||o.length!==2||!o[0]){a.push(s);break}a.push(o[1]),s=s.substring(o[0].length)}n=a.length;for(i=0;i<n;i+=1){u=a[i];switch(i){case 0:t[l?"familyName":"givenName"]=u;break;case 1:c&&2<n?t.middleName=u:t[l?"givenName":"familyName"]=u;break;case 2:c?t[l?"givenName":"familyName"]=u:t[l?"givenName":"familyName"]+=" "+u;break;default:t[l?"givenName":"familyName"]+=" "+u}}return t}}),e.comms.Utils=t},"1.0.0",{requires:[]});
YUI.add("mail-model-attachment",function(e){var t=e.common.Utils,n=t.verify,r=t.escapeHtml,i=t.unescapeHtml,s=e.Array.hash(["saved","pending","uploading","failed","infected","deleted","uploaded"]),o={web:"web",file:"file"},u={zip:["thumbnail-fileicon-zip","icon-compressed"],pdf:["thumbnail-fileicon-pdf","icon-pdf"],ppt:["thumbnail-fileicon-ppt","icon-ppt"],doc:["thumbnail-fileicon-doc","icon-doc"],xls:["thumbnail-fileicon-xls","icon-spreadsheet"],mp3:["thumbnail-fileicon-mp3","icon-music"],attachment:["thumbnail-fileicon-attachment","icon-attachment-big"]},a=function(t,f){var l=f,c=t,h="pending",p=f.partId,d=f.contentId,v=f.currentSessionAttachment||!1,m=!0,g=null,y={prefix:"attachment"},b,w,E,S,x,T,N=l.fetchFromWeb||!1,C=l.webUrl||"",k=function(){e.use("tictac-att-filter",function(e){var t=b.getFileExtension();E=e.Tictac.att.filter.map(l.type,t),T=!!a.DOC_PREVIEW_TYPES[E]})};return l&&l.partId&&(h="saved"),b={isToFetchFromWeb:function(){return N},isCurrentSessionAttachment:function(){return v},getWebUrl:function(){return C},getSourceType:function(){return N?o.web:o.file},getMultiPartName:function(){return x},getPayloadReference:function(){return N?"$(id_"+this.getMultiPartName()+")":"multipart://"+this.getMultiPartName()},setMultiPartName:function(e){x=e},getPayLoadPartDefinitionForJediBatch:function(){return N?{partName:this.getMultiPartName(),payloadFromExport:this.getPayloadReference()}:{partName:this.getMultiPartName(),payloadReference:this.getPayloadReference()}},getFilename:function(){return l.filename},getFileExtension:function(){var e=l.filename.lastIndexOf("."),t=e>=0?l.filename.substr(e+1):"";return t.toLowerCase()},getFilenameWithoutExtension:function(){var e=l.filename.lastIndexOf(".");return e>=0?l.filename.substr(0,e):l.filename},getFileType:function(){return E==="undefined"&&k(),E},isImage:function(){var e=this.getFileExtension();return!!a.IMAGE_EXTENSIONS[e]},getAttachmentIconClass:function(){return this.isImage()?[]:(typeof S=="undefined"&&k(),S=u[E]||u.attachment,S.push("icon","thumbnail-attach-icon","thumbnail-file-icon"),S)},isViewableDoc:function(){return typeof T=="undefined"&&k(),T},contentId:function(){return d},deleted:function(){var e=this;e.fire("deleted"),e.destroySlideshow()},disposition:function(){return l.disposition||"attachment"},getDownloadUrl:function(){return l.downloadUrl},getDownloadUrlV3:function(){return l.downloadUrlV3||l.downloadUrl},getThumbnailUrl:function(){return l.thumbnailurl},file:function(){return l.file},isInline:function(){return l.referencedInline===!0||l.disposition==="inline"},inputEl:function(){return l.inputEl},mid:function(){return c},size:function(){return l.size||0},state:function(){return h},partId:function(){return p},setContentId:function(e){d=e},setData:function(t){l=e.clone(t),l.partId&&this.setPartId(l.partId)},setMid:function(e){c=e},setPartId:function(e){p=e},setProgress:function(e){this.loaded=e,this.fire("progress",this.loaded)},setState:function(t){var r=!!s[t];n(r,"Attachment: Illegal model state: "+t),t!==h&&e.fire("MailLog",{m:"v3 attach state change",info:"contentId: "+(d?d:"none")+", filename: "+(l.filename?l.filename:"none")+", next: "+t+", prev: "+h}),h=t,this.fire(h),this.fire("changedState",h)},setSavedInfo:function(e){this._savedInfo=e},getSavedInfo:function(){return this._savedInfo},isViewable:function(){var e=this;if(e.getThumbnailUrl()||e.isViewableDoc())return!0},getHumanReadableSize:function(){var e=l.size||0,t=1024,n=t*t;return e>=n?(e/n).toPrecision(4)+"MB":e>=t?(e/t).toPrecision(3)+"KB":e+"B"},convertThumbnailURL:function(e,t,n){var r="&w="+t+"&h="+(n||t),i=/&w=\d*&h=\d*$/;return e?e.match(i)?e.replace(i,r):e+r:""},destroySlideshow:function(){w&&w.destroy()},openSlideshow:function(n){var s=this;w?w.show(0,!0):e.use("tictac-att-slideshow","ymma-stats").then(function(e){var o=l.filename,u=o.lastIndexOf(".")>0?o.lastIndexOf("."):o.length,a=o.substr(0,u),f=o.substr(u)||"",c=l.thumbnailurl,h={aid:p,mid:t,fullsize:c?s.convertThumbnailURL(c,3e3):"",thumbnailurl:c,has_thumbnail:!!c,filename:l.filename,filenameWithoutExtension:a,filenameExtension:f,filesize:s.getHumanReadableSize(),filetype:s.getFileType(),isDoc:s.isViewableDoc(),isViewable:s.isViewable(),getAttachmentUrl:l.downloadUrl},d={attachments:[h],position:0,showDropboxLinK:!0,stats:e.common.Utils.ymmastats};w=new e.Tictac.att.Slideshow(d),w.on("download:single",function(){e.use("mail-services-plugins",function(e){var t=e.Mail.Services.AttachIO,o=s;t.getDownLoadUrl(o).then(function(e){return n.download([{filename:r(i(o.getFilename())),url:e}])})["catch"](function(){w._showError()})})}),w.on("dropbox:single",function(){e.use("mail-services-plugins",function(e){var t=e.Mail.Services.Plugins.get("attachmentDownloader"),n=e.Mail.Services.AttachIO,o=s;n.getDownLoadUrl(o).then(function(e){return t[0].download([{filename:r(i(o.getFilename())),url:e}])})["catch"](function(){w._showError()})})}),w.show(0,!0)})}},e.augment(b,e.EventTarget,m,g,y)};a.IMAGE_EXTENSIONS=e.Array.hash(["jpg","jpeg","gif","png","bmp","tiff","tif","jif","jfif","jp2","jpx","j2k","j2c","pcd"]),a.DOC_PREVIEW_TYPES=e.Array.hash(["pdf","xls","doc","ppt"]),e.namespace("mail.Models").Attachment=a},"1.0.0",{requires:["common-utils","event-custom"]});
YUI.add("mail-controller-text-processor",function(D){function A(){}var C=D.common.Utils,B={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};D.mix(A.prototype,{convertToPlain:function(H,I,G){var J=H.cloneNode(true),F=D.Node.getDOMNode(J),E=this.convertGuts(F);if(I){E=this._formatPlaintextForDisplay(E,true);}if(G){E=this.clearNonBreakingSpaces(E);}return E;},convertHTMLToPlain:function(G,I){var E=D.Node.create("<div>"+G+"</div>"),H=D.Node.getDOMNode(E),F=this.convertGuts(H);if(I){F=this._formatPlaintextForDisplay(F);}return F;},clearNonBreakingSpaces:function(E){return E.replace(/\xA0/g," ");},convertGuts:function(F){var E=D.UA.ie;if(!E){this._removeIrrelevantTextNodes(F);}else{F.innerHTML=F.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return this._richToPlain(F,false,"").replace(/\n[\s\xA0]+$/,"");},_richToPlain:function(H,L,M){var O=D.one(H),J,P;if(O.hasClass("compose-ignore")){return"";}else{if(H.nodeType===1||H.nodeType===11){var G=H.tagName;if(D.UA.ie&&H.tagName==="DIV"&&H.getAttribute("class")&&H.getAttribute("class")!==null&&H.getAttribute("class").indexOf("hr")!==-1){G="HR";}switch(G){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":P=H.previousSibling;return(this._isLineBreak(P)?"":"\n")+M+"________________________________\n"+M;case"BR":return"\n"+M;case"BLOCKQUOTE":M+=">";default:J=[];var E=H.firstChild;var K=0;while(E!==null){var N=this._richToPlain(E,E.tagName==="PRE",M);if(E.nodeType===1){if(this._getDisplayType(E)==="block"&&J.length>0&&E.tagName!=="TD"){var I=N.match(/^[ \t\r\n\v\f]*$/);if(!I||E.tagName==="LI"){J.push("\n"+M);}}switch(E.tagName){case"LI":K++;J.push("\t"+(E.parentNode.tagName==="OL"?K+".":"*")+" ");break;}}if(N){J.push(N);}if(E.nodeType===1){switch(E.tagName){case"TD":J.push(" ");break;}}E=E.nextSibling;}return J.join("");}}else{if(H.nodeType===3){J=H.nodeValue;if(!L){P=H.previousSibling;var F=P?this._getDisplayType(P):null;J=this._isLineBreak(P)?J:J.replace(/\n[ \t\r\n\v\f]+/g," ");if(P===null||this._isLineBreak(P)){J=J.replace(/^[ \t\r\n\v\f]+/,"");}else{if(F==="block"){J=J.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(F==="inline"){J=J.replace(/^[ \t\r\n\v\f]+/," ");}}}J=J.replace(/[ \t\r\n\v\f]+$/," ");}return J;}else{return"";}}}},_isLineBreak:function(E){if(E===null||E.nodeType!==1){return false;}return E.tagName==="BR";},_getDisplayType:function(E){if(E===null||E.nodeType!==1){return null;}if(E.style.display){if(E.style.display==="block"){return"block";}else{if(E.style.display==="inline"){return"inline";}}}return B[E.tagName.toLowerCase()]?"block":"inline";},_removeIrrelevantTextNodes:function(H){if(H.nodeType===1||H.nodeType===11){var F=H.firstChild;while(F!==null){var J=F.nextSibling;this._removeIrrelevantTextNodes(F);F=J;}}else{if(H.nodeType===3){var G=H.nodeValue;if(G.match(/^[ \t\r\n\v\f]*$/)){var E=H.previousSibling;var I=E?this._getDisplayType(E):"inline";if(I==="inline"&&!this._isLineBreak(E)){H.nodeValue=H.nodeValue.replace(/\n.*/," ");}else{H.parentNode.removeChild(H);}}}}},_formatPlaintextForDisplay:function(F,E){F=C.escapeHtml(F);if(E){F=F.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");F=F.replace(/( ){2}/g,"&nbsp;&nbsp;");}F=F.replace(/\n/ig,"<br />");return F;},_removeControlCharacters:function(F){var G=F,E=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig;G=G.replace(E,"");return G;},process:function(E){var F=this.convertToPlain(E,false,true);F=this._removeControlCharacters(F);return F;}});D.namespace("mail.Controller").TextProcessor=new A();},"1.0.0",{requires:["common-utils","node"]});YUI.add("mail-models-serializers-draft-gdm-unserializer",function(e){var t=function(e,t,n){for(var r in n){var i=n[r];if(t.hasOwnProperty(i.contentId)){var s=t[i.contentId];s.setMid(e.mid),s.setData(n[r]),s.setProgress(1),s.setState("uploaded")}}},n=function(e,t){var n,r=t.length,i;for(n=0;n<r;n++){var s=t[n];e.hasOwnProperty(s.contentId)&&(i=e[s.contentId],i.setSavedInfo(s))}},r=function(e){e.attachments.filter(function(e){e.state()==="uploaded"&&e.setState("saved")})},i=function(e,t){e.mid=t.mid,e.cid=t.cid},s=function(){};e.mix(s.prototype,{update:function(s,o,u){var a=u.result.messageV2,f=u.result.simpleBody.attachments||[];i(s,a),o&&e.Object.size(o)>0?(n(o,f),t(s,o,a.part.slice(1))):r(s)},addAttachments:function(t,n,r){if(n.attachments){var i,s,o=!0;for(s=0;s<n.attachments.length;s++)o=r?r(n.attachments[s]):!0,o&&(i=new e.mail.Models.Attachment(n.mid,n.attachments[s]),t.addAttachment(i))}},addNonInlineAttachments:function(e,t){this.addAttachments(e,t,function(e){return e.referencedInline!==!0&&e.disposition!=="inline"})},hasNonInlineAttachments:function(e){var t,n;if(e.attachments)for(t=0;t<e.attachments.length;t++){n=e.attachments[t];if(n.referencedInline!==!0&&n.disposition!=="inline")return!0}return!1},addIds:function(e,t){i(e,t),e.csid=t.csid,e.csid||(e.draftToDelete=t.mid)}}),e.namespace("Mail.Models.Serializers").DraftGdmUnserializer=s},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add('calendar_strings', function(Y) {
Y.namespace("mail");
Y.mix(strings,{"str_cal_fmt_addEvent_date":"{MM}\/{dd}\/{yyyy}","str_cal_fmt_add_event_time":"{h}:{mm}{tt}","str_cal_dateformat_AM":"AM","str_cal_dateformat_PM":"PM","str_cal_ae_never":"Never","str_cal_ae_daily":"Daily","str_cal_ae_weekly":"Weekly","str_cal_ae_monthly":"Monthly","str_cal_ae_yearly":"Yearly","str_cal_err_title_length":"Length of the title should be less than 1024 characters","str_cal_err_title":"Please specify a title for the event","str_event_saved":"Event Saved","str_cal_err_date":"Enter a valid date in the format","str_cal_err_email_id_title":"Please enter a valid email address in format: name@example.com","str_cal_err_enddate":"Start Date should be before the End Date","str_cal_err_frequency":"The duration of the event must be shorter than how frequently it occurs. Shorten the duration or change the repeat pattern.","str_cal_err_invite":"There is a formatting problem with email address you entered. Be sure to use this format: user@example.com","str_cal_err_name":"Please specify a display name for the calendar","str_cal_err_reminder":"Please select at least one way to receive reminders","str_cal_err_time":"Enter a valid time in the format","str_cal_err_title_calendar":"Please specify a title for the calendar","str_cal_err_title_friends_id":"Please specify your friend's Email address","str_cal_err_title_ical":"Please enter a valid ical address","str_cal_err_title_todo":"Please specify a title for the ToDo","str_cal_err_title_todo_list":"Please specify a title for the ToDo List","str_cal_err_weekly_repeat":"Select at least a day for weekly repeat.","str_cal_mod_addevent":"New Event","str_event_title":"Title","str_event_AllDay":"All-Day","str_event_remindMe":"Remind Me","str_cal__label_repeat":"Repeat:","str_event_location":"Location","str_event_notes":"Notes","str_event_added_to_calendar":"This event has been added to your Calendar."});
}, '1.0.0');YUI.add("mail-ui-common-fonts",function(D){var A=D.mail.persist.MetaData,B="cg.pref.general.plaintextcomposefont",E={"1":"str_mailopt_fontvalue_1","2":"str_mailopt_fontvalue_2","3":"str_mailopt_fontvalue_3","4":"str_mailopt_fontvalue_4","5":"str_mailopt_fontvalue_5","6":"str_mailopt_fontvalue_6","7":"str_mailopt_fontvalue_7","8":"str_mailopt_fontvalue_8","9":"str_mailopt_fontvalue_9"};function C(){return A.get(B);}D.namespace("mail.ui.common").Fonts={getPlainTextOption:function(){var H=C(),G,F;if(H){G=Math.floor(H/100);F=[strings[E[G]],(H%100),"pt"];}return F;}};},"1.0.0",{requires:["mail-persist-meta-data"]});YUI.add("_shared_module_compose_reply",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_compose_reply={base:"{{reply_rich}}{{reply_plain}}{{cchdr}}{{plain_cchdr}}{{fwdhdr}}{{qthdr}}{{qtftr}}{{subject}}{{origHeader}}{{rulerHeader}}{{fwd_rich_short_header}}{{reply_rich_short_header}}{{reply_rich_short}}{{reply_plain_short}}",reply_rich:'<div class="yahoo_quoted"> {{quotetext_header}} <div style="font-family: {{fontfamily}}; font-size: {{fontsize}};"> <div style="font-family: {{deffontfamily}}; font-size: {{deffontsize}};"> <div {{headerDir}}> <font size="2" face="Arial"> {{reply_rich_header}} <b><span style="font-weight:bold;">{{str_comp_reply_from}}</span></b> {{from_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_to}}</span></b> {{to_data}} {{cchdr}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_date}}</span></b> {{date_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_subject}}</span></b> {{subject_data}}<br> </font> </div> <div class="y_msg_container"><br>{{reply_rich_body}}<br><br></div> </div> </div> {{quotetext_footer}} </div>',reply_plain:"<div> <br> <div>{{reply_plain_header}}<br> {{quoteprefix}}{{str_comp_reply_from}} {{from_data}}<br> {{quoteprefix}}{{str_comp_reply_to}} {{to_data}}<br> {{plain_cchdr}} {{quoteprefix}}{{str_comp_reply_date}} {{date_data}}<br> {{quoteprefix}}{{str_comp_reply_subject}} {{subject_data}}<br> {{quoteprefix}}<br>{{reply_plain_body}} </div> </div>",cchdr:'<br><b><span style="font-weight: bold;">{{str_comp_reply_cc}}</span></b> {{cc_data}}',plain_cchdr:"{{quoteprefix}}{{str_comp_reply_cc}} {{cc_data}}<br>",fwdhdr:"<br>{{str_comp_reply_fwdHeader}}<br>",qthdr:'<blockquote style="border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; margin-top: 5px; padding-left: 5px;">',qtftr:"</blockquote>",subject:"{{subject_prefix}} {{subject_data}}",origHeader:"{{str_comp_reply_origHeader}}<br>",rulerHeader:'<hr size="1">',fwd_rich_short_header:'<div {{headerDir}}> <font size="2" face="Arial"> {{str_comp_reply_fwdHeader}}<br> <b><span style="font-weight:bold;">{{str_comp_reply_from}}</span></b> {{from_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_to}}</span></b> {{to_data}} {{cchdr}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_date}}</span></b> {{date_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_subject}}</span></b> {{subject_data}}<br> </font> </div>',reply_rich_short_header:'<div {{headerDir}}><font size="2" face="Arial"> {{str_comp_reply_short}}<br></font></div>',forward_rich_body:'<div class="qtdSeparateBR"><br><br></div> ',reply_rich_short:'{{forward_rich_body}} <div class="yahoo_quoted"> <div style="font-family: {{fontfamily}}; font-size: {{fontsize}};"> <div style="font-family: {{deffontfamily}}; font-size: {{deffontsize}};"> {{msg_rich_header}} {{quotetext_header}} <br><br> <div class="y_msg_container">{{reply_rich_body}}<br><br></div> {{quotetext_footer}} </div> </div> {{quotetext_footer}} </div>',reply_plain_short:"<div> <br> <br> <div> {{quoteprefix}}{{str_comp_reply_short}}<br> {{quoteprefix}}{{reply_plain_body}} </div> </div>"}},"1.0.0");
YUI.add("mail-controller-signature-processor",function(e){function s(){}var t=e.common.persist.UserData,n=e.mail.persist.MetaData,r=e.namespace("mail.Controller"),i=e.common.Utils;e.mix(s.prototype,{insertSignature:function(e,t){var n=this,r,i=n.getSignature(e);i&&(r=n.injectSignature(e.body.html,t,i),r&&e.setBody(null,r))},getSignature:function(r){var i=t.get("userSendPref"),s=n.get("enableTweet")==="on",o=e.mail.model.DataStore.Accounts,u=r.folder.acctId,a,f;return NeoConfig.am||NeoConfig.imapIn?(a=o.get(u),f={text:a.signature,isRich:!0,isActive:a.signatureActive,hasTweet:s&&u===o.getPrimaryAccount().id}):f={text:i.signatureText,isRich:i.richTextSignature==="plainhtml"||i.richTextSignature==="dhtml",isActive:i.signatureActive,hasTweet:s},f&&f.isActive&&(f.text||f.hasTweet)?f:null},_getTweetPlaceholder:function(e,t){return e&&e.isRich&&t&&e.hasTweet&&i.features.enabled("lastTweetSignature")?'<div class="signature-tweet"></div>':""},injectSignature:function(t,n,i){var s=this,o,u=i&&i.isRich,a=i&&i.text;if(!a)return s._getTweetPlaceholder(i,n);a=s._getSignatureText(a,u),a="<div class='signature'>"+a+"</div>"+s._getTweetPlaceholder(i,n);if(!u)a=s._cleanAndEscapeSignature(a);else if(!n||n==="plain")try{a=r.TextProcessor.convertHTMLToPlain(a,!0)}catch(f){}return t=t||"",o=t!=="",a!==""&&(e.UA.ie||e.UA.webkit?o?t=t+"<div></div><div>&nbsp;</div>"+a:t="<div></div><div>&nbsp;</div>"+a+t:o?t=t+"<div>&nbsp;</div>"+a:t="<div>&nbsp;</div>"+a+t),t},_getSignatureText:function(e,t){if(e!==null){if(!t)return e=e.replace(/<vbr>|\n/gi,"<br />"),"<div>"+e+"</div>";e=e.replace(/<vbr>/gi,"<br>")}return e||""},_cleanAndEscapeSignature:function(e){var t,n;return e=i.unescapeHtml(e),e=e.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>"),e=e.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag"),e=e.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag"),e=e.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag"),e=e.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag"),e=e.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag"),e=e.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag"),e=e.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag"),e=e.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag"),e=e.replace(/<\/p>/gi,"endptag"),t=e.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag"),t=t.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag"),t=t.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag"),e=t.replace(/<\/div>/gi,"endptag"),n=i.escapeHtml(e),n=n.replace(/brtag/g,"<br />"),n=n.replace(/ltrstartptag/g,"<div dir='ltr'>"),n=n.replace(/rtlstartptag/g,"<div dir='rtl'>"),n=n.replace(/startptag/g,"<div>"),n=n.replace(/endptag/g,"</div>"),n=n.replace(/pblanklinep/g,"<br/><br/>"),n}}),r.SignatureProcessor=new s},"1.0.0",{requires:["mail-controller-text-processor","common-persist-user-data","common-utils","mail-model-datastore","mail-persist-meta-data","mail-common-utils-features"]});
YUI.add("mail-ui-mailcompose-header-form-list-helper",function(e){function f(){return a=new u,a}function l(){return a||(a=f(),a.init()),a}function c(n){var r=l(),i="sendingName",s=t.get("userSendPref"),u="email",a=e.mail.Controller.ImapIn,f,c;return f=r.getFromList(n),NeoConfig.imapIn&&n===o.PrimaryAcctId&&r.changeSelection(s.defaultID,n),c=r.getSelectedIndex(n),n!==o.PrimaryAcctId&&NeoConfig.imapIn?{name:a.getAccountAttribute(n,i),email:a.getAccountAttribute(n,u)}:{name:f[c].name,email:f[c].addr}}function h(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function p(n){var r,i={email:t.get("userSendPref.defaultFromAddress"),name:t.get("userSendPref.defaultFromName")},s;return n.fid==="Sent"?h(n.oMsg):(r=d(n.oMsg.header.to,i),r||(r=d(n.oMsg.header.cc,i)),r||(r=d(n.oMsg.header.bcc,i)),r||(NeoConfig.imapIn?(s=e.mail.ui.FolderUtils.getAcctIdByFid(n.fid),r=c(s)):r=c()),r)}function d(n,r){var i,s=null,o={},u=(t.get("externalAccounts")||{}).extAccount||[],a=(t.get("aliases")||{}).alias||[],f=(t.get("disposableAddresses")||{}).deaName||[],l=function(e){if(e&&e.address&&e.address===o.email)return s={email:e.address,name:e.fromName},!0};for(i=0;!s&&i<n.length;i++){o=n[i];if(o.email===r.email)return r;e.Array.some([].concat(u,a,f),l)}return s}function v(){var e={},n=(t.get("externalAccounts")||{}).extAccount||[],r=(t.get("aliases")||{}).alias||[],i=(t.get("disposableAddresses")||{}).deaName||[],s=NeoConfig.accounts&&NeoConfig.accounts.imapInAccount?NeoConfig.accounts.imapInAccount:[],o=n.concat(r,i),u=t.get("userSendPref"),a=s.length,f=o.length,l,c,h;u.defaultID&&(e[u.defaultID]=1),u.defaultFromAddress&&(e[u.defaultFromAddress]=1);for(h=0;h<a;h++)l=s[h],l.isPrimary||(e[l.email]=1);for(h=0;h<f;h++)if(c=o[h].address)e[c]=1;return e}function m(){var e=(t.get("externalAccounts")||{}).extAccount||[],n=(t.get("aliases")||{}).alias||[],r=(t.get("disposableAddresses")||{}).deaName||[];return[].concat(e,n,r)}function g(r){var i=r,s=t.get("userSendPref.defaultFromAddress"),o,u,a;if(NeoConfig.imapIn||NeoConfig.am){a=n.Accounts.getAll(),u=a.length;for(o=0;o<u;o++)if(a[o].email===r)return a[o].replyToAddress||r}return s===r?i=t.get("userSendPref.defaultReplyToAddress")||s:e.Array.some(m(),function(e){var t=e&&e.address&&e.address;return t===r?(i=e.replyTo||e.address,!0):!1}),i=e.Lang.trim(i),e.comms.Utils.isValidEmail(i)?i:r}var t=e.common.persist.UserData,n=e.mail.model.DataStore,r=n.Accounts,i=e.comms.Utils,s="default",o=e.mail.ui.FolderUtils,u=function(){},a;e.mix(u.prototype,{_allowedTypes:{IMAPIN:"IMAPIN",POPIN:"POPIN",SENDAS:"SENDAS",DEA:"DEA",ALIAS:"ALIAS",BIZMAIL:"BIZMAIL"},_buildAddresListItem:function(e,t){return{addr:e.address||e.email,name:e.fromName||e.sendingName||"",source:t,isRTL:e.fromNameDir==="rtl",isDefault:!!e.isDefault}},_verifyInit:function(){if(!this._init)throw new Error("FromOptionList is not initialized")},_populateV3AddressList:function(){var e=[],t,n,i;for(t in this._allowedTypes)n=this._allowedTypes[t],i=r.getAccountsByType(n),e.push({list:i,length:i?i.length:0,type:n,allowedAsFrom:function(e){return!!e&&e.status==="ENABLED"&&!!e.accountVerified}});this._refactorAddressList(e)},_refactorAddressList:function(e){var n=[],o=t.get("userSendPref"),u={},a,f,l,c,h,p,d;for(p=0;p<e.length;p++){c=e[p];for(h=0;h<c.length;h++)d=c.list[h],c.allowedAsFrom(d)&&(l=this._buildAddresListItem(d,c.type),u[d.address||d.email]=!0,i.isValidEmail(l.addr)&&n.push(l))}o&&(NeoConfig.am||NeoConfig.imapIn?(f=r.getPrimaryAccount(),l=this._buildAddresListItem({address:f.email,fromName:f.sendingName,isDefault:!0},s)):l=this._buildAddresListItem({address:o.defaultFromAddress,fromName:o.defaultFromName,isDefault:!0},s),a=l.addr,i.isValidEmail(a)&&!u[a]&&n.push(l)),this._fromAddrList=n},_populateAddressList:function(e){NeoConfig.am||NeoConfig.imapIn?this._populateV3AddressList():e&&this._populateV2AddressList()},_populateV2AddressList:function(){var e=(t.get("externalAccounts")||{}).extAccount||[],n=(t.get("disposableAddresses")||{}).deaName||[],r=(t.get("aliases")||{}).alias||[],i;i=[{list:e,length:e.length,type:this._allowedTypes.POPIN,allowedAsFrom:function(e){return!!e&&!!(e.mailFromAllowed||e.status==="ENABLED"&&e.accountVerified)}},{list:n,length:n.length,type:this._allowedTypes.DEA,allowedAsFrom:function(e){return!(!e||!!strings.tog_check_active_compos&&!e.activeComposition)}},{list:r,length:r.length,type:this._allowedTypes.ALIAS,allowedAsFrom:function(e){return!!e}}],this._refactorAddressList(i)},_sortAddressList:function(){this._fromAddrList=this._fromAddrList.sort(function(e,t){var n=e.name+e.addr,r=t.name+t.addr;return n<r?-1:n>r?1:0})},changeSelection:function(e,t){var n=0,r=this.getFromList(t);for(n=0;n<r.length;n++)if(r[n].addr.toLowerCase()===e.toLowerCase())return this._selectedItemIndex=n,!0;return!1},getSelectedIndex:function(n){var r,i;return this._verifyInit(),typeof this._selectedItemIndex=="undefined"&&(r=t.get("userSendPref"),r.defaultID?(i=this.changeSelection(r.defaultID,n),i||(i=this.changeSelection(r.defaultFromAddress,n),e.fire("util:ymstats",{name:i?"v3AccountListIncomplete":"v3AccountListWrong"}))):this.changeSelection(r.defaultFromAddress,n)),this._selectedItemIndex},getFromList:function(t){var n,r,i;return this._verifyInit(),this._populateAddressList(),NeoConfig.imapIn?(n=t?t:e.mail.Controller.ImapIn.getCurrentAccountId(),n==="1"?i=e.clone(this._fromAddrList.filter(function(e){return e.source!==a._allowedTypes.IMAPIN})):(r=e.mail.Controller.ImapIn.getAccountAttribute(n,"email"),i=e.clone(this._fromAddrList.filter(function(e){return e.addr===r}))),e.common.Utils.features.enabled("sortFromList")?i.sort(function(e,t){return e.addr>t.addr?1:-1}):i):e.clone(this._fromAddrList)},getVisible:function(){return this._verifyInit(),this._visible},init:function(){var e=t.get("userSendPref");if(this._init)return;this._populateAddressList(!0),this._sortAddressList(),this._fromAddrList.length>(e?1:0)?this._visible=!0:this._visible=!1,this._init=!0}}),e.namespace
("mail.Controller").mailComposeFromListHelper={getInstance:l,getReplyFromAddress:p,getDefaultFromAddress:c,getAllAccountEmails:v,getReplyTo:g}},"1.0.0",{requires:["comms-utils","common-persist-user-data","mail-common-utils-features","mail-persist-meta-data","mail-ui-folder-utils","mail-model-datastore"]});
YUI.add("mail-controller-reply-processor",function(e){function x(){return strings.str_cfg_tog_compose_autoattach_prefix||T(m)==="yes"}function T(e){return d.get("cg.pref."+e)}function N(e,t){var n=i.getVal(e,"origin.action"),r=i.getVal(e,"origin.parentMsg"),s=i.getVal(e,"origin.parentMsg.fid"),o,u,a;return n!=="edit"&&!t.fetchGDM?Promise.resolve(e.origin.oMsg):t.fetchGDM?(o={fid:s||"Inbox",msg:r||e,cachekey:"Prime"},a=this.requestMessage(r,o),a.then(function(t){return t},function(t){return t}),a):(u=i.getVal(e,"origin.parentMsg.part"),u&&u.length>0?Promise.resolve(e.origin.parentMsg):Promise.resolve())}function C(n,r){var i,s=t&&t.Controller?t.Controller.Messages:{},o=n?n.mid||0:0;if(o&&r.fid)return i=new Promise(function(t,n){var i=function(n){t(n)},o=function(t){n(t)},u={success:i,failure:o,suppressCodes:"[*]"};r.fid&&r.msg?NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[r.msg],sourceFid:r.fid,success:function(e){u.success(e[0])},failure:u.failure}):s.get(r,u):e.fire("MailLog",{m:"GDM failed in attach in reply",fid:r.fid,msg:r.msg},1,"attachInReplyFailure")}),i}function k(e){var t=0,n=e.attachments;for(t=0;t<n.length;t++)n[t].setState("deleted")}function L(t,n){var r=this,s,o,u=i.getVal(t,"origin.parentMsg.flags.hasAttachment");return u&&(s=new e.Mail.Models.Serializers.DraftGdmUnserializer,o=r.getParentMsg(t,n),o.then(function(n){s.addNonInlineAttachments(t,n)},function(){})),o}function A(e,t){var n=e.to.concat(e.cc),r,s,o=t.to.concat(t.cc),u={};for(r=0;r<o.length;r++){var a=i.getVal(o[r],"email");u[a]||(u[a]=1)}for(s=0;s<n.length;s++){var f=i.getVal(n[s],"email");if(!u[f])return{hasNewRecipients:!0}}return{hasNewRecipients:!1}}function O(e){var t=v+e.replace(/\r?\n|(.{0,80})\r?\n|(.{1,80})$|(.{1,80} +)/mg,"$1$2$3<br />"+v);return t=t.replace(/(^(?:\>|\&gt\;)+|\<br \/\>(?:\>|\&gt\;)*)/mgi,"$1 "),t.substring(0,t.length-v.length)}function M(t,n){var r,i=document.createElement("div");return i.innerHTML=t,r=e.mail.Controller.Compose.convertGuts(i),n||(r=s(r)),i.innerHTML="",i=null,r}function _(e){var t=e.oMsg.part;if(t)for(var n=0;n<t.length;n++)if(t[n].subtype==="html")return!0;return!1}function D(e){return e&&(e=e.replace(y,"$1"),e=e.replace(b,"$1"),e=e.replace(w,"")),e}function P(e){var t,n;return e?{fontFamily:t=B(!0),fontSize:n=j(!0)}:H()}function H(){var e,t;return t=p.get("userUIPref.composeFontFamily"),t=t.split("|"),t.length>1?t=t[0]:(t=B(!1),p.set("userUIPref.composeFontFamily",t+"|1")),t||(t=B(!1),p.set("userUIPref.composeFontFamily",t+"|1")),e=p.get("userUIPref.composeFontSize"),e?e+="px":e=j(!1),{fontFamily:t,fontSize:e}}function B(e){return e?F()[0]:strings.str_rte_default_font}function j(e){if(e){var t=F();return""+parseInt(t[1],10)+t[2]}return parseInt(strings.str_rte_default_font_size,10)+"px"}function F(){return e.mail.ui.common.Fonts.getPlainTextOption()||[strings.str_comp_plaintext_default_font,strings.str_comp_plaintext_default_font_size,"px"]}function I(e,t){var n=0,r=t.length,i=new Array(r);while(r--)i[n]=e(t[n++]);return i}function q(e){return e.name?e.name:e.email}function R(e){var t="";return e.name&&(t=U(e.name)?'"'+e.name+'"':e.name),e.email&&(t+=t.length?" <"+e.email+">":e.email),t}function U(e){return e.match(/[;,"<>@]/)!==null}function z(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function W(e,t,n){return e=X(e,n),I(t?R:q,e).join("; ")}function X(e,t){return V(e,t)}function V(e,t){var n,r,i,s=[],o;for(n=0;n<e.length;n++){o=!1;if(!e[n].email)continue;i=e[n].email.toLowerCase();if(t)for(r=0;r<t.length;r++)if(i===t[r].email.toLowerCase()){o=!0;break}o||(s.push({name:e[n].name,email:e[n].email}),t&&t.push(e[n]))}return s}function $(){return new RegExp("(^re:\\s?)|(^fw:\\s?)|(^"+strings.str_comp_reply_spRE+"\\s?)|"+"(^"+strings.str_comp_reply_spFWD+"\\s?)","i")}function J(){}var t=e.mail,n=e.mail.Controller.Messages,r=e.common,i=r.Utils,s=i.escapeHtml,o=i.unescapeHtml,u=i.substitute,a=t.Controller.mailComposeFromListHelper,f=a.getReplyFromAddress,l=a.getDefaultFromAddress,c=e.ui.Templates,h=c._shared_module_compose_reply,p=r.persist.UserData,d=t.persist.MetaData,v=">",m="general.prefixreplyquotetype",g=null,y=new RegExp(/<a[^>]*href="([^\s]*?)"[^>]*>[\s]*<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>http(([\s]|[^\s])*?)<\/span>[\s]*<\/a>/ig),b=new RegExp(/<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>(([\s]|[^\s])*?)<\/span>/ig),w=new RegExp(/<script[^>]*[^>]*>(([\s]|[^\s])*?)<\/script>/ig),E={subject_prefix:function(e){return strings[e.action==="forward"?"str_comp_reply_spFWD":"str_comp_reply_spRE"]},subject_data:function(e){return g||(g=$()),e.oMsg.header.subject.replace(g,"")}},S={quotetext_header:function(){return x()?h.qthdr:""},quotetext_footer:function(){return x()?h.qtftr:""},fontfamily:function(){return H().fontFamily},fontsize:function(){return H().fontSize},deffontfamily:function(){return B(!1)},deffontsize:function(){return j(!1)},from_data:function(e){return s(o(R(z(e.oMsg,!0))))},to_data:function(e){return s(o(W(e.oMsg.header.to,!0)))},cchdr:function(e){return e.oMsg.header.cc.length>0?u(h.cchdr,e,S,null,strings):""},plain_cchdr:function(e){return e.oMsg.header.cc.length>0?u(h.plain_cchdr,e,S,null,strings):""},cc_data:function(e){return s(o(W(e.oMsg.header.cc,!0)))},date_data:function(e){return s(i.dateFormatter(new Date(e.oMsg.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n))},subject_data:function(e){return s(o(e.oMsg.header.subject))},reply_rich_body:function(e){return D(e.oMsg.body.display)},forward_rich_body:function(e){return e.action==="forward"?h.forward_rich_body:!1},reply_rich_header:function(e){var t=NeoConfig.hasConv?"":h.rulerHeader,n=e.action==="forward"?h.fwdhdr:t;return u(n,null,null,null,strings)},msg_rich_header:function(e){var t;return e.action==="forward"&&i.features.enabled("convFWDHeader")?t=h.fwd_rich_short_header:t=h.reply_rich_short_header,u(t,e,S,null,strings)},reply_plain_body:function(e){var t=D(e.oMsg.body.display
);if(x()||_(e)){try{t=M(t)}catch(n){}t=O(t)}return t},reply_plain_header:function(e){return strings[e.action==="forward"?"str_comp_reply_fwdHeader":"str_comp_reply_origHeader"]},quoteprefix:function(){return x()?v+" ":""},headerDir:function(){return NeoConfig.isRTL?' dir="rtl" ':' dir="ltr" '}};e.mix(J.prototype,{fetchOrigin:function(t,r,i,s,o){var u=this,a=t.origin;if(a.action&&a.fid&&a.oMsg){a.ctxReq&&e.mail.Controller.Messages&&n.abort(a.ctxReq);var f,l={truncateAt:null},c={success:function(e,t){u._fetchSuccess(e,t),o&&o()},failure:function(e,t){u._fetchFailure(e,t)},draft:t,isDraft:r,isRichText:i,stopwatch:s};f={fid:a.fid,msg:a.oMsg,cachekey:"Prime",ovparams:l},s&&!s.CMGStart&&(s.CMGStart=new Date),NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[f.msg],sourceFid:f.fid,filter:l,blockImages:"none",success:function(e){c.success(e[0],c)},failure:c.failure}):e.use("mail-controller-messages",function(){e.mail.Controller.Messages.get(f,c)})}},_fetchSuccess:function(e,t){var n=this,r=t.draft,i=r.origin,s=t.stopwatch,o={};e.mid?(s&&(s.CMGEnd||(s.CMGEnd=new Date,t.respProps&&(s.wasCached=t.respProps.wasCached)),s.CMGSize=e.body.display.length),i.oMsg=n.validateMsg(e),i.ctxReq=null,i.errInfo="ok",i.yqtdPrefix=e.yivPrefixNumber,r.setOrigin(i),n._updateFromOrigin(i,r,t.isDraft,t.isRichText,o)):n._fetchFailure({msg:this.message},t)},validateMsg:function(t){var n,r;if(t&&t.header&&t.header.replyto&&t.header.replyto.length>0){r=t.header.replyto;for(n=r.length-1;n>=0;n--)!e.comms.Utils.isValidEmail(r[n].email)&&r.splice(n,1)}return t},_fetchFailure:function(e,t){var n=t.draft,r=n.origin;r.errInfo=e,n.setOrigin(r)},_updateFromOrigin:function(t,n,r,i,s){var o=this,u,a;o._markAsRead(n),u=o._transformOrigin(t,n,r,i);if(!r){var f=e.mail.Controller.SignatureProcessor.getSignature(n),l,c=!0;s&&s.noSig&&(c=!1),f&&c&&(l=e.mail.Controller.SignatureProcessor.injectSignature(null,u.isRichText,f),u.prolog=strings.str_cfg_tog_insert_signature_bottom?u.prolog+l:l+u.prolog)}n.setOrigin(t),a=new e.Mail.Models.Serializers.DraftGdmUnserializer,r&&a.addIds(n,t.oMsg),t.action==="forward"||t.action==="edit"?a.addAttachments(n,t.oMsg):a.addAttachments(n,t.oMsg,function(e){return e.referencedInline===!0||e.disposition==="inline"}),n.cc&&n.cc.length>0&&(u.header.cc||(u.header.cc=[]),u.header.cc=u.header.cc.concat(n.cc)),n.bcc&&n.bcc.length>0&&(u.header.bcc||(u.header.bcc=[]),u.header.bcc=u.header.bcc.concat(n.bcc)),o.updateDraft(n,u)},updateDraft:function(e,t){e.setHeader(t.header),e.setBody(null,t.prolog),e.notifyHeaderChanged({reply:!0}),e.notifyBodyChanged({reply:!0,isRichText:t.isRichText})},_markAsRead:function(t){var n=t.origin,r={},i=new Array(n.oMsg);r.read=1;if(NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded){e.mail.controller.v3.api.flagMessagesWithMid({messages:i,sourceFid:n.fid,flags:r,statTAE:!1});return}e.use("mail-controller-messages-ops",function(){e.mail.Controller.Messages.flag({fid:n.fid,mid:i,setFlags:r},{failure:function(){},suppressCodes:["Client.MessageIdsNotFound"]})})},_transformOrigin:function(e,t,n,r){var i=this,s,o=e,u={prolog:null,header:null,attachments:null,isRichText:r};return n?(u.header=o.oMsg.header,u.prolog=D(o.oMsg.body.display),u):(u.header=i.getHeaderContent(o),s=i.getBody(t,o,r),u.prolog=s.markup,u.isRichText=s.isRichText,u)},getBody:function(e,t,n){var r=_(t),s,o;return!n&&r&&i.features.enabled("replyInPlainText")&&(t.action==="reply_sender"||t.action==="reply_all")&&(r=!1),n||r?s=NeoConfig.hasConv?h.reply_rich_short:h.reply_rich:t.action==="forward"&&i.features.enabled("convFWDHeader")?s=h.reply_plain:s=NeoConfig.hasConv?h.reply_plain_short:h.reply_plain,o=u(s,t,S,e,strings),!n&&r&&(n=!0),{markup:o,isRichText:n}},getHeaderContent:function(t){var n=this,r,i=t.action==="reply_sender"||t.action==="reply_all",s={from:null,to:null,cc:null,subject:null},u=[],a=[],c=t.fid==="Sent"||t.fid==="%40S%40Search"&&t.oMsg.sourceFolderInfo.fid==="Sent";return s.from=i?f(t):l(),i&&(r=z(t.oMsg),t.action==="reply_sender"?(a.push(r),s.to=a):(c||a.push(r),u.push(r),u.push(s.from),s.to=a.concat(X(t.oMsg.header.to,u)),s.cc=X(t.oMsg.header.cc,u),c&&s.to.length===0&&s.cc.length===0&&(s.to=t.oMsg.header.to,s.to.length===0&&(s.cc=t.oMsg.header.cc)))),s.subject=o(n.seedSubject(t)),c||e.Array.each(t.oMsg.header.replyto||[],function(t){var n=s.to;n&&e.Array.indexOf(n,t)<0&&e.Array.indexOf(a,t)<0&&s.to.push(t)}),s},seedSubject:function(e){var t=e.action==="reply_sender"||e.action==="reply_all"||e.action==="forward";return t?(e.oMsg.header.subject===strings["str_msg-view_no_subject"]&&(e.oMsg.header.subject=""),u(h.subject.replace(/\s+$/,""),e,E,null,strings)):e.oMsg.header.subject}}),e.mix(J.prototype,{getDefaultFromAddress:l,htmlToText:M,getStyleFontFamily:B,getStyleFontSize:j,getDefaultFontInfo:P,matchRecipients:A,getParentMsg:N,requestMessage:C,includeAttachment:L,excludeAttachment:k}),e.namespace("mail.Controller").ReplyProcessor=new J},"1.0.0",{requires:["mail-models-draft","comms-utils","mail-model-attachment","mail-controller-messages","mail-controller-text-processor","common-persist-user-data","mail-persist-meta-data","mail-models-serializers-draft-gdm-unserializer","mail-ui-common-fonts","_shared_module_compose_reply","mail-controller-signature-processor","mail-common-utils-features","mail-ui-mailcompose-header-form-list-helper"]});
YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("_shared_module_compose_quick_reply_card_actions",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_quick_reply_card_actions={base:'<div class="qr-card-actions {{tallCompose}}"> <span class="right"><a tabindex="0" data-action="qr-cancel" role="button" class="icon icon-close" title="{{str_btn_discard}}"></a></span></div>',tallCompose:"tallCompose"};},"1.0.0");YUI.add("_shared_module_compose_message_header_fresh",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_compose_message_header_fresh={base:'<div class="compose-header fresh"> {{show_full_header}} {{more_recipients_str}} </div> ',quick_reply_card_actions:"{{_shared_module_compose_quick_reply_card_actions}} ",compose_from_address:'<option value="{{fromAddress}}"{{fromSelected}}>{{fromAddress}}</option> ',quickCompose:'<span class="menu" data-action="menu"> <a href="#" aria-haspopup="true" role="button" class="icon arrow-down" title="{{str_comp_btn_menu_reply_options}}"><b></b></a></span>',make_reply_all:'<span class="small makereplyall-btn replyall-toggle-btn hidden" data-action="make-replyall"> <a id="btn-switch-reply-mode" tabindex="-1" role="button">{{title}}</a> </span>',conversation_user:'<li role="presentation" class="recipient"> <span class="small lozenge {{lozengeerror}}"><a>{{conversation_user}}</a></span> </li> ',subject_hidden:"hidden",conversation_user1:"Our conversation on {{timestamp}}",less_than_IE10:'<span class="IEplaceholder cm-subject-field"> {{str_comp_add_subject}} </span> ',show_full_header:'{{quick_reply_card_actions}} <div class="field account-select hidden"> <label for="from-field" class="compose-label">{{str_msg_hdr_label_from_fresh}}</label> <div class="custom-select from-selector"> <select id="from-field" class="cm-from-field from-select"> {{compose_from_address}} </select> </div> </div> {{quickCompose}} <div id="to-group" role="group" class="field contact-search cm-to-group"> <a class="compose-label label-to-field choose-contact" tabindex="-1" id="to_add_contacts" title="{{str_comp_btn_to_add_attr}}">{{str_comp_label_to_fresh}}</a> <div class="address-btns"> <span id="btn-show-cc-in-to" class="cm-btn-show-cc cc-btn small" tabindex="-1"><a role="button" href="cc-group&amp;btn-show-cc=0" id="cc_show_btn_in_to" tabindex="-1" data-action="toggle-visibility">{{str_comp_btn_show_cc_bcc}}</a></span> {{make_reply_all}} </div> <div id="to" class="cm-to ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> {{conversation_user}} <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" aria-label="{{str_to_cap}}" spellcheck="false" id="to-field" name="to-field" class="cm-to-field" value=""> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div id="cc-group" class="cm-cc-group field contact-search hidden"> <a class="compose-label label-cc-field choose-contact" id="cc_add_contacts" title="{{str_comp_btn_to_add_attr}}" tabindex="-1">{{str_comp_label_cc_fresh}}</a> <div class="address-btns"> <span class="cc-btn small"><a role="button" href="cc-group&amp;btn-show-cc=1" id="cc_hide_btn" tabindex="-1" data-action="toggle-visibility">{{str_comp_btn_hide_cc_bcc}}</a></span> <span id="btn-show-bcc-in-cc" tabindex="-1" class="cm-btn-show-bcc bcc-btn small btn-bcc-in-cc"><a role="button" href="bcc-group&amp;btn-show-bcc=0" id="bcc_show_btn_in_cc" tabindex="-1" data-action="toggle-visibility">{{str_comp_btn_show_bcc_fresh}}</a></span> </div> <div id="cc" class="cm-cc ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" spellcheck="false" id="cc-field" name="cc-field" class="cm-cc-field" aria-label="{{str_cc}}"> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div id="bcc-group" class="cm-bcc-group field contact-search hidden"> <a class="compose-label label-bcc-field choose-contact" tabindex="-1" id="bcc_add_contacts" title="{{str_comp_btn_to_add_attr}}">{{str_comp_label_bcc_fresh}}</a> <div id="bcc" class="cm-bcc ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" spellcheck="false" id="bcc-field" name="bcc-field" class="cm-bcc-field" aria-label="{{str_bcc}}"> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div class="field subject {{subject_hidden}}"> <div id="subject" class="cm-subject"> <label> <span> <input id="subject-field" name="subject-field{{timestamp_id}}" class="cm-subject-field" data-action="compose-subject" value="{{conversation_user1}}" placeholder="{{str_comp_add_subject}}"/> </span> {{less_than_IE10}} </label> </div> </div> ',more_recipients_str:'<li class="hLozenge"> <span class="more_recp lozenge-static cl hcard more" data-address="{{data_address}}" data-action="compose-recpt-more" role="button" tabindex="0" aria-label="{{str_thread_hdr_more_recipients_attr}}"> {{str_hdr_more_recipients}}</span> </li> '}},"1.0.0",{requires:["_shared_module_compose_quick_reply_card_actions"]});
YUI.add("comms-ui-lozenge",function(e){function a(t){var n=function(t){t.addClass("focus"),e.fire("lozenge:highlight")},r=e.UA.os==="macintosh"?t.metaKey:t.ctrlKey,i=-2,s=-1,o=-1,u,a=-1,f,l,c=!0,h,p;if(r||t.shiftKey){h=this.rootNode.ancestor(".ac-input"),h&&this.rootNode.ancestor(".compose-header").all(".ac-input").each(function(e){e!==h&&e.all(".hLozenge").removeClass("focus")});if(r)this.rootNode.hasClass("focus")?this.rootNode.removeClass("focus"):n(this.rootNode);else if(h){var d=h.all(".hLozenge");d.each(function(e){e.hasClass("focus")&&(u=d.indexOf(e),a===u-1&&c?c=!0:a>=0?c=!1:c=!0,s<u&&(s=u),i<0&&(i=u),a=u)}),o=d.indexOf(this.rootNode),i===s||o<i||o>s?o<i?c?(f=o,l=s):(f=o,l=i):o>s&&(c?(f=i,l=o):(f=s,l=o)):(f=i,l=o),d.removeClass("focus");if(f<0||l<0)n(this.rootNode);else for(u=f;u<=l;u++)n(d.item(u))}}else p=this.rootNode.ancestor(".compose-header"),p&&(p=p.all(".hLozenge.focus"),p.size()===1&&this.rootNode.hasClass("focus")?(t.halt(),this.rootNode.removeClass("focus"),this.startEdit()):(p.removeClass("focus"),n(this.rootNode)))}function f(){var e=this,t=e.getFullDisplayData();e.staticL.setContent(r(t)),e.editL.removeClass("mask"),e.staticL.addClass("mask"),e.editL.focus(),e.editL.setAttribute("value",t)}function l(t){var n=this,i,s,o,u,a=t.keyCode;a===13?(i=n.rootNode.ancestor("div"),i&&(s=i.get("scrollTop"),o=i.all("li"),u=o.item(o.size()-1).one("input"),u.focus(),e.later(50,n,function(){i.set("scrollTop",s),u.addClass("whiteout")}))):e.later(0,n,function(){n.staticL.setContent(r(n.editL.get("value"))),n.staticL.setAttribute("title",n.getFullDisplayData())})}function c(){var e=this,t=s(e.editL.get("value"));if(!t){e.remove();return}e.data=e.createUserDataFromString(t),e.validate(),e.setState(),e.setLabel(),e.staticL.setAttribute("title",e.getFullDisplayData()),e.staticL.setAttribute("data-address",e.data.email),e.staticL.removeClass("mask"),e.editL.addClass("mask")}function h(){return this.rootNode}function p(){var e=this;if(e.valFn){if(!e.valFn.call(e,e.data))return e.data.fail=!0,e.error=!0,!1}else if(!i.isValidEmail(e.data.email))return e.data.fail=!0,e.error=!0,!1;return e.data.fail=!1,e.error=!1,!0}function d(){var e=this.data,t;t=e.name||e.email,this.staticL.setContent(r(t))}function v(){this.error?this.staticL.addClass("lozenge-error"):this.staticL.removeClass("lozenge-error")}function m(e){var t=!1,n=null,r=null,o=/(<[^<>]+[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a;return e=s(e),a=e.replace(/\".*\"/g,""),!s(a)||a.indexOf("@")<0?(t=!0,r=n=e):(o.test(e)?(u=e.match(o),r=u[0],n=s(e.replace(r,"")),r=r.substring(1,r.length-1)):r=n=e,i.isValidEmail(r)?(this.error=!1,t=!1):(this.error=!0,t=!0)),{fail:t,email:r,name:n}}function g(){var e=this.data,t=e.name||"",n=e.email;return this.error?n:(t=t===n?"":t+" ",t+"<"+n+">")}function y(){var t=this;e.later(0,t,function(){t.rootNode.remove().destroy(!0),e.fire("lozenge:remove")})}var t=e.common.Utils,n=t.substitute,r=t.escapeHtml,i=e.comms.Utils,s=e.Lang.trim,o={base:'<li class="hLozenge {{parentClass}}" data-action="{{action}}"><span role="button" class="lozenge-static hcard cl {{errorClass}} {{dataClass}}" title="{{hover}}" data-address="{{hover}}" >{{label}}</span>{{editable}}</li>',edit:'<input class="lozenge-edit mask" type="text" value="{{fullDisplayData}}">'},u;e.on("click",function(t){if(!t.altKey&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){var n=e.all(".hLozenge");n.each(function(e){e!==t.target&&e!==t.target.get("parentNode")&&e.hasClass("focus")&&e.removeClass("focus")})}}),u=function(t){var i=this,s,u,a,f;i.label=t.label||"",i.hover=t.hover||"",i.valFn=t.valFn||null,i.error=t.error||!1,i.menu=t.menu||null,i.edit=t.edit||!1,i.copy=t.copy||!1,i.bidi=t.bidi||!1,i.action=t.action||"",i.dataClass=t.dataClass||"",i.parentClass=t.parentClass||"",NeoConfig&&(i.bidi=!!NeoConfig.bidi),i.data=t.data||{name:"",email:"",cid:null},i.validate(),s=e.Node.create(n(o.base,null,null,null,{label:r(this.label),editable:i.edit?o.edit:"",errorClass:i.error?"lozenge-error":"",dataClass:i.dataClass,parentClass:i.parentClass,action:i.action})),u=i.staticL=s.one(".lozenge-static"),u.setAttribute("title",i.hover),t.state!=="error"&&u.setAttribute("data-address",i.hover),s.setData("lozenge",i),s.setData("user",i.data),i.bidi&&(f=e.Intl.detectDirection(i.label.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,">").replace(/&amp;/g,"&")),s.setAttribute("dir",f),s.addClass(f)),i.edit&&(a=i.editL=s.one(".lozenge-edit"),a.setAttribute("value",i.getFullDisplayData()),e.on("click",i.highlight,u,i),e.on("dblclick",i.startEdit,u,i),e.on("keydown",i.typeEdit,a,i),e.on("blur",i.finishEdit,a,i),e.on("mousedown",function(t){t.preventDefault(),e.ACWidgetInst&&e.ACWidgetInst.hide(),e.fire("HoverCard:hideHoverCard")},u,i)),i.rootNode=s},u.prototype={highlight:a,startEdit:f,typeEdit:l,finishEdit:c,getNode:h,validate:p,setLabel:d,setState:v,getFullDisplayData:g,createUserDataFromString:m,remove:y},e.namespace("comms.ui"),e.comms.ui.Lozenge=u,e.comms.ui.LozengeUtils={makeContact:function(e,t){var r,i=[],s=[],o,u,a,f,l,c,h,p=e.all("span.lozenge");for(r in t){u=t[r].fields;for(var d=0,v=u.length;d<v;d++)o=u[d],o.type==="email"?i=i.concat(o.value):o.type==="name"&&(a=o.value,f=n(strings.str_name_format,{given_name:a.givenName,family_name:a.familyName}),s=s.concat(f))}p.each(function(e){if(e.hasClass("lozengeadd")){c=e.getAttribute("data-address");for(l=0;l<i.length;l++)i[l]===c&&(e.remove(),h&&(h.addClass("right"),f=s[l],f&&h.one("a").setContent(f),h=null))}else h=e})}}},"0.0.1",{requires:["comms-ui-lozenge_css","common-utils","comms-utils","node"]});
YUI.add("comms-ui-autocomplete-plugin",function(C){var B="autocomplete",F=C.Lang,G=C.Array.each,L=C.Plugin,E=L.Base,I="ac",D=13;function J(O,Q){var N="down",P=C.stamp(this)+"|";if(C.UA.gecko>0&&C.UA.gecko<5){N="press";C.on(P+"key",O.raiseFlag,Q,"down",O);}C.on(P+"valueChange",H,Q,O);C.on(P+"key",O.next,Q,N+":40",O);C.on(P+"key",O.previous,Q,N+":38",O);C.on(P+"key",O.close,Q,"down:27",O);Q.on("keyup",function(R){if(R.keyCode===D){R.type="select";this.select.call(O,R);}},O,"select");}function H(O){var N=O.newVal;if(!N&&!(N===""&&this.get("minQueryLength")===0)){this._cachedValue=false;return this.close();}if(N===this._cachedValue||N.length<this.get("minQueryLength")){return false;}this._cachedValue=N;this.fire("ac:query",{value:O.newVal});return true;}function A(N){return function(){if(N){N.setAttribute(B,"on");}N=null;};}function K(N){var P=C.Node.getDOMNode(N),Q=P.getAttribute(B);if((Q&&Q!=="off")||Q===null||Q===undefined){var O=A(P);C.on("beforeunload",O,window);C.on("unload",O,window);}P.setAttribute(B,"off");}function M(){M.superclass.constructor.apply(this,arguments);}C.extend(M,E,{_defaultEventFn:null,initializer:function(){var N=this,O=N.get("host"),P=(!F.isNull(N._defaultEventFn)?N._defaultEventFn:{});J(N,O);G(["query","load","show","hide","next","previous","select"],function(Q){N.publish("ac:"+Q,{broadcast:1,bubbles:1,context:N,preventable:true,prefix:I,defaultFn:P[Q]||null});},N);K(O);},destructor:function(){var N=this;C.detach(C.stamp(N)+"|");N.detachAll();},open:function(){this.fire("ac:show");},next:function(N){if(this.conflictingKeyFlag&&C.UA.gecko){return;}N.preventDefault();this.fire("ac:next");},previous:function(N){if(this.conflictingKeyFlag&&C.UA.gecko){return;}N.preventDefault();this.fire("ac:previous");},raiseFlag:function(O,N){if((O.keyCode===55)||(O.keyCode===57)){N.conflictingKeyFlag=true;}else{N.conflictingKeyFlag=false;}},select:function(N){this.fire("ac:select",N);},hide:function(){},close:function(){this.fire("ac:hide");},reload:function(N){if(N){if(N.length<1){this.set("badResult",this.get("queryValue"));}this.fire("ac:load",{results:N,query:this.get("queryValue")});}}},{NAME:"ACPlugin",NS:I,ATTRS:{queryValue:{getter:function(){return this.get("host").get("value");},setter:function(N){this.get("host").set("value",N);this._cachedValue=N;return this._cachedValue;}},dataSource:{value:[]},minQueryLength:{value:0,validator:F.isNumber},queryTemplate:{value:encodeURIComponent,setter:function(N){return(F.isFunction(N)?N:function(O){return N.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(O)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");});}},alignNode:null,conflictingKeyFlag:false,badResult:{value:false,setter:function(N){return(C.Lang.isString(N))?N:false;}}}});C.namespace("comms.ui");C.comms.ui.AutoCompleteEventsPlugin=M;},"1.0.0",{requires:["node","plugin","event-valuechange","event-key"]});YUI.add("comms-ui-autocomplete",function(C){var H=C.Array.each,F=C.Lang,B=C.Overlay,G="selectedIndex",A="queryValue",J="ac",D="_BOUND",I="_"+G,K="_originalValue";function E(){E.superclass.constructor.apply(this,arguments);this.delegated=false;this.listeners=[];}C.extend(E,B,{initializer:function(){var L=this;L.after({queryChanged:L.drawMarkUp,dataChanged:L.drawMarkUp});L.hide();L.publish(J+":complete",{broadcast:1,bubbles:1,context:L,preventable:true,prefix:J});},renderUI:function(){var M=this.get("ac"),L={"display":"none","overflow":"auto","maxHeight":"300px"};if(!M){return false;}this.get("contentBox").setStyles(L);this.get("contentBox").set("role","listbox");this.setSize();this.set("align",{node:this.get("ac").get("alignNode"),points:[C.WidgetPositionAlign.TL,C.WidgetPositionAlign.BL]});this.get("contentBox").setStyle("display","block");return true;},bind:function(P){var Q=this,L=Q.get("contentBox"),O=Q.get("ac"),N=C.stamp(Q)+"|";if(P&&O!==P&&Q[D]){C.detach(N);Q[D]=0;}P=P||O;if(P&&!Q[D]){var M=[];Q[D]=1;if(!Q.delegated){Q.delegated=true;M.push(L.delegate("click",Q.click,"li",Q));M.push(L.delegate("mouseover",Q.mouseover,"li",Q));M.push(L.delegate("mouseout",Q.mouseout,"li",Q));M.push(L.delegate("mousemove",function(R){R.halt();R.currentTarget.addClass("over");},"li",Q));M.push(L.delegate("mouseleave",function(R){R.halt();R.currentTarget.removeClass("over");},"li",Q));M.push(C.on("click",function(R){if(!Q.isVisible()){return;}if(Q.get("contentBox").contains(R.target)){if(R.target.get("nodeName").toLowerCase()!=="li"){return;}Q.get("ac").get("host").simulate("keydown",{keyCode:13});}if(Q.get("ac").get("host").contains(R.target)){return;}Q.hide();},document,this));}M.push(P.on(N+J+":load",function(R){if(!Q.get("disabled")){Q.setAttrs({query:R.query,data:R.results}).drawMarkUp().show().setAlign();}}));M.push(P.on(N+J+":query",function(R){Q.set("query",R.value).drawMarkUp();}));M.push(P.on(N+J+":next",Q.next,Q));M.push(P.on(N+J+":previous",Q.previous,Q));M.push(P.on(N+J+":hide",Q.hide,Q));P.select=function(R){Q.selected.call(Q,R,"enter");};Q.listeners=M;}return Q;},bindUI:function(L){return this.bind(L);},setSize:function(){if(!this.get("expandWidthToContents")){this.set("width",this.get("ac").get("alignNode").get("offsetWidth"));}},setAlign:function(){var O=this,M=O.get("ac").get("alignNode"),L=M.get("region"),N=[L.left,L.bottom];O.set("xy",N);return O;},drawMarkUp:function(){var L=this,M=L.get("data");if(!M){return L;}L[I]=-1;L[K]="";L.get("contentBox").set("innerHTML",L.getListMarkup(M));if(M.length>0){if(L.get("selectFirst")){this.set(G,0);}L.get("contentBox").setStyle("display","block");}else{L.get("contentBox").setStyle("display","none");}return L;},getListMarkup:function(O){var N=this,L=N.get("listTpl"),M=[];H(O,function(P){M.push(N.getItemMarkup(P));});return L.replace(/\{list\}/g,M.join(""));},getItemMarkup:function(M){var L=this;if(!F.isString(M)){return false;}return L.get("itemTpl").replace(/\{hilite\}/g,M);},_fixView:function(O){var R=this,N=R.get(G),L=R.get("contentBox"),Q,M,P;if(N===-1){L.set("scrollTop",0);return true;}M=R.item(N);Q=L.get("scrollTop");M=R.item(N);P=M.get("offsetTop");M.addClass("key-select");if(O){if((P>Q)&&(R.itemsCount()!==(N+1))){return true;}L.set("scrollTop",P);document.body.scrollIntoView();return false;}else{if((P+M.get("clientHeight"))>(Q+L.get("clientHeight"))){L.set("scrollTop",L.get("scrollTop")+M.get("clientHeight"));if(C.UA.ie<=0){M.scrollIntoView();}document.body.scrollIntoView(false);}return true;}},next:function(){var L=this;if(L.get("selectFirst")&&L.itemsCount()===1){return false;}return(L.get("visible")?L.selectNext():L);},selectNext:function(){var L=this;L.set(G,this.get(G)+1);L._fixView(false);return L.get(G);},selectPrevious:function(){var L=this;L.set(G,this.get(G)-1);L._fixView(true);return L.get(G);},previous:function(){var L=this;if(L.itemsCount()===1){return false;}return L.get("visible")?L.selectPrevious():L;},isVisible:function(){return this.get("visible");},hasSelectedItem:function(){return this.get("selectedIndex")>-1;},item:function(L){return this.get("contentBox").all(this.get("itemSelector")).item(L);},itemsCount:function(){return this.get("contentBox").all(this.get("allItemsSelector")).size();},click:function(L){this.selected(L,"click");},mouseover:function(O){var M,L,N=this;M=O.currentTarget;L=N.get("contentBox").all("li").indexOf(M);N.set("selectedIndex",L);},mouseout:function(){this.set("selectedIndex",-1);},autoManageSelect:function(L){var M=this,N=M.get("ac");if(!L){L=false;}if(L){N.on(J+":select",M.handleEnter,M);}else{N.detachAll(J+":select");}},handleEnter:function(P,M){if(!M){M=this;}var O=M.get("ac"),L=M[I],N,Q;P.halt();M.fire(J+":complete",M);if(L!==-1){N=M.item(L);if(N){Q=N.get("text");O.set(A,Q);}M[I]=-1;O.get("host").focus();M.hide();}},selected:function(R,P){var M=null,N=this,Q=N.get("ac"),L,O;if(!P){P="click";}M=N.item(this.get(G));if(!M){return false;}O=M.getData("selectedCb");if(O){O.call(M,R);return;}L=this.get(G);R.selectedItem=M;R.selectedIndex=L;R.type=P;R.container=N.get("contentBox");Q.fire("ac:select",R);N[I]=-1;return true;},setHostValue:function(M){var L=this;L.get("ac").set(A,M);L.get("ac").get("host").focus();L.hide();},reload:function(L){return this.get("ac").reload(L);},close:function(){var L=this;L.get("ac").close();L.hide();},destroy:function(){var M=this.listeners;if(M){var N=M.length,L;for(L=0;L<N;L++){if(M[L]){M[L].detach();M[L]=null;}}this.listeners=null;}if(this.get("ac")){this.get("ac").destructor();}E.superclass.destroy.apply(this,arguments);}},{NAME:"AutoCompleteWidget",ATTRS:{ac:{setter:function(L){if(!this[D]){return;}this.bind(L);},validator:function(){return true;}},data:{},query:{value:""},listTpl:{value:'<ul role="presentation">{list}</ul>'},itemTpl:{value:'<li role="option">{hilite}</li>'},itemSelector:{value:"ul li"},allItemsSelector:{value:"ul li"},selectedItem:{getter:function(){return this.item(this.get(G));},readOnly:true},expandWidthToContents:{value:false},selectFirst:{value:true}}});
E.ATTRS[G]={value:-1,validator:function(L){var M=this.get("data");return M&&C.Lang.isNumber(L);},getter:function(){return this[I];},setter:function(O){var T=this,Q=T.get(G),R=T.get("data"),L=T.itemsCount(),S=T.get("ac"),M=this.getClassName("selected"),P,N;if(isNaN(Q)){Q=-1;}if(!R||!L){return false;}while(O<-1){O+=L+1;}O=(O+1)%(L+1)-1;Q=(Q+1)%(L+1)-1;T[I]=O;if(Q===-1){T[K]=S.get(A);}if(Q===O){return false;}var U=T.get("contentBox").one("."+M);if(U){U.removeClass(M).removeClass("key-select");}if(O===-1){}else{P=T.item(O);if(P&&P.hasClass("corpmail.label")){N=O+(Q<O?1:-1);T[I]=N;P=T.item(N);}if(P){P.addClass(M);}}return O;}};C.namespace("comms.ui");C.comms.ui.AutoComplete=E;},"1.0.0",{requires:["overlay","comms-ui-autocomplete-plugin","node-event-simulate"]});YUI.add("contacts-api-config",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n={1:"asc",2:"desc"},r={1:"first",3:"last",6:"email"},i=!1,s="max",o,u;o=e.common.Utils,i=o.features.enabled("contactsV2",!1),s=o.settings.value("contactsV2Limit"),u=function(){var t=this,o=function(e){return!!e},u={baseHost:{validator:o},contactsV2:{value:i,validator:o},uri:{},headers:{},wssid:{},guid:{},requestFn:{},wspath:{value:"/ws/sd",validator:o},start:{},count:{value:i?s:"max",validator:o},sortfields:{},out:{value:"name,email,nickname,yahooid,phone,otherid,image"},prefs:{value:null},sort:{},fields:{},view:{value:["compact"]},rev:{value:0,validator:o},reloadOnUpdate:{value:!0},fieldsToProcess:{value:["name","nickname","email","yahooid","image"],validator:function(t){return e.Lang.isArray(t)}},minimumFields:{value:["name","email","phone","nickname","yahooid","otherids","company"],validator:function(t){return e.Lang.isArray(t)}}};t.addAttrs(u),t.setSortField=function(e){return t.set("sortfields",r[e]),t.get("sortfields")},t.setSortOrder=function(e){return t.set("sort",n[e]),t.get("sort")}},e.augment(u,e.Attribute),t.config=new u;if(t.clientConfig)t.config.setAttrs(t.clientConfig);else if(NeoConfig){var a={guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,wspath:NeoConfig.socdirProxyPath,sortfields:"first",sort:"asc"};e.Object.getValue(e,["common","net","SessionMgr"])&&(a.requestFn=e.common.net.SessionMgr.requestProxy),t.config.setAttrs(a)}},"1.0.0",{requires:["attribute","mail-common-utils-features","mail-common-utils-settings"]});
YUI.add("contacts-api-cache",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=e.contacts.config,r,i=e.Lang,s={CONTACT_CHANGED:"contacts:api:contactChanged",CONTACTS_LOADED:"contacts:api:loaded",CONTACT_IMAGE_UPDATED:"contacts:api:imageUpdated"};t.EVENTS=s,r=function(){var t=this,r=!1,o=0,u,a={},f={},l={},c={},h=[],p=[],d=null,v,m,g,y,b,w,E;v=function(e,t){var n,r;t||(c={});for(n in e)e.hasOwnProperty(n)&&(r=e[n],typeof r=="object"&&(c[r.id]=c[r.id]||r,t&&(c[r.id].contacts=c[r.id].contacts||[],c[r.id].contacts.push(t.id))))},b=function(e,t){var r=e.fields,i=a[e.id]={typedFields:{},typedFieldValues:{}},s,o,u,f,l;if(n.get("contactsV2")){w(e,t);return}if(!r)return;t=t||[],s=t.length>0;for(l in r)if(r.hasOwnProperty(l)){o=r[l],u=o.value,f=o.type;if(s&&t.indexOf(f)===-1)continue;i.typedFields[f]||(i.typedFields[f]=[]),i.typedFieldValues[f]||(i.typedFieldValues[f]=[]),f==="name"&&u&&(u.familyName&&u.familyName.indexOf("<")!==-1&&(u.familyName=""),u.givenName&&u.givenName.indexOf("<")!==-1&&(u.givenName="")),i.typedFields[f].push(o),i.typedFieldValues[f].push(u)}},w=function(t,n){var r=a[t.id],i,s,o,u,f,l;n=n||[],i=n.length>0,t.fields=t.fields||[];for(f in t){if(f==="fields")continue;if(t.hasOwnProperty(f)){s=t[f],f=E(f,s);if(i&&n.indexOf(f)===-1)continue;r.typedFields[f]||(r.typedFields[f]=[]),r.typedFieldValues[f]||(r.typedFieldValues[f]=[]);if(Array.isArray(s))for(l in s)o=s[l],u=o.ep,o&&u&&(o.value=u,o.type=f,r.typedFields[f].push(o),r.typedFieldValues[f].push(u),t.fields.push(o));else if(typeof s=="object"){if(f==="name"){if(!s.familyName||s.familyName.indexOf("<")!==-1)s.familyName="";if(!s.givenName||s.givenName.indexOf("<")!==-1)s.givenName="";if(!s.middleName||s.middleName.indexOf("<")!==-1)s.middleName=""}u=e.clone(s),s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u)}else typeof s=="string"&&(u=s,s={},s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u))}}},E=function(e,t){switch(e){case"emails":e="email";break;case"messengers":t&&t.flags&&t.flags[0]&&t.flags[0]!=="YID"?e="otherid":e="yahooid";break;case"phones":e="phone"}return e},t.loadSortPrefs=function(e,t){d||(d={}),d.sort_order=e,d.sort_field=t},t.setSortPrefs=function(n,r){t.loadSortPrefs(n,r),e.later(10,t,e.contacts.api.load,[1])},t.getSortPrefs=function(){return d},t.load=function(i){var o,p,d=n.get("fieldsToProcess"),g,y={},w=[],E=n.get("contactsV2");E?(g=i.contacts||[],y={contacts:{},count:i.count,status:i.status,statusText:i.statusText,total:i.total}):g=i.contacts.contact||[],l={},h=[],f={},c={},a={};for(p=0;p<g.length;p++)o=g[p],w.push(o),b(o,d),h[p]=o.id,l[o.id]=o,m(o),v(o.categories,o);u=E?y:i,u.contacts.contact=w,u.contacts.count=u.contacts.total=w.length,r=!0,e.later(10,t,t.fire,[s.CONTACTS_LOADED])},t.removeFromCategories=function(t){var n=t.categories||[],r=n.length,i,s,o;for(i=0;i<r;i++)s=n[i].id,o=c[s].contacts,o&&o.splice(e.Array.indexOf(o,t.id),1)},t.update=function(r){var u,a,f,c,p=n.get("fieldsToProcess"),d=[],y=[],w=[],E=[],S=[],x=[],T=[],N,C;r.syncresult?(o=r.syncresult.rev,u=r.syncresult.diff.contacts,T=r.syncresult.results.contacts):i.isArray(r)?u=r:typeof r=="object"&&!r.contact?u=[r]:u=[r.contact];for(C=0;C<T.length;C+=1){a=T[C],c=a.op,f=l[a.id];switch(c){case"remove":x.push(f);break;case"add":E.push(a);break;case"update":S.push(a)}}for(C=0;C<u.length;C+=1){a=u[C],c=a.op||"add",f=l[a.id];switch(c){case"remove":f&&(g(f),h.splice(e.Array.indexOf(h,f.id),1),t.removeFromCategories(f),w.push(f));break;default:f?(g(f),y.push(a)):d.push(a),b(a,p),v(a.categories,a),l[a.id]=a,m(a)}}return N={created:d,modified:y,removed:w,createdCurrent:E,modifiedCurrent:S,removedCurrent:x},d.length||y.length?n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]):e.later(10,t,t.fire,[s.CONTACTS_LOADED]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,N]),N},t.updateCategories=function(){var r={categories:c};n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,r])},t.restoreObject=function(t){p[t]&&(l[t]=e.clone(p[t]))},m=function(e){var t,n,r,i;t=a[e.id].typedFieldValues.email;if(!t||t.length===0)return;for(i in t)t.hasOwnProperty(i)&&(n=t[i],r=n.toLowerCase(),f[r]=f[r]||[],f[r].push(e))},g=function(e){var t,n,r,i,s,o;t=a[e.id].typedFieldValues.email||[],s=e.id;for(o in t)t.hasOwnProperty(o)&&(n=t[o],i=n.toLowerCase(),r=f[i],r&&r[s]&&(r[s]=undefined))},t.isLoaded=function(){return r},t.getResponseObject=function(){return u},t.getContactsData=function(){return a},t.getContacts=function(){return l},t.getEmails=function(){return f},t.getCategories=function(){return c},t.getContactOrder=function(){return h},t.getUpdatedContacts=function(){return p},t.setUpdatedContacts=function(t){p[t]=e.clone(l[t])},t.getCurrentRevision=function(){return o},t.setCurrentRevision=function(e){o=e},t.loadTinyUserCard=function(r){var i=r.contacts.contact,o,u=n.get("fieldsToProcess"),a=[],f;for(f in i)i.hasOwnProperty(f)&&(o=i[f],b(o,u),l[o.id]=o,m(o),a.push(o));return e.later(10,t,t.fire,[s.CONTACT_IMAGE_UPDATED,a]),a},t.getContactsByBucket=function(e,t,n){var r,i=[],s,o=e+t,u,a=[];n?(s=c[n],s&&(i=s.contacts||[])):i=h||[];for(u=e;u<o;u++){r=i[u];if(!r)break;a.push(l[r])}return{contacts:a,total:i.length}},t.removeFlatContact=function(e,t){var n=a[e].flatContacts,r,i=n.length,s;for(r=0;r<i;r++){s=n[r];if(s.emailField&&s.emailField.id===t){n.splice(r,1);break}}},t.removeField=function(e,n){var r=l[e];if(r){var i=r.fields,s,o=i.length,u;for(s=0;s<o;s++){u=i[s];if(u.id===n){i.splice(s,1),u.type==="email"&&t.removeFlatContact(e,n);break}}}},y=function(){var e={broadcast:1,emitFacade:!0};t.publish(s.CONTACT_CHANGED,e),t.publish(s.CONTACTS_LOADED,e),t.publish(s.CONTACT_IMAGE_UPDATED,e)}()},e.augment(r,e.EventTarget),t.cache=new r},"1.0.0",{requires:["contacts-api-config","common-utils-stats"]});
YUI.add("contacts-api-utils",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.cache,r=function(){var t=this;t.getContactsByEmail=function(e){return!e||e===""?null:n.getEmails()[e.toLowerCase()]},t.isEmailKnown=function(e,n){var r,i;return r=t.getContactsByEmail(e),r?1:0},t.getContactById=function(e){var t;return t=n.getContacts()[e],t},t.getContactsByIds=function(e){var n,r;n=[];for(r in e)e.hasOwnProperty(r)&&n.push(t.getContactById(e[r]));return n},t.getCategoryById=function(e){var t;return t=n.getCategories()[e],t},t.areContactsLoaded=function(){return n.isLoaded()},t.getResponseObject=function(){return n.getResponseObject()},t.getContacts=function(e){var t,r={},i=n.getContacts();if(!e)return i;for(t in i)i.hasOwnProperty(t)&&i[t].id>=0&&(r[t]=i[t]);return r},t.getSmartContacts=function(){var e,t={};for(e in n.getContacts())n.getContacts().hasOwnProperty(e)&&n.getContacts()[e].id<0&&(t[e]=n.getContacts()[e]);return t},t.getAllContacts=function(){return n.getContacts()},t.getCategories=function(){return n.getCategories()},t.getContactsClone=function(e){var r={},i,s,o,u;if(e){i=n.getContactsByBucket(0,n.getContactOrder().length,e).contacts,o=i.length;while(o--)r[i[o].id]=i[o]}else{s=t.getContacts();for(u in s)r[u]=s[u]}return r},t.getFlatContacts=function(){var e=t.getContacts(),n=[],r,i,s;for(i in e)if(e.hasOwnProperty(i)){r=t.getBasicFlatContacts(e[i]);for(s in r)r.hasOwnProperty(s)&&n.push(r[s])}return n},t.getFieldsByType=function(e,t){var r=e[t];return r=r&&!Array.isArray(r)?[r]:r,n.getContactsData()[e.id].typedFields[t]||r},t.getFieldValues=function(r,i,s){var o,u,a;if(!r||!i)return null;if(s){u=t.getFieldsByType(r,i);if(u){o=[];for(a in u)u.hasOwnProperty(a)&&e.Array.indexOf(a.flags,s)&&o.push(a.value)}return o}return n.getContactsData()[r.id].typedFieldValues[i]},t.getShownContactName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i){i=i.familyName+" "+i.givenName;if(s(i))return i}}return o||u},t.getName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i&&i.givenName){i=i.givenName;if(s(i))return i}else if(i&&i.familyName){i=i.familyName;if(s(i))return i}return o}},t.getFirstFieldValue=function(e,n,r){return!e||!n?null:(t.getFieldValues(e,n,r)||[])[0]},t.getHigherPrecedenceFieldByType=function(e,n){function r(e,t){return e.id-t.id}if(!e)return null;var i=t.getFieldsByType(e,n)||[];return i.sort(r)[0]?i.sort(r)[0].value:null},t.getBasicFlatContacts=function(e){var r=n.getContactsData()[e.id].flatContacts,i,s,o,u;if(!r){r=[],s=t.getFieldsByType(e,"email")||[],i=t.getHigherPrecedenceFieldByType(e,"name")||{},o=s.length&&s[0]||{value:""};for(u in s)s.hasOwnProperty(u)&&r.push({firstname:i.givenName,lastname:i.familyName,middlename:i.middleName,nickname:t.getFirstFieldValue(e,"nickname"),image:t.getFirstFieldValue(e,"image"),email:s[u].value,emailField:s[u],id:e.id,isPrimary:s[u].value===o.value});n.getContactsData()[e.id].flatContacts=r}return r},t.getContactImage=function(e){var r=n.getContactsData()[e.id].image,i;return r||(i=t.getFirstFieldValue(e,"guid"),i&&(r=i.image),n.getContactsData()[e.id].image=r),r},t.getSortedFlatContacts=function(e){return t.sortFlatContacts(t.getFlatContacts(),e)},t.sortFlatContacts=function(e,t){function r(e){var t=0,n,r=e.matches,i;if(r)for(n in r)r[n].length===1&&(i=r[n][0],i.endIndex-i.startIndex===e[n].length&&t++);return t}function i(e,t,n){var r=e[n],i=t[n];return r&&i?r===i?null:r<i?-1:1:!r&&!i?null:r?-1:1}function s(e,t){var r,s;for(s in n)if(n.hasOwnProperty(s)){r=i(e,t,n[s]);if(r)return r}return 0}var n=t||["firstname","lastname","email"];return e.sort(s),e},t.getContactsCacheBucket=function(e,t,r){return n.getContactsByBucket(e,t,r)},t.getContactOrder=function(){return n.getContactOrder()},t.loadSortPrefs=function(e,t){n.loadSortPrefs(e,t)},t.getSortPrefs=function(){return n.getSortPrefs()},t.getSortedContacts=function(){var e=t.getContacts(),n=t.getContactOrder(),r=n.length,i=[],s;for(s=0;s<r;s++)i.push(e[n[s]]);return i},t.getTotalContacts=function(){return n.getContactOrder().length}};t.utils=new r},"1.0.0",{requires:["contacts-api-cache","common-utils-stats"]});
YUI.add("contacts-api-urigenerator",function(e){"use strict";function g(e,t,n){var r=e.split(" "),i,s="",o=r.length;while(o--)i=r[o],i&&(s&&(s+=";"),s+=h.replace("{field}",t).replace("{condition}",n).replace("{query}",encodeURIComponent(i.replace(/,/g,"\\,"))));return s}function y(t,n){var i={id:t.id,op:"update",fields:[],categories:[]},s=i.fields,o=t.fields||[],u=n.fields||[],a={},f,l,c,h,p;t=e.clone(t,!0),n=e.clone(n,!0),p=o.length;while(p--)a[parseInt(o[p].id,10)]=o[p];p=u.length;while(p--){c=u[p],f=parseInt(c.id,10),h=c.categories,l=a[f];if(!l)s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h);else{if(c.type!==l.type||!r.congruent(c.value,l.value,!1)||!r.congruent(c.flags,l.flags,!1)||!r.congruent(h,l.categories,!1))c.type==="yahooid"&&!r.congruent(h,l.categories,!1)?(s.push({op:"remove",id:l.id}),s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[],categories:h})):c.type!=="Image"&&(s.push({op:"update",id:f,value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h));delete a[f]}}for(p in a)a.hasOwnProperty(p)&&s.push({op:"remove",id:p});return i}function b(e,t){e=e||[],t=t||[];var n=[],r={},i,s,o,u;u=e.length;while(u--)r[parseInt(e[u].id,10)]=e[u];u=t.length;while(u--)i=t[u],o=i.id,s=r[o],s?delete r[o]:n.push({op:"addTo",id:o});for(u in r)r.hasOwnProperty(u)&&n.push({op:"removeFrom",id:e[u].id});return n}function w(t){var n=w.METHODS;t.path=t.wspath||"ws/sd",t.baseHost=t.baseHost||e.config.win.location.host,p=i.get("contactsV2"),this.params=undefined,this.method="GET",this.rev=t.rev,this.uri=m,this.guid=t.guid;if(p&&!t.prefs&&!t.contactImport)switch(t.type){case n.SAVE:this.uri+=a;break;case n.REMOVE_FIELD:this.uri+=c.replace("{cid}",t.contactId);break;case n.DELETE:this.uri+=f;break;default:this.uri+=t.singleContact?c.replace("{cid}",t.id):u}else this.uri+=t.singleContact?l.replace("{guid}",t.guid).replace("{cid}",t.id):o.replace("{guid}",t.guid);t.prefs&&(this.uri+="/preferences;"),t.contactImport&&(this.uri+="/import"),t.wssid=t.wssid||NeoConfig.wssid,p&&!t.prefs&&!t.contactImport?this.initContactV2(t):this.init(t)}var t=e.contacts,n=t.utils,r=e.common.Utils,i=e.contacts.config,s=e.Lang,o="v1/user/{guid}/contacts",u="v2/contacts/",a="v2/contact/",f="v2/contacts/trash/",l="v1/user/{guid}/contact/{cid}",c="v2/contact/{cid}",h="{field}.{condition}={query}",p,d={asc:1,desc:2,1:1,2:2},v={first:-10001,last:-10003,email:4,"-10001":"first","-10003":"last",4:"email",1:-10001,3:-10003,6:4},m=r.settings.value("contactProgrssURL");r.features.enabled("contactsUE")?m=r.settings.value("unifiedEdgeURL")+r.settings.value("contactsUEPath")+"/":m=r.settings.value("contactProgrssURL"),w.prototype={init:function(e){var t=w.METHODS,n=e.type||t.DEFAULT;switch(n){case t.SAVE:case t.DELETE:s.isNumber(this.rev)&&this.rev>=0?(this.method="PUT",e.isCreateList?this.setCreateListParams(e):this.setPUTParams(e),this.setPUTUri(e)):(this.method="POST",e.isCreateList?this.setCreateListParams(e):this.setPOSTParams(e),this.setPOSTUri(e));break;case t.SAVE_PREFS:this.method="POST",this.setPOSTPrefsParams(e),this.setPOSTUri(e);break;case t.DELETE_CATEGORIES:case t.SAVE_CATEGORIES:this.method="PUT",this.setCategoriesParams(e),this.setPUTUri(e);break;case t.UPDATE_CONTACTS_CATEGORIES:this.method="PUT",this.setUpdateCategoriesParams(e),this.setPUTUri(e);break;case t.REMOVE_FIELD:this.method="PUT",this.setRemoveFieldParams(e),this.setPUTUri(e);break;case t.IMPORT_CONTACT:this.method="POST",this.setPOSTImportParams(e),this.setPOSTUri(e);break;default:this.method="GET",this.setGETUri(e)}},initContactV2:function(e){var t=w.METHODS,n=e.type||t.DEFAULT;this.method="POST",e.contacts&&(e.contacts=this.convertContactV2(e.contacts));switch(n){case t.SAVE:this.setPOSTParams(e),this.setPOSTUri(e);break;case t.DELETE:this.setDeleteParamsV2(e),this.setPOSTUri(e);break;case t.REMOVE_FIELD:this.setRemoveFieldParamsV2(e);if(e.type===t.DELETE)break;this.setPOSTUri(e);break;default:this.method="GET",this.setGETUri(e)}},convertContactV2:function(e){var t=[],n={},r,i,s,o,u;for(s in e){r=e[s];if(r.fields)for(i in r.fields)o=r.fields[i],o.type&&(o.type==="yahooid"&&!o.flags&&(o.flags=["YID"]),u=this.mapTypeV1toV2(o.type),this.mapContantsV1toV2(n,u,o));typeof r.categories=="object"&&(n.categories=r.categories),r.id&&(n.id=r.id),t.push(n)}return t},mapContantsV1toV2:function(e,t,n){switch(t){case"emails":case"phones":case"messengers":case"links":case"addresses":e[t]=e[t]?e[t]:[],e[t].push(this.mapValuesV1toV2(t,n));break;default:e[t]=this.mapValuesV1toV2(t,n)}},mapTypeV1toV2:function(e){switch(e){case"email":e="emails";break;case"yahooid":case"otherid":e="messengers";break;case"phone":e="phones"}return e},mapValuesV1toV2:function(e,t){var n={};switch(e){case"emails":case"phones":case"messengers":case"links":n.ep=t.value,t.flags&&(n.flags=t.flags),t.id&&(n.id=t.id);break;default:n=t.value}return n},getURI:function(){return this.uri},getMethod:function(){return this.method},setMethod:function(e){this.method=e},getHeaders:function(){return{"Content-Type":"text/plain; chaset=utf-8"}},setHeaders:function(e){this.headers=e},getParams:function(){return this.params},stripContact:function(e){e._data&&(e._data=undefined)},setPOSTImportParams:function(e){var t=e.contactImport;this.params={},t&&(this.params=t)},setPOSTPrefsParams:function(e){var t=e.prefs,n={},r=t.sort_order,i=t.sort_field;this.params={},t&&(r&&(n.sort_order=d[r]),i&&(n.sort_type=v[i]),this.params.preferences=n)},setPOSTParams:function(e){var t={};this.params={},e.contacts&&s.isArray(e.contacts)&&!s.isUndefined(e.contacts[0])&&(t=e.contacts[0]),this.stripContact(t),p?this.params=t:this.params.contact=t},setPOSTUri:function(e,t){this.uri+=t===!0?"/sync?format=json":"?format=json",this.uri+="&custId=ymail&wssid="+e.wssid},setCreateListParams:function(e){var t=e.newContacts,n=e.updateContacts,r={name:e.category,op:"add",refid:"01"},i=[{refid:"01",op:"addTo"}],s={rev:this.rev,categories:[],contacts:[]},o,u,a;s.categories.push
(r),a=t.length;while(a--)o=t[a],u={op:"add",fields:[{value:{givenName:o.name},type:"name",op:"add"},{value:o.email,type:"email",op:"add"}],categories:i},s.contacts.push(u);a=n.length;while(a--)u={id:n[a].id,op:"update",categories:i},s.contacts.push(u);this.params={contactsync:s}},setPUTParams:function(t){var r=t.contacts||[],i=t.categories||[],o=[],u=[],a,f,l,c,h,p,d,v;this.params={contactsync:{rev:this.rev}},d=r.length;if(d>0){while(d--){a=e.clone(r[d]);if(s.isValue(a.id)){if(!a.op||a.op!=="remove")f=n.getContactById(a.id),c=a.categories,l=f.categories,a=y(f,a),a.categories=b(l,c)}else{a.op="add",p=a.fields||[],v=p.length;while(v--)p[v].op="add";p=a.categories||[],v=p.length;while(v--)p[v]={op:"addTo",id:p[v].id};this.stripContact(a)}o.push(a)}this.params.contactsync.contacts=o}d=i.length;if(d>0){while(d--){h=e.clone(i[d]);if(s.isValue(h.id))throw new Error("category modification not yet implemented");h.op="add",h.contacts=n.getContactsByIds(h.contacts),u.push(h)}this.params.contactsync.categories=u}},setPUTUri:function(e){this.setPOSTUri(e,!0)},updateWSSID:function(t){var n,r=this.uri.split("?"),i=r[0],s=r.slice(1).join("?");NeoConfig.wssid=t,n=e.QueryString.parse(s),n.wssid=NeoConfig.wssid,this.uri=i+"?"+e.QueryString.stringify(n)},setGETUri:function(e){var t,n=e.fields,r,i=this.uri;if(n)for(r in n)n.hasOwnProperty(r)&&(t=n[r],t.name&&t.condition&&t.value&&(i+=";"+t.name+"."+t.condition+"="+t.value));if(!p||e.prefs||e.contactImport)e.searchQuery&&e.searchField&&e.searchCondition&&(i+=";"+g(e.searchQuery,e.searchField,e.searchCondition)),e.count&&(i+=";count="+e.count),e.out&&(i+=";out="+e.out),e.start&&(i+=";start="+e.start),e.sortfields&&!e.sortByBest&&(i+=";sort-fields="+e.sortfields),e.sort&&!e.sortByBest&&(i+=";sort="+e.sort);i+="?format=json",e.view&&(s.isArray(e.view)?i+="&view="+e.view.join("&view="):i+="&view="+e.view),s.isValue(e.rev)&&(i+="&rev="+e.rev),e.id&&(i+="&id="+e.id),e.sortByBest&&(i+="&sortBy=best"),p&&!e.prefs&&!e.contactImport&&(e.count&&(i+="&count="+e.count),e.start&&(i+="&start="+e.start)),i+="&custId=ymail&wssid="+e.wssid,this.uri=i},setCategoriesParams:function(e){var t=e.categories||[],n={rev:this.rev,categories:[],contacts:[]},r=[],i={},s,o=t.length;while(o--)s=t[o],s.id?s.op==="remove"?i=s:i={op:"update","new":{name:s.name},old:{id:s.id}}:i={op:"add",name:s.name},r.push(i);n.categories=r,this.params={contactsync:n}},setUpdateCategoriesParams:function(t){var n=t.categories.addTo||[],r=n.length,i=t.categories.removeFrom||[],s=i.length,o=t.contacts,u=o.length,a=[],f=[],l=[],c=1,h={rev:this.rev,categories:[],contacts:[]},p,d;p=r;while(p--)d=n[p],e.Lang.isNumber(d)?f.push({id:n[p],op:"addTo"}):(l.push({name:d,op:"add",refid:c}),f.push({refid:c,op:"addTo"}),c++);p=s;while(p--)f.push({id:i[p],op:"removeFrom"});p=u;while(p--)a.push({id:o[p],op:"update",categories:f});h.contacts=a,h.categories=l,this.params={contactsync:h}},setRemoveFieldParamsV2:function(e){var t=this,r=!1,s=e.fieldId,o=e.contactId,u=n.getContactById(o),a=i.get("minimumFields"),l={id:o},h,p,d,v,m,g,y;u=t.convertContactV2([u]),h=u[0];for(m in h){d=h[m];if(m==="fields"||m==="id")continue;if(Array.isArray(d)){v=l[m]=[];for(g=0,y=d.length;g<y;g++){p=d[g];if(!p.id||p.id!==s)v.push(p),a.indexOf(m)>-1&&(r=!0)}}else typeof d=="object"&&(!d.id||d.id!==s)&&(l[m]=d,a.indexOf(m)>-1&&(r=!0))}l.id=h.id;if(!r){e.type=w.METHODS.DELETE,t.uri=t.uri.replace(c.replace("{cid}",e.contactId),f),t.initContactV2(e);return}t.params=l},setDeleteParamsV2:function(e){var t=this,n=e.contacts,r=e.contactId,i=[],s,o;r&&i.push(r);for(o in n)s=n[o],s.id&&i.push(s.id);t.params={ids:i}},setRemoveFieldParams:function(e){var t={rev:this.rev,contacts:[]},r=!1,i=e.fieldId,s=e.contactId,o=n.getContactById(s),u={id:s},a=o.fields,f,l=a.length;while(l--){f=a[l];if(f.id!==i){r=!0;break}}r?(u.op="update",u.fields=[{op:"remove",id:i}]):u.op="remove",t.contacts=[u],this.params={contactsync:t}}},w.METHODS={DEFAULT:0,GETCONTACTS:1,SAVE:2,DELETE:3,SAVE_CATEGORIES:4,DELETE_CATEGORIES:5,SAVE_PREFS:6,UPDATE_CONTACTS_CATEGORIES:7,REMOVE_FIELD:8,IMPORT_CONTACT:9},e.namespace("contacts"),t.URIGenerator=w},"1.0.0",{requires:["contacts-api-config","contacts-api-utils","mail-common-utils-settings","mail-common-utils-features"]});
YUI.add("contacts-api-io",function(e){"use strict";function i(e,t){return function(n,r){var i={};if(!r)return e.failure(i,r,t);try{i=e.parseJSON(r)}catch(s){return typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-contacts-api-io:1",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-contacts-api-io:1"),e.failure(i,r,t)}return i.error||!e.isSuccess(r.status)?e.failure(i,r,t):e.success(i,r,t)}}function s(e){this.io=null,this.maxRetries=2,this.retryCount=0,this.uriGenerator=t.URIGenerator,this.onSuccess=function(){},this.onFailure=function(){},this.hook=e}e.namespace("contacts");var t=e.contacts,n=e.Lang,r=e.JSON;s.prototype={parseJSON:function(t){var n={};if(typeof t.body=="string")n=r.parse(t.body);else if(typeof t.body=="object")n=t.body;else{if(typeof t.responseText!="string"||t.responseText==="")throw e.fire("MailLog",{m:"contacts-api-io.Request.parseJSON",info:"Contacts API returned empty or unrecognized response"}),new Error("no response body to parse");n=r.parse(t.responseText)}return n.status=t.status,n.statusText=t.statusText,n},isSuccess:function(e){switch(e){case 200:case 201:case 202:case 204:return!0}return!1},doRetry:function(e){switch(e.status){case 500:return!0;case 401:if(e.getResponseHeader("WSSIdReissue"))return this.uriGenerator.updateWSSID(e.getResponseHeader("WSSIdReissue")),!0}return!1},success:function(e,t,n){this.onSuccess(e,t,n),this.retryCount=0},failure:function(t,r,i){var s=t.error&&t.error.detail&&(t.error.detail.match?t.error.detail.match(/-\d+/):null);if(("-50304"===s||!r||this.doRetry(r))&&this.retryCount<this.maxRetries)return this.retryCount+=1,e.later(100,this,function(){this.send(i)});this.retryCount=0,t.errorCode=!n.isUndefined(s)&&!n.isNull(s)?s:"-99999",this.onFailure(t,r,i)},send:function(t){var n=i(this,t),s=this,o=this.uriGenerator.getURI(),u=this.uriGenerator.getMethod(),a={data:r.stringify(this.uriGenerator.getParams()),on:{success:n,failure:n},headers:this.uriGenerator.getHeaders(),method:u==="PUT"?"POST":u,xdr:{use:"native",credentials:!0},suppressWssid:o.match("&wssid=")!==null};s.io=e.io(o,a)},abort:function(){return this.io&&typeof this.io.abort=="function"?(this.io.abort(),!0):!1}},t.sendRequest=function(e,t,n,r,i){var o=new s(r,i);return t&&(o.onSuccess=t),n&&(o.onFailure=n),e&&(o.uriGenerator=e),o.send(),o},t.Request=s},"1.0.0",{requires:["contacts-api-urigenerator","json"]});
YUI.add("contacts-api-adapter",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.URIGenerator,r=t.cache,i=e.Lang,s="CONTACTS",o,u;e.common&&e.common.Utils&&(o=e.common.Utils,u=new o.Stopwatch("ContactsRequest")),t.APIAdapter={},function(){function a(e,t,s,o,f,l){function d(n){s.push(n.contact||n);if(e.length===0){var u=r.update(s);f&&i.isFunction(f)&&f(u)}else a(e,t,s,o,f,l)}function v(n){if(e.length===0&&s.length>0)r.update(s);else if(e.length>0){a(e,t,s,o,f,l);return}l&&i.isFunction(l)&&l(n)}var c=t.requestFn||null,h,p={baseHost:t.baseHost,uri:t.uri,headers:t.headers,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,wssid:t.wssid};o?p.contacts=o:p.contacts=[e.shift()],h=new n(p),u(h,d,v,c,{contact:p.contacts})}function f(e,t,s,o){function c(e){var t=r.update(e);s&&i.isFunction(s)&&s(t,e)}function h(e){o&&i.isFunction(o)&&o(e)}var a=t.requestFn||null,f,l={baseHost:t.baseHost,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,uri:t.uri,headers:t.headers,rev:r.getCurrentRevision(),wssid:t.wssid};i.isArray(e)||(e=[e]),l.contacts=e,f=new n(l),u(f,c,h,a)}var s=this,o=!1,u=t.sendRequest;s.getContact=function(s,o,a,f){function v(e){o&&i.isFunction(o)&&o(e)}function m(e){a&&i.isFunction(a)&&a(e)}var l,c,h,p,d;if(r.isLoaded()&&!f){l=r.getContacts()[s],l&&o&&i.isFunction(o)&&o({contact:l});return}c=t.config.getAttrs(),h=c.requestFn||null,p={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,fields:c.fields,wspath:c.wspath,view:c.view,rev:c.rev,singleContact:!0,id:s},d=new n(p),u(d,v,m,h)},s.getContacts=function(s,a,f,l){function v(t){var n,r,i="NA";t&&(n=t.getResponseHeader("X-Yahoo-Social-Host")||t.getResponseHeader("x-yahoo-social-host"),n&&(r=n.match(/\.([^\.]+)\.yahoo.com$/i),r[1]&&(i=r[1]))),NeoConfig.ABOriginColo=i,e.fire("contacts:api:origincolo",{ABOriginColo:i})}function m(e,t){var n=t.responseHeaders,s;n&&(s=n["X-Yahoo-Social-ContactsRev"]||n["X-Yahoo-Social-Contactsrev"]||n["x-yahoo-social-contactsrev"],s&&r.setCurrentRevision(parseInt(s,10))),r.load(e),v(t),a&&i.isFunction(a)&&a(r.getContacts()),o=!1}function g(e,t){o=!1,v(t),f&&i.isFunction(f)&&f(e)}if(r.isLoaded()&&!s){a&&i.isFunction(a)&&a(r.getContacts());return}var c=t.config.getAttrs(),h=c.requestFn||null,p,d={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,sortByBest:!!l,fields:c.fields,wspath:c.wspath,view:c.view};o&&a&&i.isFunction(a)?e.once("contacts:api:loaded",function(){a(r.getContacts())}):(o=!0,p=new n(d),u(p,m,g,h))},s.createList=function(e,s,o,a,f){function d(e){var t=r.update(e);a&&i.isFunction(a)&&a(t,e)}function v(e){f&&i.isFunction(f)&&f(e)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,uri:l.uri,headers:l.headers,guid:l.guid,type:n.METHODS.SAVE,wspath:l.wspath,wssid:l.wssid,rev:r.getCurrentRevision(),newContacts:e,updateContacts:s,category:o,isCreateList:!0},p=new n(h);p.setMethod("PUT"),u(p,d,v,c)},s.deleteContacts=function(e,s,o){function d(e){o&&i.isFunction(o)&&o(e)}function v(e){var t,n,o,u;if(e.status===202){t=e.syncresult.results,n=t.contacts,o=n.length;while(o--)if(n[o].error){e.errorCode=n[o].error,d(!1,e);return}}u=r.update(e),s&&i.isFunction(s)&&s(u,e)}var a=t.config.getAttrs(),f=a.requestFn||null,l=[],c=e&&i.isArray(e)?e.length:0,h={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid},p;while(c--)l.push({id:e[c],op:"remove"});h.contacts=l,p=new n(h),u(p,v,d,f)},this.getPreferences=function(e,s){function c(e){s&&i.isFunction(s)&&s(e)}function h(t,n,r){var s=t.preferences||"";e&&i.isFunction(e)&&e(s)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,wspath:o.wspath,uri:o.uri,headers:o.headers,rev:r.getCurrentRevision(),wssid:o.wssid,prefs:!0},l;l=new n(f),u(l,h,c,a)},this.importContact=function(e,s,o){function h(e){o&&i.isFunction(o)&&o(e)}function p(e,t,n){var r=e.preferences||"";s&&i.isFunction(s)&&s(r)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid,type:n.METHODS.IMPORT_CONTACT,contactImport:e.contactImport},c;c=new n(l),u(c,p,h,f)},this.saveContacts=function(e,n,s){var o=t.config.getAttrs(),u=r.getCurrentRevision();u>0||!i.isArray(e)||e.length===1?f(e,o,n,s):a(e,o,[],n,s)},this.getContactsTinyUserCard=function(s,o,a){function p(e){var t=r.loadTinyUserCard(e)[0];o&&i.isFunction(o)&&o(t)}function d(e){a&&i.isFunction(a)&&a(e)}var f=t.config.getAttrs(),l=f.requestFn||null,c={baseHost:f.baseHost||e.config.win.location.host,uri:f.uri,headers:f.headers,guid:f.guid,wssid:f.wssid,type:n.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:s}],wspath:f.wspath,view:"tinyusercard"},h=new n(c);u(h,p,d,l)},this.saveCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n,o;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}o=e.syncresult.diff,r.updateCategories(e),s&&i.isFunction(s)&&s(o,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),categories:[e],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.deleteCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}r.updateCategories(e),s&&i.isFunction(s)&&s(e.syncresult.diff,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:
a.headers,rev:r.getCurrentRevision(),categories:[{id:e,op:"remove"}],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.updateContactsCategories=function(e,s,o,a,f){function d(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,v(!1,e);return}}r.updateCategories(e),a&&i.isFunction(a)&&a(e.syncresult.diff,e)}function v(e,t){f&&i.isFunction(f)&&f(t)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,guid:l.guid,type:n.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:l.wspath,uri:l.uri,headers:l.headers,rev:r.getCurrentRevision(),categories:{addTo:s,removeFrom:o},contacts:e,wssid:l.wssid},p=new n(h);u(p,d,v,c)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.setSortField=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_field:e}},c=new n(l);u(c,h,p,f)},this.restoreObject=function(e,n,i){var s=t.config.getAttrs(),o=r.getUpdatedContacts()[e];o&&f(o,s,n,i)},this.setSortOrder=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_order:e}},c=new n(l);u(c,h,p,f)},this.getSortPrefs=function(s,o){function h(e){var t=e.preferences;t&&t.sort_order&&t.sort_type&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}if(r.getSortPrefs()){s&&i.isFunction(s)&&s(r.getSortPrefs());return}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost||e.config.win.location.host,uri:a.uri,headers:a.headers,guid:a.guid,wssid:a.wssid,type:n.METHODS.DEFAULT,wspath:a.wspath,prefs:!0},c=new n(l);u(c,h,p,f)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.searchContacts=function(e,r,s){function c(e){var t=e.contacts.contact||[];r&&i.isFunction(r)&&r(t)}function h(e){s&&i.isFunction(s)&&s(e)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,type:n.METHODS.GETCONTACTS,wspath:o.wspath,uri:o.uri,headers:o.headers,wssid:o.wssid,out:o.out,fields:o.fields,search:o.search,searchField:"all",searchCondition:"contains",searchQuery:e},l=new n(f);u(l,c,h,a)},this.createEmptyContact=function(){return{fields:[],categories:[]}}}.apply(t.APIAdapter)},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils"]});
YUI.add("contacts-api",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.APIAdapter,r=t.cache,i=function(){var t=this;this.load=function(e,t,r){n.getContacts(e,t,r)},this.saveContacts=function(e,t,r){n.saveContacts(e,t,r)},this.deleteContacts=function(e,t,r){n.deleteContacts(e,t,r)},this.getPreferences=function(e,t){n.getPreferences(e,t)},this.importContact=function(e,t,r){n.importContact(e,t,r)},this.saveCategory=function(e,t,r){n.saveCategory(e,t,r)},this.deleteCategory=function(e,t,r){n.deleteCategory(e,t,r)},this.createList=function(e,t,r,i,s){n.createList(e,t,r,i,s)},this.getContacts=function(e,t,r,i){if(typeof e!="boolean")return;n.getContacts(e,t,r,i)},this.getContact=function(e,t,r,i){n.getContact(e,t,r,i)},this.createEmptyContact=function(e,t){return n.createEmptyContact(e,t)},this.getContactImage=function(e,t,r){n.getContactsTinyUserCard(e,t,r)},this.searchContacts=function(e,t,r){n.searchContacts(e,t,r)},e.on("contacts:contactChanged",function(){t.load(1)}),this.setSortOrder=function(e,t,r){n.setSortOrder(e,t,r)},this.setSortField=function(e,t,r){n.setSortField(e,t,r)},this.getSortPrefs=function(e,t){n.getSortPrefs(e,t)},this.updateContactsCategories=function(e,t,r,i,s){n.updateContactsCategories(e,t,r,i,s)},this.removeEmail=function(e,t,i,s){r.setUpdatedContacts(e),n.removeField(e,t,i,s)},this.restoreEmail=function(e,t,r){n.restoreObject(e,t,r)},this.removeEmail=function(t,i,s){r.setUpdatedContacts(t),r.removeField(t,i);var o=e.contacts.utils.getContactById(t);n.removeField(t,i),s&&s()}};t.api=new i},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});
YUI.add("filter-contacts",function(e){function h(){this.filterItems=[],this.matchType=1,this.init_temp_data=!0,this.del_temp_data=!0,this.match_limit=50}function b(e){var t,n,r,i=e.value;if(e.numeric){n=i.length;if(n>1){r=i.charAt(0),t=1;while(t<n)r+="[ _\\.\\-()]*",r+=i.charAt(t),t+=1}else r=i}else r=i;e.regExp=new RegExp(r,"gi")}function w(e,t){var n={};return n.value=e,v.test(e)||(n.numeric=!0),n.group_id=t,n.match_siIndex=-1,b(n),n}function E(e){var t,n,r,i,s,o,u=[];n=e.length;if(n===0)return u;var a=new RegExp("[ ]","g");for(t=0;t<n;t++){r=e[t],i=0;while(a.test(r))s=a.lastIndex-1,i<s&&(o=w(r.substring(i,s),t),u.push(o)),i=a.lastIndex;i<r.length&&(o=w(r.substring(i),t),u.push(o))}return u}function S(e){var t=[],n,r,i;if(e.length>0){i=new RegExp("[,;]","g"),n=0;while(i.test(e))r=i.lastIndex-1,r>n&&t.push(e.substring(n,r)),n=i.lastIndex;n<e.length&&t.push(e.substring(n))}return t}function x(e,t,n,r){var i,s,o,u,a,f,l,c,p;l=r.fuzzy_match_idx+1,f=r.fuzzy_matches;if(l<f.length)return a=f[l],r.fuzzy_match_idx=l,a;if(!r.fuzzy_complete){i=g,s=-1;for(;;){if(s===-1&&r.fuzzy_match_idx===-1)s=0;else{s<=0&&(i.lastIndex=r.fuzzy_match_idx===-1?0:f[r.fuzzy_match_idx].start+1);if(!i.test(e))break;s=i.lastIndex-1}u=r.matches;for(l=0,c=u.length;l<c;l++){o=u[l];if(s>o.start)break;if(s===o.start)return a={},a.start=o.start,a.end=o.end,a.diff=0,f.push(a),r.fuzzy_match_idx+=1,n.match_idx=a.end,a}c=n.value.length;if(c<=2){p=0;if(r.complete)continue}else c<=5?p=1:p=2;if((a=h.fuzzyMatch(n.value,e,s,p))!==null)return f.push(a),r.fuzzy_match_idx+=1,n.match_idx=a.end,a}r.fuzzy_complete=!0}return r.fuzzy_match_idx=-1,null}function T(e,t,n,r){var i,s,o,u,a,f;s=r.match_idx+1,f=r.matches;if(s<f.length)return a=f[s],r.match_idx=s,a;if(!r.complete){i=n.regExp,i.lastIndex=r.match_idx===-1?0:f[r.match_idx].start+1,o=i.lastIndex;while(i.exec(e)){if(t)return u=e.substring(o,i.lastIndex),o+=u.search(i),a={},a.end=i.lastIndex,a.start=o,f.push(a),r.match_idx+=1,n.match_idx=a.end,a;o=i.lastIndex-n.value.replace(/\\/g,"").length;if(o===0||e.charAt(o-1).search(m)===0)return a={},a.end=i.lastIndex,a.start=o,f.push(a),r.match_idx+=1,n.match_idx=a.end,a}r.complete=!0}return r.match_idx=-1,null}function N(e,t,n,r,i,s,o){var u,a=n||e.matchType!==2?T:x;while((u=a(t,n,r,i))!==null){if(!o){if(r.start_siIndex===s&&r.start_idx===u.start)continue;return!0}if(u.start>=r.start_idx)return r.start_idx=u.start,!0}return!1}function C(e,t){var n=t.matches,r,i,s,o,u,a,f;if(e.match_idx!==-1)r=e.match_idx,i=e.matches;else{if(e.fuzzy_match_idx===-1)return!1;r=e.fuzzy_match_idx,i=e.fuzzy_matches}u=i[r].start,a=i[r].end;for(s=0,o=n.length;s<o;s++){f=n[s];if(!(f.end<=u||a<=f.start))return!1}for(s=0,o=t.length;s<o;s++)if((t[s].match_idx!==-1||t[s].fuzzy_match_idx!==-1)&&t[s].group_id!==e.group_id)return!1;return f={},f.start=u,f.end=a,t.matches.push(f),!0}function k(e,t,n,r,i,s,o){if(i.phoneno&&!t.numeric)return!1;var u,a,f,l,c,h,p;for(u=0,a=i.length;u<a;u++)if(i[u].index===n){f=i[u];break}f||(f={},f.index=n,f.group_id=t.group_id,f.match_idx=-1,f.matches=[],f.fuzzy_match_idx=-1,f.fuzzy_matches=[],i.push(f));var d=f.match_idx;while(N(e,r,i.phoneno,t,f,s,o))if(C(f,i))return!0;if(d!==-1){p=i.matches,l=f.matches[d].start,c=f.matches[d].end;for(u=0,a=p.length;u<a;u++)h=p[u],h.start===l&&h.end===c&&p.splice(u,1)}return t.match_idx=-1,!1}function L(e,t,n,r){var i,s,o,u,a,f,l,c;s=p.length,c=!1,n.match_siIndex===-1&&(c=!0,n.start_siIndex=-1,n.start_idx=-1,r>0&&(l=e.filterItems[r-1],l.group_id===n.group_id&&(n.start_siIndex=l.match_siIndex,n.start_idx=l.match_idx)));if(c&&n.start_siIndex!==-1){i=n.start_siIndex,f=i<3;if(!f||!!n.numeric){o=p[i],u=t[o];if(u&&u.length>0){a=t._matches[o],a||(a=[],a.matches=[],f&&(a.phoneno=!0),t._matches[o]=a);if(k(e,n,r,u,a,i,!0))return n.match_siIndex=i,n.special_match=!0,!0}}}n.match_siIndex===-1?i=0:n.special_match?(n.special_match=!1,i=0):i=n.match_siIndex;while(i<s){f=i<3;if(f&&!n.numeric){i+=1;continue}o=p[i],u=t[o];if(u&&u.length>0){a=t._matches[o],a||(a=[],a.matches=[],f&&(a.phoneno=!0),t._matches[o]=a);if(k(e,n,r,u,a,i,!1))return n.match_siIndex=i,!0}i+=1}return n.match_siIndex=-1,!1}function O(e){var t,n;for(t=0,n=e.filterItems.length;t<n;t++)if(e.filterItems[t].match_siIndex!==-1)return!1;return!0}function M(e){var t,n,r,i,s,o,u,a;if(!e._matches)return!0;for(t=0,i=p.length;t<i;t++){s=p[t],o=e[s];if(o&&o.length>0){u=e._matches[s];if(u){if(u.matches.length>0)return!1;for(n=0,r=u.length;n<r;n++){a=u[n];if(a.match_idx!==-1)return!1;if(a.fuzzy_match_idx!==-1)return!1}}}}return!0}var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=e.contacts,s=i.api,o=i.utils,u={},a=function(e){return e.emailField&&e.emailField.value?e.emailField.value:e.id},f=function(e,t){for(var n=0;n<t.length;n++)e.push(t[n]);return e},l=function(){var e=o.getSortedFlatContacts(),t=function(e,t){var n=[];return e.user&&n.push(e.user.charAt(t).toLowerCase()),e.firstname&&n.push(e.firstname.charAt(t).toLowerCase()),e.lastname&&n.push(e.lastname.charAt(t).toLowerCase()),e.nickname&&n.push(e.nickname.charAt(t).toLowerCase()),e.mobileno&&f(n,e.mobileno.toLowerCase()),e.homeno&&f(n,e.homeno.toLowerCase()),e.workno&&f(n,e.workno.toLowerCase()),e.isCategory||e.email&&n.push(e.email.charAt(t).toLowerCase()),n},n=function(e){var t=o.getHigherPrecedenceFieldByType(e,"name");return t?{firstname:t.givenName,lastname:t.familyName,middlename:t.middleName}:{}},r,i,s,l=o.getCategories();for(i in l){var c=l[i],h=0,p=[],d;for(r in c.contacts){var v=o.getContactById(c.contacts[r]),m=o.getFieldsByType(v,"email");m&&m.length&&(h+=1,d=n(v),d.email=m[0].value,p.push(d))}e.push({firstname:c.name,email:[h,"<span style='display:none'>___AC_CAT_ID:",c.id,"</span>"].join(""),id:c.id,count:h,endpoints:p,isCategory:!0})}s={},u=[];for(r in e){var g=e[r];if(!g.email||!g.email.length)continue;var y,b=t(g,0);for(y in b){var w=b[y];u[w]||(u[w]={}),u[w][a(g)]=g}}},c=function(e,t){var n={},r={},i={},s=null,f,l;f=e.filterItems;for(var c=0;c<f.length;c++){var h=f[c],p=h.value.charAt(0).toLowerCase
(),d=u[p];for(l in d){s=d[l];if(!d[l].isCategory||!t)r[l]=d[l]}}for(l in r){var v=r[l];e.filterContact(v)&&!i[v.email]&&(i[v.email]=!0,n[a(v)]=v)}var m=[];for(l in n)m.push(n[l]);return o.sortFlatContacts(m),m};e.on("contacts:api:contactChanged",l),e.on("contacts:api:loaded",l),o.areContactsLoaded()?l():s.load();var p=["mobileno","homeno","workno","firstname","lastname","user","email","nickname"],d=new RegExp("[\\+\\*\\?\\^\\[\\]\\{\\}\\$\\\\/%#~:<>()]","g"),v=new RegExp("[^0-9]","g"),m=new RegExp("[ _\\.\\-@]","g"),g=new RegExp("[ _\\.\\-@][^ _\\.\\-@]","g");h.prototype.fastMatch=function(e){return e=!!e,c(this,e).slice(0,this.match_limit)};var y=/___AC_CAT_ID\:(-?[0-9]+)/;h.prototype.decodeCategory=function(e){var t=y.exec(e);if(t&&t.length>1){var n=o.getCategoryById(t[1]),r=[];for(var i in n.contacts){var s=o.getBasicFlatContacts(o.getContactById(n.contacts[i]));for(var u in s){var f=s[u];if(f.isPrimary){r[a(f)]=f;break}}}return r}return!1},h.prototype.updateFilterItems=function(t){t.length>2048&&(t=t.substring(0,2048)),t=t.replace(d," ");var n=S(t),r,i=e.common.Utils;for(r in n)n.hasOwnProperty(r)&&(n[r]=i.regexpEscape(i.escapeHtml(n[r])));this.filterItems=E(n)},h.fuzzyMatch=function(e,t,n,r){var i=e.length,s=t.length,o=[],u=[],a=[],f,l,c,h,p,d,v,m,g,y,b,w;for(f=0;f<=i;f++)u[f]=f;h=s-n,h>i+r&&(h=i+r),c=0,d="";for(l=0;l<h;l++){m=d,d=t.charAt(l+n).toLowerCase(),c<=0?(g=l+1,a[0]=g,b=g,c=0,p=""):(g=r+1,a[c]=g,b=g,p=e.charAt(f-1).toLowerCase());for(f=c,c=-1;f<i;f++){v=p,p=e.charAt(f).toLowerCase(),p===d?g=u[f]:(g=u[f]+1,y=a[f]+1,g>y&&(g=y),y=u[f+1]+1,g>y&&(g=y),p===m&&v===d&&(y=o[f-1]+1,g>y&&(g=y))),a[f+1]=g,b>g&&(b=g),c===-1&&g<=r&&(f===0&&a[0]<=r?c=0:c=f+1);if(g>a[f]&&g>r)break}if(f===i){if(g===0){u=a,l+=1;break}y=u[i];if(y!==undefined&&y<g)break}if(b>r)return null;o=u,u=a,a=[]}return g=u[i],g===undefined||g>r?null:(w={},w.start=n,w.end=l+n,w.diff=g,w)},h.prototype.filterContact=function(e){delete e.matches;if(this.filterItems.length===0)return!1;this.init_temp_data&&(e._matches={});var t,n;n=this.filterItems.length,t=0;while(t<n){if(!L(this,e,this.filterItems[t],t)){if(t>0){t-=1;continue}return this.del_temp_data&&delete e._matches,!1}t+=1}e.matches={};var r,i,s,o,u,a,f,l,c;i=p.length,r=0;while(r<i){s=p[r],o=e._matches[s];if(o&&o.length>0){for(t=0,n=o.length;t<n;t++)u=o[t],(f=u.match_idx)!==-1?(a=this.filterItems[u.index],c=u.matches[f],l={},l.term=a.value,l.startIndex=c.start,l.endIndex=c.end,e.matches[s]||(e.matches[s]=[]),e.matches[s].push(l),u.match_idx=-1):(f=u.fuzzy_match_idx)!==-1&&(a=this.filterItems[u.index],c=u.fuzzy_matches[f],l={},l.term=a.value,l.startIndex=c.start,l.endIndex=c.end,l.diff=c.diff,e.matches[s]||(e.matches[s]=[]),e.matches[s].push(l),u.fuzzy_match_idx=-1);this.del_temp_data||(o.matches=[])}r+=1}this.del_temp_data&&delete e._matches;for(t=0,n=this.filterItems.length;t<n;t++)this.filterItems[t].match_siIndex=-1;return!0},h.prototype.setConfigValues=function(t,n,r){this.matchType=t,this.init_temp_data=e.Lang.isBoolean(n)?n:!0,this.del_temp_data=e.Lang.isBoolean(r)?r:!0},h.prototype.filterContacts=function(e){var t=!0,n=[];if(this.filterItems.length!==0){this.setConfigValues(1,!0,!t);for(var r in e)typeof e[r].email!="undefined"&&this.filterContact(e[r])&&n.push(e[r])}return n},h.prototype.buildContactsIndex=function(){l()};var A=function(){function s(t){var n=u(t),s;return t.isCategory?s=e.common.Utils.substitute(r,{hilite:n},0,0,0,0,strings):s=e.common.Utils.substitute(i,{hilite:n,id:t.id,email:t.email,emailFieldId:t.emailField.id},0,0,0,0,strings),s}function o(t,n,r,i){var s="";return t||n||r?(s=e.common.Utils.substitute(strings.str_name_format,{given_name:t?t:"",middle_name:n?n:"",family_name:r?r:""}),s=s.replace(/ +(?= )/g,"")):i?s=i:s="",s}function u(t){function x(e,t,n){var r="";switch(t){case"amp":n?r="&"+n+";":r="&";break;case"#39":r="'";break;case"quot":r='"';break;case"lt":r="<";break;case"gt":r=">";break;case"#35":r="#";break;default:r=""}return r}var n=t.matches,r,i,s,u="",f="",l="";if(n&&(n.nickname||n.user||n.firstname||n.lastname||n.mobileno||n.homeno||n.workno||n.email)){var c=e.Lang.isArray(n.nickname)&&n.nickname.length>0?!0:!1,h=e.Lang.isArray(n.firstname)&&n.firstname.length>0?!0:!1,p=e.Lang.isArray(n.lastname)&&n.lastname.length>0?!0:!1,d=e.Lang.isArray(n.email)&&n.email.length>0?!0:!1,v=t.nickname||null,m=t.firstname||null,g=t.lastname||null,y=t.email||null,b=c?a(v,n.nickname):v&&v.length>0?v:null,w=h?a(m,n.firstname):m&&m.length>0?m:null,E=p?a(g,n.lastname):g&&g.length>0?g:null,S=d?a(y,n.email):null;r="",r=o(w,"",E,b),b=c?b:null,w=h?w:null,E=p?E:null,i="",S?i+=S:i+=y,f=r||"",f=e.Lang.trim(f),f!==""&&(NeoConfig.bidi?(s=e.Intl.detectDirection(u.replace(/<\/?b\>/,"")),f="<span data-name dir="+s+">"+f+"</span>"):f="<span data-name>"+f+"</span>"),i.length>0&&(f.length>0&&(f+=" "),f===""?l="<em class='email no-name'"+(t.isCategory?"":" data-email='"+y+"'")+" dir='ltr'>"+i+"</em>":l="<em class='email'"+(t.isCategory?"":" data-email='"+y+"'")+" dir='ltr'>("+i+")</em>")}return l=l.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,x),u=f+l,u}function a(t,n){var r=t,i,s,o,u,a;n.sort(l),s=r.length;for(i=n.length-1;i>=0;i--)o=n[i],NeoConfig.bidi?(u=r.substring(0,o.startIndex),a=r.substring(o.endIndex,s)+r.substring(s),r=u+e.comms.Intl.highlightString(r.substring(o.startIndex,o.endIndex),u,a)+a):r=r.substring(0,o.startIndex)+f(r.substring(o.startIndex,o.endIndex))+r.substring(o.endIndex,s)+r.substring(s),s=o.startIndex;return r=r.substring(0,s)+r.substring(s),r}function f(e){return"<b>"+e+"</b>"}function l(e,t){return typeof e=="object"&&typeof t=="object"&&typeof e.startIndex=="number"&&typeof t.startIndex=="number"?+(e.startIndex-t.startIndex):0}var t='<li role="option"><span class="ac-value">{{hilite}}</span><span data-action="ac-remove-item" data-ac-email-field-id="{{emailFieldId}}" data-ac-id="{{id}}" data-ac-email="{{email}}" class="icon icon-small-close ac-remove-item"></span></li>',n='<li role="option"><span class="ac-value">{{hilite}}</span></li>'
,r=n,i=NeoConfig.enableContactDelete?t:n;return{getItemMarkup:s,hlMatch:a,buildName:o}}();h._test={validateFilterItems:O,validateTempMatchData:M},e.namespace("comms").FilterContacts=h,e.namespace("comms").FilterContactsMarkup=A},"1.0.0",{requires:["contacts-api-utils","contacts-api","common-utils"]});
YUI.add("comms-intl-bidihighlight",function(A){A.mix(A.namespace("comms.Intl"),{_needPrevChar:/[\u0620\u0622-\u063F\u0641-\u064A\u066E\u066F\u0671-\u0673\u0675-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u077F\u07CA-\u07EA]/,_needNextChar:/[\u0620\u0626\u0628\u062A-\u062E\u0633-\u063F\u0641-\u0647\u0649\u064A\u066E\u066F\u0678-\u0687\u069A-\u06BF\u06C1\u06C2\u06CC\u06CE\u06D0\u06D1\u06FA-\u06FC\u06FF\u0712-\u0714\u071A-\u071D\u071F-\u0727\u0729\u072B\u072D\u072E\u074E-\u0758\u075C-\u076A\u076D-\u0770\u0772\u0775-\u0777\u077A-\u077F\u07CA-\u07EA]/,_highlightJoiner:"\u200d",_highlightStartTag:"<b>",_highlightEndTag:"</b>",_initializeBidiHighlightJoiner:function(){},highlightString:function(I,J,G){var K,F,M,D,B,L,C,E,H;E=function(N){return N===""?"":N.charAt(N.length-1);};H=function(N){return N===""?"":N.charAt(0);};if(I.length===0){return"";}L=E(J);C=H(G);K=I.charAt(0);M=I.charAt(I.length-1);F=K.charCodeAt(0);D=M.charCodeAt(0);if(L===""||L.charCodeAt(0)<1568||F<1568){B=this._highlightStartTag+I;}else{if(this._needNextChar.test(L)&&this._needPrevChar.test(K)){B=this._highlightJoiner+this._highlightStartTag+this._highlightJoiner+I;}else{B=this._highlightStartTag+I;}}if(C===""||C.charCodeAt(0)<1568||D<1568){B=B+this._highlightEndTag;}else{if(this._needPrevChar.test(C)&&this._needNextChar.test(M)){B=B+this._highlightJoiner+this._highlightEndTag+this._highlightJoiner;}else{B=B+this._highlightEndTag;}}return B;}});A.comms.Intl._initializeBidiHighlightJoiner();},"1.0.0");YUI.add("ac-widget",function(e){function s(e){var t=null,n=null;return e&&(n=e.one(".ac-value"))&&(t=n.get("text")),t}function o(e){var t=this;e.ac=t._getEventPlugin(e),e.itemNodeToValue?this._nodeToValue=e.itemNodeToValue:this._nodeToValue=s,e.ac&&o.superclass.constructor.apply(t,[e])}var t=e.Lang,n=e.contacts,r=n.utils,i=e.comms;o.NAME="ACWidget",e.extend(o,i.ui.AutoComplete,{bind:function(){o.superclass.bind.apply(this,arguments)},bindUI:function(){o.superclass.bindUI.apply(this,arguments)},_getEventPlugin:function(e){var n=!1,r=t.isUndefined;return!r(e.acNode)&&!r(e.acTarget)&&(n=e.acTarget.plug(i.ui.AutoCompleteEventsPlugin,{alignNode:e.acNode}).ac),n},refresh:function(e){var t=this,n=!1;return n=t._getEventPlugin(e),n?(e.ac=n,t.setAttrs(e)):t},getItemMarkup:function(t){return e.comms.FilterContactsMarkup.getItemMarkup(t)},click:function(t){var n=this,r=n.get("ac");t.halt();if(t.target.hasClass("ac-remove-item")){var s=t.target,o=s.getAttribute("data-ac-id"),u=s.getAttribute("data-ac-email-field-id"),a=s.getAttribute("data-ac-email");e.fire("mt:click",{action:"ac_del",append:{ltxt:n._selectedIndex}}),e.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(e){var t=e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok",btnLabel:strings.str_delete}),n=e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_btn_cancel}),s={hd:strings.str_address_remove_hd,bd:e.common.Utils.substitute(strings.str_contacts_remove_bd,{name:a}),ft:t+n},f={ok:{handler:function(){var t=new i.FilterContacts;e.contacts.api.removeEmail(o,parseInt(u,10),t.buildContactsIndex),r.set("queryValue",""),s={hd:strings.str_address_removed_hd,bd:e.common.Utils.substitute(strings.str_address_removed_bd,{name:a}),ft:e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok","default":"default",btnLabel:strings.str_ok})},e.common.ui.DialogHelper.createCommon(s)}},cancel:{handler:function(){r.set("queryValue","")}}},l=function(){};e.common.ui.DialogHelper.createCommon(s,f,l)})}else{var f;e.fire("mt:click",{action:"ac_select",append:{ltxt:n._selectedIndex}}),f=t.currentTarget.getData("selectedCb");if(f){f.call(t.target,t);return}n._selectedIndex=-1;var l=this._nodeToValue(t.currentTarget);l!==null&&(r.set("queryValue",l),r.get("host").simulate("keydown",{keyCode:13})),n._currentValue=l,r.get("host").focus()}n.hide()},handleEnter:function(e,t){var n=t.get("ac"),s=t._selectedIndex,o,u;e.halt();var a=new i.FilterContacts;if(t.get("data").queryStr!==n.get("queryValue")){a.updateFilterItems(n.get("queryValue"));var f=a.filterContacts(r.getSortedFlatContacts(["firstname","lastname","email"]));t.setAttrs({query:n.get("queryValue"),data:f}).drawMarkUp().setAlign().show()}s!==-1&&(o=t.item(s),o&&(u=this._nodeToValue(o),u!==null&&(n.set("queryValue",u),t._selectedIndex=-1,n.get("host").focus(),t.hide())))},triggerQuery:function(){this.get("ac").fire("ac:query",{value:this.get("ac").get("queryValue")})},isMousedOver:function(){var e=this.get("boundingBox"),t=e&&(e.one("div.ac-results:hover")||e.one("div.ac-results li.over")||e.one("li.yui3-aclist-item-hover"));return!!t},buildName:e.comms.FilterContactsMarkup.buildName}),o.ATTRS={host:{value:null,getter:function(){return this.get("ac").get("host")}},alignNode:{value:null,getter:function(){return this.get("ac").get("alignNode")}}},e.namespace("contacts.ui"),e.contacts.ui.ACWidget=o},"1.0.0",{requires:["overlay","node-event-simulate","comms-ui-autocomplete-plugin","comms-ui-autocomplete","contacts-api-utils","contacts-api","filter-contacts","common-utils","comms-intl-bidihighlight"]});
YUI.add("_shared_module_offscreen_bin_compose",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose={base:'<div id="ac-to-results" class="ac-results"></div><div id="ac-cc-results" class="ac-results"></div><div id="ac-bcc-results" class="ac-results"></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_notification_notifications",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_notification_notifications={base:"{{addlozenge_exceededmax}}{{send_success}}{{send_error}}{{send_abuse}}{{intro}}{{spam_success}}",addlozenge_exceededmax:'<div class="nf-text">{{str_comp_addlozenge_exceededmax}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_success:'<div class="nf-text">{{str_comp_msg_sent}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_error:'<div class="nf-text">{{str_comp_not_sent}} <a href = "#" data-action="retry">{{str_retry}}</a> <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_abuse:'<div class="nf-text">{{str_comp_send_abuse_error}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',intro:'<div class="nf-text">Click <a href = "#" data-action = "view" style="padding:0">here</a> to learn more about your inbox! <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',spam_success:'<div class="nf-text">{{str_modal_spam_investigation}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>'};},"1.0.0");YUI.add("mail-model-compose",function(D){var B=function(){B.superclass.constructor.apply(this,arguments);};var C={oComposeData:null,initializer:function(){this.oComposeData={header:{subject:null,from:null,replyto:null,to:null,cc:null,bcc:null},origin:{action:null,fid:null,oMsg:null,ctxReq:null,forwardAsAttachment:false,errInfo:null},content:null,textcontent:null,attachments:[],spellcheck:{corrections:null,correctionHash:[]},composeActions:[],isRich:null};this.cdoType="compose";},destructor:function(){},updateData:function(G){var E,F={uiUpdate:true};for(E in G){if(E){this.set(E,G[E],F);}}},neas:function(E){return E&&E.length;},_getActionCount:function(){return this.oComposeData.composeActions.length;},_setComposeAction:function(E){var G,F;if(E){if(typeof E==="string"){G=E;}else{G=E.action||"composestart";F=E.timestamp;}F=F||new Date().getTime();this.oComposeData.composeActions.push({action:G,timestamp:F});}},_getComposeAction:function(){var E=this.oComposeData.composeActions.length;return this.oComposeData.composeActions[E];},_getReplyHeader:function(){var E={from:this.oComposeData.header.from,to:this.oComposeData.header.to,cc:this.oComposeData.header.cc,subject:this.oComposeData.header.subject};return E;},_setReplyHeader:function(E){if(E.from){this.oComposeData.header.from=E.from;}if(E.to){this.oComposeData.header.to=E.to;}if(E.cc){this.oComposeData.header.cc=E.cc;}if(E.bcc){this.oComposeData.header.bcc=E.bcc;}if(E.subject){this.oComposeData.header.subject=E.subject;}},_getHeader:function(){return this.oComposeData.header;},_setHeader:function(E){this.oComposeData.header=E;},_getContent:function(){return this.oComposeData.content;},_setContent:function(E){this.oComposeData.content=E;},_getTextContent:function(){return this.oComposeData.textcontent;},_setTextContent:function(E){this.oComposeData.textcontent=E;},_getReplyContent:function(){return this._getContent();},_setReplyContent:function(E){this._setContent(E);},_getTextMode:function(){if(this.oComposeData.isRich!==null){return this.oComposeData.isRich;}else{var F=D.common.persist.UserData.get("userUIPref.useRichText"),E=((F))&&(F!=="plain");this.oComposeData.isRich=E;return E;}},_setTextMode:function(E){this.oComposeData.isRich=E;D.common.persist.UserData.set("userUIPref.useRichText",E?"dynamic":"plain");setTimeout(function(){D.common.persist.UserData.saveOne("userUIPref.useRichText");},10);},_getOrigin:function(){return this.oComposeData.origin;},_setOrigin:function(E){this.oComposeData.origin=E;this.cdoType="compose";if(E.action){this.cdoType+=E.action;}else{this.cdoType+="unkorigin";}},_getOriginError:function(){return this.oComposeData.origin.errInfo;},_setOriginError:function(E){this.oComposeData.origin.errInfo=E;},_addAttachment:function(G){var F=this.oComposeData.attachments.length,E=G&&G.state&&G.state.uploaded||0;G.cdoIndex=F;this.oComposeData.attachments.push(G);this.fire("CDO_ATTACHMENT_ADDED",F,E);},_isAttachmentOversized:function(E){return E.state.failCause==="size";},_addAttachments:function(E){if(E){for(var F=0;F<E.length;F++){this._addAttachment(E[F]);}}},_removeAttachment:function(E){var F=this.oComposeData.attachments[E]||{};F.state=F.state||{};F.state.cancelled=true;this.fire("CDO_ATTACHMENT_DELETED",E);},_removeAllAttachments:function(F){var E=this.oComposeData.attachments;for(var G=0;G<E.length;G++){if(!F||F(E[G])){this._removeAttachment(G);}}this.fire("CDO_ALL_ATTACHMENTS_DELETED");},_updateAttachment:function(E,G){var F=this.oComposeData.attachments[E];for(var H in G){F[H]=G[H];}this.fire("CDO_ATTACHMENT_PROCESSED",E);},_getAttachmentsSize:function(){var I=this.oComposeData.attachments;var E=0;for(var F=0;F<I.length;F++){var H=I[F];var G=H.state||{};var J=H.size||{sampled:0,original:0};if(isNaN(J.original)){J.original=0;}if(isNaN(J.resampled)){J.resampled=0;}if(!G.cancelled){if(G.resampled){E+=J.sampled;}else{E+=J.original;}}}return E;},_getAttachmentsCount:function(E){var J=this.oComposeData.attachments,F=0;for(var G=0;G<J.length;G++){var I=J[G];var H=I.state||{};if(E&&!E(I)){continue;}else{if(!E&&H.cancelled){continue;}}F++;}return F;},_getIsEmpty:function(){var G=this.oComposeData,F=this.oComposeData.header,E=this.neas(F.subject)||this.neas(F.to)||this.neas(F.cc)||this.neas(F.bcc)||(F.replyto!==null)||(G.origin.action!==null)||this.neas(G.attachments);return(!E);},_getAttachments:function(){return this.oComposeData.attachments;},_setSpellCheckCorrections:function(E){this.oComposeData.spellcheck.corrections=E;},_getSpellCheckCorrections:function(){return this.oComposeData.spellcheck.corrections;},_setSpellCheckCorrectionHash:function(E){this.oComposeData.spellcheck.correctionHash=E;},_getSpellCheckCorrectionHash:function(){return this.oComposeData.spellcheck.correctionHash;}};D.extend(B,D.Base,C,{NAME:"composeModel",ATTRS:{header:{setter:C._setHeader,getter:C._getHeader},replyheader:{setter:C._setReplyHeader,getter:C._getReplyHeader},content:{setter:C._setContent,getter:C._getContent},textcontent:{setter:C._setTextContent,getter:C._getTextContent},replycontent:{setter:C._setReplyContent,getter:C._getReplyContent},isRichText:{setter:C._setTextMode,getter:C._getTextMode},origin:{setter:C._setOrigin,getter:C._getOrigin},originerror:{setter:C._setOriginError,getter:C._getOriginError},attachments:{getter:C._getAttachments},attachmentsSize:{getter:C._getAttachmentsSize},attachmentsCount:{getter:C._getAttachmentsCount},spellcheckcorrections:{setter:C._setSpellCheckCorrections,getter:C._getSpellCheckCorrections},spellcheckcorrectionhash:{setter:C._setSpellCheckCorrectionHash,getter:C._getSpellCheckCorrectionHash},actionCount:{value:0,getter:C._getActionCount},composeAction:{value:"",setter:C._setComposeAction,getter:C._getComposeAction},antivirus:{value:0},prePopulated:{value:false},saveaction:{}}});var A=function(){var G=this;var F=0;function E(I){var H=new B();H.isDirty=false;H.isDraft=I;H.cdoCount=F;F++;return H;}D.mix(G,{createModel:E});};D.namespace("mail.model");D.mail.model.ComposeModel=B;D.mail.model.ComposeModelFactory=new A();
},"1.0.0",{requires:["base","common-persist-user-data"]});YUI.add("mail-model-send",function(D){var C=function(){C.superclass.constructor.apply(this,arguments);};var B={oSendData:null,initializer:function(){this.oSendData={cascade:{message:{subject:null,from:null,to:null,cc:null,bcc:null,replyto:{name:null,email:null},simplebody:{html:null,text:null,attachment:null}}},origin:{fid:null,oMsg:null,action:null},draftMID:null,cid:null,requestState:null,requestId:0};},destructor:function(){},reset:function(){delete this.oSendData;this.initializer();},_setHeader:function(F){for(var E in F){if(E){this.oSendData.cascade.message[E]=F[E];}}},_setContentHTML:function(E){this.oSendData.cascade.message.simplebody.html=E;},_setContentText:function(E){this.oSendData.cascade.message.simplebody.text=E;},_setAttachments:function(E){this.oSendData.cascade.message.simplebody.attachment=E;},_setOrigin:function(E){this.oSendData.origin=E;if(E.action&&E.action!=="edit"&&E.fid&&E.oMsg&&E.oMsg&&E.oMsg.mid){this.oSendData.cascade.messageReference={fid:E.fid,mid:E.oMsg.mid,replied:E.action==="reply_all"||E.action==="reply_sender",forwarded:E.action==="forward"};}},_getOrigin:function(){return this.oSendData.origin;},_setDraftMID:function(E){this.oSendData.draftMID=E;},_getDraftMID:function(){return this.oSendData.draftMID;},_setCaptcha:function(F){if(!this.oSendData.cascade.headers){this.oSendData.cascade.headers={};}for(var E in F){if(E){this.oSendData.cascade.headers[E]=F[E];}}},_getRecipients:function(){return{to:this.oSendData.cascade.message.to,cc:this.oSendData.cascade.message.cc,bcc:this.oSendData.cascade.message.bcc};},_getCascade:function(){return this.oSendData.cascade;},_setCID:function(E){this.oSendData.cid=E;},_getCID:function(){return this.oSendData.cid;},_getRequestState:function(){return this.oSendData.requestState;},_setRequestState:function(E){this.oSendData.requestState=E;},_getRequestId:function(){return this.oSendData.requestId;},_setRequestId:function(E){this.oSendData.requestId=E;}};D.extend(C,D.Base,B,{NAME:"sendModel",ATTRS:{header:{setter:B._setHeader},contenthtml:{setter:B._setContentHTML},contenttext:{setter:B._setContentText},attachments:{setter:B._setAttachments},origin:{setter:B._setOrigin,getter:B._getOrigin},draftMID:{setter:B._setDraftMID,getter:B._getDraftMID},captcha:{setter:B._setCaptcha},recipients:{getter:B._getRecipients},cascade:{getter:B._getCascade},sendaction:{},disableaddcontact:{},cid:{setter:B._setCID,getter:B._getCID},requestState:{setter:B._setRequestState,getter:B._getRequestState},requestId:{setter:B._setRequestId,getter:B._getRequestId}}});var A=function(){var F=this;function E(){var G=new C();return G;}D.mix(F,{createModel:E});};D.namespace("mail.model");D.mail.model.SendModel=C;D.mail.model.SendModelFactory=new A();},"1.0.0",{requires:["base"]});YUI.add("mail-controller-compose",function(e){function x(){return n.createModel()}function T(){}function N(){}function C(t){var n,r=F(p.get("userSendPref.defaultID"));r&&(n=e.mail.Controller.Compose.injectSignature(t.get("content"),t.get("isRichText"),r),n&&t.set("content",n))}function k(t){e.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(e){var n={sdo:_(t.cdo,null,{draftMID:t.mid},!0),auto:t.auto||null,silent:t.silent||null,mid:t.mid},r;t.cdo&&t.cdo.appid&&(n.appid=t.cdo.appid),t.cdo&&(r=t.cdo.get("origin"),r&&(n.cid=r.oMsg&&r.oMsg.cid)),n.action=t.cdo.cdoType+"_"+t.cdo.cdoCount+"_savedraft",t.cdo.set("composeAction",n.action),n.actionCount=t.cdo.get("actionCount"),e.mail.Controller.SendConfirm.saveMessage(n,function(e,r,i){t.cdo.set("saveaction",{mid:e,auto:n.auto,state:r,isMailboxBusy:i})})})}function L(e,t){var n={textConvert:!0};e.set("isRichText",!1),e.set("content",t,n)}function A(e){e.set("isRichText",!0)}function O(t,n){p.set(t,n),setTimeout(function(){e.common.persist.UserData.saveOne(t)},10)}function M(t,n,r,i){e.Array.each(t,function(e){if(e.uploadState!=="success")return;var t=e.original;if(!t||!t.mid||r){n.push({attachment:"upload://"+e.diskfilename,disposition:"attachment"});return}n.push({attachment:tt(t.fid,t.mid?t.mid:i,t.partId,t.tnef),disposition:"attachment"})})}function _(t,n,r,i){var s=t.get("header"),o=t.get("origin"),u=t.get("content"),a=t.get("textcontent"),f=t.get("isRichText"),l=[],c;return NeoConfig.useAttComposerTT&&M(t.attachments.getAll(!1,!0),l,t.get("passive"),r?r.draftMID:null),c={subject:s.subj||s.subject,from:s.from,to:s.to,cc:s.cc,bcc:s.bcc,replyto:{name:s.from.name,email:yt(s.from.email)}},bt(o,c),n?n.reset():n=e.mail.model.SendModelFactory.createModel(),n.set("header",c),n.set("contenttext",a),n.set("attachments",l),f&&n.set("contenthtml",u),i&&!!o&&o.action&&n.set("origin",o),r&&(r.draftMID&&n.set("draftMID",r.draftMID),r.cid&&n.set("cid",r.cid)),n}function D(t,n,r,i){var o=t.get("origin");if(o.action&&o.fid&&o.oMsg){o.ctxReq&&e.mail.Controller.Messages&&s.abort(o.ctxReq);var u,a=n?{truncateAt:null,midRequest:{blockImages:"none"}}:{truncateAt:null},f={success:function(){P.apply(this,arguments),i&&i()},failure:function(){H.apply(this,arguments)},args:{cdo:t,isDraft:n,stopwatch:r}};u={fid:o.fid,msg:o.oMsg,cachekey:"Prime",ovparams:a},r&&!r.CMGStart&&(r.CMGStart=new Date),NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[u.msg],sourceFid:u.fid,filter:a,success:function(e){f.success(e[0],f)},failure:f.failure}):e.use("mail-controller-messages",function(){o.ctxReq=e.mail.Controller.Messages.get(u,f),t.set("origin",o)})}}function P(e,t){var n=t.args.cdo,r=n.get("origin"),i=t.args.stopwatch,s={};e.mid?(i&&(i.CMGEnd||(i.CMGEnd=new Date,t.respProps&&(i.wasCached=t.respProps.wasCached)),i.CMGSize=e.body.display.length),r.oMsg=e,r.ctxReq=null,r.errInfo="ok",e.yivPrefixNumber&&(s={yqtdPrefix:e.yivPrefixNumber}),B(n,t.args.isDraft,s)):H({msg:this.message},t)}function H(e,t){var n=t.args.cdo;n.set("originerror",e)}function B(t,n,r){var i,s,o;I(t),i=q(t,n),NeoConfig.useAttComposerTT&&(o=0,e.Array.each(i.attachments,function(e){typeof t.attach_map=="undefined"&&(t.attach_map=[]),t.attach_map[o]&&t.attachments.get(t.attach_map[o])?t.get("origin").action!=="forward"&&(t.attachments.del(t.attach_map[o]),t.attach_map.splice(o,1)):(s=t.attachments.add(e),t.attach_map.push(s)),o++}));if(!n){var u=t.get("origin"),a=at(u),f=F(a.email),l,c=!0;r&&r.noSig&&(c=!1),f&&c&&(l=e.mail.Controller.Compose.injectSignature(null,t.get("isRichText"),f),i.prolog=strings.str_cfg_tog_insert_signature_bottom?i.prolog+l:l+i.prolog)}r&&r.yqtdPrefix&&t.set("yqtdPrefix",r.yqtdPrefix),t.set("replyheader",i.header),t.set("replycontent",i.prolog)}function j(t){var n,r,i;n=q(t,!1),NeoConfig.useAttComposerTT&&(i=0,e.Array.each(n.attachments,function(e){typeof t.attach_map=="undefined"&&(t.attach_map=[]),t.attach_map[i]&&t.attachments.get(t.attach_map[i])?t.get("origin").action!=="forward"&&(t.attachments.del(t.attach_map[i]),t.attach_map.splice(i,1)):(r=t.attachments.add(e),t.attach_map.push(r)),i++}))}function F(e){var t=p.get("userSendPref"),n,r,i;if(strings.str_cfg_tog_use_accountbased_signature&&e&&e!==t.defaultFromAddress){r=p.get("aliases.alias");for(var s=0;s<r.length;++s){i=r[s];if(e===i.address){n={text:i.signature,isRich:i.signatureType==="d",isActive:i.addSignature};break}}}else n={text:t.signatureText,isRich:t.richTextSignature==="plainhtml"||t.richTextSignature==="dhtml",isActive:t.signatureActive};return n&&n.isActive&&n.text?n:null}function I(t){e.use("mail-controller-messages-ops",function(){var n=t.get("origin"),r={},i=new Array(n.oMsg);r.read=1,e.mail.Controller.Messages.flag({fid:n.fid,mid:i,setFlags:r},{failure:function(){},suppressCodes:["Client.MessageIdsNotFound"]})})}function q(e,t){var n=e.get("origin"),r={prolog:null,header:null,attachments:null};if(t)return r.header=n.oMsg.header,r.prolog=et(n.oMsg.body.display),r.attachments=W(n),r;r.header=U(n);if(n.forwardAsAttachment)return r.prolog="",r.attachments=X(n),r;r.prolog=R(e,n);if(n.action==="forward"||n.action==="reply_sender"||n.action==="reply_all")r.attachments=W(n);return r}function R(e,t){var n=J(e),r=Z(t),i;return NeoConfig.hasConv?i=l(n||r?h.reply_rich_short:h.reply_plain_short,t,S,e,strings):i=l(n||r?h.reply_rich:h.reply_plain,t,S,e,strings),!n&&r&&e.set("isRichText",!0),i}function U(t){var n,r=t.action==="reply_sender"||t.action==="reply_all",i={from:null,to:null,cc:null,subject:null},s=[],o=[],u=t.fid==="Sent"||t.fid==="%40S%40Search"&&t.oMsg.sourceFolderInfo.fid==="Sent";return i.from=r?at(t):ut(),r&&(n=dt(t.oMsg),t.action==="reply_sender"?(o.push(n),i.to=o):(u||o.push(n),s.push(n),s.push(i.from),i.to=o.concat(mt(t.oMsg.header.to,s)),i.cc=mt(t.oMsg.header.cc,s),u&&i.to.length===0&&i.cc.length===0&&(i.to=t.oMsg.header.to,i.to.length===0&&(i.cc=t.oMsg.header.cc)))),i.subject=f(z(t)),u||e.Array.each(t.oMsg.header.replyto||
[],function(t){var n=i.to;n&&e.Array.indexOf(n,t)<0&&e.Array.indexOf(o,t)<0&&i.to.push(t)}),i}function z(e){var t=e.action==="reply_sender"||e.action==="reply_all"||e.action==="forward";return t?(e.oMsg.header.subject===strings["str_msg-view_no_subject"]&&(e.oMsg.header.subject=""),l(h.subject.replace(/\s+$/,""),e,E,null,strings)):e.oMsg.header.subject}function W(t){var n=t.oMsg.attachments,r=[];return e.Array.each(n,function(e){(t.action==="forward"||t.action==="edit"||(t.action==="reply_sender"||t.action==="reply_all")&&(e.referencedInline===!0||e.disposition==="inline"))&&r.push(V(e,t))}),r}function X(e){var t=strings.str_comp_nosubject;return e.oMsg.header.subject.length>0&&(t=e.oMsg.header.subject.substring(0,240)),NeoConfig.useAttComposerTT?[{filename:t+".eml",uploadState:"success",size:e.oMsg.header.size,original:{fid:e.fid,mid:e.oMsg.mid,partId:"",tnef:"",disposition:"attachment",displayable:!1}}]:[{filename:t+".eml",state:{uploaded:!0},size:{original:e.oMsg.header.size},original:{partId:"",mid:e.oMsg.mid,fid:e.fid,tnef:""}}]}function V(e,t){return NeoConfig.useAttComposerTT?{filename:e.filename,size:e.size,mimetype:e.type+"/"+e.subtype,thumbnail:e.thumbnailurl,type:e.type,referencedInline:e.referencedInline,uploadState:"success",original:{fid:t.fid,mid:t.oMsg.mid,partId:e.partId||"",tnef:e.tnef,displayable:e.isDisplayable,disposition:e.disposition}}:{filename:e.filename,mimetype:e.type+"/"+e.subtype,size:{original:e.size},state:{uploaded:!0},disposition:e.disposition,isDisplayable:e.isDisplayable,original:{partId:e.partId||"",mid:t.oMsg.mid,fid:t.fid,tnef:e.tnefId}}}function $(e,t,n){var r=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig,i,s,o,u=!0;return e.get("nodeType")===9?o=e.one("body"):o=e,i=n,s=this.convertToPlain(o,!1,u),i=i.replace("<!-- ORIGINAL -->",""),i=i.replace(r,""),s=s.replace(r,""),i=i.replace(/<br\b([^>]*?)\bclass="yui-cursor"(.*?)>/ig,""),i=i.replace(/<p\b([^>]*)>/ig,"<div$1>"),i=i.replace(/<\/p\b[^>]*>/ig,"</div>"),i=["<html><body>",'<div style="color:',t.foreColor,"; background-color:",t.backColor,"; font-family:",t.fontFamily,";font-size:",t.fontSize,'">',i,"</div></body></html>"].join(""),{html:i,text:s}}function J(e){return!NeoConfig.low_bandwidth&&e.get("isRichText")}function K(){return strings.str_cfg_tog_compose_autoattach_prefix||Q(m)==="yes"}function Q(e){return d.get("cg.pref."+e)}function G(e){var t=v+e.replace(/\r?\n|(.{0,80})\r?\n|(.{1,80})$|(.{1,80} +)/mg,"$1$2$3<br />"+v);return t=t.replace(/(^[\>|(?:&gt;)]+|\<br \/\>(?:\>|\&gt\;)*)/mgi,"$1 "),t.substring(0,t.length-v.length)}function Y(t,n){var r,i=document.createElement("div");return i.innerHTML=t,r=e.mail.Controller.Compose.convertGuts(i),n||(r=a(r)),i.innerHTML="",i=null,r}function Z(e){var t=e.oMsg.part;if(t)for(var n=0;n<t.length;n++)if(t[n].subtype==="html")return!0;return!1}function et(e){return e&&(e=e.replace(y,"$1"),e=e.replace(b,"$1"),e=e.replace(w,"")),e}function tt(e,t,n,r){return typeof r!="undefined"&&r!==""&&r!=="null"?["message:/",encodeURIComponent(e),encodeURIComponent(t),n,r].join("/"):["message:/",encodeURIComponent(e),encodeURIComponent(t),n].join("/")}function nt(e){var t,n;return e?{fontFamily:t=it(!0),fontSize:n=st(!0)}:rt()}function rt(){var e,t;return t=p.get("userUIPref.composeFontFamily"),t=t.split("|"),t.length>1?t=t[0]:(t=it(!1),p.set("userUIPref.composeFontFamily",t+"|1")),t||(t=it(!1),p.set("userUIPref.composeFontFamily",t+"|1")),e=p.get("userUIPref.composeFontSize"),e?e+="px":e=st(!1),{fontFamily:t,fontSize:e}}function it(e){return e?ot()[0]:strings.str_rte_default_font}function st(e){if(e){var t=ot();return""+parseInt(t[1],10)+t[2]}return parseInt(strings.str_rte_default_font_size,10)+"px"}function ot(){return e.mail.ui.common.Fonts.getPlainTextOption()||[strings.str_comp_plaintext_default_font,strings.str_comp_plaintext_default_font_size,"px"]}function ut(){var e,t,n,r=p.get("userSendPref.defaultFromAddress"),i=p.get("userSendPref.defaultFromName"),s=p.get("externalAccounts")||{},o=s.extAccountsTotal||0,u=s.extAccount||[];if(o>0)for(e=0;e<o;e++)t=u[e],n=t.address,t.address&&t.address.length>0&&t.isDefault&&(r=t.address,i=t.fromName,i===""&&(i=p.get("userSendPref.defaultFromName")));return{name:i,email:r}}function at(e){var t,n={email:p.get("userSendPref.defaultFromAddress"),name:p.get("userSendPref.defaultFromName")};return e.fid==="Sent"?dt(e.oMsg):(t=ft(e.oMsg.header.to,n),t||(t=ft(e.oMsg.header.cc,n)),t||(t=ft(e.oMsg.header.bcc,n)),t||(t=ut()),t)}function ft(t,n){var r,i=null,s={},o=(p.get("externalAccounts")||{}).extAccount||[],u=(p.get("aliases")||{}).alias||[],a=(p.get("disposableAddresses")||{}).deaName||[],f=function(e){if(e&&e.address&&e.address===s.email)return i={email:e.address,name:e.fromName},!0};for(r=0;!i&&r<t.length;r++){s=t[r];if(s.email===n.email)return n;e.Array.some([].concat(o,u,a),f)}return i}function lt(e,t){var n=0,r=t.length,i=new Array(r);while(r--)i[n]=e(t[n++]);return i}function ct(e){return e.name?e.name:e.email}function ht(t){var n="",r;return NeoConfig.bidi?(t.name&&(r=e.Intl.detectDirection(t.name)==="rtl"?"\u202b":"\u202a",n=pt(t.name)?r+'"'+t.name+'"\u202c':r+t.name+"\u202c"),t.email&&(n+=n.length?" \u202a<"+t.email+">\u202c":t.email)):(t.name&&(n=pt(t.name)?'"'+t.name+'"':t.name),t.email&&(n+=n.length?" <"+t.email+">":t.email)),n}function pt(e){return e.match(/[;,"<>@]/)!==null}function dt(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function vt(e,t,n){return e=mt(e,n),lt(t?ht:ct,e).join("; ")}function mt(e,t){return gt(e,t)}function gt(e,t){var n,r,i,s=[],o;for(n=0;n<e.length;n++){o=!1;if(!e[n].email)continue;i=e[n].email.toLowerCase();if(t)for(r=0;r<t.length;r++)if(i===t[r].email.toLowerCase()){o=!0;break}o||(s.push({name:e[n].name,email:e[n].email}),t&&t.push(e[n]))}return s}function yt(t){var n=t,r=p.get("userSendPref.defaultFromAddress"),i=function(e){e&&e.address&&e.address===t&&(n=e.replyTo||e.address)};return r===t?n=p.get("userSendPref.defaultReplyToAddress")||r:
e.Array.each([].concat((p.get("externalAccounts")||{}).extAccount||[],(p.get("aliases")||{}).alias||[],(p.get("disposableAddresses")||{}).deaName||[]),i),n=e.Lang.trim(n),n?n:t}function bt(e,t){if(e.oMsg&&e.oMsg.header){var n=e.oMsg.header;t.inreplyto=n.messageId||n.inReplyTo,t.references="",n.references?t.references=n.references+" ":n.inReplyTo&&(t.references=n.inReplyTo+" "),t.references+=n.messageId}}function wt(){return new RegExp("(^re:\\s?)|(^fw:\\s?)|(^"+strings.str_comp_reply_spRE+"\\s?)|"+"(^"+strings.str_comp_reply_spFWD+"\\s?)","i")}function Et(t,n){var r=e.mail.Controller.Compose.convertHTMLToPlain,i=r(t),s=r(n),o=i.replace(s,""),u=["see attached","see attachment","find the included","see included","is attached","attached is","are attached","please find attached","attached are","attached to this email","attached to this message","I'm attaching","I am attaching","find attached","find the attached","find included","attached file","see the attached","see attachments","attached files","I've attached","I have attached"];for(var a in u)if(o.indexOf(u[a])!=="-1")return u[a];return!1}var t=e.mail,n=t.model.ComposeModelFactory,r=t.Controller,i=r.extend("Compose"),s=t.Controller.Messages,o=e.common,u=o.Utils,a=u.escapeHtml,f=u.unescapeHtml,l=u.substitute,c=e.ui.Templates,h=c._shared_module_compose_reply,p=o.persist.UserData,d=t.persist.MetaData,v=">",m="general.prefixreplyquotetype",g=null,y=new RegExp(/<a[^>]*href="([^\s]*?)"[^>]*>[\s]*<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>http(([\s]|[^\s])*?)<\/span>[\s]*<\/a>/ig),b=new RegExp(/<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>(([\s]|[^\s])*?)<\/span>/ig),w=new RegExp(/<script[^>]*[^>]*>(([\s]|[^\s])*?)<\/script>/ig),E={subject_prefix:function(e){return strings[e.action==="forward"?"str_comp_reply_spFWD":"str_comp_reply_spRE"]},subject_data:function(e){return g||(g=wt()),e.oMsg.header.subject.replace(g,"")}},S={quotetext_header:function(){return K()?h.qthdr:""},quotetext_footer:function(){return K()?h.qtftr:""},fontfamily:function(){return rt().fontFamily},fontsize:function(){return rt().fontSize},deffontfamily:function(){return it(!1)},deffontsize:function(){return st(!1)},from_data:function(e){return a(f(ht(dt(e.oMsg,!0))))},to_data:function(e){return a(f(vt(e.oMsg.header.to,!0)))},cchdr:function(e){return e.oMsg.header.cc.length>0?l(h.cchdr,e,S,null,strings):""},cc_data:function(e){return a(f(vt(e.oMsg.header.cc,!0)))},date_data:function(e){return a(u.dateFormatter(new Date(e.oMsg.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n))},subject_data:function(e){return a(f(e.oMsg.header.subject))},reply_rich_body:function(e){return et(e.oMsg.body.display)},forward_rich_body:function(e){return e.action==="forward"?h.forward_rich_body:!1},reply_rich_header:function(e){var t=NeoConfig.hasConv?"":h.rulerHeader,n=e.action==="forward"?h.fwdhdr:t;return l(n,null,null,null,strings)},reply_plain_body:function(e){var t=et(e.oMsg.body.display);if(K()){try{t=Y(t)}catch(n){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composectrl:1",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composectrl:1")}t=G(t)}return t},reply_plain_header:function(e){return strings[e.action==="forward"?"str_comp_reply_fwdHeader":"str_comp_reply_origHeader"]},quoteprefix:function(){return K()?v+" ":""},headerDir:function(){return NeoConfig.isRTL?' dir="rtl" ':' dir="ltr" '}};e.mix(i,{createCDO:x,insertSignature:C,applyStationery:T,addAttachment:N,assembleSendBody:$,transformSend:_,save:k,savePref:O,toPlainText:L,toRichText:A,fetchOrigin:D,getDefaultFontInfo:nt,getStyleFontFamily:it,getStyleFontSize:st,getDefaultFromAddress:ut,seedSubject:z,htmlToText:Y,getSignature:F,convertAttachmentData:W,attachAlert:Et,updateAttachments:j,getBody:R,getHeaderContent:U,transformOrigin:q,updateFromOrigin:B},!0)},"3.0.0",{requires:["mail-controller-base","mail-model-compose","mail-model-send","common-persist-user-data","mail-persist-meta-data","mail-ui-common-fonts","_shared_module_compose_reply"]});
YUI.add("mail-controller-compose-text",function(A){A.namespace("mail.Controller");var J=A.common.Utils,O={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};function B(S,T,R){var U=S.cloneNode(true),Q=A.Node.getDOMNode(U),P=F(Q);if(T){P=I(P,true);}if(R){P=E(P);}return P;}function L(R,T){var P=A.Node.create("<div>"+R+"</div>"),S=A.Node.getDOMNode(P),Q=F(S);if(T){Q=I(Q);}return Q;}function F(Q){var P=A.UA.ie;if(!P){K(Q);}else{Q.innerHTML=Q.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return M(Q,false,"").replace(/\n[\s\xA0]+$/,"");}function E(P){return P.replace(/\xA0/g," ");}function M(S,W,X){var Z=A.one(S),U,a;if(Z.hasClass("compose-ignore")){return"";}else{if(S.nodeType===1||S.nodeType===11){var R=S.tagName;if(A.UA.ie&&S.tagName==="DIV"&&S.getAttribute("class")&&S.getAttribute("class")!=null&&S.getAttribute("class").indexOf("hr")!==-1){R="HR";}switch(R){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":a=S.previousSibling;return(G(a)?"":"\n")+X+"________________________________\n"+X;case"BR":return"\n"+X;case"BLOCKQUOTE":X+=">";default:U=[];var P=S.firstChild;var V=0;if(R==="SPAN"&&A.one(S).hasClass("Apple-tab-span")){return A.one(S).get("text");}while(P!==null){var Y=M(P,P.tagName==="PRE",X);if(P.nodeType===1){if(H(P)==="block"&&U.length>0&&P.tagName!=="TD"){var T=Y.match(/^[ \t\r\n\v\f]*$/);if(!T||P.tagName==="LI"){U.push("\n"+X);}}switch(P.tagName){case"LI":V++;U.push("\t"+(P.parentNode.tagName==="OL"?V+".":"*")+" ");break;}}if(Y){U.push(Y);}if(P.nodeType===1){switch(P.tagName){case"TD":U.push(" ");break;}}P=P.nextSibling;}return U.join("");}}else{if(S.nodeType===3){U=S.nodeValue;if(!W){a=S.previousSibling;var Q=a?H(a):null;U=G(a)?U:U.replace(/\n[ \t\r\n\v\f]+/g," ");if(a===null||G(a)){U=U.replace(/^[ \t\r\n\v\f]+/,"");}else{if(Q==="block"){U=U.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(Q==="inline"){U=U.replace(/^[ \t\r\n\v\f]+/," ");}}}U=U.replace(/[ \t\r\n\v\f]+$/," ");}return U;}else{return"";}}}}function G(P){if(P===null||P.nodeType!==1){return false;}return P.tagName==="BR";}function H(P){if(P===null||P.nodeType!==1){return null;}if(P.style.display){if(P.style.display==="block"){return"block";}else{if(P.style.display==="inline"){return"inline";}}}return O[P.tagName.toLowerCase()]?"block":"inline";}function K(S){if(S.nodeType===1||S.nodeType===11){var Q=S.firstChild;while(Q!==null){var U=Q.nextSibling;K(Q);Q=U;}}else{if(S.nodeType===3){var R=S.nodeValue;if(R.match(/^[ \t\r\n\v\f]*$/)){var P=S.previousSibling;var T=P?H(P):"inline";if(T==="inline"&&!G(P)){S.nodeValue=S.nodeValue.replace(/\n.*/," ");}else{S.parentNode.removeChild(S);}}}}}function I(Q,P){Q=J.escapeHtml(Q);if(P){Q=Q.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");Q=Q.replace(/( ){2}/g,"&nbsp;&nbsp;");}Q=Q.replace(/\n/ig,"<br />");return Q;}function C(U,R,S){var P,T=S&&S.isRich,Q,W=S&&S.text;if(!W){return"";}W=N(W,T);if(!T){W=D(W);}else{if(!R){try{Q="<br>";W=W.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);W=W.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);W=W.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,Q);W=W.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,Q);W=W.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,Q);W=W.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,Q);W=W.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");W=W.replace(/<\/p>/gi,Q);W=W.replace(/(<hr\s*>)/gi,Q+"________________________________"+Q);W=L(W,true);}catch(V){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composetext:1",V,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composetext:1");}}}U=U||"";P=U!="";if(W!=""){if(A.UA.ie||A.UA.webkit){if(P){U=U+"<div></div><div>&nbsp;</div>"+W;}else{U="<div></div><div>&nbsp;</div>"+W+U;}}else{if(P){U=U+"<div>&nbsp;</div>"+W;}else{U="<div>&nbsp;</div>"+W+U;}}}return U;}function N(Q,P){if(Q!=null){if(!P){Q=Q.replace(/<vbr>|\n/gi,"<br />");return"<div>"+Q+"</div>";}else{Q=Q.replace(/<vbr>/gi,"");}}return Q||"";}function D(R){var Q,P;R=A.common.Utils.unescapeHtml(R);R=R.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");R=R.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");R=R.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");R=R.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");R=R.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");R=R.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");R=R.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");R=R.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");R=R.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");R=R.replace(/<\/p>/gi,"endptag");Q=R.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");Q=Q.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");Q=Q.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");R=Q.replace(/<\/div>/gi,"endptag");P=A.common.Utils.escapeHtml(R);P=P.replace(/brtag/g,"<br />");P=P.replace(/ltrstartptag/g,"<div dir='ltr'>");P=P.replace(/rtlstartptag/g,"<div dir='rtl'>");P=P.replace(/startptag/g,"<div>");P=P.replace(/endptag/g,"</div>");P=P.replace(/pblanklinep/g,"<br/><br/>");return P;}A.mix(A.mail.Controller.Compose,{convertToPlain:B,convertHTMLToPlain:L,convertGuts:F,injectSignature:C});},"1.0.0",{requires:["common-persist-user-data","mail-controller-compose"]});YUI.add("mail-models-validators-send",function(A){A.namespace("mail.Models.Validators").send={MAX_NUM_OF_RECIPIENTS:100,YNC_ADDR_WHITELIST:["sgproxy_test_10@localhost","sgproxy_test_20@localhost","sgproxy_test_40@localhost","sgproxy_test_50@localhost"],validateAddress:function(C){var E=Array.prototype.concat(C.to,C.cc,C.bcc),F=E.length,D,B={valid:true};for(D=0;D<F;D++){if(!A.comms.Utils.isValidEmail(E[D].email)){if(this.YNC_ADDR_WHITELIST.indexOf(E[D].email)!==-1){continue;}B.valid=false;B.invalidAddress=E[D].email;return B;}}return B;},validatePresenceOfRecipients:function(C){var B={valid:true};if(C.to.length<1&&C.cc.length<1&&C.bcc.length<1){B.valid=false;}return B;},validateNotUploadingAttachments:function(B){return({valid:!B.isUploadingAttachments()});},validateCleanAttachments:function(B){var C=0;var D=0;A.each(B.attachments,function(E){if(E.state()==="infected"){C++;}else{if(E.state()==="failed"){D++;}}});return{valid:(C+D===0),cntInfected:C,cntFailed:D};},validatePresenceOfContent:function(C){var D=A.Lang.trim(C.subject),B={valid:true};if(D.length<1){B.valid=false;}return B;},validateNumberOfRecipients:function(D){var B={valid:true},C=D.to.length+D.cc.length+D.bcc.length;if(C>this.MAX_NUM_OF_RECIPIENTS){B.valid=false;}return B;},validateSpame:function(C){var B={valid:true};if(C.isSpame()){B.valid=false;}return B;},validateCaptcha:function(C){var B={valid:true};if(C.isRejectedOnCaptcha()&&!C.captchaAnswer){B.valid=false;}return B;},checkForAttachment:function(C){var B={valid:true},E=A.common.Utils.getVal(C,"origin.action"),D;if(E==="edit"&&A.common.Utils.getVal(C,"attachments").length===0){D=C.makeInReplyTo();if(A.common.Utils.getVal(D,"replied")){E="reply_sender";}}if(A.common.Utils.getVal(C,"origin.parentMsg.flags.hasAttachment")&&(E==="reply_all"||E==="reply_sender")){B.valid=false;}return B;}};},"1.0.0",{requires:["comms-utils","common-utils"]});YUI.add("mail-ui-mailcompose-base-header-v3",function(e){function j(e){var t=this;t.composeView.attView&&t.composeView.attView.reposAttachObj(e)}function F(){e.ACWidgetInst&&e.ACWidgetInst.hide()}function I(e){e.removeAttribute("aria-owns"),e.removeAttribute("aria-activedescendant")}function q(e){e.removeAttribute("aria-describedby")}function R(){var t=e.ACWidgetInst;t&&t.get("ac").get("host").set("aria-owns",t.get("contentBox").generateID())}function U(e){var t=e.ancestor("ul"),n=t.all(".lozenge-static"),r;n.size()>0&&(r=[],n.each(function(e){r.push(e.generateID())})),r?e.set("aria-describedby",r.join(" ")):e.removeAttribute("aria-describedby")}function z(e){var t;t=e.get("value").replace(/([^,; ]+?@[^ ,;]+?\.[a-z]+?>?)[ ;]+([^ ,;])/ig,"$1, $2"),e.set("value",t)}function W(e,t){var n=e.get("value"),r=n.length,i=parseInt(e.ancestor(".ac-input").getStyle("width"),10)-40,s=150,o=17,u=this;t&&(n?(z(e),u._lozengeIt(e)):setTimeout(function(){z(e),u._lozengeIt(e)},500)),r>o?(s+=(r-o)*10,s>i&&(s=i),e.setStyle("width",s+"px")):e.setStyle("width","")}function X(t){var r=!1,i=null,s=null,o=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a=t.replace(/\".*\"/g,"");return!n(a)||a.indexOf("@")<0?{fail:!0,email:t,name:t}:(o.test(t)?(u=t.match(o),s=u[0],i=n(t.replace(s,"")),s=s.substring(1,s.length-1)):s=i=n(t),e.comms.Utils.isValidEmail(s)||(r=!0),{fail:r,email:s,name:i})}function V(e){var t=0,n=0,r=e.length,i=[],s=!1,o=!1;for(n=0;n!==r;n++){var u=e.charAt(n);switch(u){case'"':s=!s;break;case"&":o=!0;break;case";":o&&(o=!1);break;case",":s||(i.push(e.slice(t,n)),t=n+1)}}return t!==n&&i.push(e.slice(t,n)),i}function $(t){var n=t.ancestor("ul"),r=n.all(".hLozenge"),i;r&&(I(t),q(t),r.remove(),e.fire("lozenge:remove"),M&&(i=t.ancestor(".ac-input"),this._toggleHideRecptsBtn(i.get("id"),!1)))}function J(){var t=this,n;if(!t.isLozengeHighlighted)return;n=t.composeView.baseNode.all(".hLozenge.focus"),n.removeClass(S),I(e.all("#to-field, #cc-field, #bcc-field")),t.allLozengesSelected=!1,t.isLozengeHighlighted=!1}function K(e,t){var n=this;n._removeLozengeHighlights(),e.toggleClass(S),n.isLozengeHighlighted=!0;var r=e.one(".lozenge-static").generateID();t.setAttrs({"aria-owns":r,"aria-activedescendant":r})}function Q(e){var t=this,n=e.ancestor("ul"),r=n.all(".hLozenge");r&&(r.addClass(S),t.isLozengeHighlighted=!0),t.allLozengesSelected=!0}function G(e){var t=this,r,i,s;r=e.ancestor(),i=n(e.get("value"));if(!n(i)){e.set("value","");return}i&&i.indexOf('"')>-1?s=V(i):(i.lastIndexOf(",")===i.length-1&&(i=i.substring(0,i.length-1)),s=i.split(/[;,]+/)),t._makeLozenges(s,r),U(e),e.set("value",""),t.checkOtherLozengeBoxes()}function Y(){var t=this,n=t.composeView.baseNode,r,i;n.all("li.hLozenge").size()>100&&(i=new e.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"}),r=d._shared_module_offscreen_bin_notification_notifications.addlozenge_exceededmax,i.on("clickEvent",function(){i.destroy()}),i.notify(l(r,null,null,null,strings),5e3))}function Z(e,t){var r=this,i,s=e.length,o,u,a,f;for(i=0;i<s;i++)u=e[i],n(u),u&&(a=X(u),f=r._createLozenge(a),t.insert(f,t));M&&(o=t.ancestor(".ac-input"),r._toggleHideRecptsBtn(o.get("id"))),r.composeView.resizeRTE(),r._checkRecipientCount(),r.composeView._setDirty(),r.checkOtherLozengeBoxes()}function et(t,n){var r,i,s,o,u=[];P[n]=[];for(i=0;i<t.length;i++)o=t[i],P[n].push(o),u.push(o.email);s=u.join(",");var a={label:l(strings.str_hdr_more_recipients,{num_more_recipients:u.length},0,0,strings),hover:s,state:"normal",data:s,menu:null,edit:!1,copy:!1,parentClass:"group",dataClass:"more_recp more",action:"expand-recpts",valFn:function(){return!0}},f=new e.comms.ui.Lozenge(a);return f.getNode()}function tt(t){var n,r;if(!t)return null;t.name=t.name||t.email;if(strings.str_cfg_tog_compose_enable_nickname){var i=b.getContactsByEmail(t.email),s;i&&(s=b.getFirstFieldValue(i[0],"nickname"),s&&(t.isNN=!0,t.name=s))}n||(n={email:t.email,firstName:t.name||t.email}),t.fail?r=strings.str_comp_error_email_lozenge_attr:r=t.email;var o,u={label:h(t.name),hover:h(r),state:t.fail?"error":"normal",data:t,menu:null,edit:!0,copy:!0,parentClass:"draggable"};o=new e.comms.ui.Lozenge(u);var a=o.getNode();return a.set("role","presentation"),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.validateRecipients([t.email],function(e){e[0].recipient===t.email&&e[0].valid&&a._node.classList.add("lozenge-secure")}),a}function nt(t){var n=t.getData("lozenge"),r=n.data,i=n.error;if(t.hasClass("group"))return;if(strings.str_cfg_tog_compose_enable_nickname&&r.name&&r.isNN){var s=e.contacts.utils,o=s.getContactsByEmail(r.email),u,a;u=s.getFirstFieldValue(o[0],"name"),a=u?u.familyName+" "+u.givenName:"",r.name=a}if(i){this.currentAddress=r.email,this.validAddress=!1;if(!this.allowWhitelist||this.currentField!=="to"||e.mail.Models.Validators.send.YNC_ADDR_WHITELIST.indexOf(r.email)===-1)return}this[this.currentField].push(r)}function rt(){var e=this,t={to:[],cc:[],bcc:[],validAddress:!0,allowWhitelist:NeoConfig.isAMT||!!NeoConfig.isInternal||!!NeoConfig.isInternalIP,currentAddress:"",currentField:""},n,r,i,s,o,u,a,f,l,c,h,p,d;return n=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge"),t.currentField="to",n.each(nt,t),r=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge"),t.currentField="cc",r.each(nt,t),i=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge"),t.currentField="bcc",i.each(nt,t),e.composeView.type&&e.composeView.type==="inlineCompose"?t.from={email:e.composeView.draft.get("header").from.email,name:e.composeView.draft.get("header").from.name}:(f=e.composeView.baseNode.one(".from-select").get("value"),l=f.lastIndexOf("<"),c=f.lastIndexOf(">"),h=f.substring(l+1,c),p=f.substring(0,l-1),t.from={email:h,name:p}),s=e.composeView.baseNode.one(".cm-subject-field"),s?t.subject=s.get("value"):t.subject=e.composeView.draft.get("header").subject,t}function it(t,n,r)
{var i,s,o,u,a,f,c,h=e.mail.ui.PaneUtils,p=n.recipients,d=n.more_recipients,v=n.to_str;if(t)return s=t.to||[],o=t.cc||[],u=t.bcc||[],a=s.concat(o,u),i=a.length,f=function(e){var t={to:h.getName(e),rcpt_id:h.getAddress(e),rcpt_name:h.getName(e)};return t},c=h.createRecipientList(a,p,null,r,f),r!==""&&a.length>r&&(c+=l(d,{num_more_recipients:a.length-r},0,0,strings)),c=l(v,null,null,null,strings)+c,c}function st(e){var t=ft("cc"),n,r,i=this.composeView.baseNode,s=i.one(t.groupNode+" .address-btns");typeof e!="boolean"&&(n=ft("bcc"),r=i.all(t.groupNode+" .hLozenge, "+n.groupNode+" .hLozenge"),e=r.size()>0?!1:!0),s[e?"removeClass":"addClass"]("hidden")}function ot(e,t){var n=ft(e),r=this.composeView.baseNode.one(n.groupNode),i=r.one(".compose-hide-recpts"),s,o,u;typeof t=="undefined"&&(o=r.all(".hLozenge"),u=o.size(),t=u>D),e!=="to"&&this._showHideCcBccOption(t?!1:""),i[t?"removeClass":"addClass"]("hidden")}function ut(e,t){var n=this.composeView,r=ft(e),i=n.baseNode.one(r.groupNode),s=n.baseNode.one(r.node),o=s.ancestor("li"),u=[],a,f,l,c,h,p,d;d=i.one(".hLozenge.group"),d&&d.remove(!0),a=i.all(".hLozenge"),p=a.size(),l=t?!1:D===p?p:_,a.each(function(e,t){l&&t>=l?(e.addClass("hidden"),u.push(e.getData("lozenge").data)):e.removeClass("hidden")}),u.length?(h=et(u,e),o.insert(h,o),this._toggleHideRecptsBtn(e,!1)):p>D&&this._toggleHideRecptsBtn(e,!0),n.resizeRTE()}function at(e,t,n){var r=this.composeView,i=ft(t),s=r.baseNode.one(i.node),o=s.ancestor("li"),u,a,f,l;l=n?!1:_;for(u=0;u<e.length;u++)a=e[u],f=this._createLozenge({name:a.name,email:a.email}),l&&u>=l&&f.addClass("hidden"),o.insert(f,o),r.resizeRTE(),this._checkRecipientCount(),r._setDirty();M&&this._manageHideMoreOptions(t,n),this._showHideCcBccOption(),U(s)}function ft(e,t){return{list:t&&t[e],node:".cm-"+e+"-field",groupNode:".cm-"+e+"-group"}}function lt(t){var n=this,r=n.composeView,i,s,o,u,a,l,c=r.type==="inlineCompose"?r.baseNode.one(".thread-recipients"):null,h="",p=[],v=["to","cc","bcc"],m=function(e){var t={to:f.getName(e),email:f.getAddress(e)};return t},g;for(s in v)l=v[s],a=ft(l,t),u=a.list,u&&(o=a.node,c&&o!==".cm-bcc-field"&&(p=p.concat(u)),n._createAddressList(u,l));c&&(h=f.createRecipientList(p,d._shared_module_thread_thread_display_rollup.recipients1,null,null,m),c.setContent(h));if(t.cc&&t.cc.length!==0||t.bcc&&t.bcc.length!==0)n._bccSwitch(!0,!1,"cc"),n._bccSwitch(!0,!1,"bcc");if(r.type==="fullCompose"){t.from&&t.from.email&&n._setFromMenu(t.from);if(t.subject){r.baseNode.one(".cm-subject-field").set("value",t.subject);var y=e.UA.ie>0&&e.UA.ie<10,b=y&&r.baseNode.one(".IEplaceholder");y&&b&&b.addClass("hidden"),r._setDirty()}}n.checkOtherLozengeBoxes()}function ct(e){var t=this,n=t.composeView.baseNode.all("div.ac-input input"),r=t.composeView.baseNode.all("div.subject input");e?(n.removeAttribute("readOnly"),r.removeAttribute("readOnly")):(n.setAttribute("readOnly",!0),r.setAttribute("readOnly",!0))}function ht(e){!H||!e?H.changeSelection(s.get("userSendPref.defaultID")):H.changeSelection(e.email),this._buildFromMenu()}function pt(t,n){var r=this,i=t.result.value.filters,o=i.length,u,a,f,l,c,h,p,d;if(o===0){d=s.get("userSendPref.defaultFromAddress");for(h=0;h<length;h++)if(d===n[h].email){r._setFromMenu(d);break}}else{a=e.one("#storm-listnav li.selected i"),u=a?a.get("text"):null;if(u)for(h=0;h<o;h++)if(i[h].actions[0].value.folderActionValueBean.folder.name===u){c=i[h].criterions,l=c.length;for(p=0;p<l;p++){f=c[p];if(f.field==="TO"&&dt(f.value,n)){r._setFromMenu(f.value);return}}}}}function dt(e,t){var n=t.length,r;for(r=0;r<n;r++)if(t[r].addr===e||t[r].email===e)return!0;return!1}function vt(t,n,r){var i=this,s=t?t:[],o,a,f,l,c;n&&(s=t.concat(n));if(!s||s.length===0)return;H||(H=e.mail.Controller.mailComposeFromListHelper.getInstance()),o=H.getFromList();if(s.length===1&&dt(s[0].email,o)){i._setFromMenu(s[0]);return}if(!dt(r,s)){i._setFromMenu();return}dt(r,o)?(l={email:r},i._setFromMenu(l)):(a=i.getMatchedAddresses(s,o),f=a.length,f===0?i._setFromMenu():f===1?i._setFromMenu(a[0]):NeoConfig.imapIn?u?i._setFromMenu(u.getCurrentAccount()):e.use("mail-controller-filters-v3",function(e){c=e.mail.Controller.FiltersV3Controller.listFilters({suppressNotification:!0,suppressStat:!1}),c.then(function(t){i._processFiltersForReplyFrom(t,a)},function(t){i._setFromMenu(a[0])})}):i._setFromMenu(a[0]))}function mt(e,t){var n=e.length,r=t.length,i=[],s,o,u;for(s=0;s<n;s++){u=e[s];for(o=0;o<r;o++)if(u.email===t[o].addr){i.push(u);break}}return i}function gt(e,t){var n=this,r,i,s=(e.isRTL?"rtl":!1)||(strings.str_tog_loadRTLCss?"rtl":"ltr"),o,u;return NeoConfig.bidi?(o=(s==="rtl"?"\u202b":"\u202a")+e.name+"\u202c",u=(s==="rtl"?"\u202b":"\u202a")+"\u200e&lt;"+e.addr+"&gt;\u200e\u202c",i=c(o)+" "+u):i=c(e.name,p)+" &lt;"+e.addr+"&gt;",r=l(m,{isDefault:t,address:i},n.composeView.formatters,null,strings),r}function yt(){var t=this,n=t.composeView.baseNode.one(".from-select"),r=t.composeView.draft,i=r&&r.folder.acctId,s=[],o,u,a,f,l,c,h,p,d;H||(H=e.mail.Controller.mailComposeFromListHelper.getInstance()),h=H.getFromList(i),a=h.length,p=H.getSelectedIndex(i);for(f=0;f<a;f++)l=h[f],c=t._buildOptionMarkup(l,f===p),s.push(c);n.purge(!0,"change"),n.setContent(s.join("")),H.getVisible()?t.composeView.baseNode.one("div.account-select").removeClass(w):t.composeView.baseNode.one("div.account-select").addClass(w),o=t.composeView.baseNode.one(".from-selector"),u=o.one("#from-field"),a===1?(u.set(E,!0),o.addClass("disable-select-chevron")):(u.set(E,!1),o.removeClass("disable-select-chevron")),n.on("change",function(){t.composeView._setDirty()})}function bt(){var e=this,t=v.show_full_header,n=l(t,e.draft,e.composeView.formatters,null,strings,d);e.hdr=e.composeView.baseNode.one(".compose-header"),e.hdr.setContent(n),e._bindUIHeader(),e._buildFromMenu()}function wt(e,t){var n=this,r;t=t||!1,r=t?1:0,n._bccSwitch(r,!1,"cc")}function Et(e){var t,n=-1;return typeof e.get("selectionEnd")=="number"?n=e.get("selectionEnd"):document.selection&&document.selection
.createRange&&(t=document.selection.createRange(),t.moveStart("character",-e.get("value").length),n=t.text.length),n}function St(t,n){n=n||"bcc";var r=this,i=r.composeView.baseNode,s=i.one(".cm-"+n+".ac-input").all(".hLozenge"),o=i.one(".cm-"+n+"-field");t||s.isEmpty()&&o.get("value").length===0?r._bccSwitch(t,!0,n):(e.fire("util:ymstats",{name:"compose_hdr_close_confirm_"+n}),e.fire("mt:click",{action:"compose_hdr_close_confirm_"+n}),r.composeView.confirm(null,strings["str_comp_conf_"+n],function(){s.each(function(e){e.remove(),r.composeView._setDirty()}),o.set("value",""),r._bccSwitch(!1,!0,n)}))}function xt(t,n,r){r=r||"bcc";var i=this,s=i.composeView.baseNode.all(".cm-btn-show-"+r),o=i.composeView.baseNode.one(".cm-"+r+"-group");typeof n=="undefined"&&(n=!0),t?(o.removeClass(w),s.addClass(w),n&&i.composeView.setFocus(r)):(o.addClass(w),s.removeClass(w),n&&i.composeView.setFocus(r));var u=i.composeView.baseNode.one(".cm-bcc-group"),a=i.composeView.baseNode.one(".cm-cc-group"),f=i.composeView.baseNode.one(".btn-bcc-in-cc");u.hasClass(w)&&(t?f.removeClass(w):a.hasClass(w)?f.addClass(w):f.removeClass(w)),i._reposAttachObj(C),i.composeView.resizeRTE(),e.fire("recalculateScrollToRepositionSend")}function Tt(t){var n={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},r=this,i=y.ui.ACWidget,s=t.get("id");if(s&&n[s]){t.removeClass("whiteout");var o=r.composeView.baseNode.one(n[s]),u=function(){r.listeners.push(e.ACWidgetInst.get("ac").on("ac:query",function(t){var n=this,r=t.value,i,s;if(b.areContactsLoaded()){var o=new e.comms.FilterContacts;o.updateFilterItems(r),i=o.fastMatch(),i.queryStr=r,s=e.bind(n.reload,n,i),s(i)}}))};e.ACWidgetInst?e.ACWidgetInst.get("ac").get("alignNode")!==o&&(e.ACWidgetInst.get("ac").destructor(),e.ACWidgetInst.refresh({acNode:o,acTarget:t,width:o.getStyle("width"),selectFirst:!0}).setAlign().render(),u(),r._setACWidgetARIAOwns()):(r.offscreenContent&&r.offscreenContent.remove(),r.offscreenContent=e.Node.create(l(d._shared_module_offscreen_bin_compose.base,{},null,null,strings,d)),e.one(document.body).append(r.offscreenContent),e.ACWidgetInst=(new i({acNode:o,acTarget:t,contentBox:"#ac-to-results",selectFirst:!0})).setAlign().render(),r._setACWidgetARIAOwns(),e.ACWidgetInst.after("visibleChange",function(t){var n=this.get("ac").get("host"),r=e.ACWidgetInst.get("contentBox").one("li"),i=t.newVal&&r?!0:!1;n.set("aria-expanded",i),i||n.set("aria-activedescendant","")}),e.ACWidgetInst.after("selectedIndexChange",function(e){var t="";e.newVal>-1&&(t=this.get("contentBox").one(".yui3-acwidget-selected").generateID()),this.get("ac").get("host").set("aria-activedescendant",t)}),u())}}function Nt(){var e=this,t=e.listeners;if(t){var n=t.length,r;for(r=0;r<n;r++)t[r]&&t[r].detach();t.length=0}e.lozengeDD&&e.lozengeDD.destroy(!0),e.hdr&&(e.hdr.detachAll(),e.hdr.remove()),B.superclass.ondestroy.call(e,arguments)}function Ct(e){var t=this,n=e.target,r=n.ancestor("div.ac-input",!1),i;if(r){i=r.get("id"),t.composeView.focusNode=i,r.addClass(x),r.get("parentNode").addClass("active");if(r.one(".hLozenge.group")){t._manageHideMoreOptions(i,!0);return}}if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))t.composeView._registerFocus(n),a.features.enabled("autosuggest")||t._initAutoComplete(n),t.checkOtherLozengeBoxes()}function kt(t){e.one("div.ac-results:hover")||e.one("div.ac-results li.over")||e.one("li.yui3-aclist-item-hover")||(F(),this._lozengeIt(t),e.ACWidgetInst&&e.ACWidgetInst.get("ac").set("queryValue",""))}function Lt(e){var t=this,n=e.target,r=t.composeView.draft;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))e.preventDefault(),this.handleACBlur(n);else if(n.get("id")==="subject-field"){var i=n.get("value");i&&i!==""&&r.subject&&typeof r.subject!="undefined"&&r.subject!==i&&t.composeView._setDirty()}}function At(e,t){var n=this,r=e.target,i=e.keyCode,s,o,u=r.ancestor("div"),a=u.one(".hLozenge.focus"),f=r.get("value"),l,c,h=r.get("id");if(h){s={"to-field":t.one("#to_add_contacts"),cc_show_btn_in_to:"to",cc_hide_btn:"cc","cc-field":t.one("#cc_add_contacts"),"bcc-field":t.one("#bcc_add_contacts"),bcc_show_btn_in_cc:t.one("#cc_hide_btn"),bcc_hide_btn:"bcc"},o={"to-field":t.one("#cc_show_btn_in_to"),to_add_contacts:"to",cc_add_contacts:"cc",cc_hide_btn:t.one("#bcc_show_btn_in_cc"),bcc_add_contacts:"bcc",cc_show_btn_in_to:t.one("#bcc_show_btn_in_to"),"cc-field":t.one("#cc_hide_btn"),"bcc-field":t.one("#bcc_hide_btn")};if(i===39)if(r.get("nodeName")==="A"||!f&&!a||f&&Et(r)===f.length){l=o[h];if(l){n.composeView.setFocus(l);if(l==="to"||l==="cc"||l==="bcc"){var p=t.one("#"+l);c=p.one(".hLozenge"),c&&(n._selectSingleLozenge(c,p),p.addClass("whiteout"))}return}}}if(!r.get("value")){e.preventDefault();var d;if(a)i===37?(d=a.previous(),d||(s[h]&&n.composeView.setFocus(s[h]),n._removeLozengeHighlights(),r.removeClass("whiteout"))):(d=a.next(),d.hasClass("hLozenge")||(d=null,n._removeLozengeHighlights(),r.removeClass("whiteout"))),d&&(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r));else if(i===37){var v=r.ancestor();d=v.previous(),d&&d.hasClass("hLozenge")?(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r),r.addClass("whiteout")):s[h]&&n.composeView.setFocus(s[h])}}}function Ot(t){var n=this,r=t.keyCode,i=t.target;if(!i.get("value")){var s=i.ancestor(),o=i.ancestor(".ac-input"),u=o.all(".hLozenge.focus"),a=u.size();t.halt();if(n.allLozengesSelected){n.removeAllLozenges(i),i.removeClass("whiteout");return}var f,l;a?(n.removeARIAFocus(i),n.removeARIADescription(i),a===1?(f=u.item(0),l=f.next(),l===s&&(l=f.previous()),l?n._selectSingleLozenge(l,i):i.removeClass("whiteout")):i.removeClass("whiteout"),n.composeView._setDirty(),u.detachAll(),u.remove(),u=null,e.fire("lozenge:remove"),M&&n._toggleHideRecptsBtn(o.get("id"))):r===8&&(l=s.previous(),l&&(n._removeLozengeHighlights(),n._selectSingleLozenge(l,i),i.addClass("whiteout"))),n.checkOtherLozengeBoxes(),n.composeView.resizeRTE()}}function Mt(
){var e=this,t=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge").size(),n=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge").size(),r=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge").size(),i=0;return i=t+n+r,e.totalLozenges=i,i}function _t(){var e=this,t=e.lozengeCount();t<=0?e.composeView._showSendBtn(!1):e.composeView._showSendBtn(!0)}function Dt(){var t=e.ACWidgetInst;return t&&t.canHandleEnter?t.canHandleEnter():t&&t.isVisible()&&(t.get("data").length>0||NeoConfig.isCorpmail&&t.get("gabData").length>0)}function Pt(t,n){var r=this,i=e.ACWidgetInst,s=t.decodeCategory(n.get("value")),o=function(e,t,n,r,i){switch(t){case"amp":if(n)return o(e,n,"",r+5,i);return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return""}};if(s){var u,a=[];for(u in s){var f=s[u];if(f){var l="",h=f.firstname&&c(f.firstname),p=f.middlename&&c(f.middlename),d=f.lastname&&c(f.lastname),v=f.nickname&&c(f.nickname);l=i&&i.buildName(h,p,d,v),l=l+"("+f.email+")",a.push(l.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,o))}}r._makeLozenges(a,n.ancestor()),r.addARIADescription(n),n.set("value","")}else r._lozengeIt(n)}function Ht(t){var n=this,i=t.target,s=t.ctrlKey,o=t.metaKey,u=e.ACWidgetInst,a=e.UA.os,f=s&&(a==="linux"||a==="windows"||a==="win")||o&&(a==="macintosh"||a==="mac");if(i.get("nodeName")==="A")return;f&&!t.altKey&&n.composeView.handleComposeAction("send",t);var l=new e.comms.FilterContacts;if(u&&n.canACWidgetInstHandleEnter())u.handleEnter(t,u);else{l.updateFilterItems(i.get("value"));var c=l.fastMatch();if(c&&c.length){var h=c[0],p;u&&(p=r(u.getItemMarkup(h)),p.one("span.ac-remove-item").remove(),i.set("value",p.get("text")))}}t.halt();if(!i.get("value")){t.preventDefault();var d=i.ancestor("div"),v=d.one(".hLozenge.focus");v&&v.getData("lozenge").startEdit();return}n.setACCategory(l,i)}function Bt(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.ACWidgetInst,u,a,f=(u=o&&o.get("data"))&&u.length,l=(a=o&&o.get("gabData"))&&a.length;if(i||s||!r.get("value"))return;if(f>=2||l>=2)return;f===1||l===1?(t.halt(),o&&o.isVisible()&&r.simulate("keydown",{keyCode:13})):(t.halt(),n._lozengeIt(r))}function jt(e){var t=this,n=e.target,r=e.ctrlKey,i=e.metaKey;if(!r&&!i||n.get("value"))return;e.halt(),t._selectAllLozenges(n),n.addClass("whiteout")}function Ft(t){var n=this,r,i=t.target,s=t.ctrlKey,o=t.metaKey,u=t.altKey,a=e.ACWidgetInst,f=(r=a&&a.get("data"))&&r.length;if(!i.get("value")){if(!a)return;if(a.hasItemSelected){if(!a.hasItemSelected())return}else if(!a.isVisible())return}!s&&!o&&!u&&(f>=1&&t.halt(),n.composeView.keepHdrFocus=!0,i.simulate("keydown",{keyCode:13}))}function It(n){function u(){var e=r.hdr,n=t.ui.MessagePaneUtils,i="";e.all("li.focus").each(function(e){i+=e.one("input").get("value"),i+="; "}),i!==""&&(i=i.substring(0,i.length-1),n.initializeCopyText(),n.copyToClipboard(i,null,document.activeElement))}var r=this,i=n.ctrlKey,s=n.metaKey,o=e.UA.os==="macintosh"?s:i;o&&(n.stopPropagation(),u())}function qt(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.UA.os==="macintosh"?s:i,u=t.type==="paste"?!0:!1;(o||u)&&setTimeout(function(){n.updateTextField(r,!0)},0)}function Rt(n){var r=this,i=(e.UA.os==="macintosh"?n.metaKey:n.ctrlKey)&&!n.altKey&&!n.shiftKey,s=t.ui.MessagePaneUtils,o="",u;i&&(u=r.hdr.all("li.focus"),u.each(function(e){o+=e.one("input").get("value"),o+="; "}),o!==""&&(e.fire("lozenge:remove"),r.composeView._setDirty(),u.detachAll(),u.remove(),u=null,o=o.substring(0,o.length-1),s.initializeCopyText(),s.copyToClipboard(o,null,document.activeElement)))}function Ut(t){var n=this,r=t.target,i=t.shiftKey,s=t.ctrlKey,o=t.metaKey,u=e.UA.os==="macintosh"?o:s;r.removeClass("whiteout"),!u&&!i&&n._removeLozengeHighlights()}function zt(e){var t=this,n=e.target;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field")){var r=t.composeView.baseNode.one(".ac-input.compose-field-focus .recipient-input input"),i=t.totalLozenges;r===null&&i<=0?t.composeView._showSendBtn(!1):r.getDOMNode().value===""&&i<=0?t.composeView._showSendBtn(!1):t.composeView._showSendBtn(!0)}}function Wt(t){var n=this,r=n.hdr,i=t.keyCode,s=t.shiftKey,o=t.ctrlKey,u=t.metaKey,a=t.altKey,f=e.UA.os==="macintosh"?u:o,l,c=t.target,h=NeoConfig.infinitePane,p=c?c.get("type")?c.get("type").toLowerCase()||"":"":"",d=c?c.get("tagName").toLowerCase():"",v=function(){return c.ancestor("div.cm-to ul,.cm-cc ul,div.cm-bcc ul")},m;e.fire("HoverCard:hideHoverCard"),!p||p!=="text"&&p!=="textarea"?d&&(d==="input"||d==="textarea")&&t.stopPropagation():t.stopPropagation(),c.hasClass("cm-from-field")&&h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation(),!(s&&o&&u&&a)&&(i===188||i===186)&&c.hasClass("lozenge-edit")&&v()&&(m=v().one("li.recipient-input input"),m?m.focus():c.blur());if(c.hasClass("cm-subject-field")||c.hasClass("cm-to-field")||c.hasClass("cm-cc-field")||c.hasClass("cm-bcc-field")||c.get("nodeName")==="A"){h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation();if((i===83||i===89&&s||i===85&&s)&&(o||u)||i===27){n.composeView.get("keydownHandler")?n.composeView.get("keydownHandler")(t):n.composeView.onKeyDown(t);return}if(c.hasClass("cm-subject-field")){l=(o||u)&&!a&&!s||i===9,(!l||f&&i===86)&&n.composeView._setDirty(),i===9&&!s&&(c.blur(),n.composeView.setFocus("body"),t.halt()),i===13&&f&&!t.altKey&&(n.composeView.handleComposeAction("send",t),t.halt());return}switch(i){case 37:case 39:n.handleLeftRightArrow(t,r);break;case 8:case 46:n.handleDelete(t);break;case 13:n.handleEnter(t);break;case 32:n.handleSpacebar(t);break;case 65:n.handleSelectAll(t);break;case 38:break;case 9:n.handleTab(t);break;case 67:n.handleCopy(t,r);break;case 86:n.handlePaste(t);break;case 88:n.handleCut(t,r);break;default:n.handleDefaultKeydown(t)}}}function Xt(){var e=this,t=e.hdr,n=e.listeners;n.push(t.on("blur",e.setInputBlur,e)),n.push(t.on("keydown",e.keyHandler,e)),n.push(t.on("keyup",e.sendEnableKeyHandle
,e)),n.push(t.one("#subject-field").on("keyup",function(){e.composeView._setDirty()})),n.push(t.on("change",function(t){var n=t.target;(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))&&e.composeView._setDirty()}))}function Vt(t){var n=this,r=t.dataAction;switch(r){case"reply_all":case"reply_sender":case"forward":n.switchReplyMode(t.dataAction),e.fire("mt:click",{action:"reply_card_menu_"+r});break;case"edit_subject":n.allowSubjectEdit(!0)}}function $t(t){var n=this,r=n.composeView.draft.origin,i=e.common.ui.MenuHelper,s=t.target;e.use("mail-ui-inboxmenu-base","_shared_module_offscreen_bin_menus_reply_modes",function(e){e.mail.ui.InboxMenu.insert("menu-reply-modes",function(){var r=e.one("#menu-reply-modes");i.create(s,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY]},function(){r.on("menuSelected",n.onReplyModeSelected,n),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(s.removeClass("pressed"),s.unplug(e.Plugin.Menu),this.destroy(!0))})})},r.fid,{origin:r,isQuickReply:n.composeView.get("isQuickReply")})})}function Jt(){var t=this,n,r,i,s;t.listeners.push(t.hdr.delegate("click",function(r){var i=a.getDataAction(r).action;switch(i){case"menu":t.loadReplyModeMenu(r),e.fire("mt:click",{action:"reply_card_"+i});break;case"qr-cancel":t.neoFire("qrCancel"),e.fire("mt:click",{action:"reply_card_"+i});break;case"expand-recpts":s=r.target.ancestor(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!0);break;case"hide-recpts":s=r.target.ancestor(".field").one(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!1)}},".compose-header"))}function Kt(){var t=this,r=t.composeView.baseNode,i=r.one("input.cm-subject-field"),s=r.one("input.cm-to-field"),o=r.one("input.cm-cc-field"),u=r.one("input.cm-bcc-field"),a=e.UA.ie>0&&e.UA.ie<10,f=a&&r.one(".IEplaceholder"),l=t.hdr;NeoConfig.bidi&&i.plug(e.Plugin.BidiTextEntry),t._bindAutoComplete(),t.listeners.push(t.hdr.delegate("paste",qt,"#to-field, #cc-field, #bcc-field",t)),t.listeners.push(e.on("lozenge:highlight",function(){t.isLozengeHighlighted=!0})),NeoConfig.useDD&&t.composeView.type==="fullCompose"&&e.use("common-ui-lozengeDD",function(e){e.Lang.later(0,0,function(){t.lozengeDD=new e.common.ui.lozengeDD({composeView:t.composeView,dragSelector:".draggable"})})}),t.listeners.push(l.on("focus",Ct,t)),t.listeners.push(i.after("focus",function(){t.composeView._registerFocus(i),a&&f.addClass("hidden")})),t.listeners.push(i.on("change",function(){a&&f.addClass("hidden")})),t.listeners.push(s.after("blur",function(){s.ancestor("div").removeClass(x),t.composeView.resizeRTE()})),t.listeners.push(o.after("blur",function(){o.ancestor("div").removeClass(x),t.composeView.resizeRTE()})),t.listeners.push(u.after("blur",function(){u.ancestor("div").removeClass(x),t.composeView.resizeRTE()})),t.listeners.push(i.after("blur",function(n){t.neoFire("updateSubject"),a&&e.Lang.trim(n.target.get("value"))===""&&f.removeClass("hidden")})),t.listeners.push(l.delegate("click",function(n){n.halt(),t._reposAttachObj(T);var r={to_add_contacts:".cm-to",cc_add_contacts:".cm-cc",bcc_add_contacts:".cm-bcc"},i=function(e,n){var i,s,o,u=n.get("id"),a=t.composeView.baseNode.one(r[u]),f=a.all("li"),l=f.item(f.size()-1);for(i in e)s={name:e[i].name,email:h(e[i].field.value)},o=t._createLozenge(s),t.composeView._setDirty(),l.insert(o,l),t.composeView.resizeRTE(),t._checkRecipientCount();M&&t._toggleHideRecptsBtn(a.get("id")),t._reposAttachObj(N),t.composeView._restoreFocus()},s=n.currentTarget.get("id"),o="addrec";s=s||"bcc_add_contacts",e.fire("ws:onboarding",{module:"contact_picker",onDone:i,target:n.currentTarget,field:s.slice(0,s.indexOf("_"))}),s==="to_add_contacts"?o="addrec":s==="cc_add_contacts"&&(o="addcc"),e.fire("mt:click",{action:"cmps_"+o,append:{t1:"cmpsTb"}})},".choose-contact")),t.listeners.push(l.delegate("click",function(e){var n=e.target,r=e.currentTarget,i=r.getElementsByTagName("INPUT"),s=i.item(i.size()-1),o;if(n.hasClass("lozenge-edit"))return;o=r.get("scrollTop"),n.hasClass("compose-hide-recpts")||n.hasClass("more_recp")?s===t.composeView.focusNode?t.composeView.setFocus(t.composeView.editor.getRTE()):t.composeView._restoreFocus():s.focus(),n.hasClass("lozenge-static")||n.hasClass("lozenge-edit")?(r.set("scrollTop",o),s.addClass("whiteout")):(s.removeClass("whiteout"),t._removeLozengeHighlights(),r.set("scrollTop",r.get("scrollHeight")))},"div.ac-input")),t.listeners.push(l.on("keyup",function(e){var r=e.target,i=r.get("value"),s=i.length,o=i[s-1];if(!(r.hasClass("cm-to-field")||r.hasClass("cm-cc-field")||r.hasClass("cm-bcc-field")))return;s>0&&t.composeView._setDirty();if(o===";"||o===","){e.halt(),i=n(i);if(i.length===1){r.set("value","");return}if(!i)return;t._lozengeIt(r)}t.updateTextField(r),t._reposAttachObj(C)}))}function Qt(e,t){var n=e.action===k;n?(t.removeClass("ico-thread-reply"),t.addClass("ico-thread-reply-all")):(t.removeClass("ico-thread-reply-all"),t.addClass("ico-thread-reply"))}function Gt(t){t=t||0;var n=this,r=n.composeView.draft.origin,s=n.composeView.baseNode,o=s.all(".replyall-toggle-btn a"),u,a,f=s.one(".qr-card-actions");t||(t=r.action===L?k:L),r.action=t,f&&f.replace(l(d._shared_module_compose_quick_reply_card_actions.base,{reply_type:O[t]},null,null,strings)),t===L?(o.set("text",strings.str_comp_btn_reply_all),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplysndr",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===k?(o.set("text",strings.str_comp_btn_reply_sender),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplyall",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===A&&(!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_fwd",append:{t1:"cmpsTb"}}),n.allowSubjectEdit(!1),i.excludeAttachment(n.composeView.draft),i.includeAttachment
(n.composeView.draft,{fetchGDM:!0}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane"))),n.composeView.type==="inlineCompose"&&Qt(r,o),a=i.getHeaderContent(r),u=s.one(".cm-subject-field"),u&&(a.subject=u.get("value"));var c=s.one(".cm-to-field"),h=s.one(".cm-cc-field");n.removeAllLozenges(c),n.removeAllLozenges(h),n.setHeader(a),n.composeView._restoreFocus()}function Yt(){var e=this,t=e.hdr,n,r,i=e.composeView.draft.origin,s=i&&i.oMsg&&i.oMsg.header,o=i&&i.oMsg&&i.oMsg.body,u=s&&(s.to?s.to.length:0)+(s.cc?s.cc.length:0)||0,a=i.action,f,l,c,h=e.composeView.baseNode,p=h.all(".replyall-toggle-btn"),d,v={},m,y,b=1,w;i.fid==="Sent"&&a===L&&(i.action=k);if(a!==k&&a!==L||!o||!u)return;if(s.replyto){w=s.replyto.length;for(d=0;d<w;d++)v[s.replyto[d].email]=1}m=s.to.concat(s.cc),f=g()||{},w=m.length;for(d=0;d<w;d++){l=m[d].email||"";if(y&&l!==y||w===1&&!(l in f||l in v))b=0;y=l,(l in f||l in v)&&!c?c=0:c=1}if(a&&c&&!b&&h.one(".replyall-toggle-btn")&&i.fid!=="Sent"){p.removeClass("hidden"),n=t.one("#to"),r=t.one(".address-btns");if(r&&n.getX()+n.get("clientWidth")+r.get("clientWidth")+20>t.get("clientWidth")+t.getX()){p.addClass("hidden");return}e.composeView.type==="inlineCompose"&&Qt(i,h.all(".replyall-toggle-btn a")),e.listeners.push(h.delegate("click",function(){e.switchReplyMode()},".address-btns .replyall-toggle-btn a",e))}}function Zt(e){var t=this.hdr.one(".subject");t.removeClass("hidden"),e&&setTimeout(function(){t.one("input").focus()},0)}var t=e.mail,n=e.Lang.trim,r=e.Node.create,i=e.mail.Controller.ReplyProcessor,s=e.common.persist.UserData,o=t.persist.MetaData,u=t.model.DataStore.Accounts,a=e.common.Utils,f=t.ui.PaneUtils,l=a.substitute,c=a.escapeHtml,h=a.unescapeHtml,p=strings.str_cfg_tog_unescape_ncr,d=e.ui.Templates,v=d._shared_module_compose_message_header_fresh,m=v&&v.compose_from_address,g=e.mail.Controller.mailComposeFromListHelper.getAllAccountEmails,y=e.contacts,b=y.utils,w="hidden",E="disabled",S="focus",x="compose-field-focus",T="offscreen",N="restore",C="move",k="reply_all",L="reply_sender",A="forward",O={reply_sender:strings.str_reply,reply_all:strings.str_reply,forward:strings.str_forward},M=a.features.enabled("showHideComposeRecipients"),_=a.settings.value("recipientThresholdVal"),D=_+1,P={},H,B=function(e,t){var n=this;n.isLozengeHighlighted=!1,n.allLozengesSelected=!1,n.composeView=t,n.offscreenContent=null,n.listeners=[],B.superclass.constructor.apply(n,arguments),n.neoEvent("updateSubject",{emitFacade:!0,broadcast:1}),n.neoEvent("qrCancel",{emitFacade:!0,broadcast:1})};e.extend(B,t.ui.BaseWidget),e.mix(B.prototype,{NAME:"HeaderBase",render:bt,getHeader:rt,setHeader:lt,enableHeader:ct,allowEditing:wt,_bindUIHeader:Kt,bind:Jt,loadReplyModeMenu:$t,setInputFocus:Ct,setInputBlur:Lt,keyHandler:Wt,lozengeCount:Mt,sendEnableKeyHandle:zt,handleACBlur:kt,handleLeftRightArrow:At,handleDelete:Ot,handleEnter:Ht,handleSpacebar:Bt,handleTab:Ft,handleSelectAll:jt,handleCopy:It,handlePaste:qt,handleCut:Rt,handleDefaultKeydown:Ut,setACCategory:Pt,canACWidgetInstHandleEnter:Dt,checkOtherLozengeBoxes:_t,_bindAutoComplete:Xt,ondestroy:Nt,destroy:Nt,hideACWidget:F,_cmdBccSwitch:St,_reposAttachObj:j,_setFromMenu:ht,removeAllLozenges:$,_removeLozengeHighlights:J,_createLozenge:tt,enableSwitchReplyButton:Yt,switchReplyMode:Gt,_lozengeIt:G,_manageHideMoreOptions:ut,_createAddressList:at,_toggleHideRecptsBtn:ot,_showHideCcBccOption:st,_checkRecipientCount:Y,_makeLozenges:Z,_selectSingleLozenge:K,_selectAllLozenges:Q,_tokenizeAddresses:V,removeARIAFocus:I,_setACWidgetARIAOwns:R,removeARIADescription:q,addARIADescription:U,updateTextField:W,_buildOptionMarkup:gt,_buildFromMenu:yt,createAddress:X,_initAutoComplete:Tt,_processFiltersForReplyFrom:pt,addressInList:dt,_bccSwitch:xt,_getRecptList:it,getCursorLocation:Et,onReplyModeSelected:Vt,setReplyFrom:vt,getMatchedAddresses:mt,allowSubjectEdit:Zt,_ccSwitch:function(){}},!0),e.namespace("mail.Views").ComposeHeader=B},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-reply-processor","_shared_module_offscreen_bin_notification_notifications","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header_fresh","mail-models-validators-send","mail-ui-basewidget","mail-common-utils-features","mail-ui-mailcompose-header-form-list-helper","mail-model-datastore","mail-common-utils-settings","mail-ui-pane-utils"]});
