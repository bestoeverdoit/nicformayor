YUI.add("autosuggest-tictac-stats",function(a){"use strict";function b(b,c){var d=this,e="autosuggest:";if(!c||!a.Lang.isFunction(c.stat))throw new Error("Invalid Tictac Base Stat object provided");if(!(b&&b instanceof YUI))throw new Error("YUI instance not provided for stats");d.StatObj=c,d.statHandlers=[b.on(e+"select",a.bind(d._onSelection,d)),b.on(e+"serverdata",a.bind(d._onServerDataReceived,d)),b.on(e+"cachecheck",a.bind(d._onCacheCheck,d)),b.on(e+"error",a.bind(d._onError,d)),b.on(e+"socialfooterclick",a.bind(d._onSocialFooterClick,d)),b.on(e+"socialfooterhide",a.bind(d._onSocialHideClick,d)),b.on(e+"socialfootershow",a.bind(d._onSocialFooterShow,d)),b.on(e+"hideendpoint",a.bind(d._onHideEndpoint,d)),b.on(e+"unhideendpoint",a.bind(d._onUnhideEndpoint,d)),b.on(e+"hiderelatedcontacts",a.bind(d._onHideRelatedContacts,d)),b.on(e+"searchperformance",a.bind(d._onPerformanceRequest,d)),b.on(e+"searchretries",a.bind(d._onRetriesFinished,d)),b.on(e+"prefetchdata",a.bind(d._onPrefetchDataReceived,d))]}function c(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)&&a>=0}var d=b.prototype;d._isValidTimeStat=function(a,b){return c(a)&&a>0&&("s"===b&&1e3>a||"ms"===b&&1e6>a)},d._onSelection=function(a){if(a){a.inputMethod||(a.inputMethod="invalid_value");var b=this;a.searchText=a.searchText||"",c(a.selectionIndex)&&b.StatObj.stat("selection",{index:a.selectionIndex,inputLength:a.searchText.length,source:a.resultSource}),b._isValidTimeStat(a.timeToSelect,"s")&&b.StatObj.stat("selectionLatency",{inputMethod:a.inputMethod},{type:"duration",unit:"s",datum:a.timeToSelect}),b._isValidTimeStat(a.end2endTime,"s")&&b.StatObj.stat("inputToSelectionTime",{inputMethod:a.inputMethod},{type:"duration",unit:"s",datum:a.end2endTime})}},d._onPrefetchDataReceived=function(a){a&&c(a.limit)&&c(a.recipients)&&c(a.totalResults)&&this.StatObj.stat("prefetchResultInfo",{resLimit:a.limit,recipients:a.recipients,totalResults:a.totalResults})},d._onServerDataReceived=function(a){if(a){"boolean"==typeof a.doRender&&this.StatObj.stat("doRender",{status:a.doRender}),c(a.recipients)&&c(a.queryLength)&&c(a.totalResults)&&this.StatObj.stat("responseInfo",{recipients:a.recipients,queryLength:a.queryLength,totalResults:a.totalResults});var b=a.xTiming,d="string"==typeof b&&b.match(/pachinko: *(\d+)/);b=d&&d.length>1?parseInt(d[1],10):null,c(b)&&this.StatObj.stat("xTiming",{},{type:"duration",unit:"ms",datum:b})}},d._onCacheCheck=function(a){a&&"boolean"==typeof a.hit&&this.StatObj.stat("cache",{hit:a.hit})},d._onError=function(a){a&&"string"==typeof a.msg&&this.StatObj.stat("error",{status:a.msg.replace(/\s+/g,"_").substr(0,200)})},d._onSocialFooterClick=function(a){a&&a.provider&&(this.StatObj.stat("socialFooterClick",a),this.StatObj.stat(a.provider+"_footer_click",{reconnect:a.reconnect}))},d._onSocialHideClick=function(a){a&&a.provider&&this.StatObj.stat("socialFooterHide",a)},d._onSocialFooterShow=function(a){a&&a.provider&&(this.StatObj.stat("socialFooterShow",a),this.StatObj.stat(a.provider+"_footer_view",{reconnect:a.reconnect}))},d._onHideEndpoint=function(){this.StatObj.stat("hideEndpoint")},d._onUnhideEndpoint=function(){this.StatObj.stat("unhideEndpoint")},d._onHideRelatedContacts=function(a){this.StatObj.stat("hideRelatedContacts",{duration:a})},d._onRetriesFinished=function(a){a&&c(a.retries)&&this.StatObj.stat("retries",{totalRetries:a.retries})},d._onPerformanceRequest=function(a){if(a&&a.entry&&a.baseURL&&this._isValidTimeStat(a.entry.duration,"ms")){var b=["startTime","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","duration"],c={};b.forEach(function(b){c[b]=a.entry[b]}),c.queryLatency=a.queryLatency,c.xTiming=a.fullxTiming,c.baseURL=a.baseURL,yui.fire("SplunkLog","autosuggest_searchPerformance",c,"sample")}},d.detachListeners=function(){var a,b=this;for(a=0;a<b.statHandlers.length;a++)b.statHandlers[a].detach();b.statHandlers.length=0,b.StatObj=null},a.namespace("autosuggest.tictac").Stats=b},"0.0.1",{requires:["event-base"]});